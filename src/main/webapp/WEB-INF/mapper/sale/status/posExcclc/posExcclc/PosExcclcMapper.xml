<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.sale.status.posExcclc.posExcclc.service.impl.PosExcclcMapper">

	<!-- POS정산내역 - 리스트 조회 -->
    <!--
        TABLE    : TB_SL_DAILY_POS_PROD, TB_SL_DAILY_POS, TB_MS_POS
        PARAM    : posExcclcVO
        COMMENTS : POS정산내역 - 리스트를 조회한다.
    -->
    <select id="getPosExcclcList" parameterType="posExcclcVO" resultType="DefaultMap">
    	<include refid="CmmSQL.PagingTemplateHeader"/>
		SELECT	TPE.HQ_OFFICE_CD
				, TPE.HQ_BRAND_CD
				, TPE.STORE_CD
				, TO_CHAR(TO_DATE(TPE.SALE_DATE,'YYYYMMDD'),'YYYY-MM-DD') AS SALE_DATE
				, TPE.POS_NO
				, TPE.REG_SEQ
				, TPE.CLOSE_FG_SEQ
				, TPE.CLOSE_FG_NM
				, TO_CHAR(TO_DATE(TPE.REG_DT,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') AS REG_DT
				, NVL(SUM(TPES.TOT_SALE_AMT),0)  AS TOT_SALE_AMT
				, NVL(SUM(TPES.TOT_DC_AMT),0)    AS TOT_DC_AMT
				, NVL(SUM(TPES.REAL_SALE_AMT),0) AS REAL_SALE_AMT
				, NVL(SUM(TPEF.FUND_AMT),0)  	  AS FUND_AMT
				, NVL(SUM(TPEC.CASH_EXACT_AMT),0)AS CASH_EXACT_AMT
				, SUM(DECODE(TPEI.ACCNT_FG,'1',TPEI.ACCNT_AMT, 0)) AS ACCNT_IN_AMT
				, SUM(DECODE(TPEI.ACCNT_FG,'2',TPEI.ACCNT_AMT, 0)) AS ACCNT_OUT_AMT
				, NVL(SUM(TPECT.CASH_TICKET_AMT),0) AS CASH_TICKET_AMT
				, NVL(SUM(TPEL.LOST_AMT),0) AS LOST_AMT
				<include refid="CmmSQL.PagingTemplateCount"/>
		FROM	(
					SELECT	TPE.CLOSE_FG_SEQ
							, DECODE(TPE.CLOSE_FG_SEQ, '1', '개점', '2', '중간마감', '일마감') AS CLOSE_FG_NM
							, TPE.HQ_OFFICE_CD
							, TPE.HQ_BRAND_CD
							, TPE.STORE_CD
							, TPE.SALE_DATE
							, TPE.POS_NO
							, TPE.REG_SEQ
							, TPE.REG_DT
					FROM (
							SELECT	'1'  AS CLOSE_FG_SEQ
									, '1'  AS CLOSE_POS_SEQ
									, TPE.HQ_OFFICE_CD
									, TPE.HQ_BRAND_CD
									, TPE.STORE_CD
									, TPE.SALE_DATE
									, TPE.POS_NO
									, TPE.REG_SEQ
									, TPE.OPEN_DT   AS REG_DT
							FROM	TB_PS_EXACTCALC TPE
							WHERE	TPE.REG_SEQ = '00'
									AND TPE.HQ_OFFICE_CD = #{hqOfficeCd}
								<if test='storeCd != null and storeCd != ""'>
						        	AND TPE.STORE_CD = #{storeCd}
						        </if>
						        <if test='startDate != null and startDate != ""'>
									AND TPE.SALE_DATE >= #{startDate}
								</if>
								<if test='endDate != null and endDate != ""'>
									AND TPE.SALE_DATE <![CDATA[<= ]]> #{endDate}
								</if>
								<if test='closeFg != null and closeFg != "" and closeFg.toString() != "1"'>
									AND 1 = 2
								</if>
							UNION ALL
							SELECT	'2'  AS CLOSE_FG_SEQ
									, '2'  AS CLOSE_POS_SEQ
									, TPE.HQ_OFFICE_CD
									, TPE.HQ_BRAND_CD
									, TPE.STORE_CD
									, TPE.SALE_DATE
									, TPE.POS_NO
									, TPE.REG_SEQ
									, TPE.CLOSE_DT AS REG_DT
							FROM	TB_PS_EXACTCALC TPE
							WHERE	TPE.REG_SEQ >= '01'
									AND TPE.HQ_OFFICE_CD = #{hqOfficeCd}
								<if test='storeCd != null and storeCd != ""'>
						        	AND TPE.STORE_CD = #{storeCd}
						        </if>
						        <if test='startDate != null and startDate != ""'>
									AND TPE.SALE_DATE >= #{startDate}
								</if>
								<if test='endDate != null and endDate != ""'>
									AND TPE.SALE_DATE <![CDATA[<= ]]> #{endDate}
								</if>
								<if test='closeFg != null and closeFg != "" and closeFg.toString() != "2"'>
									AND 1 = 2
								</if>
							UNION ALL

							SELECT	'3'  AS CLOSE_FG_SEQ
									, '3'  AS CLOSE_POS_SEQ
									, TPE.HQ_OFFICE_CD
									, TPE.HQ_BRAND_CD
									, TPE.STORE_CD
									, TPE.SALE_DATE
									, TPE.POS_NO
									, TPE.REG_SEQ
									, TPE.CLOSE_DT AS REG_DT
							FROM	TB_PS_EXACTCALC TPE
							WHERE	TPE.REG_SEQ = '00'
									AND TPE.HQ_OFFICE_CD = #{hqOfficeCd}
								<if test='storeCd != null and storeCd != ""'>
						        	AND TPE.STORE_CD = #{storeCd}
						        </if>
						        <if test='startDate != null and startDate != ""'>
									AND TPE.SALE_DATE >= #{startDate}
								</if>
								<if test='endDate != null and endDate != ""'>
									AND TPE.SALE_DATE <![CDATA[<= ]]> #{endDate}
								</if>
						        <if test='closeFg != null and closeFg != "" and closeFg.toString() != "3"'>
									AND 1 = 2
								</if>

						) TPE
				) TPE
				, TB_PS_EXACTCALC_SALE TPES --매출
				, TB_PS_EXACTCALC_FUND TPEF --준비금
				, TB_PS_EXACTCALC_CASH TPEC --현금
				, TB_PS_EXACTCALC_IOMONEY TPEI --시재
				, TB_PS_EXACTCALC_CASH_TICKET TPECT
				, TB_PS_EXACTCALC_LOST TPEL
		WHERE	TPE.HQ_OFFICE_CD = TPES.HQ_OFFICE_CD(+)
				AND TPE.HQ_BRAND_CD = TPES.HQ_BRAND_CD(+)
				AND TPE.STORE_CD = TPES.STORE_CD(+)
				AND TPE.SALE_DATE = TPES.SALE_DATE(+)
				AND TPE.POS_NO = TPES.POS_NO(+)
				AND TPE.REG_SEQ = TPES.REG_SEQ(+)
				AND TPE.HQ_OFFICE_CD = TPEF.HQ_OFFICE_CD(+)
				AND TPE.HQ_BRAND_CD = TPEF.HQ_BRAND_CD(+)
				AND TPE.STORE_CD = TPEF.STORE_CD(+)
				AND TPE.SALE_DATE = TPEF.SALE_DATE(+)
				AND TPE.POS_NO = TPEF.POS_NO(+)
				AND TPE.REG_SEQ = TPEF.REG_SEQ(+)
				AND TPE.HQ_OFFICE_CD = TPEC.HQ_OFFICE_CD(+)
				AND TPE.HQ_BRAND_CD = TPEC.HQ_BRAND_CD(+)
				AND TPE.STORE_CD = TPEC.STORE_CD(+)
				AND TPE.SALE_DATE = TPEC.SALE_DATE(+)
				AND TPE.POS_NO = TPEC.POS_NO(+)
				AND TPE.REG_SEQ = TPEC.REG_SEQ(+)
				AND TPE.HQ_OFFICE_CD = TPEI.HQ_OFFICE_CD(+)
				AND TPE.HQ_BRAND_CD = TPEI.HQ_BRAND_CD(+)
				AND TPE.STORE_CD = TPEI.STORE_CD(+)
				AND TPE.SALE_DATE = TPEI.SALE_DATE(+)
				AND TPE.POS_NO = TPEI.POS_NO(+)
				AND TPE.REG_SEQ = TPEI.REG_SEQ(+)
				AND TPE.HQ_OFFICE_CD = TPECT.HQ_OFFICE_CD(+)
				AND TPE.HQ_BRAND_CD = TPECT.HQ_BRAND_CD(+)
				AND TPE.STORE_CD = TPECT.STORE_CD(+)
				AND TPE.SALE_DATE = TPECT.SALE_DATE(+)
				AND TPE.POS_NO = TPECT.POS_NO(+)
				AND TPE.REG_SEQ = TPECT.REG_SEQ(+)
				AND TPE.HQ_OFFICE_CD = TPEL.HQ_OFFICE_CD(+)
				AND TPE.HQ_BRAND_CD = TPEL.HQ_BRAND_CD(+)
				AND TPE.STORE_CD = TPEL.STORE_CD(+)
				AND TPE.SALE_DATE = TPEL.SALE_DATE(+)
				AND TPE.POS_NO = TPEL.POS_NO(+)
				AND TPE.REG_SEQ = TPEL.REG_SEQ(+)
		GROUP BY TPE.HQ_OFFICE_CD
				, TPE.HQ_BRAND_CD
				, TPE.STORE_CD
				, TPE.SALE_DATE
				, TPE.POS_NO
				, TPE.REG_SEQ
				, TPE.CLOSE_FG_SEQ
				, TPE.CLOSE_FG_NM
				, TPE.REG_DT
		ORDER BY TPE.SALE_DATE, TPE.CLOSE_FG_SEQ
		 <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <select id="getPosExcclcDetailInfo" parameterType="posExcclcVO" resultType="DefaultMap">
    	SELECT  TPE.STORE_CD
		        , TMS.STORE_NM AS STORE_NM
		        , TO_CHAR(TO_DATE(TPE.SALE_DATE,'YYYYMMDD'),'YYYY-MM-DD') AS SALE_DATE
		        , TPE.POS_NO
		        , #{closeFgNm} AS CLOSE_FG_NM
		        , TO_CHAR(TO_DATE(TPE.OPEN_DT,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') AS OPEN_DT
		        , TO_CHAR(TO_DATE(TPE.CLOSE_DT,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') AS CLOSE_DT
		        , SUM(TPEF.FUND_AMT) AS TOT_FUND_AMT
		        , SUM(TPES.TOT_SALE_AMT) AS TOT_SALE_AMT
		        , SUM(TPES.TOT_DC_AMT) AS TOT_DC_AMT
		        , SUM(TPES.REAL_SALE_AMT) AS REAL_SALE_AMT
		        , SUM(TPES.TOT_BILL_CNT) AS TOT_BILL_CNT
		        , TRUNC(SUM(TPES.TOT_BILL_AMT)/SUM(TPER.TOT_BILL_CNT),2) AS TOT_BILL_TRAN
		        , SUM(TSSH.TOT_GUEST_CNT) AS TOT_GUEST_CNT
		        , TRUNC(SUM(TPER.REAL_SALE_AMT)/SUM(TSSH.TOT_GUEST_CNT),2) AS TOT_GUEST_TRAN
		        , SUM(TPES.TOT_TIP_AMT) AS TOT_TIP_AMT
		        , SUM(TPES.TOT_ETC_AMT) AS TOT_ETC_AMT
		        , SUM(TPES.RTN_BILL_CNT) AS RTN_BILL_CNT
		        , SUM(TPES.RTN_BILL_AMT) AS RTN_BILL_AMT
		        , SUM(DECODE(TPEP.PAY_CD,'01', TPEP.PAY_AMT, 0)) AS PAY_AMT_CARD
		        , SUM(DECODE(TPEP.PAY_CD,'02', TPEP.PAY_AMT, 0)) AS PAY_AMT_CASH
		        , SUM(DECODE(TPEP.PAY_CD,'03', TPEP.PAY_AMT, 0)) AS PAY_AMT_PAYCO
		        , SUM(DECODE(TPEP.PAY_CD,'04', TPEP.PAY_AMT, 0)) AS PAY_AMT_VPOINT
		        , SUM(DECODE(TPEP.PAY_CD,'05', TPEP.PAY_AMT, 0)) AS PAY_AMT_VCOUPN
		        , SUM(DECODE(TPEP.PAY_CD,'06', TPEP.PAY_AMT, 0)) AS PAY_AMT_VCHARGE
		        , SUM(DECODE(TPEP.PAY_CD,'07', TPEP.PAY_AMT, 0)) AS PAY_AMT_MPAY
		        , SUM(DECODE(TPEP.PAY_CD,'08', TPEP.PAY_AMT, 0)) AS PAY_AMT_MCOUPN
		        , SUM(DECODE(TPEP.PAY_CD,'09', TPEP.PAY_AMT, 0)) AS PAY_AMT_MEMBR
		        , SUM(DECODE(TPEP.PAY_CD,'10', TPEP.PAY_AMT, 0)) AS PAY_AMT_PREPAID
		        , SUM(DECODE(TPEP.PAY_CD,'11', TPEP.PAY_AMT, 0)) AS PAY_AMT_POSTPAID
		        , SUM(DECODE(TPEP.PAY_CD,'12', TPEP.PAY_AMT, 0)) AS PAY_AMT_COUPN
		        , SUM(DECODE(TPEP.PAY_CD,'13', TPEP.PAY_AMT, 0)) AS PAY_AMT_GIFT
		        , SUM(DECODE(TPEP.PAY_CD,'14', TPEP.PAY_AMT, 0)) AS PAY_AMT_FSTMP
		        , SUM(DECODE(TPEP.PAY_CD,'15', TPEP.PAY_AMT, 0)) AS PAY_AMT_PARTNER
		        , SUM(DECODE(TPEP.PAY_CD,'16', TPEP.PAY_AMT, 0)) AS PAY_AMT_OKCSB
		        , SUM(DECODE(TPEP.PAY_CD,'17', TPEP.PAY_AMT, 0)) AS PAY_AMT_EMP_CARD
		        , SUM(DECODE(TPEP.PAY_CD,'18', TPEP.PAY_AMT, 0)) AS PAY_AMT_EMP_TEMPORARY
		        , SUM(DECODE(TPEP.PAY_CD,'024', TPEP.PAY_AMT, 0)) AS PAY_AMT_PREV
		        , SUM(DECODE(TPED.DC_CD,'01', TPED.DC_AMT, 0)) AS DC_AMT_GENERAL
		        , SUM(DECODE(TPED.DC_CD,'02', TPED.DC_AMT, 0)) AS DC_AMT_COUPN
		        , SUM(DECODE(TPED.DC_CD,'03', TPED.DC_AMT, 0)) AS DC_AMT_MEMBR
		        , SUM(DECODE(TPED.DC_CD,'04', TPED.DC_AMT, 0)) AS DC_AMT_PARTNER
		        , SUM(DECODE(TPED.DC_CD,'05', TPED.DC_AMT, 0)) AS DC_AMT_SERVICE
		        , SUM(DECODE(TPED.DC_CD,'06', TPED.DC_AMT, 0)) AS DC_AMT_PROMTN
		        , SUM(DECODE(TPED.DC_CD,'07', TPED.DC_AMT, 0)) AS DC_AMT_PACK
		        , SUM(DECODE(TPED.DC_CD,'08', TPED.DC_AMT, 0)) AS DC_AMT_SITE
		        , SUM(DECODE(TPED.DC_CD,'08', TPED.DC_AMT, 0)) AS DC_AMT_VCOUPN
		        , SUM(DECODE(TPEI.ACCNT_FG,'1',TPEI.ACCNT_CD, 0)) AS ACCNT_IN_AMT
		        , SUM(DECODE(TPEI.ACCNT_FG,'2',TPEI.ACCNT_CD, 0)) AS ACCNT_OUT_AMT
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'1',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_10
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'2',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_50
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'3',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_100
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'4',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_500
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'5',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_1000
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'6',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_5000
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'7',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_10000
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'8',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_50000
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'9',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_100000
		        , SUM(DECODE(TPEFT.CASH_TICKET_CD,'10',TPEFT.CASH_TICKET_AMT, 0)) AS CASH_TICKET_AMT_ECT
		        , SUM(DECODE(TPEL.LOST_CD,'1',TPEL.EXACT_AMT, 0)) AS EXACT_AMT_CASH
		        , SUM(DECODE(TPEL.LOST_CD,'2',TPEL.EXACT_AMT, 0)) AS EXACT_AMT_GIFT
		        , SUM(DECODE(TPEL.LOST_CD,'1',TPEL.LOST_AMT, 0)) AS LOST_AMT_CASH
		        , SUM(DECODE(TPEL.LOST_CD,'2',TPEL.LOST_AMT, 0)) AS LOST_AMT_GIFT
		FROM    TB_PS_EXACTCALC TPE
		        , TB_PS_EXACTCALC_SALE TPES
		        , TB_PS_EXACTCALC_IOMONEY TPEI
		        , TB_PS_EXACTCALC_FUND TPEF
		        , TB_PS_EXACTCALC_CASH TPEC
		        , TB_PS_EXACTCALC_CASH_TICKET TPECT
		        , TB_PS_EXACTCALC_LOST TPEL
		        , TB_PS_EXACTCALC_RSVE TPER
		        , TB_PS_EXACTCALC_PAY TPEP
		        , TB_PS_EXACTCALC_DC TPED
		        , TB_PS_EXACTCALC_FUND_TICKET TPEFT
		        , TB_SL_SALE_HDR TSSH
		        , TB_MS_STORE TMS
		WHERE   TPE.HQ_OFFICE_CD = TPES.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPES.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPES.STORE_CD(+)
		        AND TPE.SALE_DATE = TPES.SALE_DATE(+)
		        AND TPE.POS_NO = TPES.POS_NO(+)
		        AND TPE.REG_SEQ = TPES.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPEI.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPEI.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPEI.STORE_CD(+)
		        AND TPE.SALE_DATE = TPEI.SALE_DATE(+)
		        AND TPE.POS_NO = TPEI.POS_NO(+)
		        AND TPE.HQ_OFFICE_CD = TPEF.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPEF.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPEF.STORE_CD(+)
		        AND TPE.SALE_DATE = TPEF.SALE_DATE(+)
		        AND TPE.POS_NO = TPEF.POS_NO(+)
		        AND TPE.REG_SEQ = TPEF.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPEC.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPEC.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPEC.STORE_CD(+)
		        AND TPE.SALE_DATE = TPEC.SALE_DATE(+)
		        AND TPE.POS_NO = TPEC.POS_NO(+)
		        AND TPE.REG_SEQ = TPEC.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPECT.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPECT.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPECT.STORE_CD(+)
		        AND TPE.SALE_DATE = TPECT.SALE_DATE(+)
		        AND TPE.POS_NO = TPECT.POS_NO(+)
		        AND TPE.REG_SEQ = TPECT.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPEL.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPEL.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPEL.STORE_CD(+)
		        AND TPE.SALE_DATE = TPEL.SALE_DATE(+)
		        AND TPE.POS_NO = TPEL.POS_NO(+)
		        AND TPE.REG_SEQ = TPEL.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPER.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPER.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPER.STORE_CD(+)
		        AND TPE.SALE_DATE = TPER.SALE_DATE(+)
		        AND TPE.POS_NO = TPER.POS_NO(+)
		        AND TPE.REG_SEQ = TPER.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPEP.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPEP.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPEP.STORE_CD(+)
		        AND TPE.SALE_DATE = TPEP.SALE_DATE(+)
		        AND TPE.POS_NO = TPEP.POS_NO(+)
		        AND TPE.REG_SEQ = TPEP.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPED.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPED.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPED.STORE_CD(+)
		        AND TPE.SALE_DATE = TPED.SALE_DATE(+)
		        AND TPE.POS_NO = TPED.POS_NO(+)
		        AND TPE.REG_SEQ = TPED.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TPEFT.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TPEFT.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TPEFT.STORE_CD(+)
		        AND TPE.SALE_DATE = TPEFT.SALE_DATE(+)
		        AND TPE.POS_NO = TPEFT.POS_NO(+)
		        AND TPE.REG_SEQ = TPEFT.REG_SEQ(+)
		        AND TPE.HQ_OFFICE_CD = TSSH.HQ_OFFICE_CD(+)
		        AND TPE.HQ_BRAND_CD = TSSH.HQ_BRAND_CD(+)
		        AND TPE.STORE_CD = TSSH.STORE_CD(+)
		        AND TPE.SALE_DATE = TSSH.SALE_DATE(+)
		        AND TPE.POS_NO = TSSH.POS_NO(+)
		        AND TPE.HQ_OFFICE_CD = TMS.HQ_OFFICE_CD
		        AND TPE.STORE_CD = TMS.STORE_CD
		        AND TPE.HQ_OFFICE_CD = #{hqOfficeCd}
		        <if test='storeCd != null and storeCd != ""'>
		        	AND TPE.STORE_CD = #{storeCd}
		        </if>
		        <if test='saleDate != null and saleDate != ""'>
					AND TPE.SALE_DATE = REPLACE(#{saleDate},'-','')
				</if>
				<if test='regSeq != null and regSeq != ""'>
					AND TPE.REG_SEQ = #{regSeq}
				</if>
				<if test='posNo != null and posNo != ""'>
					AND TPE.POS_NO = #{posNo}
				</if>
		GROUP BY TPE.STORE_CD
				, TMS.STORE_NM
		        , TPE.SALE_DATE
		        , TPE.POS_NO
		        , TPE.OPEN_DT
		        , TPE.CLOSE_DT
    </select>

</mapper>
