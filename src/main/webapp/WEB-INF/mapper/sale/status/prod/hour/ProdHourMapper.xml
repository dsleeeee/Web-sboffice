<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.sale.status.prod.hour.service.impl.ProdHourMapper">
    <!-- 상품별매출 - 시간대별 리스트 조회 -->
    <!--
        TABLE    : TB_SL_SALE_HDR, TB_SL_SALE_DTL, TB_MS_TABLE, TB_MS_PRODUCT, TB_MS_PRODUCT_BARCD
        PARAM    : todayBillSaleDtlVO
        COMMENTS : 영수증별매출상세현황 - 영수증별매출상세 리스트를 조회한다.
    -->
    <select id="getProdHourList" parameterType="prodHourVO" resultType="DefaultMap">
        /* USE : ProdRankMapper.getProdRankList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
		SELECT TMP.PROD_CD
		    , TMP.PROD_NM
			${sQuery1}
			<include refid="CmmSQL.PagingTemplateCount"/>
		  FROM TB_SL_DAILY_PROD TSDP
         		, TB_SL_DAILY_TIME TSDT
		     	, TB_MS_PRODUCT TMP
		 WHERE TSDP.STORE_CD = TMP.STORE_CD
		 AND TSDP.PROD_CD = TMP.PROD_CD
         AND TSDP.STORE_CD = TSDT.STORE_CD
        <if test='arrStoreCd != null and arrStoreCd != ""'>
                    AND TSDP.STORE_CD IN
                    <foreach collection="arrStoreCd" item="item" open="(" close=")" separator=",">
                        #{item}
                    </foreach>
        </if>
		<if test='startDate != null and startDate != ""'>
		   AND TSDP.SALE_DATE >= #{startDate}
		</if>
		<if test='endDate != null and endDate != ""'>
		   AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
		</if>
		GROUP BY TMP.PROD_CD, TMP.PROD_NM 
		ORDER BY TMP.PROD_CD ASC
		<include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

</mapper>
