<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    TouchKey.xml
    판매터치키 sql
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       노현수     2018.09.08     파일 재생성, 주석생성
    2       노현수     2018.09.13     파일 재생성, 커밋테스트
-->
<mapper namespace="kr.co.solbipos.base.prod.touchkey.service.impl.TouchKeyMapper">

    <resultMap id="touchKeyMap" type="DefaultMap">
        <result column="TOUCHKEY_USED" property="touchKeyUsed" typeHandler="CustomBooleanTypeHandler"/>
    </resultMap>

    <!-- 판매터치키 등록 상품 목록 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT, TB_HQ_PRODUCT_SALE_PRICE, TB_HQ_PRODUCT_CLASS,
                   TB_MS_PRODUCT, TB_MS_PRODUCT_SALE_PRICE, TB_MS_PRODUCT_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 판매터치키로 등록할 상품의 목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getProductListForTouchKey" parameterType="touchKeyVO" resultMap="touchKeyMap">
        /* USE : TouchKeyMapper.getProductListForTouchKey */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thp.PROD_CD,
                    thp.PROD_NM,
                    thpc.PROD_CLASS_CD,
                    thpc.PROD_CLASS_NM,
                    NVL(thpsp.SALE_UPRC, 0) AS SALE_UPRC,
                    'N' AS TOUCHKEY_USED,
                    (SELECT PROD_NM FROM TB_HQ_PRODUCT thp2 WHERE HQ_OFFICE_CD = #{hqOfficeCd} AND PROD_CD = thp.GROUP_PROD_CD) AS GROUP_PROD_NM,
                    thp.REMARK
                FROM
                    TB_HQ_PRODUCT thp
                LEFT OUTER JOIN TB_HQ_PRODUCT_CLASS thpc ON
                    thp.HQ_OFFICE_CD = thpc.HQ_OFFICE_CD
                    AND thp.PROD_CLASS_CD = thpc.PROD_CLASS_CD
                LEFT OUTER JOIN (
                    SELECT
                        HQ_OFFICE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                        ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_HQ_PRODUCT_SALE_PRICE
                    WHERE
                        HQ_OFFICE_CD = #{hqOfficeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                        AND SALE_PRC_FG = '1'
                    GROUP BY
                        HQ_OFFICE_CD, PROD_CD ) thpsp ON
                    thp.HQ_OFFICE_CD = thpsp.HQ_OFFICE_CD
                    AND thp.PROD_CD = thpsp.PROD_CD
                WHERE
                    thp.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thp.USE_YN = 'Y'
                <if test="prodClassCd != null and prodClassCd != ''">
                    AND thp.PROD_CLASS_CD IN (
                                                SELECT
                                                    PROD_CLASS_CD
                                                FROM
                                                    TB_HQ_PRODUCT_CLASS
                                                WHERE
                                                    HQ_OFFICE_CD = #{hqOfficeCd}
                                                START WITH
                                                    PROD_CLASS_CD = #{prodClassCd} AND HQ_OFFICE_CD = #{hqOfficeCd}
                                                CONNECT BY
                                                    PRIOR PROD_CLASS_CD = P_PROD_CLASS_CD AND HQ_OFFICE_CD = #{hqOfficeCd}
                                             )
                </if>
                <if test="prodNm != null and prodNm != ''">
                    AND thp.PROD_NM LIKE '%'||#{prodNm}||'%'
                </if>
                <if test="hqBrandCd != null and hqBrandCd != ''">
                    AND thp.HQ_BRAND_CD = #{hqBrandCd} -- 브랜드
                </if>
                ORDER BY thpc.PROD_CLASS_CD, thp.PROD_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmp.PROD_CD,
                    tmp.PROD_NM,
                    tmpc.PROD_CLASS_CD,
                    tmpc.PROD_CLASS_NM,
                    NVL(tmpsp.SALE_UPRC, 0) AS SALE_UPRC,
                    'N' AS TOUCHKEY_USED,
                    (SELECT PROD_NM FROM TB_MS_PRODUCT tmp2 WHERE STORE_CD = #{storeCd} AND PROD_CD = tmp.GROUP_PROD_CD) AS GROUP_PROD_NM,
                    tmp.REMARK
                FROM
                    TB_MS_PRODUCT tmp
                LEFT OUTER JOIN TB_MS_PRODUCT_CLASS tmpc ON
                    tmp.STORE_CD = tmpc.STORE_CD
                    AND tmp.PROD_CLASS_CD = tmpc.PROD_CLASS_CD
                LEFT OUTER JOIN (
                    SELECT
                        STORE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                        ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_MS_PRODUCT_SALE_PRICE
                    WHERE
                        STORE_CD = #{storeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                        AND SALE_PRC_FG = '1'
                    GROUP BY
                        STORE_CD, PROD_CD ) tmpsp ON
                    tmp.STORE_CD = tmpsp.STORE_CD
                    AND tmp.PROD_CD = tmpsp.PROD_CD
                WHERE
                    tmp.STORE_CD = #{storeCd}
                    AND tmp.USE_YN = 'Y'
                <if test="prodClassCd != null and prodClassCd != ''">
                    AND tmp.PROD_CLASS_CD IN (
                                                SELECT
                                                    PROD_CLASS_CD
                                                FROM
                                                    TB_MS_PRODUCT_CLASS
                                                WHERE
                                                    STORE_CD = #{storeCd}
                                                START WITH
                                                    PROD_CLASS_CD = #{prodClassCd} AND STORE_CD = #{storeCd}
                                                CONNECT BY
                                                    PRIOR PROD_CLASS_CD = P_PROD_CLASS_CD AND STORE_CD = #{storeCd}
                                             )
                </if>
                <if test="prodNm != null and prodNm != ''">
                    AND tmp.PROD_NM LIKE '%'||#{prodNm}||'%'
                </if>
                <if test="hqBrandCd != null and hqBrandCd != ''">
                    AND tmp.HQ_BRAND_CD = #{hqBrandCd} -- 브랜드
                </if>
                ORDER BY tmpc.PROD_CLASS_CD, tmp.PROD_CD
            </when>
        </choose>
    </select>

    <!-- 터치키 페이지 스타일코드 조회 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    :
        COMMENTS : 터치키 분류 페이지별로 적용되어 있는 스타일코드를 조회한다.
    -->
    <select id="getTouchKeyPageStyleCd" parameterType="touchKeyClassVO" resultType="java.lang.String">
        /* USE : TouchKeyMapper.getTouchKeyPageStyleCd */
        <choose>
        <!-- 본사 -->
        <when test='orgnFg != null and orgnFg == "H"'>
            SELECT
                tkc.STYLE_CD
            FROM
                (
                SELECT
                    ROWNUM AS rnum,
                    thtkc.STYLE_CD
                FROM
                    TB_HQ_TOUCH_KEY_CLASS thtkc
                WHERE
                    thtkc.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thtkc.TUKEY_GRP_CD = #{tukeyGrpCd}
                    AND thtkc.PAGE_NO = #{pageNo}
                ORDER BY
                    TUKEY_CLASS_CD ) tkc
            WHERE
                tkc.rnum = 1
        </when>
        <!-- 매장 -->
        <when test='orgnFg != null and orgnFg == "S"'>
            SELECT
                tkc.STYLE_CD
            FROM
                (
                SELECT
                    ROWNUM AS rnum,
                    tmtkc.STYLE_CD
                FROM
                    TB_MS_TOUCH_KEY_CLASS tmtkc
                WHERE
                    tmtkc.STORE_CD = #{storeCd}
                    AND tmtkc.TUKEY_GRP_CD = #{tukeyGrpCd}
                    AND tmtkc.PAGE_NO = #{pageNo}
                ORDER BY
                    tmtkc.TUKEY_CLASS_CD ) tkc
            WHERE
                tkc.rnum = 1
        </when>
        </choose>
    </select>

    <!-- 터치키 스타일코드 조회 -->
    <!--
        TABLE    : TB_CM_TOUCH_KEY_STYLE
        PARAM    :
        COMMENTS : 터치키에 적용할 스타일코드를 조회한다.
    -->
    <select id="getTouchKeyStyleCdList" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyStyleCdList */
        SELECT
            tctks.STYLE_CD,
            tctks.STYLE_NM
        FROM
            TB_CM_TOUCH_KEY_STYLE tctks
        WHERE
            tctks.USE_YN = 'Y'
        ORDER BY
            tctks.STYLE_CD
    </select>

    <!-- 터치키 스타일 조회 -->
    <!--
        TABLE    : TB_CM_TOUCH_KEY_STYLE_DTL
        PARAM    :
        COMMENTS : 터치키에 적용할 스타일을 조회한다.
    -->
    <select id="getTouchKeyStyleList" parameterType="touchKeyStyleVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyStyleList */
        SELECT
            tctksd.STYLE_CD,
            tctksd.BUTTON_FG,
            tctksd.BUTTON_TAG_FG,
            tctksd.BUTTON_ON_COLOR,
            tctksd.BUTTON_OFF_COLOR,
            tctksd.FONT_ON_COLOR,
            tctksd.FONT_OFF_COLOR,
            tctksd.FONT_SIZE
        FROM
            TB_CM_TOUCH_KEY_STYLE_DTL tctksd
        <where>
            <if test='styleCd != "" and styleCd != null'>
            tctksd.STYLE_CD = #{styleCd}
            </if>
        </where>
        ORDER BY
            tctksd.STYLE_CD, tctksd.BUTTON_FG
    </select>

    <!-- 터치키 스타일 비교값 조회 -->
    <!--
        TABLE    : TB_CM_TOUCH_KEY_STYLE_DTL
        PARAM    :
        COMMENTS : 터치키 자료 입력시 비교할 스타일코드 값을 조회한다
    -->
    <select id="getTouchKeyStyleForCompare" parameterType="touchKeyStyleVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyStyleForCompare */
        SELECT
            FONT_SIZE,
            FONT_OFF_COLOR,
            BUTTON_OFF_COLOR
        FROM
            TB_CM_TOUCH_KEY_STYLE_DTL
        WHERE
            STYLE_CD = #{styleCd}
            AND BUTTON_FG = #{buttonFg}
            AND BUTTON_TAG_FG = #{buttonTagFg}

    </select>

    <!-- 판매터치키 XML 조회 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 조회한다.
    -->
    <select id="getTouchKeyXml" parameterType="DefaultMap" resultType="String">
        /* USE : TouchkeyMapper.getTouchKeyXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    XML
                FROM
                    TB_WB_HQ_CONFG_XML twhcx
                WHERE
                    twhcx.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND twhcx.CONFG_FG = #{confgFg}
                    AND twhcx.GRP_CD = #{tukeyGrpCd}
                    AND twhcx.USE_YN = 'Y'
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    XML
                FROM
                    TB_WB_STORE_CONFG_XML twscx
                WHERE
                    twscx.STORE_CD = #{storeCd}
                    AND twscx.CONFG_FG = #{confgFg}
                    AND twscx.GRP_CD = #{tukeyGrpCd}
                    AND twscx.USE_YN = 'Y'
            </when>
        </choose>
    </select>

    <!-- 판매터치키 저장 상품정보 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SALE_PRICE, TB_MS_PRODUCT_SALE_PRICE
        PARAM    : touchKeyVO
        COMMENTS : 판매터치키 구성에 존재하는 상품정보를 조회한다.
    -->
    <select id="getTouchKeyProdInfoList" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchKeyMapper.getTouchKeyProdInfoList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thtk.PROD_CD,
                    <if test='gubun != null and gubun != "" and gubun == "0"'>
                        thp.PROD_NM,
                    </if>
                    <if test='gubun != null and gubun != "" and gubun == "1"'>
                        ('[' || thtk.PROD_CD || ']' || thp.PROD_NM) AS PROD_NM,
                    </if>
                    TO_CHAR(NVL(thpsp.SALE_UPRC, 0), 'FM9,999,999') AS SALE_UPRC
                FROM
                    TB_HQ_TOUCH_KEY thtk

                LEFT OUTER JOIN TB_HQ_PRODUCT thp ON
                    thtk.HQ_OFFICE_CD = thp.HQ_OFFICE_CD
                    AND thtk.PROD_CD = thp.PROD_CD
                LEFT OUTER JOIN (
                    SELECT
                        HQ_OFFICE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                            ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_HQ_PRODUCT_SALE_PRICE
                    WHERE
                        HQ_OFFICE_CD = #{hqOfficeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                    GROUP BY
                    HQ_OFFICE_CD, PROD_CD ) thpsp ON
                    thtk.HQ_OFFICE_CD = thpsp.HQ_OFFICE_CD
                    AND thtk.PROD_CD = thpsp.PROD_CD
                WHERE
                    thtk.HQ_OFFICE_CD = #{hqOfficeCd}
                AND thtk.TUKEY_GRP_CD = #{tukeyGrpCd}
                GROUP BY
                    thtk.PROD_CD, thp.PROD_NM, thpsp.SALE_UPRC
                ORDER BY
                    thtk.PROD_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmtk.PROD_CD,
                    <if test='gubun != null and gubun != "" and gubun == "0"'>
                        tmp.PROD_NM,
                    </if>
                    <if test='gubun != null and gubun != "" and gubun == "1"'>
                        ('[' || tmtk.PROD_CD || ']' || tmp.PROD_NM) AS PROD_NM,
                    </if>
                    NVL(tmpsp.SALE_UPRC, 0) AS SALE_UPRC
                FROM
                    TB_MS_TOUCH_KEY tmtk
                LEFT OUTER JOIN TB_MS_PRODUCT tmp ON
                    tmtk.STORE_CD = tmp.STORE_CD
                    AND tmtk.PROD_CD = tmp.PROD_CD
                LEFT OUTER JOIN (
                    SELECT
                        STORE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                            ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_MS_PRODUCT_SALE_PRICE
                    WHERE
                        STORE_CD = #{storeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                    GROUP BY
                        STORE_CD, PROD_CD ) tmpsp ON
                    tmtk.STORE_CD = tmpsp.STORE_CD
                    AND tmtk.PROD_CD = tmpsp.PROD_CD
                WHERE
                    tmtk.STORE_CD = #{storeCd}
                AND tmtk.TUKEY_GRP_CD = #{tukeyGrpCd}
                GROUP BY
                    tmtk.PROD_CD, tmp.PROD_NM, tmpsp.SALE_UPRC
                ORDER BY
                    tmtk.PROD_CD
            </when>
        </choose>
    </select>

    <!-- 판매터치키 XML 생성 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 생성한다.
    -->
    <insert id="insertTouchKeyConfgXml" parameterType="DefaultMap">
        /* USE : TouchkeyMapper.insertTouchKeyConfgXml */
        <selectKey keyProperty="cnt" resultType="String" order="BEFORE">
            <choose>
                <!-- 본사 -->
                <when test='orgnFg != null and orgnFg == "H"'>
                SELECT  COUNT(*) AS CNT
                FROM    TB_WB_HQ_CONFG_XML
                WHERE   HQ_OFFICE_CD  =   #{hqOfficeCd}
                AND     CONFG_FG      =   #{confgFg}
                AND     GRP_CD        =   #{tukeyGrpCd}
                </when>
                <!-- 매장 -->
                <when test='orgnFg != null and orgnFg == "S"'>
                    SELECT  COUNT(*) AS CNT
                    FROM    TB_WB_STORE_CONFG_XML
                    WHERE   STORE_CD  =   #{storeCd}
                    AND     CONFG_FG  =   #{confgFg}
                    AND     GRP_CD    =   #{tukeyGrpCd}
                </when>
            </choose>
        </selectKey>
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H" and cnt != "0"'>
                UPDATE  TB_WB_HQ_CONFG_XML A
                SET     A.USE_YN    =   #{useYn}
                ,       A.MOD_DT    =   #{regDt}
                ,       A.MOD_ID    =   #{regId}
                ,       A.XML       =   #{xml:CLOB}
                WHERE   HQ_OFFICE_CD  =   #{hqOfficeCd}
                AND     CONFG_FG      =   #{confgFg}
                AND     GRP_CD        =   #{tukeyGrpCd}
            </when>
            <when test='orgnFg != null and orgnFg == "H" and cnt == "0"'>
                INSERT INTO TB_WB_HQ_CONFG_XML A
                (
                        A.HQ_OFFICE_CD
                ,       A.CONFG_FG
                ,       A.USE_YN
                ,       A.REG_DT
                ,       A.REG_ID
                ,       A.GRP_CD
                ,       A.XML
                )
                VALUES
                (
                        #{hqOfficeCd}
                ,       #{confgFg}
                ,       #{useYn}
                ,       #{regDt}
                ,       #{regId}
                ,       #{tukeyGrpCd}
                ,       #{xml:CLOB}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S" and cnt != "0"'>
                UPDATE  TB_WB_STORE_CONFG_XML A
                SET     A.USE_YN    =   #{useYn}
                ,       A.MOD_DT    =   #{regDt}
                ,       A.MOD_ID    =   #{regId}
                ,       A.XML       =   #{xml:CLOB}
                WHERE   STORE_CD  =   #{storeCd}
                AND     CONFG_FG  =   #{confgFg}
                AND     GRP_CD    =   #{tukeyGrpCd}
            </when>
            <when test='orgnFg != null and orgnFg == "S" and cnt == "0"'>
                INSERT INTO TB_WB_STORE_CONFG_XML A
                (
                        A.STORE_CD
                ,       A.CONFG_FG
                ,       A.USE_YN
                ,       A.REG_DT
                ,       A.REG_ID
                ,       A.GRP_CD
                ,       A.XML
                )
                VALUES
                (
                        #{storeCd}
                ,       #{confgFg}
                ,       #{useYn}
                ,       #{regDt}
                ,       #{regId}
                ,       #{tukeyGrpCd}
                ,       #{xml:CLOB}
                )
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 XML 수정 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 수정한다.
    -->
    <update id="updateTouchKeyConfgXml" parameterType="DefaultMap">
        /* USE : TouchkeyMapper.updateTouchKeyConfgXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE
                    TB_WB_HQ_CONFG_XML twhcx
                SET
                    twhcx.USE_YN = #{useYn},
                    twhcx.MOD_DT = #{regDt},
                    twhcx.MOD_ID = #{regId},
                    twhcx.XML = #{xml:CLOB}
                WHERE
                    twhcx.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND twhcx.CONFG_FG = #{confgFg}
                    AND twhcx.GRP_CD = #{tukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE
                    TB_WB_STORE_CONFG_XML twscx
                SET
                    twscx.USE_YN = #{useYn},
                    twscx.MOD_DT = #{regDt},
                    twscx.MOD_ID = #{regId},
                    twscx.XML = #{xml:CLOB}
                WHERE
                    twscx.STORE_CD = #{storeCd}
                    AND twscx.CONFG_FG = #{confgFg}
                    AND twscx.GRP_CD = #{tukeyGrpCd}
            </when>
        </choose>
    </update>

    <!-- 판매터치키 XML 삭제 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyConfgXml" parameterType="DefaultMap">
        /* USE : TouchkeyMapper.deleteTouchKeyConfgXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                DELETE
                FROM
                    TB_WB_HQ_CONFG_XML twhcx
                WHERE
                    twhcx.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND twhcx.CONFG_FG = #{confgFg}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND twhcx.GRP_CD = #{tukeyGrpCd}
                </if>
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                    TB_WB_STORE_CONFG_XML twscx
                WHERE
                    twscx.STORE_CD = #{storeCd}
                    AND twscx.CONFG_FG = #{confgFg}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND twscx.GRP_CD = #{tukeyGrpCd}
                </if>
            </when>
        </choose>
    </delete>

    <!-- 판매터치키 XML 기본값 세팅 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 삭제한다.
    -->
    <delete id="defaultTouchKeyConfgXml" parameterType="DefaultMap">
        /* USE : TouchkeyMapper.defaultTouchKeyConfgXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_WB_HQ_CONFG_XML twhcx
                (
                        twhcx.HQ_OFFICE_CD
                ,       twhcx.CONFG_FG
                ,       twhcx.XML
                ,       twhcx.USE_YN
                ,       twhcx.REG_DT
                ,       twhcx.REG_ID
                ,       twhcx.GRP_CD
                )
                SELECT  #{hqOfficeCd}
                ,       CONFG_FG
                ,       XML
                ,       USE_YN
                ,       #{regDt}
                ,       #{regId}
                ,       GRP_CD
                FROM    TB_WB_STORE_CONFG_XML
                WHERE   STORE_CD    =   '0000000'
                AND     CONFG_FG    =   '10'
                AND     GRP_CD      =   '01'
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_WB_STORE_CONFG_XML twscx
                (
                        twscx.STORE_CD
                ,       twscx.CONFG_FG
                ,       twscx.XML
                ,       twscx.USE_YN
                ,       twscx.REG_DT
                ,       twscx.REG_ID
                ,       twscx.GRP_CD
                )
                SELECT  #{storeCd}
                ,       CONFG_FG
                ,       XML
                ,       USE_YN
                ,       #{regDt}
                ,       #{regId}
                ,       GRP_CD
                FROM    TB_WB_STORE_CONFG_XML
                WHERE   STORE_CD    =   '0000000'
                AND     CONFG_FG    =   '10'
                AND     GRP_CD      =   '01'
            </when>
        </choose>
    </delete>

    <!-- 판매터치키 그룹 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_CLASS, TB_MS_TOUCH_CLASS
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 그룹 정보를 생성한다.
    -->
    <insert id="insertTouchKeyClass" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.insertTouchKeyClass */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY_CLASS thtkc (
                    thtkc.HQ_OFFICE_CD,
                    thtkc.TUKEY_GRP_CD,
                    thtkc.TUKEY_CLASS_CD,
                    thtkc.TUKEY_CLASS_NM,
                    thtkc.PAGE_NO,
                    thtkc.PAGE_ROWS,
                    thtkc.X,
                    thtkc.Y,
                    thtkc.WIDTH,
                    thtkc.HEIGHT,
                    thtkc.STYLE_CD,
                    thtkc.FONT_SIZE,
                    thtkc.FONT_COLOR,
                    thtkc.FILL_COLOR,
                    thtkc.IMG_NM,
                    thtkc.REG_DT,
                    thtkc.REG_ID,
                    thtkc.MOD_DT,
                    thtkc.MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{tukeyGrpCd},
                    #{tukeyClassCd},
                    NVL(SUBSTRB(#{tukeyClassNm}, 1, 50), ' '),
                    #{pageNo},
                    #{pageRows},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY_CLASS tmtkc (
                    tmtkc.STORE_CD,
                    tmtkc.TUKEY_GRP_CD,
                    tmtkc.TUKEY_CLASS_CD,
                    tmtkc.TUKEY_CLASS_NM,
                    tmtkc.PAGE_NO,
                    tmtkc.PAGE_ROWS,
                    tmtkc.X,
                    tmtkc.Y,
                    tmtkc.WIDTH,
                    tmtkc.HEIGHT,
                    tmtkc.STYLE_CD,
                    tmtkc.FONT_SIZE,
                    tmtkc.FONT_COLOR,
                    tmtkc.FILL_COLOR,
                    tmtkc.IMG_NM,
                    tmtkc.IN_FG,
                    tmtkc.REG_DT,
                    tmtkc.REG_ID,
                    tmtkc.MOD_DT,
                    tmtkc.MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{tukeyGrpCd},
                    #{tukeyClassCd},
                    NVL(SUBSTRB(#{tukeyClassNm}, 1, 50), ' '),
                    #{pageNo},
                    #{pageRows},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{inFg},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 그룹 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 그룹 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyClass" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.deleteTouchKeyClass */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                DELETE
                FROM
                    TB_HQ_TOUCH_KEY_CLASS
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                    TB_MS_TOUCH_KEY_CLASS
                WHERE
                    STORE_CD = #{storeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
            </when>
        </choose>
    </delete>

    <!-- 판매터치키 그룹 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 그룹 정보를 삭제한다.
    -->
    <delete id="deleteTouchkeyGrp" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.deleteTouchkeyGrp */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                DELETE
                FROM
                TB_HQ_TOUCH_KEY_GROUP
                WHERE
                HQ_OFFICE_CD = #{hqOfficeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                TB_MS_TOUCH_KEY_GROUP
                WHERE
                STORE_CD = #{storeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
            </when>
        </choose>
    </delete>

    <!-- 판매터치키 그룹 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 그룹 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyClass2" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.deleteTouchKeyClass2 */
        <choose>
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                    TB_MS_TOUCH_KEY_CLASS
                WHERE
                    STORE_CD = #{storeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
                AND 	TUKEY_GRP_CD || TUKEY_CLASS_CD IN ( SELECT 	NMCODE_NM || NMCODE_ITEM_1
                                                            FROM 	TB_HQ_NMCODE thn
                                                            WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
                                                            AND     NMCODE_GRP_CD = '228'
                                                            AND 	NMCODE_ITEM_2 = 'Y')
            </when>
        </choose>
    </delete>

    <!-- 판매터치키 분류 기본값 세팅 -->
    <!--
        TABLE    : TB_HQ_TOUCH_CLASS, TB_MS_TOUCH_CLASS
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 그룹 정보를 생성한다.
    -->
    <insert id="defaultTouchKeyClass" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.defaultTouchKeyClass */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY_CLASS thtkc
                (
                        thtkc.HQ_OFFICE_CD
                ,       thtkc.TUKEY_GRP_CD
                ,       thtkc.TUKEY_CLASS_CD
                ,       thtkc.TUKEY_CLASS_NM
                ,       thtkc.PAGE_NO
                ,       thtkc.PAGE_ROWS
                ,       thtkc.X
                ,       thtkc.Y
                ,       thtkc.WIDTH
                ,       thtkc.HEIGHT
                ,       thtkc.STYLE_CD
                ,       thtkc.FONT_SIZE
                ,       thtkc.FONT_COLOR
                ,       thtkc.FILL_COLOR
                ,       thtkc.IMG_NM
                ,       thtkc.REG_DT
                ,       thtkc.REG_ID
                ,       thtkc.MOD_DT
                ,       thtkc.MOD_ID
                )
                SELECT  #{hqOfficeCd}
                ,       TUKEY_GRP_CD
                ,       TUKEY_CLASS_CD
                ,       TUKEY_CLASS_NM
                ,       PAGE_NO
                ,       PAGE_ROWS
                ,       X
                ,       Y
                ,       WIDTH
                ,       HEIGHT
                ,       STYLE_CD
                ,       FONT_SIZE
                ,       FONT_COLOR
                ,       FILL_COLOR
                ,       IMG_NM
                ,       TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
                ,       #{regId}
                ,       TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
                ,       #{regId}
                FROM    TB_MS_TOUCH_KEY_CLASS
                WHERE   STORE_CD        =   '0000000'
                AND     TUKEY_GRP_CD    =   '01'
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY_CLASS tmtkc
                (
                        tmtkc.STORE_CD
                ,       tmtkc.TUKEY_GRP_CD
                ,       tmtkc.TUKEY_CLASS_CD
                ,       tmtkc.TUKEY_CLASS_NM
                ,       tmtkc.PAGE_NO
                ,       tmtkc.PAGE_ROWS
                ,       tmtkc.X
                ,       tmtkc.Y
                ,       tmtkc.WIDTH
                ,       tmtkc.HEIGHT
                ,       tmtkc.STYLE_CD
                ,       tmtkc.FONT_SIZE
                ,       tmtkc.FONT_COLOR
                ,       tmtkc.FILL_COLOR
                ,       tmtkc.IMG_NM
                ,       tmtkc.IN_FG
                ,       tmtkc.REG_DT
                ,       tmtkc.REG_ID
                ,       tmtkc.MOD_DT
                ,       tmtkc.MOD_ID
                )
                SELECT  #{storeCd}
                ,       TUKEY_GRP_CD
                ,       TUKEY_CLASS_CD
                ,       TUKEY_CLASS_NM
                ,       PAGE_NO
                ,       PAGE_ROWS
                ,       X
                ,       Y
                ,       WIDTH
                ,       HEIGHT
                ,       STYLE_CD
                ,       FONT_SIZE
                ,       FONT_COLOR
                ,       FILL_COLOR
                ,       IMG_NM
                ,       IN_FG
                ,       TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
                ,       #{regId}
                ,       TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
                ,       #{regId}
                FROM    TB_MS_TOUCH_KEY_CLASS
                WHERE   STORE_CD        =   '0000000'
                AND     TUKEY_GRP_CD    =   '01'
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 정보를 생성한다.
    -->
    <insert id="insertTouchKey" parameterType="java.util.Map">
        /* USE : TouchkeyMapper.insertTouchKey */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY thtk (
                    thtk.HQ_OFFICE_CD,
                    thtk.TUKEY_CLASS_CD,
                    thtk.TUKEY_GRP_CD,
                    thtk.TUKEY_CD,
                    thtk.TUKEY_FG,
                    thtk.PROD_CD,
                    thtk.PAGE_NO,
                    thtk.X,
                    thtk.Y,
                    thtk.WIDTH,
                    thtk.HEIGHT,
                    thtk.STYLE_CD,
                    thtk.FONT_SIZE,
                    thtk.FONT_COLOR,
                    thtk.FILL_COLOR,
                    thtk.IMG_NM,
                    thtk.REG_DT,
                    thtk.REG_ID,
                    thtk.MOD_DT,
                    thtk.MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{tukeyClassCd},
                    #{tukeyGrpCd},
                    #{tukeyCd},
                    #{tukeyFg},
                    #{prodCd},
                    #{pageNo},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY tmtk (
                    tmtk.STORE_CD,
                    tmtk.TUKEY_CLASS_CD,
                    tmtk.TUKEY_GRP_CD,
                    tmtk.TUKEY_CD,
                    tmtk.TUKEY_FG,
                    tmtk.PROD_CD,
                    tmtk.PAGE_NO,
                    tmtk.X,
                    tmtk.Y,
                    tmtk.WIDTH,
                    tmtk.HEIGHT,
                    tmtk.STYLE_CD,
                    tmtk.FONT_SIZE,
                    tmtk.FONT_COLOR,
                    tmtk.FILL_COLOR,
                    tmtk.IMG_NM,
                    tmtk.IN_FG,
                    tmtk.REG_DT,
                    tmtk.REG_ID,
                    tmtk.MOD_DT,
                    tmtk.MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{tukeyClassCd},
                    #{tukeyGrpCd},
                    #{tukeyCd},
                    #{tukeyFg},
                    #{prodCd},
                    #{pageNo},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{inFg},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 정보를 삭제한다.
    -->
    <delete id="deleteTouchKey" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.deleteTouchKey */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                DELETE
                FROM
                    TB_HQ_TOUCH_KEY
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
                AND 	TUKEY_GRP_CD || TUKEY_CLASS_CD NOT IN ( SELECT 	NMCODE_NM || NMCODE_ITEM_1
                                                                FROM 	TB_HQ_NMCODE thn
                                                                WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
                                                                AND     NMCODE_GRP_CD = '228'
                                                                AND 	NMCODE_ITEM_2 = 'Y')
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                    TB_MS_TOUCH_KEY
                WHERE
                    STORE_CD = #{storeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
            </when>
        </choose>

    </delete>

    <!-- 판매터치키 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 정보를 삭제한다.
    -->
    <delete id="deleteTouchKey2" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.deleteTouchKey2 */
        <choose>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                    TB_MS_TOUCH_KEY
                WHERE
                    STORE_CD = #{storeCd}
                <if test="tukeyGrpCd != null and tukeyGrpCd != ''">
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
                AND 	TUKEY_GRP_CD || TUKEY_CLASS_CD IN ( SELECT 	NMCODE_NM || NMCODE_ITEM_1
                                                            FROM 	TB_HQ_NMCODE thn
                                                            WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
                                                            AND     NMCODE_GRP_CD = '228'
                                                            AND 	NMCODE_ITEM_2 = 'Y')
            </when>
        </choose>

    </delete>

    <!-- 터치키미적용상품 조회 -->
    <!--
        TABLE    : TB_MS_STORE
        PARAM    : touchKeyVO
        COMMENTS : 터치키미적용상품을 조회한다.
    -->
    <select id="getNoTouchKey" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getNoTouchKey */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT thtk.TUKEY_CLASS_CD,
                       thtkc.TUKEY_CLASS_NM,
                       thtk.PAGE_NO,
                       thp.PROD_CD,
                       thp.PROD_NM,
                       NVL2(thp.PROD_CD, 'Y', 'N') AS PROD_INFO,
                       thp.SALE_PROD_YN,
                       thp.USE_YN,
                       thtk.TUKEY_GRP_CD
                  FROM TB_HQ_TOUCH_KEY thtk,
                	   TB_HQ_TOUCH_KEY_CLASS thtkc,
                       TB_HQ_PRODUCT thp
                 WHERE thtk.HQ_OFFICE_CD 	= #{hqOfficeCd}
                   AND thtk.TUKEY_GRP_CD    = #{tukeyGrpCd}
                   AND thtkc.HQ_OFFICE_CD   = thtk.HQ_OFFICE_CD
                   AND thtkc.TUKEY_GRP_CD   = thtk.TUKEY_GRP_CD
                   AND thtkc.TUKEY_CLASS_CD = thtk.TUKEY_CLASS_CD
                   AND thp.HQ_OFFICE_CD (+) = thtk.HQ_OFFICE_CD
                   AND thp.PROD_CD      (+) = thtk.PROD_CD
                   AND thp.PROD_CD IS NULL --  상품마스터에 없는 경우(매장)
                 UNION
                SELECT thtk.TUKEY_CLASS_CD,
                       thtkc.TUKEY_CLASS_NM,
                       thtk.PAGE_NO,
                       thp.PROD_CD,
                       thp.PROD_NM,
                       NVL2(thp.PROD_CD, 'Y', 'N') AS PROD_INFO,
                       thp.SALE_PROD_YN,
                       thp.USE_YN,
                       thtk.TUKEY_GRP_CD
                  FROM TB_HQ_TOUCH_KEY thtk,
                	   TB_HQ_TOUCH_KEY_CLASS thtkc,
                       TB_HQ_PRODUCT thp
                 WHERE thtk.HQ_OFFICE_CD 	= #{hqOfficeCd}
                   AND thtk.TUKEY_GRP_CD    = #{tukeyGrpCd}
                   AND thtkc.HQ_OFFICE_CD   = thtk.HQ_OFFICE_CD
                   AND thtkc.TUKEY_GRP_CD   = thtk.TUKEY_GRP_CD
                   AND thtkc.TUKEY_CLASS_CD = thtk.TUKEY_CLASS_CD
                   AND thp.HQ_OFFICE_CD     = thtk.HQ_OFFICE_CD
                   AND thp.PROD_CD          = thtk.PROD_CD
                   AND (
                        thp.SALE_PROD_YN = 'N'     -- 상품 '판매상품여부'  - '미판매상품' 인 경우
                        OR  thp.USE_YN   = 'N'     -- 상품 '사용여부'      - '미사용' 인 경우
                       )
                <if test="hqBrandCd != null and hqBrandCd != ''">
                    AND thp.HQ_BRAND_CD = #{hqBrandCd} -- 브랜드
                </if>
                 ORDER BY TUKEY_CLASS_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT tmtk.TUKEY_CLASS_CD,
                       tmtkc.TUKEY_CLASS_NM,
                       tmtk.PAGE_NO,
                       tmp.PROD_CD,
                       tmp.prod_nm,
                       NVL2(tmp.PROD_CD, 'Y', 'N') AS PROD_INFO,
                       tmp.SALE_PROD_YN,
                       tmp.USE_YN,
                       tmtk.TUKEY_GRP_CD
                  FROM TB_MS_TOUCH_KEY tmtk,
                	   TB_MS_TOUCH_KEY_CLASS tmtkc,
                 	   TB_MS_PRODUCT tmp
                 WHERE tmtk.STORE_CD 	    = #{storeCd}
                   AND tmtk.TUKEY_GRP_CD    = #{tukeyGrpCd}
                   AND tmtkc.STORE_CD       = tmtk.STORE_CD
                   AND tmtkc.TUKEY_GRP_CD   = tmtk.TUKEY_GRP_CD
                   AND tmtkc.TUKEY_CLASS_CD = tmtk.TUKEY_CLASS_CD
                   AND tmp.STORE_CD     (+) = tmtk.STORE_CD
                   AND tmp.PROD_CD      (+) = tmtk.PROD_CD
                   AND tmp.PROD_CD IS NULL --  상품마스터에 없는 경우(매장)
                 UNION
                SELECT tmtk.TUKEY_CLASS_CD,
                       tmtkc.TUKEY_CLASS_NM,
                       tmtk.PAGE_NO,
                       tmp.PROD_CD,
                       tmp.PROD_NM,
                       NVL2(tmp.PROD_CD, 'Y', 'N') AS PROD_INFO,
                       tmp.SALE_PROD_YN,
                       tmp.USE_YN,
                       tmtk.TUKEY_GRP_CD             -- 터치키분류정보, 터치키정보, 상품정보
                  FROM TB_MS_TOUCH_KEY tmtk,
                	   TB_MS_TOUCH_KEY_CLASS tmtkc,
                 	   TB_MS_PRODUCT tmp
                 WHERE tmtk.STORE_CD 	    = #{storeCd}
                   AND tmtk.TUKEY_GRP_CD    = #{tukeyGrpCd}
                   AND tmtkc.STORE_CD       = tmtk.STORE_CD
                   AND tmtkc.TUKEY_GRP_CD   = tmtk.TUKEY_GRP_CD
                   AND tmtkc.TUKEY_CLASS_CD = tmtk.TUKEY_CLASS_CD
                   AND tmp.STORE_CD         = tmtk.STORE_CD
                   AND tmp.PROD_CD          = tmtk.PROD_CD
                   AND (
                        tmp.SALE_PROD_YN = 'N'     -- 상품 '판매상품여부'  - '미판매상품' 인 경우
                        OR  tmp.USE_YN   = 'N'     -- 상품 '사용여부'      - '미사용' 인 경우
                       )
                <if test="hqBrandCd != null and hqBrandCd != ''">
                    AND tmp.HQ_BRAND_CD = #{hqBrandCd} -- 브랜드
                </if>
                 ORDER BY TUKEY_CLASS_CD
            </when>
        </choose>
    </select>

    <!-- 매장수정허용분류 조회 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_HQ_NMCODE
        PARAM    : touchKeyVO
        COMMENTS : 매장수정허용분류를 조회한다.
    -->
    <select id="getStoreModGrpList" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getStoreModGrpList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
            SELECT  thtkc.TUKEY_GRP_CD
            ,       thtkg.TUKEY_GRP_NM
            ,       thtkc.TUKEY_CLASS_CD
            ,       thtkc.TUKEY_CLASS_NM
            ,       NVL(thn.NMCODE_ITEM_2,'N') AS STORE_MOD_YN
            FROM	TB_HQ_TOUCH_KEY_CLASS thtkc
            ,       TB_HQ_TOUCH_KEY_GROUP thtkg
            ,		TB_HQ_NMCODE thn
            WHERE   thtkc.HQ_OFFICE_CD = #{hqOfficeCd}
            AND	    thtkc.HQ_OFFICE_CD = thtkg.HQ_OFFICE_CD (+)
            AND 	thtkc.TUKEY_GRP_CD = thtkg.TUKEY_GRP_CD (+)
            AND 	thtkc.HQ_OFFICE_CD = thn.HQ_OFFICE_CD(+)
            AND 	thtkc.TUKEY_GRP_CD = thn.NMCODE_NM(+)
            AND 	thtkc.TUKEY_CLASS_CD = thn.NMCODE_ITEM_1(+)
            AND 	'228' = thn.NMCODE_GRP_CD(+)
            <if test='tukeyGrpCd != null and tukeyGrpCd != ""'>
                AND thtkc.TUKEY_GRP_CD = #{tukeyGrpCd}
            </if>
            <if test='storeModYn != null and storeModYn == "Y"'>
                AND thn.NMCODE_ITEM_2 = 'Y'
            </if>
            <if test='storeModYn != null and storeModYn == "N"'>
                AND (thn.NMCODE_ITEM_2 = 'N' OR thn.NMCODE_ITEM_2 IS NULL)
            </if>
            ORDER BY thtkc.TUKEY_GRP_CD, thtkc.TUKEY_CLASS_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT  thtkc.TUKEY_GRP_CD
                ,       thtkg.TUKEY_GRP_NM
                ,       thtkc.TUKEY_CLASS_CD
                ,       thtkc.TUKEY_CLASS_NM
                ,       NVL(thn.NMCODE_ITEM_2,'N') AS STORE_MOD_YN
                FROM	TB_HQ_TOUCH_KEY_CLASS thtkc
                ,       TB_HQ_TOUCH_KEY_GROUP thtkg
                ,		TB_HQ_NMCODE thn
                WHERE   thtkc.HQ_OFFICE_CD = #{hqOfficeCd}
                AND	    thtkc.HQ_OFFICE_CD = thtkg.HQ_OFFICE_CD (+)
                AND 	thtkc.TUKEY_GRP_CD = thtkg.TUKEY_GRP_CD (+)
                AND 	thtkc.HQ_OFFICE_CD = thn.HQ_OFFICE_CD(+)
                AND 	thtkc.TUKEY_GRP_CD = thn.NMCODE_NM(+)
                AND 	thtkc.TUKEY_CLASS_CD = thn.NMCODE_ITEM_1(+)
                AND 	'228' = thn.NMCODE_GRP_CD(+)
                <if test='tukeyGrpCd != null and tukeyGrpCd != ""'>
                    AND thtkc.TUKEY_GRP_CD = #{tukeyGrpCd}
                </if>
                AND thn.NMCODE_ITEM_2 = 'Y'
                ORDER BY thtkc.TUKEY_GRP_CD, thtkc.TUKEY_CLASS_CD
            </when>
        </choose>
    </select>

    <!-- 매장수정허용분류 저장 -->
    <!--
        TABLE    : TB_MS_STORE
        PARAM    : touchKeyVO
        COMMENTS : 매장수정허용분류를 저장한다.
    -->
    <insert id="saveStoreModGrp" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.saveStoreModGrp */
        <selectKey keyProperty="nmcodeCd" resultType="String" order="BEFORE">
            SELECT  LPAD(NVL(MAX(TO_NUMBER(NMCODE_CD)), 0) + 1, 4, '0')
            FROM    TB_HQ_NMCODE
            WHERE   HQ_OFFICE_CD = #{hqOfficeCd}
            AND     NMCODE_GRP_CD = '228'
        </selectKey>
        MERGE INTO TB_HQ_NMCODE thn
        USING DUAL
        ON (
                HQ_OFFICE_CD = #{hqOfficeCd}
                AND NMCODE_GRP_CD = '228'
                AND NMCODE_NM = #{tukeyGrpCd}
                AND NMCODE_ITEM_1 = #{tukeyClassCd}
            )
        WHEN MATCHED THEN
            UPDATE
            SET
                NMCODE_ITEM_2   = #{storeModYn}
            ,   MOD_DT          = #{modDt}
            ,   MOD_ID          = #{modId}
        WHEN NOT MATCHED THEN
            INSERT
            (
                HQ_OFFICE_CD
            ,   NMCODE_GRP_CD
            ,   NMCODE_CD
            ,   PARENT_CD
            ,   NMCODE_NM
            ,   NMCODE_ITEM_1
            ,   NMCODE_ITEM_2
            ,   REG_DT
            ,   REG_ID
            ,   MOD_DT
            ,   MOD_ID
            )
            VALUES
            (
                #{hqOfficeCd}
            ,   '228'
            ,   #{nmcodeCd}
            ,   '228'
            ,   #{tukeyGrpCd}
            ,   #{tukeyClassCd}
            ,   #{storeModYn}
            ,   #{regDt}
            ,   #{regId}
            ,   #{modDt}
            ,   #{modId}
            )
    </insert>

    <!-- 터치키그룹_조회 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS, TB_HQ_TOUCH_KEY_GROUP
        PARAM    : touchKeyVO
        COMMENTS : 터치키그룹을 조회한다.
    -->
    <select id="getGrpList" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getGrpList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT 	DISTINCT thtkc.TUKEY_GRP_CD
                ,       thtkg.TUKEY_GRP_NM
                FROM 	TB_HQ_TOUCH_KEY_CLASS thtkc
                ,		TB_HQ_TOUCH_KEY_GROUP thtkg
                WHERE	thtkc.HQ_OFFICE_CD = thtkg.HQ_OFFICE_CD (+)
                AND 	thtkc.TUKEY_GRP_CD = thtkg.TUKEY_GRP_CD (+)
                AND     thtkc.HQ_OFFICE_CD = #{hqOfficeCd}
                ORDER BY thtkc.TUKEY_GRP_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT	DISTINCT tmtkc.TUKEY_GRP_CD
                ,       tmtkg.TUKEY_GRP_NM
                FROM 	TB_MS_TOUCH_KEY_CLASS tmtkc
                ,		TB_MS_TOUCH_KEY_GROUP tmtkg
                WHERE	tmtkc.STORE_CD = tmtkg.STORE_CD (+)
                AND 	tmtkc.TUKEY_GRP_CD = tmtkg.TUKEY_GRP_CD (+)
                AND     tmtkc.STORE_CD = #{storeCd}
                ORDER BY tmtkc.TUKEY_GRP_CD
            </when>
        </choose>
    </select>

    <!-- 터치키그룹 저장 -->
    <!--
        TABLE    : TB_MS_STORE
        PARAM    : touchKeyVO
        COMMENTS : 터치키그룹을 저장한다.
    -->
    <insert id="saveGrpNm" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.saveGrpNm */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
            MERGE INTO TB_HQ_TOUCH_KEY_GROUP thtkg
            USING DUAL
            ON (
                HQ_OFFICE_CD = #{hqOfficeCd}
            AND TUKEY_GRP_CD = #{tukeyGrpCd}
            )
            WHEN MATCHED THEN
            UPDATE
            SET
                TUKEY_GRP_NM   = #{tukeyGrpNm}
            ,   MOD_DT      = #{modDt}
            ,   MOD_ID      = #{modId}
            WHEN NOT MATCHED THEN
            INSERT
            (
                HQ_OFFICE_CD
            ,   TUKEY_GRP_CD
            ,   TUKEY_GRP_NM
            ,   REG_DT
            ,   REG_ID
            ,   MOD_DT
            ,   MOD_ID
            )
            VALUES
            (
                #{hqOfficeCd}
            ,   #{tukeyGrpCd}
            ,   #{tukeyGrpNm}
            ,   #{regDt}
            ,   #{regId}
            ,   #{modDt}
            ,   #{modId}
            )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
            MERGE INTO TB_MS_TOUCH_KEY_GROUP thtkg
            USING DUAL
            ON (
                STORE_CD = #{storeCd}
            AND TUKEY_GRP_CD = #{tukeyGrpCd}
            )
            WHEN MATCHED THEN
            UPDATE
            SET
                TUKEY_GRP_NM   = #{tukeyGrpNm}
            ,   MOD_DT      = #{modDt}
            ,   MOD_ID      = #{modId}
            WHEN NOT MATCHED THEN
            INSERT
            (
                STORE_CD
            ,   TUKEY_GRP_CD
            ,   TUKEY_GRP_NM
            ,   REG_DT
            ,   REG_ID
            ,   MOD_DT
            ,   MOD_ID
            )
            VALUES
            (
                #{storeCd}
            ,   #{tukeyGrpCd}
            ,   #{tukeyGrpNm}
            ,   #{regDt}
            ,   #{regId}
            ,   #{modDt}
            ,   #{modId}
            )
            </when>
        </choose>
    </insert>

    <!-- 분류 삭제 전 매장수정허용분류 체크 -->
    <!--
        TABLE    : TB_HQ_NMCODE
        PARAM    : DefaultMap
        COMMENTS : 분류 삭제 전 매장수정허용분류 체크한다.
    -->
    <select id="getDeleteClassChk" parameterType="touchKeyVO" resultType="Integer">
        /* USE : TouchkeyMapper.getDeleteClassChk */
        SELECT 	COUNT(*)
        FROM 	TB_HQ_NMCODE thn
        WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
        AND 	NMCODE_GRP_CD = '228'
        AND 	NMCODE_NM = #{tukeyGrpCd}
        AND 	NMCODE_ITEM_1 = #{tukeyClassCd}
        AND     NMCODE_ITEM_2 = 'Y'
    </select>

    <!-- 저장 전 매장수정허용분류 체크 -->
    <!--
        TABLE    : TB_HQ_NMCODE
        PARAM    : DefaultMap
        COMMENTS : 저장 전 매장수정허용분류 체크한다.
    -->
    <select id="getSaveClassChk" parameterType="touchKeyClassVO" resultType="Integer">
        /* USE : TouchkeyMapper.getSaveClassChk */
        SELECT 	COUNT(*)
        FROM 	TB_HQ_NMCODE thn
        WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
        AND 	NMCODE_GRP_CD = '228'
        AND 	NMCODE_NM = #{tukeyGrpCd}
        AND 	NMCODE_ITEM_1 = #{tukeyClassCd}
        AND     NMCODE_ITEM_2 = 'Y'
    </select>

    <!-- 매장목록 조회 -->
    <!--
        TABLE    : TB_MS_STORE
        PARAM    : touchKeyVO
        COMMENTS : 매장목록을 조회한다.
    -->
    <select id="getStoreList" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getStoreList */
        SELECT  (SELECT HQ_BRAND_NM FROM TB_HQ_BRAND thb WHERE thb.HQ_OFFICE_CD = tms.HQ_OFFICE_CD AND thb.HQ_BRAND_CD = tms.HQ_BRAND_CD) AS BRAND,
                tms.STORE_CD,
                tms.STORE_NM,
                tcm_sys_stat_fg.NMCODE_NM AS sys_stat_fg_nm,
                tcm_cls_stat_fg.NMCODE_NM AS cls_fg_nm
        FROM    TB_MS_STORE tms
        ,       TB_CM_NMCODE tcm_sys_stat_fg
        ,       TB_CM_NMCODE tcm_cls_stat_fg
        ,       TB_MS_STORE_INFO tmsi
        WHERE   tms.HQ_OFFICE_CD = #{hqOfficeCd}
        AND     tms.STORE_CD = tmsi.STORE_CD (+)
        AND     tms.SYS_STAT_FG = tcm_sys_stat_fg.NMCODE_CD (+)
        AND     tcm_sys_stat_fg.NMCODE_GRP_CD = '005'
        AND     tms.CLS_FG = tcm_cls_stat_fg.NMCODE_CD (+)
        AND     tcm_cls_stat_fg.NMCODE_GRP_CD = '001'
        <if test='storeCd != null and storeCd != ""'>
            AND tms.STORE_CD LIKE '%'||#{storeCd}||'%'
        </if>
        <if test='storeNm != null and storeNm != ""'>
            AND tms.STORE_NM LIKE '%'||#{storeNm}||'%'
        </if>
        <if test='sysStatFg != null and sysStatFg.toString() != ""'>
            AND tms.SYS_STAT_FG = #{sysStatFg}
        </if>
        <if test='clsFg != null and clsFg != ""'>
            AND tms.CLS_FG = #{clsFg}
        </if>
        <if test='storeHqBrandCd != null and storeHqBrandCd != ""'>
            AND tms.HQ_BRAND_CD = #{storeHqBrandCd} -- 매장브랜드 선택일때
        </if>
        <if test='storeHqBrandCd == null or storeHqBrandCd == ""'>
            <if test='userBrands != null and userBrands != ""'>
                -- 매장브랜드 전체일때
                AND tms.HQ_BRAND_CD IN
                <foreach collection="userBrandList" item="item" open=" (" separator="," close=")" >
                    #{item}
                </foreach>
            </if>
        </if>
        <if test='momsTeam != null and momsTeam != ""'>
            AND tmsi.MOMS_TEAM = #{momsTeam}
        </if>
        <if test='momsAcShop != null and momsAcShop != ""'>
            AND tmsi.MOMS_AC_SHOP = #{momsAcShop}
        </if>
        <if test='momsAreaFg != null and momsAreaFg != ""'>
            AND tmsi.MOMS_AREA_FG = #{momsAreaFg}
        </if>
        <if test='momsCommercial != null and momsCommercial != ""'>
            AND tmsi.MOMS_COMMERCIAL = #{momsCommercial}
        </if>
        <if test='momsShopType != null and momsShopType != ""'>
            AND tmsi.MOMS_SHOP_TYPE = #{momsShopType}
        </if>
        <if test='momsStoreManageType != null and momsStoreManageType != ""'>
            AND tmsi.MOMS_STORE_MANAGE_TYPE = #{momsStoreManageType}
        </if>
        <if test='branchCd != null and branchCd != ""'>
            AND tms.BRANCH_CD = #{branchCd}
        </if>
        ORDER BY tms.STORE_CD
    </select>

    <!-- 판매터치키 분류 매장삭제 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 매장에 적용되어 있는 판매터치키 분류 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyClassToStore" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.deleteTouchKeyClassToStore */
        DELETE
        FROM
            TB_MS_TOUCH_KEY_CLASS
        WHERE
            STORE_CD = #{storeCd}
            AND TUKEY_GRP_CD  = #{tukeyGrpCd}
    </delete>

    <!-- 판매터치키 매장삭제 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 매장에 적용되어 있는 판매터치키 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyToStore" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.deleteTouchKeyToStore */
        DELETE
        FROM
            TB_MS_TOUCH_KEY
        WHERE
            STORE_CD = #{storeCd}
            AND TUKEY_GRP_CD  = #{tukeyGrpCd}
    </delete>

    <!-- 판매터치키 매장삭제 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 매장에 적용되어 있는 판매터치키 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyToStore2" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.deleteTouchKeyToStore2 */
        DELETE
        FROM
            TB_MS_TOUCH_KEY
        WHERE
            STORE_CD = #{storeCd}
            AND TUKEY_GRP_CD  = #{tukeyGrpCd}
        AND 	TUKEY_GRP_CD || TUKEY_CLASS_CD NOT IN ( SELECT 	NMCODE_NM || NMCODE_ITEM_1
                                                        FROM 	TB_HQ_NMCODE thn
                                                        WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
                                                        AND     NMCODE_GRP_CD = '228'
                                                        AND 	NMCODE_ITEM_2 = 'Y')
    </delete>

    <!-- 터치키 매장적용 본사 라인수 적용(HQ: 0041, MS:1041) -->
    <!--
        TABLE    : TB_MS_STORE_ENVST
        PARAM    : touchKeyVO
        COMMENTS : 터치키 매장적용 본사 라인수 적용(TB_HQ_ENVST: 0041, TB_MS_STORE_ENVST:1041)
    -->
    <insert id="mergeStoreEnvst" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.mergeStoreEnvst */
            MERGE INTO TB_MS_STORE_ENVST A
            USING   (
                        SELECT  #{storeCd}      AS STORE_CD
                        ,       '1041'          AS ENVST_CD
                        ,       ENVST_VAL       AS ENVST_VAL
                        ,       DIRCT_IN_YN     AS DIRCT_IN_YN
                        ,       USE_YN          AS USE_YN
                        ,       #{regDt}        AS REG_DT
                        ,       #{regId}        AS REG_ID
                        FROM    TB_HQ_ENVST the
                        WHERE   HQ_OFFICE_CD    =   #{hqOfficeCd}
                        AND     ENVST_CD        =   '0041'
                    ) B
            ON      (
                        B.STORE_CD      =   A.STORE_CD
                    AND B.ENVST_CD      =   A.ENVST_CD
                    )
            WHEN MATCHED THEN
            UPDATE
            SET     A.ENVST_VAL     =   B.ENVST_VAL
            ,       A.DIRCT_IN_YN   =   B.DIRCT_IN_YN
            ,       A.USE_YN        =   B.USE_YN
            ,       A.MOD_DT        =   B.REG_DT
            ,       A.MOD_ID        =   B.REG_ID
            WHEN NOT MATCHED THEN
            INSERT
            (
                    A.STORE_CD
            ,       A.ENVST_CD
            ,       A.ENVST_VAL
            ,       A.DIRCT_IN_YN
            ,       A.USE_YN
            ,       A.REG_DT
            ,       A.REG_ID
            ,       A.MOD_DT
            ,       A.MOD_ID
            )
            VALUES
            (
                    B.STORE_CD
            ,       B.ENVST_CD
            ,       B.ENVST_VAL
            ,       B.DIRCT_IN_YN
            ,       B.USE_YN
            ,       B.REG_DT
            ,       B.REG_ID
            ,       B.REG_DT
            ,       B.REG_ID
            )
    </insert>

    <!-- 판매터치키 그룹 생성 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 그룹 정보를 생성한다.
    -->
    <insert id="insertTouchKeyGroupToStore" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.insertTouchKeyGroupToStore */
            INSERT INTO TB_MS_TOUCH_KEY_GROUP
            (
                STORE_CD
            ,   TUKEY_GRP_CD
            ,   TUKEY_GRP_NM
            ,   REG_DT
            ,   REG_ID
            ,   MOD_DT
            ,   MOD_ID
            )
            SELECT  #{storeCd} AS STORE_CD
            ,       TUKEY_GRP_CD
            ,       TUKEY_GRP_NM
            ,       REG_DT
            ,       REG_ID
            ,       MOD_DT
            ,       MOD_ID
            FROM    TB_HQ_TOUCH_KEY_GROUP
            WHERE   HQ_OFFICE_CD = #{hqOfficeCd}
            AND     TUKEY_GRP_CD = #{tukeyGrpCd}
    </insert>

    <!-- 판매터치키 분류 생성 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 분류 정보를 생성한다.
    -->
    <insert id="insertTouchKeyClassToStore" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.insertTouchKeyClassToStore */
        INSERT INTO TB_MS_TOUCH_KEY_CLASS tmtkc
        (
                tmtkc.STORE_CD
        ,       tmtkc.TUKEY_GRP_CD
        ,       tmtkc.TUKEY_CLASS_CD
        ,       tmtkc.TUKEY_CLASS_NM
        ,       tmtkc.PAGE_NO
        ,       tmtkc.PAGE_ROWS
        ,       tmtkc.X
        ,       tmtkc.Y
        ,       tmtkc.WIDTH
        ,       tmtkc.HEIGHT
        ,       tmtkc.STYLE_CD
        ,       tmtkc.FONT_SIZE
        ,       tmtkc.FONT_COLOR
        ,       tmtkc.FILL_COLOR
        ,       tmtkc.IMG_NM
        ,       tmtkc.IN_FG
        ,       tmtkc.REG_DT
        ,       tmtkc.REG_ID
        ,       tmtkc.MOD_DT
        ,       tmtkc.MOD_ID
        )
        SELECT
            #{storeCd} AS STORE_CD,
            TUKEY_GRP_CD,
            TUKEY_CLASS_CD,
            TUKEY_CLASS_NM,
            PAGE_NO,
            PAGE_ROWS,
            X,
            Y,
            WIDTH,
            HEIGHT,
            STYLE_CD,
            FONT_SIZE,
            FONT_COLOR,
            FILL_COLOR,
            IMG_NM,
            'H',
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        FROM
            TB_HQ_TOUCH_KEY_CLASS
        WHERE
            HQ_OFFICE_CD = #{hqOfficeCd}
            AND TUKEY_GRP_CD = #{tukeyGrpCd}
    </insert>

    <!-- 판매터치키 생성 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 정보를 생성한다.
    -->
    <insert id="insertTouchKeyToStore" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.insertTouchKeyToStore */
        INSERT INTO TB_MS_TOUCH_KEY thtk
        (
            thtk.STORE_CD,
            thtk.TUKEY_CLASS_CD,
            thtk.TUKEY_CD,
            thtk.TUKEY_FG,
            thtk.PROD_CD,
            thtk.PAGE_NO,
            thtk.X,
            thtk.Y,
            thtk.WIDTH,
            thtk.HEIGHT,
            thtk.STYLE_CD,
            thtk.FONT_SIZE,
            thtk.FONT_COLOR,
            thtk.FILL_COLOR,
            thtk.IMG_NM,
            thtk.IN_FG,
            thtk.REG_DT,
            thtk.REG_ID,
            thtk.MOD_DT,
            thtk.MOD_ID,
            thtk.TUKEY_GRP_CD
        )
        SELECT
            #{storeCd} AS STORE_CD,
            TUKEY_CLASS_CD,
            TUKEY_CD,
            TUKEY_FG,
            PROD_CD,
            PAGE_NO,
            X,
            Y,
            WIDTH,
            HEIGHT,
            STYLE_CD,
            FONT_SIZE,
            FONT_COLOR,
            FILL_COLOR,
            IMG_NM,
            'H',
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID,
            TUKEY_GRP_CD
        FROM
            TB_HQ_TOUCH_KEY
        WHERE
            HQ_OFFICE_CD = #{hqOfficeCd}
            AND TUKEY_GRP_CD = #{tukeyGrpCd}
    </insert>


    <!-- 판매터치키 생성 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 정보를 생성한다.
    -->
    <insert id="insertTouchKeyToStore2" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.insertTouchKeyToStore2 */
        INSERT INTO TB_MS_TOUCH_KEY thtk
        (
            thtk.STORE_CD,
            thtk.TUKEY_CLASS_CD,
            thtk.TUKEY_CD,
            thtk.TUKEY_FG,
            thtk.PROD_CD,
            thtk.PAGE_NO,
            thtk.X,
            thtk.Y,
            thtk.WIDTH,
            thtk.HEIGHT,
            thtk.STYLE_CD,
            thtk.FONT_SIZE,
            thtk.FONT_COLOR,
            thtk.FILL_COLOR,
            thtk.IMG_NM,
            thtk.IN_FG,
            thtk.REG_DT,
            thtk.REG_ID,
            thtk.MOD_DT,
            thtk.MOD_ID,
            thtk.TUKEY_GRP_CD
        )
        SELECT
            #{storeCd} AS STORE_CD,
            TUKEY_CLASS_CD,
            TUKEY_CD,
            TUKEY_FG,
            PROD_CD,
            PAGE_NO,
            X,
            Y,
            WIDTH,
            HEIGHT,
            STYLE_CD,
            FONT_SIZE,
            FONT_COLOR,
            FILL_COLOR,
            IMG_NM,
            'H',
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID,
            TUKEY_GRP_CD
        FROM
            TB_HQ_TOUCH_KEY
        WHERE
            HQ_OFFICE_CD = #{hqOfficeCd}
            AND TUKEY_GRP_CD = #{tukeyGrpCd}
          AND 	TUKEY_GRP_CD || TUKEY_CLASS_CD NOT IN ( SELECT 	NMCODE_NM || NMCODE_ITEM_1
                                                         FROM 	TB_HQ_NMCODE thn
                                                         WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
                                                           AND     NMCODE_GRP_CD = '228'
                                                           AND 	NMCODE_ITEM_2 = 'Y')
    </insert>

    <!-- 판매터치키 XML 정보생성 -->
    <!--
        TABLE    : TB_WB_STORE_CONFG_XML
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 XML 정보를 생성한다.
    -->
    <update id="saveStoreConfgXml" parameterType="touchKeyVO">
        /* TouchkeyMapper.saveStoreConfgXml */
        MERGE INTO TB_WB_STORE_CONFG_XML twscx
        USING
        (
            SELECT
                #{storeCd} AS STORE_CD,
                CONFG_FG,
                XML,
                USE_YN,
                GRP_CD
            FROM
                TB_WB_HQ_CONFG_XML
            WHERE
                HQ_OFFICE_CD = #{hqOfficeCd}
                AND CONFG_FG = '10'
                AND GRP_CD = #{tukeyGrpCd}
        ) ORG
        ON
        (
            twscx.STORE_CD = ORG.STORE_CD
            AND twscx.CONFG_FG = ORG.CONFG_FG
            AND twscx.GRP_CD = ORG.GRP_CD
        )
        WHEN MATCHED THEN
            UPDATE
            SET
                twscx.XML = ORG.XML,
                twscx.USE_YN = 'Y',
                twscx.MOD_DT = #{regDt},
                twscx.MOD_ID = #{regId}
        WHEN NOT MATCHED THEN
            INSERT
            (
                twscx.STORE_CD,
                twscx.CONFG_FG,
                twscx.XML,
                twscx.USE_YN,
                twscx.REG_DT,
                twscx.REG_ID,
                twscx.GRP_CD
            )
            VALUES
            (
                #{storeCd},
                ORG.CONFG_FG,
                ORG.XML,
                'Y',
                #{regDt},
                #{regId},
                #{tukeyGrpCd}
            )
  </update>

    <!-- 판매터치키 그룹 조회 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 그룹(템플릿)을 조회한다.
    -->
    <select id="getTouchKeyGrp" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyGrp */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT  DISTINCT thtkc.TUKEY_GRP_CD AS VALUE
                ,       NVL2(thtkg.TUKEY_GRP_NM, '[' || thtkc.TUKEY_GRP_CD || ']' || thtkg.TUKEY_GRP_NM,  '[' ||thtkc.TUKEY_GRP_CD || ']') AS NAME
                FROM    TB_HQ_TOUCH_KEY_CLASS thtkc
                ,       TB_HQ_TOUCH_KEY_GROUP thtkg
                WHERE   thtkc.HQ_OFFICE_CD = #{hqOfficeCd}
                AND     thtkc.HQ_OFFICE_CD = thtkg.HQ_OFFICE_CD(+)
                AND     thtkc.TUKEY_GRP_CD = thtkg.TUKEY_GRP_CD(+)
                ORDER BY thtkc.TUKEY_GRP_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT  DISTINCT tmtkc.TUKEY_GRP_CD AS VALUE
                ,       NVL2(tmtkg.TUKEY_GRP_NM, '[' || tmtkc.TUKEY_GRP_CD || ']' || tmtkg.TUKEY_GRP_NM,  '[' ||tmtkc.TUKEY_GRP_CD || ']') AS NAME
                FROM    TB_MS_TOUCH_KEY_CLASS tmtkc
                ,       TB_MS_TOUCH_KEY_GROUP tmtkg
                WHERE   tmtkc.STORE_CD = #{storeCd}
                AND     tmtkc.STORE_CD = tmtkg.STORE_CD(+)
                AND     tmtkc.TUKEY_GRP_CD = tmtkg.TUKEY_GRP_CD(+)
                ORDER BY DECODE(tmtkc.TUKEY_GRP_CD, #{envstVal}, 1), tmtkc.TUKEY_GRP_CD
            </when>
        </choose>
    </select>

    <!-- 터치키 그룹코드 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : DefaultMap
        COMMENTS : 터치키 그룹코드를 생성한다. ( 본사/매장 )
    -->
    <select id="getTouchKeyGrpCd" parameterType="DefaultMap" resultType="String">
        /* USE : TouchkeyMapper.getTouchKeyGrpCd */
        <choose>
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT GRP_CD
                FROM TB_CM_GROUP_CODE_TOUCHKEY_KIOSKKEYMAP
                WHERE 1=1
                AND SEQ = (
                                SELECT
                                NVL(MAX(B.SEQ), 0) +1
                                FROM TB_HQ_TOUCH_KEY_CLASS A,
                                TB_CM_GROUP_CODE_TOUCHKEY_KIOSKKEYMAP B
                                WHERE 1=1
                                AND A.HQ_OFFICE_CD = #{hqOfficeCd}
                                AND B.GRP_CD (+)= A.TUKEY_GRP_CD
                            )
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT GRP_CD
                FROM TB_CM_GROUP_CODE_TOUCHKEY_KIOSKKEYMAP
                WHERE 1=1
                AND SEQ = (
                                SELECT
                                NVL(MAX(B.SEQ), 0) +1
                                FROM TB_MS_TOUCH_KEY_CLASS A,
                                TB_CM_GROUP_CODE_TOUCHKEY_KIOSKKEYMAP B
                                WHERE 1=1
                                AND A.STORE_CD = #{storeCd}
                                AND B.GRP_CD (+)= A.TUKEY_GRP_CD
                            )
            </when>
        </choose>
    </select>

    <!-- 터치키 XML 데이터 복사 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : touchKeyVO
        COMMENTS : 터치키 XML 데이터 복사
    -->
    <insert id="copyTouchKeyGrpXml" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.copyTouchKeyGrpXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_WB_HQ_CONFG_XML
                (
                HQ_OFFICE_CD,
                CONFG_FG,
                XML,
                USE_YN,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                GRP_CD
                )
                SELECT HQ_OFFICE_CD,
                        CONFG_FG,
                        XML,
                        USE_YN,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId},
                        #{tukeyGrpCd}
                  FROM TB_WB_HQ_CONFG_XML
                 WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                    AND CONFG_FG = '10'
                    AND GRP_CD = #{copyTukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_WB_STORE_CONFG_XML
                (
                STORE_CD,
                CONFG_FG,
                XML,
                USE_YN,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                GRP_CD
                )
                SELECT STORE_CD,
                        CONFG_FG,
                        XML,
                        USE_YN,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId},
                        #{tukeyGrpCd}
                  FROM TB_WB_STORE_CONFG_XML
                 WHERE STORE_CD = #{storeCd}
                   AND CONFG_FG = '10'
                   AND GRP_CD = #{copyTukeyGrpCd}
            </when>
        </choose>
    </insert>

    <!-- 터치키 CLASS 데이터 복사 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 터치키 CLASS 데이터 복사
    -->
    <insert id="copyTouchKeyGrpClass" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.copyTouchKeyGrpClass */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY_CLASS
                (
                HQ_OFFICE_CD,
                TUKEY_GRP_CD,
                TUKEY_CLASS_CD,
                TUKEY_CLASS_NM,
                PAGE_NO,
                PAGE_ROWS,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID
                )
                SELECT HQ_OFFICE_CD,
                        #{tukeyGrpCd},
                        TUKEY_CLASS_CD,
                        TUKEY_CLASS_NM,
                        PAGE_NO,
                        PAGE_ROWS,
                        X,
                        Y,
                        WIDTH,
                        HEIGHT,
                        STYLE_CD,
                        FONT_SIZE,
                        FONT_COLOR,
                        FILL_COLOR,
                        IMG_NM,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId}
                  FROM TB_HQ_TOUCH_KEY_CLASS
                 WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                   AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY_CLASS
                (
                STORE_CD,
                TUKEY_GRP_CD,
                TUKEY_CLASS_CD,
                TUKEY_CLASS_NM,
                PAGE_NO,
                PAGE_ROWS,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                IN_FG,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID
                )
                SELECT STORE_CD,
                        #{tukeyGrpCd},
                        TUKEY_CLASS_CD,
                        TUKEY_CLASS_NM,
                        PAGE_NO,
                        PAGE_ROWS,
                        X,
                        Y,
                        WIDTH,
                        HEIGHT,
                        STYLE_CD,
                        FONT_SIZE,
                        FONT_COLOR,
                        FILL_COLOR,
                        IMG_NM,
                        IN_FG,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId}
                  FROM TB_MS_TOUCH_KEY_CLASS
                 WHERE STORE_CD = #{storeCd}
                   AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
        </choose>
    </insert>

    <!-- 터치키 데이터 복사 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 터치키 데이터 복사
    -->
    <insert id="copyTouchKeyGrp" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.copyTouchKeyGrp */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY
                (
                HQ_OFFICE_CD,
                TUKEY_CLASS_CD,
                TUKEY_CD,
                TUKEY_FG,
                PROD_CD,
                PAGE_NO,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                TUKEY_GRP_CD
                )
                SELECT HQ_OFFICE_CD,
                        TUKEY_CLASS_CD,
                        TUKEY_CD,
                        TUKEY_FG,
                        PROD_CD,
                        PAGE_NO,
                        X,
                        Y,
                        WIDTH,
                        HEIGHT,
                        STYLE_CD,
                        FONT_SIZE,
                        FONT_COLOR,
                        FILL_COLOR,
                        IMG_NM,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId},
                        #{tukeyGrpCd}
                  FROM TB_HQ_TOUCH_KEY
                 WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                   AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY
                (
                STORE_CD,
                TUKEY_CLASS_CD,
                TUKEY_CD,
                TUKEY_FG,
                PROD_CD,
                PAGE_NO,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                IN_FG,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                TUKEY_GRP_CD
                )
                SELECT STORE_CD,
                TUKEY_CLASS_CD,
                TUKEY_CD,
                TUKEY_FG,
                PROD_CD,
                PAGE_NO,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                IN_FG,
                #{regDt},
                #{regId},
                #{modDt},
                #{modId},
                #{tukeyGrpCd}
                FROM TB_MS_TOUCH_KEY
                WHERE STORE_CD = #{storeCd}
                AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
        </choose>
    </insert>

    <!-- 터치키 그룹명 복사 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_GROUP, TB_MS_TOUCH_KEY_GROUP
        PARAM    : touchKeyVO
        COMMENTS : 터치키 그룹명 복사
    -->
    <insert id="copyTouchKeyGrpNm" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.copyTouchKeyGrpNm */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                MERGE INTO TB_HQ_TOUCH_KEY_GROUP A
                    USING   (
                        SELECT  HQ_OFFICE_CD
                        ,       #{tukeyGrpCd} AS TUKEY_GRP_CD
                        ,		TUKEY_GRP_NM
                        ,       #{regDt} AS REG_DT
                        ,       #{regId} AS REG_ID
                        ,       #{modDt} AS MOD_DT
                        ,       #{modId} AS MOD_ID
                        FROM    TB_HQ_TOUCH_KEY_GROUP
                        WHERE   HQ_OFFICE_CD = #{hqOfficeCd}
                        AND     TUKEY_GRP_CD = #{copyTukeyGrpCd}
                    ) B
                    ON (
                        A.HQ_OFFICE_CD = B.HQ_OFFICE_CD
                    AND A.TUKEY_GRP_CD = B.TUKEY_GRP_CD
                    )
                WHEN MATCHED THEN
                UPDATE
                SET A.TUKEY_GRP_NM = B.TUKEY_GRP_NM
                ,   A.MOD_DT = B.MOD_DT
                ,   A.MOD_ID = B.MOD_ID
                WHEN NOT MATCHED THEN
                INSERT
                (
                    A.HQ_OFFICE_CD
                ,   A.TUKEY_GRP_CD
                ,   A.TUKEY_GRP_NM
                ,   A.REG_DT
                ,   A.REG_ID
                ,   A.MOD_DT
                ,   A.MOD_ID
                )
                VALUES
                (
                    B.HQ_OFFICE_CD
                ,   B.TUKEY_GRP_CD
                ,   B.TUKEY_GRP_NM
                ,   B.REG_DT
                ,   B.REG_ID
                ,   B.MOD_DT
                ,   B.MOD_ID
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                MERGE INTO TB_MS_TOUCH_KEY_GROUP A
                USING   (
                SELECT  STORE_CD
                ,       #{tukeyGrpCd} AS TUKEY_GRP_CD
                ,		TUKEY_GRP_NM
                ,       #{regDt} AS REG_DT
                ,       #{regId} AS REG_ID
                ,       #{modDt} AS MOD_DT
                ,       #{modId} AS MOD_ID
                FROM    TB_MS_TOUCH_KEY_GROUP
                WHERE   STORE_CD = #{storeCd}
                AND     TUKEY_GRP_CD = #{copyTukeyGrpCd}
                ) B
                ON (
                A.STORE_CD = B.STORE_CD
                AND A.TUKEY_GRP_CD = B.TUKEY_GRP_CD
                )
                WHEN MATCHED THEN
                UPDATE
                SET A.TUKEY_GRP_NM = B.TUKEY_GRP_NM
                ,   A.MOD_DT = B.MOD_DT
                ,   A.MOD_ID = B.MOD_ID
                WHEN NOT MATCHED THEN
                INSERT
                (
                    A.STORE_CD
                ,   A.TUKEY_GRP_CD
                ,   A.TUKEY_GRP_NM
                ,   A.REG_DT
                ,   A.REG_ID
                ,   A.MOD_DT
                ,   A.MOD_ID
                )
                VALUES
                (
                    B.STORE_CD
                ,   B.TUKEY_GRP_CD
                ,   B.TUKEY_GRP_NM
                ,   B.REG_DT
                ,   B.REG_ID
                ,   B.MOD_DT
                ,   B.MOD_ID
                )
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 조회 - 데이터 기준으로 XML 만들기 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY
        PARAM    : DefaultMap
        COMMENTS :  판매터치키 조회 - 데이터 기준으로 XML 만들기
    -->
    <select id="getTouchKeyXmlByData" parameterType="DefaultMap" resultType="java.lang.String">
        /* USE : TouchkeyMapper.getTouchKeyXmlByData */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT CONCAT
                (
                    ( SELECT XMLElement("mxGraphModel"
                                ,XMLElement("root"
                                    ,XMLElement("mxCell",XMLAttributes(0 AS "id"))
                                    ,XMLElement("mxCell",XMLAttributes(1 AS "id", 0 AS "parent"))
                                    ,XMLAGG(XMLElement("mxCell"
                                    ,XMLAttributes(id AS "id", TUKEY_CLASS_NM AS "value", style AS "style", parent AS "parent", vertex AS "vertex")
                                    ,CASE WHEN X != 0 AND Y != 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes( x AS "x" , y AS "y" ,width AS "width",height AS "height",geometry AS "as" ))
                                          WHEN X = 0 AND Y = 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes( width AS "width",height AS "height",geometry AS "as" ))
                                          WHEN X != 0 AND Y = 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes( x AS "x" ,width AS "width",height AS "height",geometry AS "as" ))
                                          WHEN X = 0 AND Y != 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes(  y AS "y" ,width AS "width",height AS "height",geometry AS "as" ))
                                          ELSE
                                            XMLElement("mxGeometry",XMLAttributes( x AS "x" , y AS "y" ,width AS "width",height AS "height",geometry AS "as" ))
                                      END
                             ) <!-- mxCell -->
                             ) <!-- XMLAGG -->
                             ) <!-- root -->
                             ).getClobVal() <!-- mxGraphModel -->
                        FROM (
                                 SELECT 'G'||TO_CHAR(( RANK() OVER(ORDER BY TUKEY_GRP_CD, TUKEY_CLASS_CD ) ) + 1) ID
                                        , REPLACE(REPLACE(TUKEY_CLASS_NM, CHR(10), '∧│enter│∧'), CHR(13), '∧│enter│∧') AS TUKEY_CLASS_NM
                                        , 'classCd='||TUKEY_CLASS_CD
                                        || ';rounded=0;styleCd='||STYLE_CD
                                        || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'G', '01', 'BUTTON_OFF_COLOR'))
                                        || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'G', '01', 'FONT_OFF_COLOR'))
                                        || ';fontSize=' ||NVL(FONT_SIZE , FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'G', '01', 'FONT_SIZE'))
                                        || ';' style
                                        , '1' parent
                                        , '1' vertex
                                        , width
                                        , height
                                        , 'geometry' as geometry
                                        , TUKEY_CLASS_CD
                                        , X + (PAGE_NO-1) * 500 as x
                                        , Y
                                   FROM TB_HQ_TOUCH_KEY_CLASS
                                  WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                                  ORDER
                                     BY Y, X
                             )
                  )
                  ,
                  '|' ||
                  (  SELECT XMLElement("mxGraphModel"
                                ,XMLElement("root"
                                    ,XMLElement("mxCell",XMLAttributes('0' AS "id" ) )
                                    ,XMLElement("mxCell",XMLAttributes('1' AS "id" ,'0' AS "parent" , '0' AS "visible" ) )
                                    ,XMLAGG(CASE WHEN TUKEY_FG = '01' THEN <!-- (SELECT XMLAGG(XMLElement("mxCell",XMLAttributes(parent AS id ,parent AS value, '0' AS parent , '0' AS visible )) -->
                                                   XMLElement("mxCell"
                                                   ,XMLAttributes(id AS "id", style AS "style", parent AS "parent", vertex AS "vertex")
                                                   ,XMLElement("mxGeometry", XMLAttributes(x AS "x", y AS "y", width AS "width", height AS "height", geometry AS "as")))
                                                 WHEN TUKEY_FG = '02' THEN
                                                   XMLElement("mxCell"
                                                   ,XMLAttributes(id AS "id", PROD_NM AS "value", style AS "style", parent AS "parent", vertex AS "vertex")
                                                   ,XMLElement("mxGeometry", XMLAttributes(x_NAME AS "x", y AS "y", width AS "width", height AS "height", geometry AS "as")))
                                                 WHEN TUKEY_FG = '03' THEN
                                                   XMLElement("mxCell"
                                                   ,XMLAttributes(id AS "id", SALE_UPRC AS "value", style AS "style", parent AS "parent", vertex AS "vertex")
                                                   ,XMLElement("mxGeometry", XMLAttributes(x_NAME AS "x", y AS "y", width AS "width", height AS "height", geometry AS "as")))
                                                 WHEN TUKEY_FG = '99' THEN
                                                   (
                                                      SELECT XMLAGG(XMLElement("mxCell", XMLAttributes(id AS "id", id AS "value", '0' AS "parent", '0' AS "visible")))
                                                        FROM (
                                                               SELECT TUKEY_CLASS_NM, TUKEY_CLASS_CD
                                                                      ,'G'||to_char((rank() over(order by TUKEY_GRP_CD, TUKEY_CLASS_CD )) + 1) id
                                                                 FROM TB_HQ_TOUCH_KEY_CLASS
                                                                WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                                                                  AND TUKEY_GRP_CD = #{tukeyGrpCd}
                                                             )
                                                   )
                                                 ELSE NULL
                                             END
                            ) <!-- XMLAGG -->
                            ) <!-- XMLElement -->
                            ).getClobVal() <!-- XMLElement("mxGraphModel", -->
                       FROM ( SELECT A.*
                                     , C.PROD_NM
                                     , B.SALE_UPRC
                                FROM ( SELECT A.TUKEY_FG
                                              , id
                                              , CASE WHEN A.TUKEY_FG = '01' THEN
                                                       'prodCd='||PROD_CD
                                                       || ';styleCd='||STYLE_CD
                                                       || ';tukeyFg='||A.TUKEY_FG
                                                       || ';rounded=0'
                                                       || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'BUTTON_OFF_COLOR'))
                                                       || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_OFF_COLOR'))
                                                       || ';fontSize='||NVL(FONT_SIZE, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_SIZE'))
                                                       || ';'
                                                     WHEN A.TUKEY_FG = '02' THEN <!-- prodCd=9000000000005;styleCd=02;tukeyFg=02;rounded=0;fillColor=#edf8ff;fontColor=#444444;fontSize=15; -->
                                                       'prodCd='||PROD_CD
                                                       || ';styleCd='||STYLE_CD
                                                       || ';tukeyFg='||A.TUKEY_FG
                                                       || ';rounded=0'
                                                       || ';strokeColor=none;resizable=0;selectable=1;movable=0;align=left;verticalAlign=top;whiteSpace=wrap;overflow=hidden'
                                                       || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'BUTTON_OFF_COLOR'))
                                                       || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_OFF_COLOR'))
                                                       || ';fontSize='||NVL(FONT_SIZE, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_SIZE'))
                                                       || ';'
                                                     WHEN A.TUKEY_FG = '03' THEN <!-- prodCd=9000000000005;styleCd=02;tukeyFg=03;rounded=0;fillColor=#edf8ff;fontColor=#0267fe;fontSize=15; -->
                                                       'prodCd='||PROD_CD
                                                       || ';styleCd='||STYLE_CD
                                                       || ';tukeyFg='||A.TUKEY_FG
                                                       || ';rounded=0'
                                                       || ';strokeColor=none;resizable=0;selectable=1;movable=0;align:right'
                                                       || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'BUTTON_OFF_COLOR'))
                                                       || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_OFF_COLOR'))
                                                       || ';fontSize='||NVL(FONT_SIZE, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_SIZE'))
                                                       || ';'
                                                     ELSE
                                                       'TUKEY_FG NOT FOUND'
                                                END AS style
                                              , '1' vertex
                                              , width
                                              , height
                                              , 'geometry' as geometry
                                              , X + (PAGE_NO-1) * 500 as x
                                              , X  as x_NAME   <!-- 상품명,가격 태그는 그대로 사용 -->
                                              , y
                                              , A.PROD_CD
                                              , A.HQ_OFFICE_CD
                                              , CASE WHEN A.ID = B.MIN_ID THEN
                                                       FN_GET_TOUCH_KEY_CLASS_ID2_HQ (#{hqOfficeCd}, #{tukeyGrpCd}, A.TUKEY_CLASS_CD)
                                                     ELSE
                                                       TO_CHAR(B.MIN_ID)
                                                 END PARENT
                                         FROM ( SELECT rank() over(order by A.TUKEY_GRP_CD, A.TUKEY_CLASS_CD, A.TUKEY_CD, TO_NUMBER(A.TUKEY_FG)) + 1 id
                                                       , A.*
                                                  FROM TB_HQ_TOUCH_KEY A
                                                 WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                                                   AND TUKEY_GRP_CD = #{tukeyGrpCd}
                                              ) A,
                                              ( SELECT HQ_OFFICE_CD
                                                       , TUKEY_GRP_CD
                                                       , TUKEY_CLASS_CD
                                                       , TUKEY_CD
                                                       , MIN(PARENT) MIN_ID
                                                  FROM ( SELECT HQ_OFFICE_CD
                                                                , TUKEY_GRP_CD
                                                                , TUKEY_CLASS_CD
                                                                , TUKEY_CD
                                                                , rank() over(order by TUKEY_GRP_CD, TUKEY_CLASS_CD, TUKEY_CD, TO_NUMBER(TUKEY_FG)) + 1 PARENT
                                                           FROM TB_HQ_TOUCH_KEY
                                                          WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                                                            AND TUKEY_GRP_CD = #{tukeyGrpCd})
                                                          GROUP
                                                             BY HQ_OFFICE_CD, TUKEY_GRP_CD, TUKEY_CLASS_CD, TUKEY_CD
                                              ) B
                                        WHERE A.HQ_OFFICE_CD = #{hqOfficeCd}
                                          AND A.TUKEY_GRP_CD = #{tukeyGrpCd}
                                          AND A.HQ_OFFICE_CD = B.HQ_OFFICE_CD
                                          AND A.TUKEY_GRP_CD = B.TUKEY_GRP_CD
                                          AND A.TUKEY_CLASS_CD = B.TUKEY_CLASS_CD
                                          AND A.TUKEY_CD = B.TUKEY_CD
                                     ) A, TB_HQ_PRODUCT_SALE_PRICE_V01 B, TB_HQ_PRODUCT C
                               WHERE A.HQ_OFFICE_CD = B.HQ_OFFICE_CD
                                 AND A.PROD_CD  = B.PROD_CD
                                 AND B.SALE_DATE = TO_CHAR(SYSDATE, 'yyyyMMdd')
                                 AND A.HQ_OFFICE_CD = C.HQ_OFFICE_CD
                                 AND A.PROD_CD = C.PROD_CD
                               UNION
                              SELECT '99', 0, '', '1', 0, 0, 'geometry', 0, 0, 0, '', #{hqOfficeCd}, '', '', 0 FROM DUAL
                            )
                     )
                ) FROM DUAL
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT CONCAT
                (
                    ( SELECT XMLElement("mxGraphModel"
                                ,XMLElement("root"
                                    ,XMLElement("mxCell",XMLAttributes(0 AS "id"))
                                    ,XMLElement("mxCell",XMLAttributes(1 AS "id", 0 AS "parent"))
                                    ,XMLAGG(XMLElement("mxCell"
                                    ,XMLAttributes(id AS "id", TUKEY_CLASS_NM AS "value", style AS "style", parent AS "parent", vertex AS "vertex")
                                    ,CASE WHEN X != 0 AND Y != 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes( x AS "x" , y AS "y" ,width AS "width",height AS "height",geometry AS "as" ))
                                          WHEN X = 0 AND Y = 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes( width AS "width",height AS "height",geometry AS "as" ))
                                          WHEN X != 0 AND Y = 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes( x AS "x" ,width AS "width",height AS "height",geometry AS "as" ))
                                          WHEN X = 0 AND Y != 0 THEN
                                            XMLElement("mxGeometry",XMLAttributes(  y AS "y" ,width AS "width",height AS "height",geometry AS "as" ))
                                          ELSE
                                            XMLElement("mxGeometry",XMLAttributes( x AS "x" , y AS "y" ,width AS "width",height AS "height",geometry AS "as" ))
                                     END
                             ) <!-- mxCell -->
                             ) <!-- XMLAGG -->
                             ) <!-- root -->
                             ).getClobVal() <!-- mxGraphModel -->
                        FROM (
                                 SELECT 'G'||TO_CHAR(( RANK() OVER(ORDER BY TUKEY_GRP_CD, TUKEY_CLASS_CD ) ) + 1) ID
                                        , REPLACE(REPLACE(TUKEY_CLASS_NM, CHR(10), '∧│enter│∧'), CHR(13), '∧│enter│∧') AS TUKEY_CLASS_NM
                                        , 'classCd='||TUKEY_CLASS_CD
                                        || ';rounded=0;styleCd='||STYLE_CD
                                        || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'G', '01', 'BUTTON_OFF_COLOR'))
                                        || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'G', '01', 'FONT_OFF_COLOR'))
                                        || ';fontSize=' ||NVL(FONT_SIZE , FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'G', '01', 'FONT_SIZE'))
                                        || ';' style
                                        , '1' parent
                                        , '1' vertex
                                        , width
                                        , height
                                        , 'geometry' as geometry
                                        , TUKEY_CLASS_CD
                                        , X + (PAGE_NO-1) * 500 as x
                                        , Y
                                   FROM TB_MS_TOUCH_KEY_CLASS
                                  WHERE STORE_CD = #{storeCd}
                                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
                              )
                    )
                    ,
                    '|' ||
                    (  SELECT XMLElement("mxGraphModel"
                                ,XMLElement("root"
                                     ,XMLElement("mxCell",XMLAttributes('0' AS "id" ) )
                                     ,XMLElement("mxCell",XMLAttributes('1' AS "id" ,'0' AS "parent" , '0' AS "visible" ) )
                                     ,XMLAGG(CASE WHEN TUKEY_FG = '01' THEN <!-- (SELECT XMLAGG(XMLElement("mxCell",XMLAttributes(parent AS id ,parent AS value, '0' AS parent , '0' AS visible )) -->
                                                    XMLElement("mxCell"
                                                    ,XMLAttributes(id AS "id", style AS "style", parent AS "parent", vertex AS "vertex")
                                                    ,XMLElement("mxGeometry", XMLAttributes(x AS "x", y AS "y", width AS "width", height AS "height", geometry AS "as")))
                                                  WHEN TUKEY_FG = '02' THEN
                                                    XMLElement("mxCell"
                                                    ,XMLAttributes(id AS "id", PROD_NM AS "value", style AS "style", parent AS "parent", vertex AS "vertex")
                                                    ,XMLElement("mxGeometry", XMLAttributes(x_NAME AS "x", y AS "y", width AS "width", height AS "height", geometry AS "as")))
                                                  WHEN TUKEY_FG = '03' THEN
                                                    XMLElement("mxCell"
                                                    ,XMLAttributes(id AS "id", SALE_UPRC AS "value", style AS "style", parent AS "parent", vertex AS "vertex")
                                                    ,XMLElement("mxGeometry", XMLAttributes(x_NAME AS "x", y AS "y", width AS "width", height AS "height", geometry AS "as")))
                                                  WHEN TUKEY_FG = '99' THEN
                                                    (
                                                      SELECT XMLAGG(XMLElement("mxCell", XMLAttributes(id AS "id", id AS "value", '0' AS "parent", '0' AS "visible")))
                                                        FROM (
                                                               SELECT TUKEY_CLASS_NM, TUKEY_CLASS_CD
                                                                      ,'G'||to_char((rank() over(order by TUKEY_GRP_CD, TUKEY_CLASS_CD )) + 1) id
                                                                 FROM TB_MS_TOUCH_KEY_CLASS
                                                                WHERE STORE_CD = #{storeCd}
                                                                  AND TUKEY_GRP_CD = #{tukeyGrpCd}
                                                             )
                                                    )
                                                  ELSE NULL
                                              END
                            ) <!-- XMLAGG -->
                            ) <!-- XMLElement -->
                            ).getClobVal() <!-- XMLElement("mxGraphModel", -->
                       FROM ( SELECT A.*
                                     , C.PROD_NM
                                     , B.SALE_UPRC
                                FROM ( SELECT A.TUKEY_FG
                                              ,id
                                              ,CASE WHEN A.TUKEY_FG = '01' THEN
                                                      'prodCd='||PROD_CD
                                                      || ';styleCd='||STYLE_CD
                                                      || ';tukeyFg='||A.TUKEY_FG
                                                      || ';rounded=0'
                                                      || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'BUTTON_OFF_COLOR'))
                                                      || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_OFF_COLOR'))
                                                      || ';fontSize='||NVL(FONT_SIZE, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_SIZE'))
                                                      || ';'
                                                    WHEN A.TUKEY_FG = '02' THEN <!-- prodCd=9000000000005;styleCd=02;tukeyFg=02;rounded=0;fillColor=#edf8ff;fontColor=#444444;fontSize=15; -->
                                                      'prodCd='||PROD_CD
                                                      || ';styleCd='||STYLE_CD
                                                      || ';tukeyFg='||A.TUKEY_FG
                                                      || ';rounded=0'
                                                      || ';strokeColor=none;resizable=0;selectable=1;movable=0;align=left;verticalAlign=top;whiteSpace=wrap;overflow=hidden'
                                                      || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'BUTTON_OFF_COLOR'))
                                                      || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_OFF_COLOR'))
                                                      || ';fontSize='||NVL(FONT_SIZE, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_SIZE'))
                                                      || ';'
                                                    WHEN A.TUKEY_FG = '03' THEN <!-- prodCd=9000000000005;styleCd=02;tukeyFg=03;rounded=0;fillColor=#edf8ff;fontColor=#0267fe;fontSize=15; -->
                                                      'prodCd='||PROD_CD
                                                      || ';styleCd='||STYLE_CD
                                                      || ';tukeyFg='||A.TUKEY_FG
                                                      || ';rounded=0'
                                                      || ';strokeColor=none;resizable=0;selectable=1;movable=0;align:right'
                                                      || ';fillColor='||NVL(FILL_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'BUTTON_OFF_COLOR'))
                                                      || ';fontColor='||NVL(FONT_COLOR, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_OFF_COLOR'))
                                                      || ';fontSize='||NVL(FONT_SIZE, FN_GET_TOUCH_KEY_STYLE(STYLE_CD, 'P', A.TUKEY_FG, 'FONT_SIZE'))
                                                      || ';'
                                                    ELSE
                                                      'TUKEY_FG NOT FOUND'
                                                END AS style
                                              , '1' vertex
                                              , width
                                              , height
                                              , 'geometry' as geometry
                                              , X + (PAGE_NO-1) * 500 as x
                                              , X  as x_NAME   <!-- 상품명,가격 태그는 그대로 사용 -->
                                              , y
                                              , A.PROD_CD
                                              , A.STORE_CD
                                              , CASE WHEN A.ID = B.MIN_ID THEN
                                                       FN_GET_TOUCH_KEY_CLASS_ID2_MS (#{storeCd}, #{tukeyGrpCd}, A.TUKEY_CLASS_CD)
                                                     ELSE
                                                       TO_CHAR(B.MIN_ID)
                                                 END PARENT
                                         FROM ( SELECT rank() over(order by A.TUKEY_GRP_CD, A.TUKEY_CLASS_CD, A.TUKEY_CD, TO_NUMBER(A.TUKEY_FG)) + 1 id
                                                       , A.*
                                                  FROM TB_MS_TOUCH_KEY A
                                                 WHERE STORE_CD = #{storeCd}
                                                   AND TUKEY_GRP_CD = #{tukeyGrpCd}
                                              ) A,
                                              ( SELECT STORE_CD
                                                       , TUKEY_GRP_CD
                                                       , TUKEY_CLASS_CD
                                                       , TUKEY_CD
                                                       , MIN(PARENT) MIN_ID
                                                  FROM ( SELECT STORE_CD
                                                                , TUKEY_GRP_CD
                                                                , TUKEY_CLASS_CD
                                                                , TUKEY_CD
                                                                , rank() over(order by TUKEY_GRP_CD, TUKEY_CLASS_CD, TUKEY_CD, TO_NUMBER(TUKEY_FG)) + 1 PARENT
                                                           FROM TB_MS_TOUCH_KEY
                                                          WHERE STORE_CD = #{storeCd}
                                                            AND TUKEY_GRP_CD = #{tukeyGrpCd})
                                                          GROUP
                                                             BY STORE_CD, TUKEY_GRP_CD, TUKEY_CLASS_CD, TUKEY_CD
                                              ) B
                                        WHERE A.STORE_CD = #{storeCd}
                                          AND A.TUKEY_GRP_CD = #{tukeyGrpCd}
                                          AND A.STORE_CD = B.STORE_CD
                                          AND A.TUKEY_GRP_CD = B.TUKEY_GRP_CD
                                          AND A.TUKEY_CLASS_CD = B.TUKEY_CLASS_CD
                                          AND A.TUKEY_CD = B.TUKEY_CD
                                      ) A, TB_MS_PRODUCT_SALE_PRICE_V01 B, TB_MS_PRODUCT C
                                WHERE A.STORE_CD = B.STORE_CD
                                  AND A.PROD_CD  = B.PROD_CD
                                  AND B.SALE_DATE = TO_CHAR(SYSDATE, 'yyyyMMdd')
                                  AND A.STORE_CD = C.STORE_CD
                                  AND A.PROD_CD = C.PROD_CD
                                UNION
                               SELECT '99', 0, '', '1', 0, 0, 'geometry', 0, 0, 0, '', #{storeCd}, '', '', 0 FROM DUAL
                           )
                    )
               ) FROM DUAL
            </when>
        </choose>
    </select>

    <!-- 터치키 분류코드 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : DefaultMap
        COMMENTS : 터치키 분류코드를 생성한다. (본사/매장)
    -->
    <select id="getTouchKeyClassCd" parameterType="DefaultMap" resultType="String">
        /* USE : TouchkeyMapper.getTouchKeyClassCd */
        <choose>
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT 'G' || LPAD(NVL(MAX(TO_NUMBER(SUBSTR(TUKEY_CLASS_CD, 2, 4))), 1) + 1, 4, '0') AS TUKEY_CLASS_CD
                FROM TB_HQ_TOUCH_KEY_CLASS
                WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                AND TUKEY_GRP_CD = #{tukeyGrpCd}
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT 'G' || LPAD(NVL(MAX(TO_NUMBER(SUBSTR(TUKEY_CLASS_CD, 2, 4))), 1) + 1, 4, '0') AS TUKEY_CLASS_CD
                  FROM TB_MS_TOUCH_KEY_CLASS
                 WHERE STORE_CD = #{storeCd}
                   AND TUKEY_GRP_CD = #{tukeyGrpCd}
            </when>
        </choose>
    </select>


    <!-- 터치키 분류코드 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : DefaultMap
        COMMENTS : 터치키 분류코드를 생성한다. (본사/매장)
    -->
    <select id="insertTouchKeyChk" parameterType="DefaultMap" resultType="Integer">
        /* USE : TouchkeyMapper.insertTouchKeyChk */
        SELECT  COUNT(*)
        FROM    TB_HQ_NMCODE thn
        WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
        AND     NMCODE_GRP_CD = '228'
        AND 	NMCODE_NM = #{tukeyGrpCd}
        AND 	NMCODE_ITEM_1 = #{tukeyClassCd}
        AND 	NMCODE_ITEM_2 = 'Y'
    </select>

    <!-- 판매 터치키 포스 조회 ENVST4038 -->
    <!--
          TABLE    : TB_MS_STORE
          PARAM    : kioskKeyMapVO
          COMMENTS : 판매 터치키 포스 조회한다.
    -->
    <select id="getTouchKeyEnv" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyEnv */
        SELECT  tms.STORE_NM
        ,       tms.STORE_CD
        ,       tmp.POS_NO
        ,       tms.SYS_STAT_FG
        ,		tmpe.ENVST_VAL AS ENV_4038
        ,       TO_CHAR(TO_DATE(tmpe.MOD_DT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS MOD_DT
        FROM    TB_MS_STORE tms
        ,       TB_MS_STORE_INFO tmsi
        ,       (
                    SELECT  tmp.STORE_CD
                    ,       tmp.POS_NO
                    FROM    TB_MS_POS_ENVST tmpe
                    ,       TB_MS_POS tmp
                    WHERE   tmpe.STORE_CD = tmp.STORE_CD
                    AND     tmpe.POS_NO = tmp.POS_NO
                    AND     tmpe.ENVST_CD = '4019'
                    AND     tmpe.ENVST_VAL IN ('1', '2', '3')
                ) tmp
        ,		TB_MS_POS_ENVST tmpe
        WHERE   tms.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='orgnFg != null and orgnFg == "S"'>
            AND tms.STORE_CD = #{storeCd}
        </if>
        AND     tmp.STORE_CD = tms.STORE_CD
        AND     tms.STORE_CD = tmsi.STORE_CD(+)
        AND     tms.STORE_CD = tmsi.STORE_CD(+)
        AND 	tms.STORE_CD = tmpe.STORE_CD(+)
        AND 	tmp.POS_NO = tmpe.POS_NO(+)
        AND 	'4038' = tmpe.ENVST_CD(+)
        <if test='tukeyGrpCd != null and tukeyGrpCd != ""'>
            AND tmpe.ENVST_VAL = #{tukeyGrpCd}
        </if>
        <if test="storeCd != null and storeCd != ''">
            AND tms.STORE_CD LIKE '%'||#{storeCd}||'%' --매장코드
        </if>
        <if test="storeNm != null and storeNm != ''">
            AND tms.STORE_NM LIKE '%'||#{storeNm}||'%' --매장명
        </if>
        <if test="sysStatFg != null and sysStatFg != ''">
            AND tms.SYS_STAT_FG = #{sysStatFg} --매장상태구분
        </if>
        <if test='storeHqBrandCd != null and storeHqBrandCd != ""'>
            AND tms.HQ_BRAND_CD = #{storeHqBrandCd} -- 선택한 매장브랜드가 있을 때
        </if>
        <if test='momsTeam != null and momsTeam != ""'>
            AND tmsi.MOMS_TEAM = #{momsTeam}
        </if>
        <if test='momsAcShop != null and momsAcShop != ""'>
            AND tmsi.MOMS_AC_SHOP = #{momsAcShop}
        </if>
        <if test='momsAreaFg != null and momsAreaFg != ""'>
            AND tmsi.MOMS_AREA_FG = #{momsAreaFg}
        </if>
        <if test='momsCommercial != null and momsCommercial != ""'>
            AND tmsi.MOMS_COMMERCIAL = #{momsCommercial}
        </if>
        <if test='momsShopType != null and momsShopType != ""'>
            AND tmsi.MOMS_SHOP_TYPE = #{momsShopType}
        </if>
        <if test='momsStoreManageType != null and momsStoreManageType != ""'>
            AND tmsi.MOMS_STORE_MANAGE_TYPE = #{momsStoreManageType}
        </if>
        <if test='branchCd != null and branchCd != ""'>
            AND tms.BRANCH_CD = #{branchCd}
        </if>
        <if test='storeHqBrandCd == null or storeHqBrandCd == ""'>
            <if test='userBrands != null and userBrands != ""'>
                -- 선택한 매장브랜드가 없을 때('전체' 일때), 사용자 관리브랜드에 속한 정보만 조회
                AND tms.HQ_BRAND_CD IN
                <foreach collection="userBrandList" item="item" open=" (" separator="," close=")" >
                    #{item}
                </foreach>
            </if>
        </if>
        ORDER
        BY      tms.STORE_CD, tmp.POS_NO ASC
    </select>


    <!-- 판매 터치키 포스에 적용 ENVST4038 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매 터치키 포스에 적용한다.
    -->
    <update id="saveTouchKeyEnv" parameterType="DefaultMap">
    /* USE : TouchkeyMapper.saveTouchKeyEnv */
    MERGE INTO TB_MS_POS_ENVST
        USING DUAL
        ON  (
                STORE_CD = #{storeCd}
                AND POS_NO = #{posNo}
                AND ENVST_CD = '4038'
            )
        WHEN MATCHED THEN
            UPDATE
            SET     ENVST_VAL = #{envstVal}
            ,       MOD_DT = #{modDt}
            ,       MOD_ID = #{modId}
        WHEN NOT MATCHED THEN
            INSERT
            (
                 STORE_CD
            ,    POS_NO
            ,    ENVST_CD
            ,    ENVST_VAL
            ,    DIRCT_IN_YN
            ,    POS_FG
            ,    USE_YN
            ,    REG_DT
            ,    REG_ID
            ,    MOD_DT
            ,    MOD_ID
            ) VALUES (
                #{storeCd}
            ,   #{posNo}
            ,   '4038'
            ,   #{envstVal}
            ,   'Y'
            ,   'M'
            ,   'Y'
            ,   #{regDt}
            ,   #{regId}
            ,   #{modDt}
            ,   #{modId}
            )
    </update>

    <!-- 매장 판매터치키 그룹 ENVST4038 조회 -->
    <!--
        TABLE    :
        PARAM    :
        COMMENTS :
    -->
    <select id="getStoreTouchKeyGrp4038" parameterType="touchKeyVO" resultType="String">
        /* USE : TouchkeyMapper.getStoreTouchKeyGrp4038 */
        SELECT ENV_4038
        FROM
        (
            SELECT
            tmp.STORE_CD,
            tmp.POS_NO,
            tmpe.ENVST_VAL AS ENV_4038
            FROM TB_MS_POS_ENVST tmpe,
            (
                SELECT tmp.STORE_CD
                ,       tmp.POS_NO
                FROM   TB_MS_POS_ENVST tmpe
                ,       TB_MS_POS tmp
                WHERE  tmpe.STORE_CD = tmp.STORE_CD
                AND    tmpe.POS_NO = tmp.POS_NO
                AND    tmpe.ENVST_CD = '4019'
                AND    tmpe.ENVST_VAL IN ('1', '2', '3')
            ) tmp
            WHERE 1=1
            AND tmpe.STORE_CD = #{storeCd}
            AND tmpe.ENVST_CD = '4038'
            AND tmpe.STORE_CD (+)= tmp.STORE_CD
            AND tmpe.POS_NO (+)= tmp.POS_NO
            ORDER BY tmpe.STORE_CD, tmpe.POS_NO
        )
        WHERE 1=1
        <![CDATA[
            AND ROWNUM <= 1
        ]]>
    </select>

    <!-- 본사 판매터치키 매장적용(PKG 처리) -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_GROUP, TB_HQ_TOUCH_KEY_CLASS, TB_HQ_TOUCH_KEY,
                   TB_MS_TOUCH_KEY_GROUP, TB_MS_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY,
                   TB_MS_STORE_ENVST
        PARAM    : touchKeyVO
        COMMENTS : 본사 판매터치키를 매장적용한다.(PKG 처리)
    -->
    <select id="saveTouchKeyToStore" statementType="CALLABLE"  parameterType="touchKeyVO" resultType="String">
        /* USE : TouchkeyMapper.saveTouchKeyToStore */
        {
            CALL PKG_HQ_TOUCH_KEY.SP_HQ_TOUCH_KEY_TO_STORE_I
            (
                #{hqOfficeCd},
                #{storeCds},
                #{tukeyGrpCd},
                #{regId},
                #{result, mode=OUT, jdbcType=VARCHAR}
            )
        }
    </select>

    <!-- 매장사용터치키설정(PKG 처리) -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_GROUP, TB_HQ_TOUCH_KEY_CLASS, TB_HQ_TOUCH_KEY,
                   TB_MS_TOUCH_KEY_GROUP, TB_MS_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY,
                   TB_MS_STORE_ENVST
        PARAM    : touchKeyVO
        COMMENTS : 매장사용터치키를 설정한다.(PKG 처리)
    -->
    <select id="saveTouchKeyEnv2" statementType="CALLABLE"  parameterType="touchKeyVO" resultType="String">
        /* USE : TouchkeyMapper.saveTouchKeyEnv2 */
        {
            CALL PKG_HQ_TOUCH_KEY.SP_MS_TOUCH_KEY_ENV_IU
            (
                #{hqOfficeCd},
                #{storeCds},
                #{posNos},
                #{chkApplyStore},
                #{tukeyGrpCd},
                #{regId},
                #{result, mode=OUT, jdbcType=VARCHAR}
            )
        }
    </select>

    <!-- 터치키삭제 팝업 - 조회 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <select id="getPopUpTouchKeyDelList" parameterType="touchKeyVO" resultType="DefaultMap">
        /* TouchkeyMapper.getPopUpTouchKeyDelList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                DISTINCT A.TUKEY_GRP_CD,
                B.TUKEY_GRP_NM
                FROM TB_HQ_TOUCH_KEY_CLASS A,
                TB_HQ_TOUCH_KEY_GROUP B
                WHERE 1=1
                AND A.HQ_OFFICE_CD = #{hqOfficeCd}
                <if test='tukeyGrpCd != null and tukeyGrpCd != ""'>
                    AND A.TUKEY_GRP_CD LIKE '%'||#{tukeyGrpCd}||'%'
                </if>
                <if test='tukeyGrpNm != null and tukeyGrpNm != ""'>
                    AND B.TUKEY_GRP_NM LIKE '%'||#{tukeyGrpNm}||'%'
                </if>
                AND B.HQ_OFFICE_CD (+)= A.HQ_OFFICE_CD
                AND B.TUKEY_GRP_CD (+)= A.TUKEY_GRP_CD
                ORDER BY A.TUKEY_GRP_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                DISTINCT A.TUKEY_GRP_CD,
                B.TUKEY_GRP_NM
                FROM TB_MS_TOUCH_KEY_CLASS A,
                TB_MS_TOUCH_KEY_GROUP B
                WHERE 1=1
                AND A.STORE_CD = #{storeCd}
                <if test='tukeyGrpCd != null and tukeyGrpCd != ""'>
                    AND A.TUKEY_GRP_CD LIKE '%'||#{tukeyGrpCd}||'%'
                </if>
                <if test='tukeyGrpNm != null and tukeyGrpNm != ""'>
                    AND B.TUKEY_GRP_NM LIKE '%'||#{tukeyGrpNm}||'%'
                </if>
                AND B.STORE_CD (+)= A.STORE_CD
                AND B.TUKEY_GRP_CD (+)= A.TUKEY_GRP_CD
                ORDER BY A.TUKEY_GRP_CD
            </when>
        </choose>
    </select>

</mapper>
