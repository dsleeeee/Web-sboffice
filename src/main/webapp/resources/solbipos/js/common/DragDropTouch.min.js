var wijmo;!function(t){"use strict";var e=function(){function e(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(e.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(e){this._dropEffect=t.asString(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(e){this._effectAllowed=t.asString(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),e.prototype.clearData=function(t){null!=t?delete this._data[t]:this._data=null},e.prototype.getData=function(t){return this._data[t]||""},e.prototype.setData=function(t,e){this._data[t]=e},e.prototype.setDragImage=function(e,n,s){var o=i._instance;o._imgCustom=e,o._imgOffset=new t.Point(n,s)},e}();t.DataTransfer=e;var i=function(){function i(){if(this._lastClick=0,t.assert(!i._instance,"DragDropTouch instance already created."),"ontouchstart"in document){var e=document,n=this._touchstart.bind(this),s=this._touchmove.bind(this),o=this._touchend.bind(this);e.addEventListener("touchstart",n),e.addEventListener("touchmove",s),e.addEventListener("touchend",o),e.addEventListener("touchcancel",o)}}return i.getInstance=function(){return i._instance},i.prototype._touchstart=function(e){var n=this;if(this._shouldHandle(e)){if(Date.now()-this._lastClick<i._DBLCLICK&&this._dispatchEvent(e,"dblclick",e.target))return e.preventDefault(),void this._reset();this._reset();var s=t.closest(e.target,"[draggable]");s&&s.draggable&&(this._dispatchEvent(e,"mousemove",e.target)||this._dispatchEvent(e,"mousedown",e.target)||(this._dragSource=s,this._ptDown=this._getPoint(e),this._lastTouch=e,e.preventDefault(),setTimeout(function(){n._dragSource==s&&null==n._img&&n._dispatchEvent(e,"contextmenu",s)&&n._reset()},i._CTXMENU)))}},i.prototype._touchmove=function(t){if(this._shouldHandle(t)){var e=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",e))return this._lastTouch=t,void t.preventDefault();if(this._dragSource&&!this._img)this._getDelta(t)>i._THRESHOLD&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",e));this._img&&(this._lastTouch=t,t.preventDefault(),e!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",e),this._lastTarget=e),this._moveImage(t),this._dispatchEvent(t,"dragover",e))}},i.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target))return void t.preventDefault();this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},i.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},i.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._dataTransfer=new e},i.prototype._getPoint=function(e,i){return e&&e.touches&&(e=e.touches[0]),t.assert(e&&"clientX"in e,"invalid event?"),1==i?new t.Point(e.pageX,e.pageY):new t.Point(e.clientX,e.clientY)},i.prototype._getDelta=function(t){var e=this._getPoint(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)},i.prototype._getTarget=function(t){for(var e=this._getPoint(t),i=document.elementFromPoint(e.x,e.y);i&&"none"==getComputedStyle(i).pointerEvents;)i=i.parentElement;return i},i.prototype._createImage=function(e){this._img&&this._destroyImage();var n=this._imgCustom||this._dragSource;if(this._img=n.cloneNode(!0),this._copyStyle(n,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var s=n.getBoundingClientRect(),o=this._getPoint(e);this._imgOffset=new t.Point(o.x-s.left,o.y-s.top),this._img.style.opacity=i._OPACITY.toString()}this._moveImage(e),document.body.appendChild(this._img)},i.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},i.prototype._moveImage=function(e){var i=this;this._img&&requestAnimationFrame(function(){var n=i._getPoint(e,!0);t.setCss(i._img,{position:"absolute",pointerEvents:"none",zIndex:999999,left:Math.round(n.x-i._imgOffset.x),top:Math.round(n.y-i._imgOffset.y)})})},i.prototype._copyProps=function(t,e,i){for(var n=0;n<i.length;n++){var s=i[n];t[s]=e[s]}},i.prototype._copyStyle=function(t,e){if(i._rmvAtts.forEach(function(t){e.removeAttribute(t)}),t instanceof HTMLCanvasElement){var n=t,s=e;s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(n,0,0)}for(var o=getComputedStyle(t),r=0;r<o.length;r++){var a=o[r];e.style[a]=o[a]}e.style.pointerEvents="none";for(r=0;r<t.children.length;r++)this._copyStyle(t.children[r],e.children[r])},i.prototype._dispatchEvent=function(t,e,n){if(t&&n){var s=document.createEvent("Event"),o=t.touches?t.touches[0]:t;return s.initEvent(e,!0,!0),s.button=0,s.which=s.buttons=1,this._copyProps(s,t,i._kbdProps),this._copyProps(s,o,i._ptProps),s.dataTransfer=this._dataTransfer,n.dispatchEvent(s),s.defaultPrevented}return!1},i._instance=new i,i._THRESHOLD=5,i._OPACITY=.5,i._DBLCLICK=500,i._CTXMENU=900,i._rmvAtts="id,class,style,draggable".split(","),i._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),i._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),i}();t.DragDropTouch=i}(wijmo||(wijmo={}));
