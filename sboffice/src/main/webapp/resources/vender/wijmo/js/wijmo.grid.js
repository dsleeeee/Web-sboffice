/*
    *
    * Wijmo Library 5.20172.328
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
System.register(["wijmo/wijmo","wijmo/wijmo.grid"],function(n,t){"use strict";function ot(){var n;return(n=window.wijmo)&&n.input}var w=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ii=t&&t.id,i,ni,l,y,s,yt,st,r,p,k,u,e,ht,v,nt,h,ct,et,ft,rt,d,lt,at,f,c,o,pt,g,wt,ut,bt,tt,it,b,vt,ti,kt,dt,a,gt;return{setters:[function(n){i=n},function(n){ni=n}],execute:function(){window.wijmo=window.wijmo||{};window.wijmo.grid=ni;i.culture.FlexGrid=window.wijmo.culture.FlexGrid||{groupHeaderFormat:'{name}: <b>{value}</b> ({count:n0} items)'},function(n){n[n.None=0]="None";n[n.Column=1]="Column";n[n.Row=2]="Row";n[n.All=3]="All"}(l||(l={}));n("HeadersVisibility",l);y=function(n){function t(t,u){var e=n.call(this,t,null,!0)||this,o,s;e._szClient=new i.Size(0,0);e._ptScrl=new i.Point(0,0);e._cellPadding=3;e._autoGenCols=!0;e._autoClipboard=!0;e._readOnly=!1;e._indent=14;e._autoSizeMode=it.Both;e._hdrVis=l.All;e._alSorting=!0;e._alAddNew=!1;e._alDelete=!1;e._alResizing=tt.Columns;e._alDragging=b.Columns;e._alMerging=d.None;e._ssHdr=l.None;e._shSort=!0;e._shGroups=!0;e._shAlt=!0;e._shErr=!0;e._valEdt=!0;e._deferResizing=!1;e._pSel=!0;e._pOutline=!0;e._vt=0;e.itemsSourceChanged=new i.Event;e.scrollPositionChanged=new i.Event;e.selectionChanging=new i.Event;e.selectionChanged=new i.Event;e.loadingRows=new i.Event;e.loadedRows=new i.Event;e.updatingLayout=new i.Event;e.updatedLayout=new i.Event;e.resizingColumn=new i.Event;e.resizedColumn=new i.Event;e.autoSizingColumn=new i.Event;e.autoSizedColumn=new i.Event;e.draggingColumn=new i.Event;e.draggingColumnOver=new i.Event;e.draggedColumn=new i.Event;e.resizingRow=new i.Event;e.resizedRow=new i.Event;e.autoSizingRow=new i.Event;e.autoSizedRow=new i.Event;e.draggingRow=new i.Event;e.draggingRowOver=new i.Event;e.draggedRow=new i.Event;e.groupCollapsedChanging=new i.Event;e.groupCollapsedChanged=new i.Event;e.sortingColumn=new i.Event;e.sortedColumn=new i.Event;e.beginningEdit=new i.Event;e.prepareCellForEdit=new i.Event;e.cellEditEnding=new i.Event;e.cellEditEnded=new i.Event;e.rowEditStarting=new i.Event;e.rowEditStarted=new i.Event;e.rowEditEnding=new i.Event;e.rowEditEnded=new i.Event;e.rowAdded=new i.Event;e.deletingRow=new i.Event;e.deletedRow=new i.Event;e.copying=new i.Event;e.copied=new i.Event;e.pasting=new i.Event;e.pasted=new i.Event;e.pastingCell=new i.Event;e.pastedCell=new i.Event;e.formatItem=new i.Event;e.updatingView=new i.Event;e.updatedView=new i.Event;e._mappedColumns=null;o=e.hostElement;i.isIE()&&(o.style.borderRadius='0px');var h='tabindex',c=o.getAttribute(h),a=e.getTemplate();return e.applyTemplate('wj-control wj-flexgrid wj-content',a,{_root:'root',_eSz:'sz',_eCt:'cells',_fCt:'fcells',_eTL:'tl',_eBL:'bl',_eCHdr:'ch',_eRHdr:'rh',_eCFtr:'cf',_eTLCt:'tlcells',_eBLCt:'blcells',_eCHdrCt:'chcells',_eCFtrCt:'cfcells',_eRHdrCt:'rhcells',_eMarquee:'marquee',_eFocus:'focus'}),i.setAttribute(o,h,c),s=e._getDefaultRowHeight(),e.deferUpdate(function(){e._rows=new ft(e,s);e._cols=new et(e,s*4);e._hdrRows=new ft(e,s);e._hdrCols=new et(e,Math.round(s*1.25));e._ftrRows=new ft(e,s);e._gpTL=new p(e,r.TopLeft,e._hdrRows,e._hdrCols,e._eTLCt);e._gpCHdr=new p(e,r.ColumnHeader,e._hdrRows,e._cols,e._eCHdrCt);e._gpRHdr=new p(e,r.RowHeader,e._rows,e._hdrCols,e._eRHdrCt);e._gpCells=new p(e,r.Cell,e._rows,e._cols,e._eCt);e._gpBL=new p(e,r.BottomLeft,e._ftrRows,e._hdrCols,e._eBLCt);e._gpCFtr=new p(e,r.ColumnFooter,e._ftrRows,e._cols,e._eCFtrCt);e._hdrRows.push(new nt);e._hdrCols.push(new v);e._hdrCols[0].align='center';e._cf=new k;e._keyHdl=new wt(e);e._mouseHdl=new vt(e);e._edtHdl=new kt(e);e._selHdl=new pt(e);e._addHdl=new dt(e);e._mrgMgr=new lt(e);e._bndSortConverter=e._sortConverter.bind(e);e._bndScroll=e._scroll.bind(e);e.cells.hostElement.setAttribute('role','grid');e.selectionMode=f.CellRange;e.initialize(u)}),e.addEventListener(e._root,'scroll',function(){e._updateScrollPosition()&&(e.finishEditing(),e._updateContent(!0))}),e.addEventListener(o,'focus',function(n){if(o.tabIndex>-1){var t=n.target;if(t instanceof HTMLElement&&t.tabIndex<0){e._setFocus(!0);return}}},!0),e}return w(t,n),t.prototype._handleResize=function(){this._rcBounds=null;n.prototype._handleResize.call(this)},Object.defineProperty(t.prototype,"headersVisibility",{get:function(){return this._hdrVis},set:function(n){n!=this._hdrVis&&(this._hdrVis=i.asEnum(n,l),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stickyHeaders",{get:function(){return this._stickyHdr},set:function(n){n!=this._stickyHdr&&(this._stickyHdr=i.asBoolean(n),this._updateStickyHeaders(),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveSelectedState",{get:function(){return this._pSel},set:function(n){this._pSel=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveOutlineState",{get:function(){return this._pOutline},set:function(n){this._pOutline=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_virtualizationThreshold",{get:function(){return this._vt},set:function(n){this._vt=i.asNumber(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoGenerateColumns",{get:function(){return this._autoGenCols},set:function(n){this._autoGenCols=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoClipboard",{get:function(){return this._autoClipboard},set:function(n){this._autoClipboard=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnLayout",{get:function(){for(var h,e,r,n,u,o=t._getSerializableProperties(v),c=new v,s=[],f=0;f<this.columns.length;f++){for(h=this.columns[f],e={},r=0;r<o.length;r++)n=o[r],u=h[n],u!=c[n]&&i.isPrimitive(u)&&n!='size'&&(e[n]=u);s.push(e)}return JSON.stringify({columns:s})},set:function(n){var t=JSON.parse(i.asString(n));if(!t||t.columns==null)throw'Invalid columnLayout data.';this.columns.clear();this.initialize(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReadOnly",{get:function(){return this._readOnly},set:function(n){n!=this._readOnly&&(this._readOnly=i.asBoolean(n),this.finishEditing(),this.invalidate(!0),this._addHdl.updateNewRowTemplate(),i.toggleClass(this.hostElement,'wj-state-readonly',this.isReadOnly),this._setAria('readonly',this.isReadOnly?'true':null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imeEnabled",{get:function(){return this._imeHdl!=null},set:function(n){n!=this.imeEnabled&&(this._imeHdl&&(this._imeHdl.dispose(),this._imeHdl=null),n&&(this._imeHdl=new gt(this)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowResizing",{get:function(){return this._alResizing},set:function(n){this._alResizing=i.asEnum(n,tt)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deferResizing",{get:function(){return this._deferResizing},set:function(n){this._deferResizing=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSizeMode",{get:function(){return this._autoSizeMode},set:function(n){this._autoSizeMode=i.asEnum(n,it)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._alSorting},set:function(n){this._alSorting=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowAddNew",{get:function(){return this._alAddNew},set:function(n){n!=this._alAddNew&&(this._alAddNew=i.asBoolean(n),this._addHdl.updateNewRowTemplate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newRowAtTop",{get:function(){return this._addHdl.newRowAtTop},set:function(n){this._addHdl.newRowAtTop=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDelete",{get:function(){return this._alDelete},set:function(n){n!=this._alDelete&&(this._alDelete=i.asBoolean(n))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowMerging",{get:function(){return this._alMerging},set:function(n){n!=this._alMerging&&(this._alMerging=i.asEnum(n,d),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSelectedHeaders",{get:function(){return this._ssHdr},set:function(n){n!=this._ssHdr&&(this._ssHdr=i.asEnum(n,l),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showMarquee",{get:function(){return!this._eMarquee.style.display},set:function(n){if(n!=this.showMarquee){var t=this._eMarquee.style;t.visibility='collapse';t.display=i.asBoolean(n)?'':'none';this.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSort",{get:function(){return this._shSort},set:function(n){n!=this._shSort&&(this._shSort=i.asBoolean(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showGroups",{get:function(){return this._shGroups},set:function(n){n!=this._shGroups&&(this._shGroups=i.asBoolean(n),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showAlternatingRows",{get:function(){return this._shAlt},set:function(n){n!=this._shAlt&&(this._shAlt=i.asBoolean(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showErrors",{get:function(){return this._shErr},set:function(n){n!=this._shErr&&(this._shErr=i.asBoolean(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemValidator",{get:function(){return this._itemValidator},set:function(n){n!=this.itemValidator&&(this._itemValidator=i.asFunction(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validateEdits",{get:function(){return this._valEdt},set:function(n){this._valEdt=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupHeaderFormat",{get:function(){return this._gHdrFmt},set:function(n){n!=this._gHdrFmt&&(this._gHdrFmt=i.asString(n),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDragging",{get:function(){return this._alDragging},set:function(n){n!=this._alDragging&&(this._alDragging=i.asEnum(n,b),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemsSource",{get:function(){return this._items},set:function(n){var t;n!=this._items&&(this._cv&&(t=i.tryCast(this._cv,i.CollectionView),t&&t.sortConverter==this._bndSortConverter&&(t.sortConverter=null),this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null),this._items=n,this._cv=this._getCollectionView(n),this._lastCount=0,this._cv&&(this._cv.currentChanged.addHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this),t=i.tryCast(this._cv,i.CollectionView),t&&!t.sortConverter&&(t.sortConverter=this._bndSortConverter)),this._bindGrid(!0),this.onItemsSourceChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editableCollectionView",{get:function(){return i.tryCast(this._cv,'IEditableCollectionView')},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(n){n!=this._childItemsPath&&(i.assert(n==null||i.isArray(n)||i.isString(n),'childItemsPath should be an array or a string.'),this._childItemsPath=n,this._bindGrid(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaderPath",{get:function(){return this._rowHdrPath?this._rowHdrPath.path:null},set:function(n){n!=this.rowHeaderPath&&(n=i.asString(n),this._rowHdrPath=n?new i.Binding(n):null,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._gpCells},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnHeaders",{get:function(){return this._gpCHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnFooters",{get:function(){return this._gpCFtr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaders",{get:function(){return this._gpRHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeftCells",{get:function(){return this._gpTL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeftCells",{get:function(){return this._gpBL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),t.prototype.getColumn=function(n){return this.columns.getColumn(n)},Object.defineProperty(t.prototype,"frozenRows",{get:function(){return this.rows.frozen},set:function(n){this.rows.frozen=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozenColumns",{get:function(){return this.columns.frozen},set:function(n){this.columns.frozen=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cloneFrozenCells",{get:function(){return this._fzClone},set:function(n){n!=this.cloneFrozenCells&&(this._fzClone=i.asBoolean(n,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortRowIndex",{get:function(){return this._sortRowIndex},set:function(n){n!=this._sortRowIndex&&(this._sortRowIndex=i.asNumber(n,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollPosition",{get:function(){return this._ptScrl.clone()},set:function(n){var i=this._root,r=-n.x;if(this.rightToLeft)switch(t._getRtlMode()){case'rev':r=i.scrollWidth-i.clientWidth+n.x;break;case'neg':r=n.x;break;default:r=-n.x}i.scrollLeft=r;i.scrollTop=-n.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientSize",{get:function(){return this._szClient},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlRect",{get:function(){return this._rcBounds||(this._rcBounds=i.getElementRect(this._root)),this._rcBounds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollSize",{get:function(){return new i.Size(this._gpCells.width,this._heightBrowser)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewRange",{get:function(){return this._gpCells.viewRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellFactory",{get:function(){return this._cf},set:function(n){n!=this._cf&&(this._cf=i.asType(n,k,!1),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemFormatter",{get:function(){return this._itemFormatter},set:function(n){n!=this._itemFormatter&&(this._itemFormatter=i.asFunction(n),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.canEditCell=function(n,t){return this._edtHdl._allowEditing(n,t)},t.prototype.getCellData=function(n,t,i){return this.cells.getCellData(n,t,i)},t.prototype.getCellBoundingRect=function(n,t,i){return this.cells.getCellBoundingRect(n,t,i)},t.prototype.setCellData=function(n,t,i,r,u){return r===void 0&&(r=!0),u===void 0&&(u=!0),this.cells.setCellData(n,t,i,r,u)},t.prototype.hitTest=function(n,t){return i.isNumber(n)&&i.isNumber(t)&&(n=new i.Point(n,t)),new rt(this,n)},t.prototype.getClipString=function(n){return this._edtHdl.getClipString(n)},t.prototype.setClipString=function(n,t){this._edtHdl.setClipString(n,t)},t.prototype.focus=function(){this._setFocus(!1)},t.prototype.dispose=function(){this.finishEditing(!0);this.itemsSource=null;n.prototype.dispose.call(this)},t.prototype.refresh=function(t){t===void 0&&(t=!0);n.prototype.refresh.call(this,t);this.finishEditing();t&&(this._updateColumnTypes(),this.scrollPosition=this._ptScrl);this.refreshCells(t)},t.prototype.refreshCells=function(n,t,i){this.isUpdating||(n?this._updateLayout():this._updateContent(t,i))},t.prototype.autoSizeColumn=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=4);this.autoSizeColumns(n,n,t,i)},t.prototype.autoSizeColumns=function(n,r,u,f){var o=this;u===void 0&&(u=!1);f===void 0&&(f=4);var s=0,c=u?this.topLeftCells:this.columnHeaders,e=u?this.rowHeaders:this.cells,h=this.viewRange;n=n==null?0:i.asInt(n);r=r==null?e.columns.length-1:i.asInt(r);i.asBoolean(u);i.asNumber(f);h.row=Math.max(0,h.row-1e3);h.row2=Math.min(h.row2+1e3,this.rows.length-1);this.finishEditing()&&this.deferUpdate(function(){var l,a,u,v;for(i.setCss(o._eCt,{width:o._gpCells.width}),l=document.createElement('div'),l.setAttribute(t._WJS_MEASURE,'true'),l.style.visibility='hidden',e.hostElement.parentElement.appendChild(l),a=n;a<=r&&a>-1&&a<e.columns.length;a++){if(s=0,o.autoSizeMode&it.Headers)for(u=0;u<c.rows.length;u++)c.rows[u].isVisible&&(v=o._getDesiredWidth(c,u,a,l),s=Math.max(s,v));if(o.autoSizeMode&it.Cells)for(u=h.row;u<=h.row2&&u>-1&&u<e.rows.length;u++)e.rows[u].isVisible&&(v=o._getDesiredWidth(e,u,a,l),s=Math.max(s,v));e.columns[a].width=s+f+2}l.parentElement.removeChild(l)})},t.prototype.autoSizeRow=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=0);this.autoSizeRows(n,n,t,i)},t.prototype.autoSizeRows=function(n,r,u,f){var o=this;u===void 0&&(u=!1);f===void 0&&(f=0);var s=0,h=u?this.topLeftCells:this.rowHeaders,e=u?this.columnHeaders:this.cells;u=i.asBoolean(u);f=i.asNumber(f);n=n==null?0:i.asInt(n);r=r==null?e.rows.length-1:i.asInt(r);this.finishEditing()&&this.deferUpdate(function(){var c,l,u,a;for(i.setCss(o._eCt,{width:o._gpCells.width}),c=document.createElement('div'),c.setAttribute(t._WJS_MEASURE,'true'),c.style.visibility='hidden',e.hostElement.appendChild(c),l=n;l<=r&&l>-1&&l<e.rows.length;l++){if(s=0,o.autoSizeMode&it.Headers)for(u=0;u<h.columns.length;u++)h.columns[u].renderSize>0&&(a=o._getDesiredHeight(h,l,u,c),s=Math.max(s,a));if(o.autoSizeMode&it.Cells)for(u=0;u<e.columns.length;u++)e.columns[u].renderSize>0&&(a=o._getDesiredHeight(e,l,u,c),s=Math.max(s,a));e.rows[l].height=s+f}c.parentElement.removeChild(c)})},Object.defineProperty(t.prototype,"treeIndent",{get:function(){return this._indent},set:function(n){n!=this._indent&&(this._indent=i.asNumber(n,!1,!0),this.columns.onCollectionChanged())},enumerable:!0,configurable:!0}),t.prototype.collapseGroupsToLevel=function(n){if(this.finishEditing()){var t=this.rows;t.deferUpdate(function(){for(var u,r=0;r<t.length;r++)u=i.tryCast(t[r],h),u&&(u.isCollapsed=u.level>=n)})}},Object.defineProperty(t.prototype,"selectionMode",{get:function(){return this._selHdl.selectionMode},set:function(n){n!=this.selectionMode&&(this._selHdl.selectionMode=i.asEnum(n,f),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selHdl.selection.clone()},set:function(n){this._selHdl.selection=n},enumerable:!0,configurable:!0}),t.prototype.select=function(n,t){t===void 0&&(t=!0);this._selHdl.select(n,t)},t.prototype.getSelectedState=function(n,t){return this.cells.getSelectedState(n,t,null)},Object.defineProperty(t.prototype,"selectedRows",{get:function(){var t=[],i,n;if(this.selectionMode==f.ListBox)for(n=0;n<this.rows.length;n++)this.rows[n].isSelected&&t.push(this.rows[n]);else if(this.rows.length)for(i=this.selection,n=i.topRow;n>-1&&n<=i.bottomRow;n++)t.push(this.rows[n]);return t},set:function(n){var t=this;i.assert(this.selectionMode==f.ListBox,'This property can be set only in ListBox mode.');n=i.asArray(n);this.deferUpdate(function(){for(var u,f,i=0,r=!0;i<t.rows.length;i++)u=t.rows[i],f=n&&n.indexOf(u)>-1,f&&r&&(r=!1,t.select(i,t.selection.col)),u.isSelected=f})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){for(var n=this.selectedRows,t=0;t<n.length;t++)n[t]=n[t].dataItem;return n},set:function(n){var t=this;i.assert(this.selectionMode==f.ListBox,'This property can be set only in ListBox mode.');n=i.asArray(n);this.deferUpdate(function(){for(var u,f,i=0,r=!0;i<t.rows.length;i++)u=t.rows[i],f=n&&n.indexOf(u.dataItem)>-1,f&&r&&(r=!1,t.select(i,t.selection.col)),u.isSelected=f})},enumerable:!0,configurable:!0}),t.prototype.scrollIntoView=function(n,t){var u,h;this._maxOffsetY==null&&this._updateLayout();var r=this.scrollPosition,c=this._szClient.width,f=this._szClient.height-this._gpCFtr.rows.getTotalSize(),e=this.cells._getFrozenPos();if(n=i.asInt(n),n>-1&&n<this._rows.length&&n>=this._rows.frozen){var s=this._rows[n],a=this.cells.height>f?Math.round(s.pos/(this.cells.height-f)*100)/100:0,v=Math.round(this._maxOffsetY*a),o=s.pos-v,l=o+s.renderSize-1;l>f-r.y&&(r.y=Math.max(-o,f-l));o-e.y<-r.y&&(r.y=-(o-e.y))}return(t=i.asInt(t),t>-1&&t<this._cols.length&&t>=this._cols.frozen&&(u=this._cols[t],h=u.pos+u.renderSize-1,h>-r.x+c&&(r.x=Math.max(-u.pos,c-h)),u.pos-e.x<-r.x&&(r.x=-(u.pos-e.x))),!r.equals(this._ptScrl))?(this.scrollPosition=r,!0):!1},t.prototype.isRangeValid=function(n){return n.isValid&&n.bottomRow<this.rows.length&&n.rightCol<this.columns.length},t.prototype.startEditing=function(n,t,i,r){return n===void 0&&(n=!0),this._edtHdl.startEditing(n,t,i,r)},t.prototype.finishEditing=function(n){return n===void 0&&(n=!1),this._edtHdl.finishEditing(n)},Object.defineProperty(t.prototype,"activeEditor",{get:function(){return this._edtHdl.activeEditor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editRange",{get:function(){return this._edtHdl.editRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mergeManager",{get:function(){return this._mrgMgr},set:function(n){n!=this._mrgMgr&&(this._mrgMgr=i.asType(n,lt,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getMergedRange=function(n,t,i,r){return r===void 0&&(r=!0),this._mrgMgr?this._mrgMgr.getMergedRange(n,t,i,r):null},Object.defineProperty(t.prototype,"keyActionTab",{get:function(){return this._keyHdl._kaTab},set:function(n){this._keyHdl._kaTab=i.asEnum(n,g)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyActionEnter",{get:function(){return this._keyHdl._kaEnter},set:function(n){this._keyHdl._kaEnter=i.asEnum(n,g)},enumerable:!0,configurable:!0}),t.prototype.onItemsSourceChanged=function(n){this.itemsSourceChanged.raise(this,n)},t.prototype.onScrollPositionChanged=function(n){this.scrollPositionChanged.raise(this,n)},t.prototype.onSelectionChanging=function(n){return this.selectionChanging.raise(this,n),!n.cancel},t.prototype.onSelectionChanged=function(n){this.selectionChanged.raise(this,n)},t.prototype.onLoadingRows=function(n){return this.loadingRows.raise(this,n),!n.cancel},t.prototype.onLoadedRows=function(n){this.loadedRows.raise(this,n)},t.prototype.onUpdatingLayout=function(n){return this.updatingLayout.raise(this,n),!n.cancel},t.prototype.onUpdatedLayout=function(n){this.updatedLayout.raise(this,n)},t.prototype.onResizingColumn=function(n){return this.resizingColumn.raise(this,n),!n.cancel},t.prototype.onResizedColumn=function(n){this.resizedColumn.raise(this,n)},t.prototype.onAutoSizingColumn=function(n){return this.autoSizingColumn.raise(this,n),!n.cancel},t.prototype.onAutoSizedColumn=function(n){this.autoSizedColumn.raise(this,n)},t.prototype.onDraggingColumn=function(n){return this.draggingColumn.raise(this,n),!n.cancel},t.prototype.onDraggingColumnOver=function(n){return this.draggingColumnOver.raise(this,n),!n.cancel},t.prototype.onDraggedColumn=function(n){this.draggedColumn.raise(this,n)},t.prototype.onResizingRow=function(n){return this.resizingRow.raise(this,n),!n.cancel},t.prototype.onResizedRow=function(n){this.resizedRow.raise(this,n)},t.prototype.onAutoSizingRow=function(n){return this.autoSizingRow.raise(this,n),!n.cancel},t.prototype.onAutoSizedRow=function(n){this.autoSizedRow.raise(this,n)},t.prototype.onDraggingRow=function(n){return this.draggingRow.raise(this,n),!n.cancel},t.prototype.onDraggingRowOver=function(n){return this.draggingRowOver.raise(this,n),!n.cancel},t.prototype.onDraggedRow=function(n){this.draggedRow.raise(this,n)},t.prototype.onGroupCollapsedChanging=function(n){return this.groupCollapsedChanging.raise(this,n),!n.cancel},t.prototype.onGroupCollapsedChanged=function(n){this.groupCollapsedChanged.raise(this,n)},t.prototype.onSortingColumn=function(n){return this.sortingColumn.raise(this,n),!n.cancel},t.prototype.onSortedColumn=function(n){this.sortedColumn.raise(this,n)},t.prototype.onBeginningEdit=function(n){return this.beginningEdit.raise(this,n),!n.cancel},t.prototype.onPrepareCellForEdit=function(n){this.prepareCellForEdit.raise(this,n)},t.prototype.onCellEditEnding=function(n){return this.cellEditEnding.raise(this,n),!n.cancel&&!n.stayInEditMode},t.prototype.onCellEditEnded=function(n){this.cellEditEnded.raise(this,n)},t.prototype.onRowEditStarting=function(n){this.rowEditStarting.raise(this,n)},t.prototype.onRowEditStarted=function(n){this.rowEditStarted.raise(this,n)},t.prototype.onRowEditEnding=function(n){this.rowEditEnding.raise(this,n)},t.prototype.onRowEditEnded=function(n){this.rowEditEnded.raise(this,n)},t.prototype.onRowAdded=function(n){this.rowAdded.raise(this,n)},t.prototype.onDeletingRow=function(n){return this.deletingRow.raise(this,n),!n.cancel},t.prototype.onDeletedRow=function(n){this.deletedRow.raise(this,n)},t.prototype.onCopying=function(n){return this.copying.raise(this,n),!n.cancel},t.prototype.onCopied=function(n){this.copied.raise(this,n)},t.prototype.onPasting=function(n){return this.pasting.raise(this,n),!n.cancel},t.prototype.onPasted=function(n){this.pasted.raise(this,n)},t.prototype.onPastingCell=function(n){return this.pastingCell.raise(this,n),!n.cancel},t.prototype.onPastedCell=function(n){this.pastedCell.raise(this,n)},t.prototype.onFormatItem=function(n){this.formatItem.raise(this,n)},t.prototype.onUpdatingView=function(n){return this.updatingView.raise(this,n),!n.cancel},t.prototype.onUpdatedView=function(n){this.updatedView.raise(this,n)},t.prototype._getShowErrors=function(){if(this.showErrors){if(i.isFunction(this.itemValidator))return!0;var n=this.collectionView,t=n?n.getError:null;if(i.isFunction(t))return!0}return!1},t.prototype._getError=function(n,t,r){var f,e,o,h,s,u;if(i.isFunction(this.itemValidator)){if(n==this.cells)return this.itemValidator(t,r);if(n==this.rowHeaders)for(r=0;r<this.columns.length;r++)if(u=this.itemValidator(t,r),u)return u}if(f=this.collectionView,e=f?f.getError:null,f&&i.isFunction(e)&&(o=n.rows[t].dataItem,o)){if(n==this.cells)return s=this._getBindingColumn(n,t,this.columns[r]),e(o,s.binding);if(n==this.rowHeaders)for(h=0;h<this.columns.length;h++)if(s=this._getBindingColumn(n,t,this.columns[h]),u=e(o,s.binding),u)return u}return null},t.prototype._setAria=function(n,t){i.setAttribute(this.cells.hostElement,'aria-'+n,t)},t.prototype._setFocus=function(n){var r,u,f;if(this.hostElement&&(n||!this.containsFocus())){if(r=i.getActiveElement(),u='tabindex',this.activeEditor)i.contains(this.activeEditor,r)||(this.activeEditor.focus(),this._eFocus.removeAttribute(u));else if(this._activeCell){if(!i.contains(this._activeCell,r)){var e=this.scrollPosition,t=this._activeCell.style,o=t.width,s=t.height;t.width=t.height='0';this._activeCell.tabIndex=0;this._activeCell.focus();t.width=o;t.height=s;this.scrollPosition=e;f=this.hostElement;f.scrollTop=f.scrollLeft=0;this._eFocus.removeAttribute(u)}}else i.contains(this._eFocus,r)||(this._eFocus.tabIndex=0,this._eFocus.focus());this.containsFocus()||(this._eFocus.tabIndex=0,this._eFocus.focus())}},t.prototype._getDefaultRowHeight=function(){var f=this.hostElement,n=document.body,t=null,r,e,u;if(n&&!i.contains(n,f)){for(r=f;r;r=r.parentElement)t=r;t&&n.appendChild(t)}return e=i.createElement('<div class="wj-cell">123</div>',f),u=e.scrollHeight+2,f.removeChild(e),t&&n.removeChild(t),(u<=6||isNaN(u)||!n)&&(u=28),u},t.prototype._getCollectionView=function(n){return i.asCollectionView(n)},t.prototype._getDesiredWidth=function(n,t,i,r){var u=this.getMergedRange(n,t,i),f;return this.cellFactory.updateCell(n,t,i,r,u),r.style.width='',f=r.offsetWidth,u&&u.columnSpan>1?f/u.columnSpan:f},t.prototype._getDesiredHeight=function(n,t,i,r){var u=this.getMergedRange(n,t,i),f;return this.cellFactory.updateCell(n,t,i,r,u),r.style.height='',f=r.offsetHeight,u&&u.rowSpan>1?f/u.rowSpan:f},t.prototype._getSortRowIndex=function(){return this._sortRowIndex!=null?this._sortRowIndex:this.columnHeaders.rows.length-1},t.prototype._sortConverter=function(n,t,i,r){var u,o,f,e;if(r){if(this._mappedColumns=null,this.collectionView)for(o=this.collectionView.sortDescriptions,f=0;f<o.length;f++)u=this.getColumn(o[f].property),u&&u.dataMap&&(this._mappedColumns||(this._mappedColumns={}),this._mappedColumns[u.binding]=u.dataMap);this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1&&(u=this.columns[this._mouseHdl._htDown.col],this._mappedColumns&&u.dataMap&&(this._mappedColumns[u.binding]=u.dataMap))}return this._mappedColumns&&(e=this._mappedColumns[n.property],e&&e.sortByDisplayValues&&(i=e.getDisplayValue(i))),i},t.prototype._bindGrid=function(n){var t=this,r;this.deferUpdate(function(){var u,s,c,e,o,l,a,r;if(t._lastCount==0&&t._cv&&t._cv.items&&t._cv.items.length&&(n=!0),u=[],t.preserveSelectedState&&t.selectionMode==f.ListBox&&!t.childItemsPath)for(r=0;r<t.rows.length;r++)s=t.rows[r],s.isSelected&&s.dataItem&&u.push(s.dataItem);if(t.preserveOutlineState&&i.isFunction(window.Map)&&t.rows.maxGroupLevel>-1)for(c=new Map,r=0;r<t.rows.length;r++)e=t.rows[r],e instanceof h&&e.isCollapsed&&e.dataItem&&(o=e.dataItem,o instanceof i.CollectionViewGroup&&(o=o._path),c.set(o,!0));if(n&&t.columns.deferUpdate(function(){t._bindColumns()}),t.rows.deferUpdate(function(){t._bindRows()}),l=0,u.length)for(r=0;r<t.rows.length&&l<u.length;r++)u.indexOf(t.rows[r].dataItem)>-1&&(t.rows[r].isSelected=!0,l++);if(t.selectionMode==f.ListBox&&l==0)for(a=t.selection,r=a.topRow;r<=a.bottomRow&&r>-1&&r<t.rows.length;r++)t.rows[r].isSelected=!0;c&&t.rows.deferUpdate(function(){for(var u,n,r=0;r<t.rows.length;r++)u=t.rows[r],u instanceof h&&(n=u.dataItem,n instanceof i.CollectionViewGroup&&(n=n._path),c.get(n)&&(u.isCollapsed=!0))});!t._lastCount&&t._cv&&t._cv.items&&(t._lastCount=t._cv.items.length)});this.rows.length||(r=this._selHdl.selection,r.row=r.row2=-1);this.collectionView&&this._cvCurrentChanged(this.collectionView,i.EventArgs.empty)},t.prototype._cvCollectionChanged=function(n,t){var r,u;if(this.autoGenerateColumns&&this.columns.length==0){this._bindGrid(!0);return}if(this.childItemsPath&&t.action!=i.NotifyCollectionChangedAction.Change){this._bindGrid(!1);return}switch(t.action){case i.NotifyCollectionChangedAction.Change:this.invalidate();return;case i.NotifyCollectionChangedAction.Add:if(t.index==this.collectionView.items.length-1){r=this.rows.length;this.rows[r-1]instanceof a&&r--;this.rows.insert(r,new nt(t.item));return}i.assert(!1,'added item should be the last one.');break;case i.NotifyCollectionChangedAction.Remove:if(u=this._findRow(t.item),u>-1){this.rows.removeAt(u);this._cvCurrentChanged(n,t);return}i.assert(!1,'removed item not found in grid.')}this._bindGrid(!1)},t.prototype._cvCurrentChanged=function(){var n,t,r;this.collectionView&&this.selectionMode!=f.None&&(n=this.selection,t=n.row>-1&&n.row<this.rows.length?this.rows[n.row].dataItem:null,t instanceof i.CollectionViewGroup&&(t=null),t!=this.collectionView.currentItem&&(this.childItemsPath&&this.editableCollectionView&&this.editableCollectionView.currentAddItem||(r=this._getRowIndex(this.collectionView.currentPosition),r==n.row&&this.childItemsPath||(n.row=n.row2=r,this.select(n)))))},t.prototype._getRowIndex=function(n){var r,t,i;if(this.collectionView){if(n>-1){for(r=this.collectionView.items[n];n<this.rows.length;n++)if(this.rows[n].dataItem===r)return n;return-1}return this.rows.length==1&&this.rows[0]instanceof a?0:(t=this.selection.row,i=t>-1?this.rows[t]:null,i&&(i instanceof h||i.dataItem==null)?t:-1)}return this.selection.row},t.prototype._getCvIndex=function(n){if(n>-1&&this.collectionView){var t=this.rows[n].dataItem;for(n=Math.min(n,this.collectionView.items.length);n>-1;n--)if(this.collectionView.items[n]===t)return n}return-1},t.prototype._findRow=function(n){for(var t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==n)return t;return-1},t.prototype._updateLayout=function(){var w=new i.CancelEventArgs,c,e,a,s,p,o;if(this.onUpdatingLayout(w)){var n=this._hdrVis&l.Row?this._hdrCols.getTotalSize():0,r=this._hdrVis&l.Column?this._hdrRows.getTotalSize():0,f=this._ftrRows.getTotalSize(),h=this._rows.getTotalSize()+f;h<1&&(h=1);this._heightBrowser=Math.min(h,t._getMaxSupportedCssHeight());this._maxOffsetY=Math.max(0,h-this._heightBrowser);this.cells.hostElement&&(c=i.createElement('<div class="wj-cell"></div>',this.cells.hostElement),o=getComputedStyle(c),this._cellPadding=parseInt(this.rightToLeft?o.paddingRight:o.paddingLeft),c.parentElement.removeChild(c));e=this._heightBrowser+r-f;this.rightToLeft?(i.setCss(this._eTL,{right:0,top:0,width:n,height:r}),i.setCss(this._eCHdr,{right:n,top:0,height:r}),i.setCss(this._eRHdr,{right:0,top:r,width:n}),i.setCss(this._eCt,{right:n,top:r,width:this._gpCells.width,height:this._heightBrowser}),i.setCss(this._fCt,{right:n,top:r}),i.setCss(this._eBL,{right:0,top:e,width:n,height:f}),i.setCss(this._eCFtr,{right:n,top:e,height:f})):(i.setCss(this._eTL,{left:0,top:0,width:n,height:r}),i.setCss(this._eCHdr,{left:n,top:0,height:r}),i.setCss(this._eRHdr,{left:0,top:r,width:n}),i.setCss(this._eCt,{left:n,top:r,width:this._gpCells.width,height:this._heightBrowser}),i.setCss(this._fCt,{left:n,top:r}),i.setCss(this._eBL,{left:0,top:e,width:n,height:f}),i.setCss(this._eCFtr,{left:n,top:e,height:f}));this._stickyHdr&&this._updateStickyHeaders();i.setCss([this._eTL,this._eBL,this._eCHdr,this._eCFtr,this._eRHdr,this._eMarquee],{zIndex:this.frozenRows||this.frozenColumns?'3':''});var u=this._root,v=u.offsetWidth-u.clientWidth,y=u.offsetHeight-u.clientHeight;i.setCss(this._eSz,{width:n+v+this._gpCells.width,height:r+y+this._heightBrowser});a=null;this.columns._updateStarSizes(u.clientWidth-n)&&(a=u.clientWidth,i.setCss(this._eCt,{width:this._gpCells.width}));this._szClient=new i.Size(u.clientWidth-n,u.clientHeight-r);this._rcBounds=null;this._updateScrollHandler();this._updateContent(!1);v=u.offsetWidth-u.clientWidth;y=u.offsetHeight-u.clientHeight;i.setCss(this._eSz,{width:n+v+this._gpCells.width,height:r+y+this._heightBrowser});s=this.hostElement;s&&(p=s.offsetHeight+'px',o=getComputedStyle(s),o.maxHeight==p&&o.boxSizing!='content-box'&&(s.style.height=p));this._szClient=new i.Size(u.clientWidth-n,u.clientHeight-r);a&&a!=u.clientWidth&&this.columns._updateStarSizes(u.clientWidth-n)&&(i.setCss(this._eCt,{width:this._gpCells.width}),this._updateContent(!1));i.setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width});i.setCss([this._eRHdr,this._fCt],{height:this._szClient.height});f&&(e=Math.min(e,this._szClient.height+r-f),i.setCss([this._eBL,this._eCFtr],{top:e}));this.onUpdatedLayout(w)}},t.prototype._updateStickyHeaders=function(){var u=!1,o=0,f,n,r,e;if(this._stickyHdr){for(f=0,n=null,r=this.hostElement;r;r=r.parentElement)e=r.getBoundingClientRect(),n==null&&(n=e.top),f=Math.max(f,e.top);n=Math.max(0,f-n-1);o=-n;u=n>0}this._eTL.style.top=this._eCHdr.style.top=u?-o+'px':'';i.toggleClass(this._eTL,t._WJS_STICKY,u);i.toggleClass(this._eCHdr,t._WJS_STICKY,u)},t.prototype._updateScrollHandler=function(){var n=this._stickyHdr||this._clipToScreen();n!=this._scrollHandlerAttached&&(this._scrollHandlerAttached=n,n?this.addEventListener(window,'scroll',this._bndScroll,!0):this.removeEventListener(window,'scroll',this._bndScroll,!0))},t.prototype._clipToScreen=function(){var n=this.hostElement;return this.rows.length>t._MIN_VIRT_ROWS&&n.parentElement==document.body&&n.clientHeight==n.scrollHeight},t.prototype._scroll=function(n){var t=this;i.contains(n.target,this.hostElement)&&(this._clipToScreen()&&(this._afScrl&&cancelAnimationFrame(this._afScrl),this._afScrl=requestAnimationFrame(function(){t.finishEditing();t._updateContent(!0);t._afScrl=null})),this._stickyHdr&&(this._toSticky&&cancelAnimationFrame(this._toSticky),this._toSticky=requestAnimationFrame(function(){t._toSticky=null;var n=new i.CancelEventArgs;if(t.onUpdatingLayout(n)){t._updateStickyHeaders();t.onUpdatedLayout(n)}})))},t.prototype._updateScrollPosition=function(){var n=this._root,f=n.scrollTop,r=n.scrollLeft,u;return(this.rightToLeft&&t._getRtlMode()=='rev'&&(r=n.scrollWidth-n.clientWidth-r),u=new i.Point(-Math.abs(r),-f),!this._ptScrl.equals(u))?(this._ptScrl=u,this.onScrollPositionChanged(),!0):!1},t.prototype._updateContent=function(n,t){var h=i.getActiveElement(),u=i.contains(this.hostElement,h)?h:null,o=this._activeCell,c=new i.CancelEventArgs,a,r,s,f;if(this.onUpdatingView(c)){if(this._offsetY=0,this._heightBrowser>this._szClient.height&&(a=Math.round(-this._ptScrl.y/(this._heightBrowser-this._szClient.height)*100)/100,this._offsetY=Math.round(this._maxOffsetY*a)),this._updateScrollPosition(),r=this._gpCells._updateContent(n,t,this._offsetY),this._hdrVis&l.Column&&(!t||this._ssHdr&l.Column)&&this._gpCHdr._updateContent(n,t,0),this._hdrVis&l.Row&&(!t||this._ssHdr&l.Row)&&this._gpRHdr._updateContent(n,t,this._offsetY),this._hdrVis&&!t&&this._gpTL._updateContent(n,t,0),this._gpCFtr.rows.length&&(this._gpBL._updateContent(n,t,0),this._gpCFtr._updateContent(n,t,0)),this.showMarquee)if(s=this._selHdl.selection,f=this._eMarquee,this.isRangeValid(s)){var e=this._getMarqueeRect(s),v=f.firstChild,y=f.offsetWidth-v.offsetWidth,p=f.offsetHeight-v.offsetHeight;i.setCss(f,{left:e.left+this.cells.hostElement.offsetLeft-y/2,top:e.top+this.cells.hostElement.offsetTop-p/2,width:e.width+y,height:e.height+p,visibility:e.width>0&&e.height>0?'':'collapse'})}else f.style.visibility='collapse';this._useFrozenDiv()&&(this._updateFrozenCells(t),r&&r.classList.contains('wj-frozen')&&(r=null));this._activeCell=r;u&&(u!=this._root&&u!=this._eFocus&&i.contains(this.hostElement,u)&&!i.contains(this.cells.hostElement,u)?u.focus():this._setFocus(!0));!u&&r&&(r.tabIndex=0);o&&o!=r&&o.removeAttribute('tabindex');this._rcBounds=null;this.onUpdatedView(c)}},t.prototype._useFrozenDiv=function(){return i.isBoolean(this._fzClone)?this._fzClone:i.isIE()||i.isFirefox()||i.isMobile()},t.prototype._updateFrozenCells=function(n){var r,t,u;if(this.frozenRows||this.frozenColumns){if(r=this._eCt.querySelectorAll('.wj-frozen'),n&&this._fCt.children.length==r.length){for(t=0;t<r.length;t++)this._fCt.children[t].className=r[t].className;return}if(i.setText(this._fCt,null),!this.activeEditor)for(t=0;t<r.length;t++)u=r[t].cloneNode(!0),u.style.pointerEvents='auto',this._fCt.appendChild(u)}else i.setText(this._fCt,null)},t.prototype._getMarqueeRect=function(n){var s=this.getMergedRange(this.cells,n.topRow,n.leftCol)||new u(n.topRow,n.leftCol),h=this.getMergedRange(this.cells,n.bottomRow,n.rightCol)||new u(n.bottomRow,n.rightCol),t=this.cells.getCellBoundingRect(s.topRow,s.leftCol,!0),f=this.cells.getCellBoundingRect(h.bottomRow,h.rightCol,!0),o,e,r;return this.rows.frozen&&(o=Math.min(this.rows.length,this.rows.frozen),r=this.cells.getCellBoundingRect(o-1,0,!0),n.topRow>=o&&t.top<r.bottom&&(t.top=r.bottom),n.bottomRow>=o&&f.bottom<r.bottom&&(f.height=r.bottom-f.top)),this.columns.frozen&&(e=Math.min(this.columns.length,this.columns.frozen),r=this.cells.getCellBoundingRect(0,e-1,!0),this.rightToLeft?(n.leftCol>=e&&t.right>r.left&&(t.left=r.left-t.width),n.rightCol>=e&&f.left>r.left&&(f.left=r.left)):(n.leftCol>=e&&t.left<r.right&&(t.left=r.right),n.rightCol>=e&&f.right<r.right&&(f.width=r.right-f.left))),this.rightToLeft?new i.Rect(f.left,t.top,t.right-f.left,f.bottom-t.top):new i.Rect(t.left,t.top,f.right-t.left,f.bottom-t.top)},t.prototype._bindColumns=function(){for(var u,f,o,n,s,t=0;t<this.columns.length;t++)n=this.columns[t],n._getFlag(e.AutoGenerated)&&(this.columns.removeAt(t),t--);var c=this.collectionView,r=c?c.sourceCollection:null,h=r&&r.length?r[0]:null;if(h&&this.autoGenerateColumns)for(u in h)for(f=null,o=0;o<r.length&&o<1e3&&f==null;o++)f=r[o][u],i.isPrimitive(f)&&(n=new v,n._setFlag(e.AutoGenerated,!0),n.binding=n.name=u,n.header=i.toHeaderCase(u),n.dataType=i.getType(f),n.dataType==i.DataType.Number&&(n.width=80),s=Object.getOwnPropertyDescriptor(h,u),!s||s.writable||i.isFunction(s.set)||n._setFlag(e.ReadOnly,!0),this.columns.push(n));this._updateColumnTypes()},t.prototype._updateColumnTypes=function(){var u=this.collectionView,f,r,t,n;if(i.hasItems(u))for(f=u.items[0],r=this.columns,t=0;t<r.length;t++)n=r[t],n.dataType==null&&n._binding&&(n.dataType=i.getType(n._binding.getValue(f)))},t.prototype._getBindingColumn=function(n,t,i){return i},t.prototype._getRowHeaderPath=function(){return this._rowHdrPath},t.prototype._bindRows=function(){var f=new i.CancelEventArgs,t,r,u,n;if(this.onLoadingRows(f)){if(this.rows.clear(),t=this.collectionView,t&&t.items)if(r=t.items,u=t.groups,this.childItemsPath)for(n=0;n<r.length;n++)this._addNode(r,n,0);else if(u!=null&&u.length>0&&this.showGroups)for(n=0;n<u.length;n++)this._addGroup(u[n]);else for(n=0;n<r.length;n++)this._addBoundRow(r,n);this.onLoadedRows(f)}},t.prototype._addBoundRow=function(n,t){this.rows.push(new nt(n[t]))},t.prototype._addNode=function(n,t,r){var f=new h,e=this.childItemsPath,c=i.isArray(e)?e[r]:e,s=n[t],o=s[c],u;if(f.dataItem=s,f.level=r,this.rows.push(f),i.isArray(o))for(u=0;u<o.length;u++)this._addNode(o,u,r+1)},t.prototype._addGroup=function(n){var i=new h,r,t;if(i.level=n.level,i.dataItem=n,this.rows.push(i),n.isBottomLevel)for(r=n.items,t=0;t<r.length;t++)this._addBoundRow(r,t);else for(t=0;t<n.groups.length;t++)this._addGroup(n.groups[t])},t._getSerializableProperties=function(n){var f=[],u,i,t,r;for(n=n.prototype;n!=Object.prototype;n=Object.getPrototypeOf(n))for(u=Object.getOwnPropertyNames(n),i=0;i<u.length;i++)t=u[i],r=Object.getOwnPropertyDescriptor(n,t),r&&r.set&&r.get&&t[0]!='_'&&!t.match(/disabled|required/)&&f.push(t);return f},t.prototype._copy=function(n,t){var u,r,f;if(n=='columns'){for(this.columns.clear(),u=i.asArray(t),r=0;r<u.length;r++)f=new v,i.copy(f,u[r]),this.columns.push(f);return!0}return!1},t.prototype._isInputElement=function(n){if(n instanceof HTMLElement){if(n.contentEditable=='true')return!0;var t=n.tagName.match(/^(BUTTON|A|INPUT|TEXTAREA|SELECT|OPTION)$/i);return t&&t.length>0}return!1},t.prototype._wantsInput=function(n){return!this.activeEditor&&this._isInputElement(n)},t._getMaxSupportedCssHeight=function(){var n;if(!t._maxCssHeight){var r=1e6,i=document.createElement('div');for(i.style.visibility='hidden',document.body.appendChild(i),n=r;n<=6e7;n+=5e5){if(i.style.height=n+'px',i.offsetHeight!=n)break;r=n}document.body.removeChild(i);t._maxCssHeight=r}return t._maxCssHeight},t._getRtlMode=function(){var n,r,u;return t._rtlMode||(n=i.createElement('<div dir="rtl" style="visibility:hidden;width:100px;height:100px;overflow:auto"><div style="width:2000px;height:2000px"><\/div><\/div>'),document.body.appendChild(n),r=n.scrollLeft,n.scrollLeft=-1e3,u=n.scrollLeft,document.body.removeChild(n),t._rtlMode=u<0?'neg':r>0?'rev':'std'),t._rtlMode},t}(i.Control);y._WJS_STICKY='wj-state-sticky';y._WJS_MEASURE='wj-state-measuring';y._WJS_UPDATING='wj-state-updating';y._MIN_VIRT_ROWS=200;y.controlTemplate='<div style="position:relative;width:100%;height:100%;overflow:hidden;max-width:inherit;max-height:inherit"><div wj-part="focus" aria-hidden="true" style="position:fixed;opacity:0;pointer-events:none;left:-10px;top:-10px"><\/div><div wj-part="root" style="position:absolute;width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch;max-width:inherit;max-height:inherit"><div wj-part="cells" class="wj-cells" style="position:absolute"><\/div><div wj-part="marquee" aria-hidden="true" class="wj-marquee" style="display:none;pointer-events:none;"><div style="width:100%;height:100%"><\/div><\/div><\/div><div wj-part="fcells" aria-hidden="true" class="wj-cells" style="position:absolute;pointer-events:none;overflow:hidden"><\/div><div wj-part="rh" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="rhcells" class="wj-rowheaders" style="position:relative"><\/div><\/div><div wj-part="cf" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="cfcells" class="wj-colfooters" style="position:relative"><\/div><\/div><div wj-part="ch" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="chcells" class="wj-colheaders" style="position:relative"><\/div><\/div><div wj-part="bl" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="blcells" class="wj-bottomleft" style="position:relative"><\/div><\/div><div wj-part="tl" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="tlcells" class="wj-topleft" style="position:relative"><\/div><\/div><div wj-part="sz" aria-hidden="true" style="position:relative;visibility:hidden"><\/div><\/div>';n("FlexGrid",y);s=function(n){function t(t,r,f){var e=n.call(this)||this;return e._p=i.asType(t,p),e._rng=i.asType(r,u),e._data=f,e}return w(t,n),Object.defineProperty(t.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(n){this._data=n},enumerable:!0,configurable:!0}),t}(i.CancelEventArgs);n("CellRangeEventArgs",s);yt=function(n){function t(t,r,u){var f=n.call(this,t,r)||this;return f._cell=i.asType(u,HTMLElement),f}return w(t,n),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),t}(s);n("FormatItemEventArgs",yt);st=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),Object.defineProperty(t.prototype,"stayInEditMode",{get:function(){return this._stayInEditMode},set:function(n){this._stayInEditMode=i.asBoolean(n)},enumerable:!0,configurable:!0}),t}(s);n("CellEditEndingEventArgs",st),function(n){n[n.None=0]="None";n[n.Cell=1]="Cell";n[n.ColumnHeader=2]="ColumnHeader";n[n.RowHeader=3]="RowHeader";n[n.TopLeft=4]="TopLeft";n[n.ColumnFooter=5]="ColumnFooter";n[n.BottomLeft=6]="BottomLeft"}(r||(r={}));n("CellType",r);p=function(){function n(t,r,f,e,o){this._offsetY=0;this._g=i.asType(t,y);this._ct=i.asInt(r);this._rows=i.asType(f,ft);this._cols=i.asType(e,et);this._e=i.asType(o,HTMLElement);this._vrb=new u;n._evtBlur||(n._evtBlur=document.createEvent('HTMLEvents'),n._evtBlur.initEvent('blur',!0,!1))}return Object.defineProperty(n.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cellType",{get:function(){return this._ct},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewRange",{get:function(){return this._getViewRange()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._cols.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._rows.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),n.prototype.getCellData=function(n,t,u){var o=this._rows[i.asNumber(n,!1,!0)],s,e=null,f,c,l,a;if(i.isString(t)&&(t=this._cols.indexOf(t),t<0))throw'Invalid column name or binding.';if(s=this._cols[i.asNumber(t,!1,!0)],f=this._g?this._g._getBindingColumn(this,n,s):s,!f.binding||!o.dataItem||o.dataItem instanceof i.CollectionViewGroup?o._ubv&&(e=o._ubv[s._hash]):e=f._binding.getValue(o.dataItem),e==null)switch(this._ct){case r.ColumnHeader:(n==this._rows.length-1||f!=s)&&(e=f.header);break;case r.ColumnFooter:f.aggregate!=i.Aggregate.None&&o instanceof h&&(c=this._g.collectionView,c&&(l=i.tryCast(c,i.CollectionView),e=l?l.getAggregate(f.aggregate,f.binding):i.getAggregate(f.aggregate,c.items,f.binding)));break;case r.Cell:f.aggregate!=i.Aggregate.None&&o instanceof h&&(a=i.tryCast(o.dataItem,i.CollectionViewGroup),a&&(e=a.getAggregate(f.aggregate,f.binding,this._g.collectionView)))}return u&&(this.cellType==r.Cell&&f.dataMap&&(e=f.dataMap.getDisplayValue(e)),e=e!=null?i.Globalize.format(e,f.format):''),e},n.prototype.setCellData=function(n,t,u,f,e){var s,v,o,c,y,h,p,a,k;if(f===void 0&&(f=!0),e===void 0&&(e=!0),s=this._rows[i.asNumber(n,!1,!0)],i.isString(t)&&(t=this._cols.indexOf(t),t<0))throw'Invalid column name or binding.';if(v=this._cols[i.asNumber(t,!1,!0)],o=this._g?this._g._getBindingColumn(this,n,v):v,this._ct==r.Cell){if(o.dataMap&&u!=null&&(o.isRequired||u!==''&&u!=null))if(c=o.dataMap,y=c.getKeyValue(u),y==null){if(!c.isEditable||c.displayMemberPath!=c.selectedValuePath)return!1}else u=y;if(h=i.DataType.Object,o.dataType?h=o.dataType:(p=this.getCellData(n,t,!1),h=i.getType(p)),i.isBoolean(o.isRequired))if(o.isRequired||u!==''&&u!==null){if(o.isRequired&&(u===''||u===null))return!1}else u=null,f=!1;if(f&&(u=i.changeType(u,h,o.format),h!=i.DataType.Object&&i.getType(u)!=h))return!1}if(s.dataItem&&o.binding){var w=o._binding,l=s.dataItem,b=w.getValue(l);if(u!==b&&!i.DateTime.equals(u,b)&&(w.setValue(l,u),a=this._g.collectionView,a instanceof i.CollectionView&&l!=a.currentEditItem)){k=new i.NotifyCollectionChangedEventArgs(i.NotifyCollectionChangedAction.Change,l,a.items.indexOf(l));a.onCollectionChanged(k)}}else s._ubv||(s._ubv={}),s._ubv[v._hash]=u;return e&&this._g&&this._g.invalidate(),!0},n.prototype.getCellBoundingRect=function(n,t,r){var o=this.rows[n],s=this.columns[t],u=new i.Rect(s.pos,o.pos,s.renderSize,o.renderSize),f,e;return this._g.rightToLeft&&(u.left=this.hostElement.clientWidth-u.right,i.isIE()||i.isFirefox()||(f=this.hostElement.parentElement,u.left-=f.offsetWidth-f.clientWidth)),r||(e=this.hostElement.getBoundingClientRect(),u.left+=e.left,u.top+=e.top-this._offsetY),n<this.rows.frozen&&(u.top-=this._g.scrollPosition.y),t<this.columns.frozen&&(u.left-=this._g.scrollPosition.x*(this._g.rightToLeft?-1:1)),u},n.prototype.getCellElement=function(t,i){for(var e,h,u,o,r,s=this.hostElement.children,c=Math.min(t+2,s.length),f=0;f<c;f++)for(e=s[f].children,h=Math.min(i+1,e.length),u=0;u<h;u++)if(o=e[u],r=o[n._INDEX_KEY],r&&(r.row==t&&r.col==i||r.rng&&r.rng.contains(t,i)))return o;return null},n.prototype.getSelectedState=function(n,t,i){var e=this._g,o=e.selectionMode,u=e._selHdl.selection;if(o!=f.None)switch(this._ct){case r.Cell:if(i||(i=e.getMergedRange(this,n,t)),i){if(i.contains(u.row,u.col))return e.showMarquee?c.None:c.Cursor;if(i.intersects(u))return c.Selected}return u.row==n&&u.col==t?e.showMarquee?c.None:c.Cursor:e.rows[n].isSelected||e.columns[t].isSelected?c.Selected:(u=e._selHdl._adjustSelection(u),o==f.ListBox)?c.None:u.containsRow(n)&&u.containsColumn(t)?c.Selected:c.None;case r.ColumnHeader:if(e.showSelectedHeaders&l.Column&&(e.columns[t].isSelected||u.containsColumn(t)||u.intersectsColumn(i))&&(i&&(n=i.bottomRow),n==this.rows.length-1))return c.Selected;break;case r.RowHeader:if(e.showSelectedHeaders&l.Row&&(e.rows[n].isSelected||u.containsRow(n)||u.intersectsRow(i))&&(i&&(t=i.rightCol),t==this.columns.length-1))return c.Selected}return c.None},Object.defineProperty(n.prototype,"hostElement",{get:function(){return this._e},enumerable:!0,configurable:!0}),n.prototype._getOffsetY=function(){return this._offsetY},n.prototype._updateContent=function(t,f,e){var v=this._g,h=this._e,l=this._rows,y=this._cols,p=this._ct,w,b,c,o,g,k,nt,d,a,s;if((p==r.ColumnHeader||p==r.ColumnFooter||p==r.RowHeader)&&(w=v._ptScrl,b=h.style,p==r.RowHeader?b.top=w.y+'px':v.rightToLeft?b.right=w.x+'px':b.left=w.x+'px'),this._offsetY!=e&&(t=!1,this._offsetY=e),c=this._getViewRange(),l.length<=v._virtualizationThreshold?o=new u(0,0,l.length-1,y.length-1):(o=c.clone(),o.isValid&&v.isTouching&&(g=6,o.row=Math.max(c.row-g,l.frozen),o.row2=Math.min(c.row2+g,l.length-1),o.col=Math.max(c.col-1,y.frozen),o.col2=Math.min(c.col2+1,y.length-1))),t&&!f&&this._vrb.contains(c)&&!l.frozen&&!y.frozen)return this._activeCell;if(t&&o.equals(this._vrb)||(f=!1),!t){var tt=i.getActiveElement(),it=i.contains(h,tt)?tt:null,rt=v.cellFactory;for(k=0;k<h.childElementCount;k++)for(nt=h.children[k],d=0;d<nt.childElementCount;d++)rt.disposeCell(nt.children[d]);i.setText(h,null);it&&it.dispatchEvent(n._evtBlur)}for(t&&!f&&this._ct!=r.TopLeft&&this._reorderCells(o,this._vrb),this._activeCell=null,this._vru=c,this._vrb=o,a=0,this._ct==r.Cell&&(a=this._renderColHdrRow(o,f)),s=0;s<l.frozen&&s<l.length;s++)a=this._renderRow(s,o,f,a);for(s=o.topRow;s<=o.bottomRow&&s>-1;s++)a=this._renderRow(s,o,f,a);while(h.childElementCount>a)h.removeChild(h.lastChild);return this._activeCell},n.prototype._reorderCells=function(n,t){var u,e,c;if(!(this._rows.frozen>0)&&!(this._cols.frozen>0)&&n.columnSpan==t.columnSpan&&n.rowSpan==t.rowSpan&&t.isValid&&n.isValid&&n.intersects(t)&&n.row!=t.row){var i=n.row-t.row,l=Math.max(1,n.rowSpan-1),f=this._e;if(i!=0&&Math.abs(i)<l){if(u=this._ct==r.Cell?1:0,e=f.childElementCount,i>0){var h=u,o=Math.min(u+i,e-1),s=this._createRange(h,o);s&&o<e-1&&f.appendChild(s.extractContents())}if(i<0){var o=e,h=Math.max(u,o+i),s=this._createRange(h,o);s&&h>u&&(c=f.children[u],f.insertBefore(s.extractContents(),c))}}}},n.prototype._createRange=function(n,t){var i,r=this._e.childElementCount;return t>n&&t<=r&&n>-1&&(i=document.createRange(),i.setStart(this._e,n),i.setEnd(this._e,t)),i},n.prototype._renderColHdrRow=function(n,t){var f=this._e.children[0],u,e,r;for(f||(f=i.createElement('<div class="wj-row" role="row" tabindex="-1"></div>',this._e)),u=0,e=this._g._getRowHeaderPath(),e&&(u=this._renderRowHdrCell(f,-1,e.path)),r=0;r<this.columns.frozen&&r<this.columns.length;r++)u=this._renderColHdrCell(f,r,n,t,u);for(r=n.leftCol;r<=n.rightCol&&r>-1;r++)u=this._renderColHdrCell(f,r,n,t,u);return 1},n.prototype._renderColHdrCell=function(t,r,u,f,e){var s=this.columns[r],o,c,h,l;if(s.renderSize<=0)return e;if(o=t.children[e],o||(o=i.createElement('<div class="wj-cell" role="columnheader" tabindex="-1"></div>',t)),f||(o.textContent=this.columns[r].header,i.setCss(o,{left:s.pos,width:s.renderSize,top:-32e3,height:.1,overflow:'hidden'})),c=this.grid,c.allowSorting){h='none';l=c._getBindingColumn(this,0,s);switch(l.currentSort){case'+':h='ascending';break;case'-':h='descending'}i.setAttribute(o,'aria-sort',h)}return o[n._INDEX_KEY]={row:-1,col:r,panel:this},e+1},n.prototype._renderRowHdrCell=function(t,r,u){var f=t.children[0];return f||(f=i.createElement('<div class="wj-cell" tabindex="-1"></div>',t)),i.setAttribute(f,'role',r<0?'columnheader':'rowheader'),i.setText(f,u?u.toString():''),i.setCss(f,{left:-32e3,top:-32e3,width:.1,height:.1,overflow:'hidden'}),f[n._INDEX_KEY]={row:r,col:-1,panel:this},1},n.prototype._renderRow=function(n,t,u,f){var c=this.rows[n],l=c.renderSize,e,s,h,o;if(l<=0)return f;for(e=this._e.children[f],e||(e=i.createElement('<div class="wj-row" tabindex="-1"></div>',this._e),this._ct==r.Cell&&e.setAttribute('role','row')),s=0,this._ct==r.Cell&&(h=this._g._getRowHeaderPath(),h&&(s=this._renderRowHdrCell(e,n,h.getValue(c.dataItem)))),o=0;o<this.columns.frozen&&o<this.columns.length;o++)s=this._renderCell(e,n,o,t,u,s);for(o=t.leftCol;o<=t.rightCol&&o>-1;o++)s=this._renderCell(e,n,o,t,u,s);while(e.childElementCount>s)e.removeChild(e.lastElementChild);return f+1},n.prototype._renderCell=function(t,u,f,e,o,s){var p=this._g,l=p.getMergedRange(this,u,f),a,w,y,v;if(l){for(a=Math.max(e.row,l.row);a<u;a++)if(this.rows[a].isVisible)return s;for(a=Math.max(e.col,l.col);a<f;a++)if(this.columns[a].isVisible)return s}if(w=this.columns[f],w.renderSize<=0&&(!l||l.getRenderSize(this).width<=0))return s;y=!1;this.cellType==r.Cell&&(v=p._selHdl.selection,y=v.row==u&&v.col==f||l&&l.contains(v.row,v.col));var h=t.children[s],b=this.getSelectedState(u,f,l),k=c;return h&&o?(i.toggleClass(h,'wj-state-selected',b==k.Cursor),i.toggleClass(h,'wj-state-multi-selected',b==k.Selected),y&&(this._activeCell=h),s+1):(h||(h=document.createElement('div'),h.tabIndex=-1,this._ct==r.Cell&&h.setAttribute('role','gridcell'),t.appendChild(h)),y&&(this._activeCell=h),p.cellFactory.updateCell(this,u,f,h,l),h[n._INDEX_KEY]={row:u,col:f,rng:l,panel:this},s+1)},n.prototype._getViewRange=function(){var e=this._g,l=e._ptScrl,t=this._rows,i=this._cols,n=new u(0,0,t.length-1,i.length-1),o,f;if(this._ct==r.Cell||this._ct==r.RowHeader){var h=-l.y+this._offsetY,a=e._szClient.height,s=Math.min(t.frozen,t.length-1);s>0&&(f=t[s-1].pos,h+=f,a-=f);n.row=Math.min(t.length-1,Math.max(t.frozen,t.getItemAt(h+1)));n.row2=t.getItemAt(h+a);e._clipToScreen()&&(o=e.hostElement.getBoundingClientRect(),o.top<0&&(n.row=Math.max(n.row,t.getItemAt(-o.top)-1)),o.bottom>innerHeight&&(n.row2=Math.min(n.row2,t.getItemAt(-o.top+innerHeight)+1)))}if(this._ct==r.Cell||this._ct==r.ColumnHeader){var c=-l.x,v=e._szClient.width,s=Math.min(i.frozen,i.length-1);s>0&&(f=i[s-1].pos,c+=f,v-=f);n.col=Math.min(i.length-1,Math.max(i.frozen,i.getItemAt(c+1)));n.col2=i.getItemAt(c+v)}return t.length<=t.frozen&&(n.row=n.row2=-1),i.length<=i.frozen&&(n.col=n.col2=-1),n},n.prototype._getFrozenPos=function(){var r=this._rows.frozen,u=this._cols.frozen,n=r>0?this._rows[r-1]:null,t=u>0?this._cols[u-1]:null,f=n?n.pos+n.renderSize:0,e=t?t.pos+t.renderSize:0;return new i.Point(e,f)},n}();p._INDEX_KEY='wj-cell-index';n("GridPanel",p);k=function(){function n(){}return n.prototype.updateCell=function(t,f,e,o,s,l){var v=t.grid,vt=v.rightToLeft,d=t.cellType,g=t.rows,nt=t.columns,k=g[f],ft=nt[e],ht=f,pt=e,tt=k instanceof h?k:null,ei=k instanceof a?k:null,oi=ft.renderWidth,si=k.renderHeight,w='wj-cell',dt=l!=!1,p={display:''},gt,ti,bt,ut,hi,ii,kt,it,ri,ui,rt,fi,et,ci,ct,li,st,ai,lt,at,vi;l!=!1&&o.firstElementChild&&(o.childNodes.length!=1||o.firstElementChild.type!='checkbox')&&(i.setText(o,null),dt=!1);s&&!s.isSingleCell&&(f=s.row,e=s.col,ht=s.row2,pt=s.col2,k=g[f],ft=nt[e],tt=i.tryCast(k,h),gt=s.getRenderSize(t),si=gt.height,oi=gt.width);var y=v._getBindingColumn(t,f,ft),yi=y.dataType==i.DataType.Boolean&&!y.dataMap,wt=ft.pos,ni=k.pos;v._useFrozenDiv()&&d==r.Cell&&!v.editRange?(f<g.frozen&&e>=nt.frozen&&(wt+=v._ptScrl.x),e<nt.frozen&&f>=g.frozen&&(ni+=v._ptScrl.y)):(f<g.frozen&&(ni-=v._ptScrl.y),e<nt.frozen&&(wt-=v._ptScrl.x));(f<g.frozen||e<nt.frozen)&&(dt=!1);vt?p.right=wt+'px':p.left=wt+'px';p.top=ni-t._getOffsetY()+'px';p.width=oi+'px';p.height=si+'px';p.zIndex='';(f<g.frozen||e<nt.frozen)&&(p.zIndex=f<g.frozen&&e<nt.frozen?2:1);d==r.Cell?(tt&&(w+=' wj-group'),v.showAlternatingRows&&k.visibleIndex%2!=0&&(s&&s.row!=s.row2||(w+=' wj-alt')),(f<g.frozen||e<nt.frozen)&&(w+=' wj-frozen'),ei&&(w+=' wj-new'),k.cssClass&&(w+=' '+k.cssClass),y.cssClass&&(w+=' '+y.cssClass)):(w+=' wj-header',v.showAlternatingRows&&f%2!=0&&(w+=' wj-header-alt'));(d==r.Cell||d==r.RowHeader)&&v._getShowErrors()&&(ti=v._getError(t,f,e),ti?(w+=' wj-state-invalid',o.title=ti):o.title='');bt=t.getSelectedState(f,e,s);bt!=c.None&&d==r.Cell&&!yi&&v.editRange&&v.editRange.contains(f,e)&&(bt=c.None);switch(bt){case c.Cursor:w+=' wj-state-selected';break;case c.Selected:w+=' wj-state-multi-selected'}if(ht==g.frozen-1&&(w+=' wj-frozen-row'),pt==nt.frozen-1&&(w+=' wj-frozen-col'),(y.wordWrap||k.wordWrap)&&(w+=' wj-wrap'),dt&&w==o.className&&(ut=o.style,ut.top==p.top&&ut.width==p.width&&ut.height==p.height&&(vt&&ut.right==p.right||!vt&&ut.left==p.left))){ut.display&&(ut.display='');return}p.textAlign=y.getAlignment();p.paddingLeft=p.paddingRight=p.paddingTop=p.paddingBottom='';d==r.Cell&&v.rows.maxGroupLevel>-1&&e==v.columns.firstVisibleIndex&&v.treeIndent&&(hi=tt?Math.max(0,tt.level):v.rows.maxGroupLevel+1,ii=v.treeIndent*hi+v._cellPadding,vt?p.paddingRight=ii+'px':p.paddingLeft=ii+'px');l!=!1&&(kt=t.getCellData(f,e,!1),it=t.getCellData(f,e,!0),d==r.Cell&&e==v.columns.firstVisibleIndex&&tt&&tt.hasChildren&&!this._isEditingCell(v,f,e)?(it||(it=tt.getGroupHeader()),o.innerHTML=this._getTreeIcon(tt)+' '+it,p.textAlign=''):d==r.ColumnHeader&&y.currentSort&&v.showSort&&(ht==v._getSortRowIndex()||y!=ft)?(w+=' wj-sort-'+(y.currentSort=='+'?'asc':'desc'),o.innerHTML=i.escapeHtml(it)+'&nbsp;'+this._getSortIcon(y)):d!=r.RowHeader||e!=v.rowHeaders.columns.length-1||it?d!=r.Cell||y.dataType!=i.DataType.Boolean||y.dataMap||tt&&!i.isBoolean(kt)?d==r.Cell&&this._isEditingCell(v,f,e)?(fi=y.inputType,y.inputType||(fi=y.dataType==i.DataType.Number&&!y.dataMap?'tel':'text'),y.dataMap||y.mask||(et=t.getCellData(f,e,!1),i.isNumber(et)&&(ci=et.toString(),ct=y.format,ct&&et!=Math.round(et)&&(li=ci.match(/\.(\d+)/)[1].length,ct=ct.replace(/([a-z])(\d*)(.*)/ig,'$01'+li+'$3')),it=i.Globalize.formatNumber(et,ct,!0))),o.innerHTML='<input type="'+fi+'" class="wj-grid-editor wj-form-control">',st=o.children[0],st.value=it,st.required=y.getIsRequired(),st.style.textAlign=y.getAlignment(),p.paddingTop=p.paddingBottom='0px',y.mask&&new i._MaskProvider(st,y.mask),v._edtHdl._edt=st):d==r.Cell&&(k.isContentHtml||y.isContentHtml)?o.innerHTML=it:i.setText(o,it):(rt=o.firstChild,rt instanceof HTMLInputElement&&rt.type=='checkbox'||(o.innerHTML='<input type="checkbox" class="wj-cell-check" tabindex="-1"/>',rt=o.firstChild),rt.checked=kt==!0?!0:!1,rt.indeterminate=kt==null,rt.disabled=!v.canEditCell(f,e),rt.disabled&&(rt.style.cursor='default'),v.editRange&&v.editRange.contains(f,e)&&(v._edtHdl._edt=rt)):(ri=v.editableCollectionView,ui=ri?ri.currentEditItem:null,ui&&k.dataItem==ui?o.innerHTML='<span class="wj-glyph-pencil"></span>':i.tryCast(k,a)&&(o.innerHTML='<span class="wj-glyph-asterisk"></span>')),d==r.Cell&&ot()&&y.dataMap&&y.showDropDown!=!1&&v.canEditCell(f,e)&&(n._ddIcon||(n._ddIcon=i.createElement('<div role="button" class="'+n._WJC_DROPDOWN+'"><span class="wj-glyph-down"><\/span><\/div>')),ai=n._ddIcon.cloneNode(!0),o.appendChild(ai)));lt=!1;switch(d){case r.RowHeader:lt=!tt&&!ei&&k.allowDragging&&(v.allowDragging&b.Rows)!=0;i.setAttribute(o,'draggable',lt?'true':null);break;case r.ColumnHeader:lt=ft.allowDragging&&(v.allowDragging&b.Columns)!=0;i.setAttribute(o,'draggable',lt?'true':null)}if(o.className!=w&&(o.className=w),i.setCss(o,p),v.itemFormatter&&v.itemFormatter(t,f,e,o),v.formatItem.hasHandlers){at=n._fmtRng;at?at.setRange(f,e,ht,pt):at=n._fmtRng=new u(f,e,ht,pt);vi=new yt(t,at,o);v.onFormatItem(vi)}},n.prototype.disposeCell=function(){},n.prototype.getEditorValue=function(n){var t=n._edtHdl._edt;return t instanceof HTMLInputElement?t.type=='checkbox'?t.checked:t.value:null},n.prototype._isEditingCell=function(n,t,i){return n.editRange&&n.editRange.contains(t,i)},n.prototype._getTreeIcon=function(t){var i='wj-glyph-'+(t.isCollapsed?'':'down-')+(t.grid.rightToLeft?'left':'right');return'<span role="button" class="'+n._WJC_COLLAPSE+' '+i+'"></span>'},n.prototype._getSortIcon=function(n){return'<span class="wj-glyph-'+(n.currentSort=='+'?'up':'down')+'"></span>'},n}();k._WJC_COLLAPSE='wj-elem-collapse';k._WJC_DROPDOWN='wj-elem-dropdown';n("CellFactory",k);u=function(){function n(n,t,i,r){n===void 0&&(n=-1);t===void 0&&(t=-1);i===void 0&&(i=n);r===void 0&&(r=t);this.setRange(n,t,i,r)}return n.prototype.setRange=function(n,t,r,u){n===void 0&&(n=-1);t===void 0&&(t=-1);r===void 0&&(r=n);u===void 0&&(u=t);this._row=i.asInt(n);this._col=i.asInt(t);this._row2=i.asInt(r);this._col2=i.asInt(u)},Object.defineProperty(n.prototype,"row",{get:function(){return this._row},set:function(n){this._row=i.asInt(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"col",{get:function(){return this._col},set:function(n){this._col=i.asInt(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"row2",{get:function(){return this._row2},set:function(n){this._row2=i.asInt(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"col2",{get:function(){return this._col2},set:function(n){this._col2=i.asInt(n)},enumerable:!0,configurable:!0}),n.prototype.clone=function(){return new n(this._row,this._col,this._row2,this._col2)},Object.defineProperty(n.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"columnSpan",{get:function(){return Math.abs(this._col2-this._col)+1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isSingleCell",{get:function(){return this._row==this._row2&&this._col==this._col2},enumerable:!0,configurable:!0}),n.prototype.contains=function(t,r){var u=i.tryCast(t,n);if(u)return u.topRow>=this.topRow&&u.bottomRow<=this.bottomRow&&u.leftCol>=this.leftCol&&u.rightCol<=this.rightCol;if(i.isInt(t)&&i.isInt(r))return t>=this.topRow&&t<=this.bottomRow&&r>=this.leftCol&&r<=this.rightCol;throw'contains expects a CellRange or row/column indices.';},n.prototype.containsRow=function(n){return i.asInt(n)>=this.topRow&&n<=this.bottomRow},n.prototype.containsColumn=function(n){return i.asInt(n)>=this.leftCol&&n<=this.rightCol},n.prototype.intersects=function(n){return this.intersectsRow(n)&&this.intersectsColumn(n)},n.prototype.intersectsRow=function(n){return n&&!(this.bottomRow<n.topRow||this.topRow>n.bottomRow)},n.prototype.intersectsColumn=function(n){return n&&!(this.rightCol<n.leftCol||this.leftCol>n.rightCol)},n.prototype.getRenderSize=function(n){var u=new i.Size(0,0),t,r;if(this.isValid){for(t=this.topRow;t<=this.bottomRow;t++)u.height+=n.rows[t].renderSize;for(r=this.leftCol;r<=this.rightCol;r++)u.width+=n.columns[r].renderSize}return u},n.prototype.equals=function(t){return t instanceof n&&this._row==t._row&&this._col==t._col&&this._row2==t._row2&&this._col2==t._col2},n}();n("CellRange",u),function(n){n[n.Visible=1]="Visible";n[n.AllowResizing=2]="AllowResizing";n[n.AllowDragging=4]="AllowDragging";n[n.AllowMerging=8]="AllowMerging";n[n.AllowSorting=16]="AllowSorting";n[n.AutoGenerated=32]="AutoGenerated";n[n.Collapsed=64]="Collapsed";n[n.ParentCollapsed=128]="ParentCollapsed";n[n.Selected=256]="Selected";n[n.ReadOnly=512]="ReadOnly";n[n.HtmlContent=1024]="HtmlContent";n[n.WordWrap=2048]="WordWrap";n[n.RowDefault=3]="RowDefault";n[n.ColumnDefault=23]="ColumnDefault"}(e||(e={}));n("RowColFlags",e);ht=function(){function n(){this._list=null;this._pos=0;this._idx=-1;this._vidx=-1}return Object.defineProperty(n.prototype,"visible",{get:function(){return this._getFlag(e.Visible)},set:function(n){this._setFlag(e.Visible,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isVisible",{get:function(){return this._getFlag(e.Visible)?this._getFlag(e.ParentCollapsed)&&!(this instanceof a)?!1:!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pos",{get:function(){return this._list&&this._list._update(),this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"index",{get:function(){return this._list&&this._list._update(),this._idx},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visibleIndex",{get:function(){return this._list&&this._list._update(),this.isVisible?this._vidx:-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._sz},set:function(n){n!=this._sz&&(this._sz=i.asNumber(n,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"renderSize",{get:function(){if(!this.isVisible)return 0;var n=this._sz,t=this._list;return t&&((n==null||n<0)&&(n=Math.round(t.defaultSize)),t.minSize!=null&&n<t.minSize&&(n=t.minSize),t.maxSize!=null&&n>t.maxSize&&(n=t.maxSize)),this._szMin!=null&&n<this._szMin&&(n=this._szMin),this._szMax!=null&&n>this._szMax&&(n=this._szMax),Math.round(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowResizing",{get:function(){return this._getFlag(e.AllowResizing)},set:function(n){this._setFlag(e.AllowResizing,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowDragging",{get:function(){return this._getFlag(e.AllowDragging)},set:function(n){this._setFlag(e.AllowDragging,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowMerging",{get:function(){return this._getFlag(e.AllowMerging)},set:function(n){this._setFlag(e.AllowMerging,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isSelected",{get:function(){return this._getFlag(e.Selected)},set:function(n){if(this._setFlag(e.Selected,n,!0)){var t=this.grid;t&&t.refreshCells(!1,!0,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isReadOnly",{get:function(){return this._getFlag(e.ReadOnly)},set:function(n){this._setFlag(e.ReadOnly,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isContentHtml",{get:function(){return this._getFlag(e.HtmlContent)},set:function(n){this.isContentHtml!=n&&(this._setFlag(e.HtmlContent,n),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wordWrap",{get:function(){return this._getFlag(e.WordWrap)},set:function(n){this._setFlag(e.WordWrap,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cssClass",{get:function(){return this._cssClass},set:function(n){n!=this._cssClass&&(this._cssClass=i.asString(n),this.grid&&this.grid.invalidate(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"grid",{get:function(){return this._list?this._list._g:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"collectionView",{get:function(){return this.grid?this.grid.collectionView:null},enumerable:!0,configurable:!0}),n.prototype.onPropertyChanged=function(){this._list&&(this._list._dirty=!0,this.grid.invalidate())},n.prototype._getFlag=function(n){return(this._f&n)!=0},n.prototype._setFlag=function(n,t,i){return t!=this._getFlag(n)?(this._f=t?this._f|n:this._f&~n,i||this.onPropertyChanged(),!0):!1},n}();n("RowCol",ht);v=function(n){function t(r){var u=n.call(this)||this;return u._f=e.ColumnDefault,u._hash=t._ctr.toString(36),t._ctr++,r&&i.copy(u,r),u}return w(t,n),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(n){this._name=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){return this._type},set:function(n){this._type!=n&&(this._type=i.asEnum(n,i.DataType),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRequired",{get:function(){return this._required},set:function(n){this._required=i.asBoolean(n,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showDropDown",{get:function(){return this._showDropDown},set:function(n){n!=this._showDropDown&&(this._showDropDown=i.asBoolean(n,!0),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropDownCssClass",{get:function(){return this._ddCssClass},set:function(n){this._ddCssClass=i.asString(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputType",{get:function(){return this._inpType},set:function(n){this._inpType=i.asString(n,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(n){this._mask=i.asString(n,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(n){var r,t,u;n!=this.binding&&(r=i.asString(n),this._binding=r?new i.Binding(r):null,!this._type&&this.grid&&this._binding&&(t=this.grid.collectionView,t&&t.sourceCollection&&t.sourceCollection.length&&(u=t.sourceCollection[0],this._type=i.getType(this._binding.getValue(u)))),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortMemberPath",{get:function(){return this._bindingSort?this._bindingSort.path:null},set:function(n){if(n!=this.sortMemberPath){var t=i.asString(n);this._bindingSort=t?new i.Binding(t):null;this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._szStar!=null?this._szStar:this.size},set:function(n){t._parseStarSize(n)!=null?(this._szStar=n,this.onPropertyChanged()):(this._szStar=null,this.size=i.asNumber(n,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minWidth",{get:function(){return this._szMin},set:function(n){n!=this._szMin&&(this._szMin=i.asNumber(n,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._szMax},set:function(n){n!=this._szMax&&(this._szMax=i.asNumber(n,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderWidth",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(n){this._align!=n&&(this._align=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),t.prototype.getAlignment=function(){var n=this._align;if(n==null&&(n='',!this._map))switch(this._type){case i.DataType.Boolean:n='center';break;case i.DataType.Number:n='right'}return n},t.prototype.getIsRequired=function(){return this._required!=null?this._required:this.dataType==i.DataType.String?this.dataMap!=null||this._mask&&this._mask.length>0:!0},Object.defineProperty(t.prototype,"header",{get:function(){return this._hdr?this._hdr:this.binding},set:function(n){this._hdr!=n&&(this._hdr=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataMap",{get:function(){return this._map},set:function(n){this._map!=n&&(this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this),i.isArray(n)&&(n=new at(n,null,null)),this._map=i.asType(n,at,!0),this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._fmt},set:function(n){this._fmt!=n&&(this._fmt=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._getFlag(e.AllowSorting)},set:function(n){this._setFlag(e.AllowSorting,n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSort",{get:function(){var t,n;if(this.grid&&this.grid.collectionView&&this.grid.collectionView.canSort)for(t=this.grid.collectionView.sortDescriptions,n=0;n<t.length;n++)if(t[n].property==this._getBindingSort())return t[n].ascending?'+':'-';return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregate",{get:function(){return this._agg!=null?this._agg:i.Aggregate.None},set:function(n){n!=this._agg&&(this._agg=i.asEnum(n,i.Aggregate),this.onPropertyChanged())},enumerable:!0,configurable:!0}),t.prototype._getBindingSort=function(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null},t._parseStarSize=function(n){if(i.isString(n)&&n.length>0&&n[n.length-1]=='*'){var t=n.length==1?1:n.substr(0,n.length-1)*1;if(t>0&&!isNaN(t))return t}return null},t}(ht);v._ctr=0;n("Column",v);nt=function(n){function t(t){var i=n.call(this)||this;return i._f=e.ColumnDefault,i._data=t,i}return w(t,n),Object.defineProperty(t.prototype,"dataItem",{get:function(){return this._data},set:function(n){this._data=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size},set:function(n){this.size=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderHeight",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),t}(ht);n("Row",nt);h=function(n){function t(){var t=n.call(this)||this;return t._level=-1,t.isReadOnly=!0,t}return w(t,n),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(n){i.asInt(n);n!=this._level&&(this._level=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){if(this.grid!=null&&this._list!=null){this._list._update();var n=this.index<this._list.length-1?this._list[this.index+1]:null,r=i.tryCast(n,t),u=i.tryCast(n,a);return n!=null&&u==null&&(r==null||r.level>this.level)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollapsed",{get:function(){return this._getFlag(e.Collapsed)},set:function(n){i.asBoolean(n);n!=this.isCollapsed&&this._list!=null&&this._setCollapsed(n)},enumerable:!0,configurable:!0}),t.prototype.getGroupHeader=function(){var u=this.grid,o=u.groupHeaderFormat?u.groupHeaderFormat:i.culture.FlexGrid.groupHeaderFormat,r=i.tryCast(this.dataItem,i.CollectionViewGroup),s;if(r&&o){var f=r.groupDescription.propertyName,t=r.name,n=u.getColumn(f),e=this.isContentHtml;return n&&(e=e||n.isContentHtml,n.header&&(f=n.header),n.dataMap?t=n.dataMap.getDisplayValue(t):n.format&&(t=i.Globalize.format(t,n.format))),s=r.getAggregate(i.Aggregate.CntAll,null,u.collectionView),i.format(o,{name:i.escapeHtml(f),value:e?t:i.escapeHtml(t),level:r.level,count:s})}return''},t.prototype._setCollapsed=function(n){var l=this,r=this.grid,o=r.rows,c=this.getCellRange(),h=new s(r.cells,new u(this.index,-1)),f;r.onGroupCollapsedChanging(h);if(!h.cancel){r.deferUpdate(function(){l._setFlag(e.Collapsed,n);for(var r=c.topRow+1;r<=c.bottomRow&&r>-1&&r<o.length;r++)o[r]._setFlag(e.ParentCollapsed,n),f=i.tryCast(o[r],t),f!=null&&f.isCollapsed&&(r=f.getCellRange().bottomRow)});r.onGroupCollapsedChanged(h)}},t.prototype.getCellRange=function(){for(var f,e=this._list,o=this.index,r=e.length-1,n=o+1;n<=r;n++)if(f=i.tryCast(e[n],t),f!=null&&f.level<=this.level){r=n-1;break}return new u(o,0,r,this.grid.columns.length-1)},t}(nt);n("GroupRow",h);ct=function(n){function t(t,r){var u=n.call(this)||this;return u._frozen=0,u._vlen=0,u._szDef=28,u._szTot=0,u._dirty=!1,u._g=i.asType(t,y),u._szDef=i.asNumber(r,!1,!0),u}return w(t,n),Object.defineProperty(t.prototype,"defaultSize",{get:function(){return this._szDef},set:function(n){this._szDef!=n&&(this._szDef=i.asNumber(n,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozen",{get:function(){return this._frozen},set:function(n){n!=this._frozen&&(this._frozen=i.asNumber(n,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.isFrozen=function(n){return n<this.frozen},Object.defineProperty(t.prototype,"minSize",{get:function(){return this._szMin},set:function(n){n!=this._szMin&&(this._szMin=i.asNumber(n,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._szMax},set:function(n){n!=this._szMax&&(this._szMax=i.asNumber(n,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getTotalSize=function(){return this._update(),this._szTot},Object.defineProperty(t.prototype,"visibleLength",{get:function(){return this._update(),this._vlen},enumerable:!0,configurable:!0}),t.prototype.getItemAt=function(n){if(this._update(),n<=0&&this.length>0)return 0;for(var u=0,i=this.length-1,t,r;u<=i;)if(t=u+i>>>1,r=this[t],r._pos>n)i=t-1;else if(r._pos+r.renderSize<n)u=t+1;else{while(t>0&&!this[t].visible)t--;while(t<this.length-1&&!this[t].visible)t++;return t}return i},t.prototype.getNextCell=function(n,t,i){var r;switch(t){case o.Next:for(r=n+1;r<this.length;r++)if(this[r].renderSize>0)return r;break;case o.Prev:for(r=n-1;r>=0;r--)if(this[r].renderSize>0)return r;break;case o.End:for(r=this.length-1;r>=0;r--)if(this[r].renderSize>0)return r;break;case o.Home:for(r=0;r<this.length;r++)if(this[r].renderSize>0)return r;break;case o.NextPage:return r=this.getItemAt(this[n].pos+i),r<0?this.getNextCell(n,o.End,i):r==n&&r<this.length-1?r+1:r;case o.PrevPage:return r=this.getItemAt(this[n].pos-i),r<0?this.getNextCell(n,o.Home,i):r==n&&r>0?r-1:r}return n},t.prototype.canMoveElement=function(n,t){var r,u,i;if(t==n||n<0||n>=this.length||t>=this.length)return!1;for(t<0&&(t=this.length-1),r=Math.min(n,t),u=Math.max(n,t),i=r;i<=u;i++)if(!this[i].allowDragging)return!1;return this[t]instanceof a?!1:!0},t.prototype.moveElement=function(n,t){if(this.canMoveElement(n,t)){var i=this[n];this.removeAt(n);t<0&&(t=this.length);this.insert(t,i)}},t.prototype.onCollectionChanged=function(t){t===void 0&&(t=i.NotifyCollectionChangedEventArgs.reset);this._dirty=!0;this._g.invalidate();n.prototype.onCollectionChanged.call(this,t)},t.prototype.push=function(t){return t._list=this,n.prototype.push.call(this,t)},t.prototype.splice=function(t,i,r){return r&&(r._list=this),n.prototype.splice.call(this,t,i,r)},t.prototype.beginUpdate=function(){this._update();n.prototype.beginUpdate.call(this)},t.prototype._update=function(){var t;if(this._dirty&&!this.isUpdating){this._dirty=!1;var i=0,r=0,u=void 0,n=void 0;for(t=0;t<this.length;t++)n=this[t],n._idx=t,n._vidx=i,n._list=this,n._pos=r,u=n.renderSize,u>0&&(r+=u,i++);return this._vlen=i,this._szTot=r,!0}return!1},t}(i.ObservableArray);n("RowColCollection",ct);et=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._firstVisible=-1,t}return w(t,n),t.prototype.getColumn=function(n){var t=i.isNumber(n)?n:this.indexOf(n);return t>-1?this[t]:null},t.prototype.indexOf=function(t){var i;if(t instanceof v)return n.prototype.indexOf.call(this,t);for(i=0;i<this.length;i++)if(this[i].name==t)return i;for(i=0;i<this.length;i++)if(this[i].binding==t)return i;return-1},Object.defineProperty(t.prototype,"firstVisibleIndex",{get:function(){return this._update(),this._firstVisible},enumerable:!0,configurable:!0}),t.prototype._update=function(){if(n.prototype._update.call(this)){this._firstVisible=-1;for(var t=0;t<this.length;t++)if(this[t].visible){this._firstVisible=t;break}return!0}return!1},t.prototype._updateStarSizes=function(n){for(var r,t,f=0,u,i=0;i<this.length;i++)t=this[i],t.isVisible&&(t._szStar?(f+=v._parseStarSize(t._szStar),u=t):n-=t.renderWidth);if(u){for(r=n,i=0;i<this.length;i++)t=this[i],t.isVisible&&t._szStar&&(t==u&&r>0?t._sz=r:(t._sz=Math.max(0,Math.round(v._parseStarSize(t._szStar)/f*n)),r-=t.renderWidth));return this._dirty=!0,this._update(),!0}return!1},t}(ct);n("ColumnCollection",et);ft=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._maxLevel=-1,t}return w(t,n),Object.defineProperty(t.prototype,"maxGroupLevel",{get:function(){return this._update(),this._maxLevel},enumerable:!0,configurable:!0}),t.prototype._update=function(){var t,r;if(n.prototype._update.call(this)){for(this._maxLevel=-1,t=0;t<this.length;t++)r=i.tryCast(this[t],h),r&&r.level>this._maxLevel&&(this._maxLevel=r.level);return!0}return!1},t}(ct);n("RowCollection",ft);rt=function(){function n(t,u){var f,k,s,c,w,b;if(this._row=-1,this._col=-1,this._edge=0,t instanceof Element){k=i.closest(t,'.wj-cell');s=k?k[p._INDEX_KEY]:null;s&&(this._row=s.row,this._col=s.col,this._rng=s.rng,this._p=s.panel,this._g=s.panel.grid);return}if(t instanceof y)f=this._g=t;else if(t instanceof p)this._p=t,f=this._g=this._p.grid;else throw'First parameter should be a FlexGrid or GridPanel.';u=i.mouseToPage(u);this._pt=u.clone();var d=f.controlRect,g=f._szClient,et=f.topLeftCells,ot=f._eTL,nt=f.headersVisibility,tt=l,h=nt&tt.Row?et.columns.getTotalSize():0,a=nt&tt.Column?et.rows.getTotalSize():0,it=nt&tt.Column?a+ot.offsetTop:0,rt=f._eBL,st=rt.offsetHeight;if(u.x-=d.left,u.y-=d.top,this._g.rightToLeft&&(u.x=d.width-u.x),!this._p&&u.x>=0&&u.y>=ot.offsetTop&&g&&u.x<=g.width+h&&u.y<=g.height+it&&(this._p=u.y<it?u.x<h?f.topLeftCells:f.columnHeaders:u.y<rt.offsetTop?u.x<h?f.rowHeaders:f.cells:u.x<h?f.bottomLeftCells:f.columnFooters),this._p!=null){var ut=this._p.rows,ft=this._p.columns,e=this._p.cellType,o=r,v=this._p._getFrozenPos(),ht=e==o.TopLeft||e==o.ColumnHeader?a:e==o.BottomLeft||e==o.ColumnFooter?st:ut.getTotalSize(),ct=e==o.TopLeft||e==o.BottomLeft||e==o.RowHeader?h:ft.getTotalSize();if(e==o.RowHeader||e==o.Cell?(u.y-=a,(u.y>v.y||v.y<=0)&&(u.y-=f._ptScrl.y,u.y+=this._p._getOffsetY())):(e==o.BottomLeft||e==o.ColumnFooter)&&(u.y-=rt.offsetTop),(e==o.ColumnHeader||e==o.Cell||e==o.ColumnFooter)&&(u.x-=h,(u.x>v.x||v.x<=0)&&(u.x-=f._ptScrl.x)),(e==o.ColumnHeader||e==o.TopLeft)&&(u.y-=it-a),this._row=u.y>ht?-1:ut.getItemAt(u.y),this._col=u.x>ct?-1:ft.getItemAt(u.x),this._row<0||this._col<0){this._p=null;return}this._edge=0;c=n._SZEDGE[this._g.isTouching?1:0];this._col>-1&&(w=ft[this._col],u.x-w.pos<=c&&(this._edge|=1),w.pos+w.renderSize-u.x<=c&&(this._edge|=4));this._row>-1&&(b=ut[this._row],u.y-b.pos<=c&&(this._edge|=2),b.pos+b.renderSize-u.y<=c&&(this._edge|=8))}}return Object.defineProperty(n.prototype,"point",{get:function(){return this._pt},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cellType",{get:function(){return this._p?this._p.cellType:r.None},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"grid",{get:function(){return this._p?this._p.grid:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"range",{get:function(){return this._rng||(this._rng=new u(this._row,this._col)),this._rng},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeLeft",{get:function(){return(this._edge&1)!=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeTop",{get:function(){return(this._edge&2)!=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeRight",{get:function(){return(this._edge&4)!=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeBottom",{get:function(){return(this._edge&8)!=0},enumerable:!0,configurable:!0}),n}();rt._SZEDGE=[5,30];n("HitTestInfo",rt),function(n){n[n.None=0]="None";n[n.Cells=1]="Cells";n[n.ColumnHeaders=2]="ColumnHeaders";n[n.RowHeaders=4]="RowHeaders";n[n.AllHeaders=6]="AllHeaders";n[n.All=7]="All"}(d||(d={}));n("AllowMerging",d);lt=function(){function n(n){this._g=n}return n.prototype.getMergedRange=function(n,t,f,e){var l,it,g,p,w,rt,nt,b,k;e===void 0&&(e=!0);var o,v,c=n.cellType,s=n.columns,y=n.rows,tt=y[t],ut=s[f];if(tt instanceof a)return null;if(tt instanceof h&&tt.dataItem instanceof i.CollectionViewGroup){if(o=new u(t,f),ut.aggregate==i.Aggregate.None){while(o.col>0&&s[o.col-1].aggregate==i.Aggregate.None&&o.col!=s.frozen)o.col--;while(o.col2<s.length-1&&s[o.col2+1].aggregate==i.Aggregate.None&&o.col2+1!=s.frozen)o.col2++}while(o.col<f&&!s[o.col].visible)o.col++;return o.isSingleCell?null:o}l=!1;switch(this._g.allowMerging){case d.None:l=!0;break;case d.Cells:l=c!=r.Cell;break;case d.ColumnHeaders:l=c!=r.ColumnHeader&&c!=r.TopLeft;break;case d.RowHeaders:l=c!=r.RowHeader&&c!=r.TopLeft;break;case d.AllHeaders:l=c==r.Cell}if(l)return null;if(s[f].allowMerging){for(o=new u(t,f),it=0,g=y.length-1,t>=y.frozen?e&&(c==r.Cell||c==r.RowHeader)&&(v=n._getViewRange(),it=v.topRow,g=v.bottomRow):g=y.frozen-1,p=t-1;p>=it&&this._mergeCell(n,p,f,t,f);p--)o.row=p;for(w=t+1;w<=g&&this._mergeCell(n,t,f,w,f);w++)o.row2=w;while(o.row<t&&!y[o.row].visible)o.row++;if(!o.isSingleCell)return o}if(y[t].allowMerging){for(o=new u(t,f),rt=0,nt=s.length-1,f>=s.frozen?e&&(c==r.Cell||c==r.ColumnHeader)&&(v=n._getViewRange(),rt=v.leftCol,nt=v.rightCol):nt=s.frozen-1,b=f-1;b>=rt&&this._mergeCell(n,t,b,t,f);b--)o.col=b;for(k=f+1;k<=nt&&this._mergeCell(n,t,f,t,k);k++)o.col2=k;while(o.col<f&&!s[o.col].visible)o.col++;if(!o.isSingleCell)return o}return null},n.prototype._mergeCell=function(n,t,i,r,u){var f=n.rows[t],e=n.rows[r];return f instanceof h||f instanceof a||e instanceof h||e instanceof a?!1:t!=r&&n.rows.isFrozen(t)!=n.rows.isFrozen(r)?!1:i!=u&&n.columns.isFrozen(i)!=n.columns.isFrozen(u)?!1:t!=r&&(i>0&&(f.allowMerging&&this._mergeCell(n,t,i-1,t,i)||e.allowMerging&&this._mergeCell(n,r,i-1,r,i))||u<n.columns.length-1&&(f.allowMerging&&this._mergeCell(n,t,u,t,u+1)||e.allowMerging&&this._mergeCell(n,r,u,r,u+1)))?!1:n.getCellData(t,i,!0)!=n.getCellData(r,u,!0)?!1:!0},n}();n("MergeManager",lt);at=function(){function n(n,t,r){var f,u;if(this.mapChanged=new i.Event,i.isArray(n)&&!t&&!r){for(f=[],u=0;u<n.length;u++)f.push({value:n[u]});n=f;t=r='value'}this._cv=i.asCollectionView(n);this._keyPath=i.asString(t,!1);this._displayPath=i.asString(r,!1);this._cv.collectionChanged.addHandler(this.onMapChanged,this)}return Object.defineProperty(n.prototype,"sortByDisplayValues",{get:function(){return this._sortByKey!=!0},set:function(n){this._sortByKey=!i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectedValuePath",{get:function(){return this._keyPath},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayMemberPath",{get:function(){return this._displayPath},enumerable:!0,configurable:!0}),n.prototype.getKeyValue=function(n){var t=this._indexOf(n,this._displayPath,!1);return t>-1?this._cv.sourceCollection[t][this._keyPath]:null},n.prototype.getDisplayValue=function(n){var t,i,r;if(!this._hash&&(this._hash={},t=this._cv.sourceCollection,t&&this._keyPath&&this._displayPath))for(i=t.length-1;i>=0;i--){var u=t[i],f=u[this._keyPath],e=u[this._displayPath];this._hash[f]=e}return r=this._hash[n],r!=null?r:n},n.prototype.getDisplayValues=function(){var i=[],t,n;if(this._cv&&this._displayPath)for(t=this._cv.items,n=0;n<t.length;n++)i.push(t[n][this._displayPath]);return i},n.prototype.getKeyValues=function(){var i=[],t,n;if(this._cv&&this._keyPath)for(t=this._cv.items,n=0;n<t.length;n++)i.push(t[n][this._keyPath]);return i},Object.defineProperty(n.prototype,"isEditable",{get:function(){return this._editable},set:function(n){this._editable=i.asBoolean(n)},enumerable:!0,configurable:!0}),n.prototype.onMapChanged=function(n){this._hash=null;this.mapChanged.raise(this,n)},n.prototype._indexOf=function(n,t,i){var u=-1,e=-1,r,s,f;if(this._cv&&t){var o=n!=null?n.toString():'',h=i?o:o.toLowerCase(),c=this._cv.sourceCollection;for(r=0;r<c.length;r++)if(s=c[r],f=s[t],f==n?u=r:i||f.length!=h.length||f.toLowerCase()!=h?f!=null&&f.toString()==o&&(u=r):u=r,u==r){if(!this._cv.filter||this._cv.filter(s))return u;e<0&&(e=u)}}return e},n}();n("DataMap",at),function(n){n[n.None=0]="None";n[n.Cell=1]="Cell";n[n.CellRange=2]="CellRange";n[n.Row=3]="Row";n[n.RowRange=4]="RowRange";n[n.ListBox=5]="ListBox"}(f||(f={}));n("SelectionMode",f),function(n){n[n.None=0]="None";n[n.Selected=1]="Selected";n[n.Cursor=2]="Cursor"}(c||(c={}));n("SelectedState",c),function(n){n[n.None=0]="None";n[n.Next=1]="Next";n[n.Prev=2]="Prev";n[n.NextPage=3]="NextPage";n[n.PrevPage=4]="PrevPage";n[n.Home=5]="Home";n[n.End=6]="End";n[n.NextCell=7]="NextCell";n[n.PrevCell=8]="PrevCell"}(o||(o={}));n("SelMove",o);pt=function(){function n(n){this._sel=new u(0,0);this._mode=f.CellRange;this._g=n}return Object.defineProperty(n.prototype,"selectionMode",{get:function(){return this._mode},set:function(n){var i,t,r,u;if(n!=this._mode){if(n==f.ListBox||this._mode==f.ListBox)for(i=this._g.rows,t=0;t<i.length;t++)r=i[t],u=n==f.ListBox?this._sel.containsRow(t):!1,r._setFlag(e.Selected,u,!0);switch(n){case f.None:this._sel.setRange(-1,-1);break;case f.Cell:this._sel.row2=this._sel.row;this._sel.col2=this._sel.col;break;case f.Row:this._sel.row2=this._sel.row}this._mode=n;this._g.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selection",{get:function(){return this._sel},set:function(n){this.select(n)},enumerable:!0,configurable:!0}),n.prototype.select=function(n,t){var l,a,h,v;t===void 0&&(t=!0);i.isNumber(n)&&i.isNumber(t)&&(n=new u(n,t),t=!0);n=i.asType(n,u);var r=this._g,y=this._sel,o=n,c=!1;switch(r.selectionMode){case f.Cell:n.row2=n.row;n.col2=n.col;break;case f.Row:n.row2=n.row;break;case f.ListBox:c=!0}if(l=o.equals(y),c&&o.row>-1&&!r.rows[o.row].isSelected&&(l=!1),l){t&&r.scrollIntoView(o.row,o.col);return}if(a=new s(r.cells,o),r.onSelectionChanging(a)){if(c){for(h=0;h<r.rows.length;h++)r.rows[h]._setFlag(e.Selected,o.containsRow(h),!0);r.refreshCells(!1,!0,!0)}o.row=Math.min(o.row,r.rows.length-1);o.row2=Math.min(o.row2,r.rows.length-1);this._sel=o;r.refreshCells(!1,!0,!0);t&&r.scrollIntoView(o.row,o.col);r.collectionView&&(v=r._getCvIndex(o.row),r.collectionView.moveCurrentToPosition(v));r.onSelectionChanged(a)}},n.prototype.moveSelection=function(n,t,i){var f,r,h=this._g,l=h.rows,c=h.columns,e=this._getReferenceCell(n,t,i),s=Math.max(0,h._szClient.height-h.columnHeaders.height),a;t==o.NextCell?(r=c.getNextCell(e.col,o.Next,s),f=e.row,r==e.col&&(f=l.getNextCell(f,o.Next,s),f>e.row&&(r=c.getNextCell(0,o.Next,s),r=c.getNextCell(r,o.Prev,s))),h.select(f,r)):t==o.PrevCell?(r=c.getNextCell(e.col,o.Prev,s),f=e.row,r==e.col&&(f=l.getNextCell(f,o.Prev,s),f<e.row&&(r=c.getNextCell(c.length-1,o.Prev,s),r=c.getNextCell(r,o.Next,s))),h.select(f,r)):(f=l.getNextCell(e.row,n,s),r=c.getNextCell(e.col,t,s),i?(a=h._selHdl._sel,h.select(new u(f,r,a.row2,a.col2))):h.select(f,r))},n.prototype._getReferenceCell=function(n,t){var u=this._g,r=u._selHdl._sel,i=u.getMergedRange(u.cells,r.row,r.col);if(!i||i.isSingleCell)return r;i=i.clone();switch(n){case o.Next:case o.NextCell:i.row=i.bottomRow;break;case o.None:i.row=r.row}switch(t){case o.Next:case o.NextCell:i.col=i.rightCol;break;case o.None:i.col=r.col}return i},n.prototype._adjustSelection=function(n){switch(this._mode){case f.Cell:return new u(n.row,n.col,n.row,n.col);case f.Row:return new u(n.row,0,n.row,this._g.columns.length-1);case f.RowRange:case f.ListBox:return new u(n.row,0,n.row2,this._g.columns.length-1)}return n},n}();n("_SelectionHandler",pt),function(n){n[n.None=0]="None";n[n.MoveDown=1]="MoveDown";n[n.MoveAcross=2]="MoveAcross";n[n.Cycle=3]="Cycle"}(g||(g={}));n("KeyAction",g);wt=function(){function n(n){this._kaTab=g.None;this._kaEnter=g.MoveDown;this._g=n;var t=n.hostElement;n.addEventListener(t,'keypress',this._keypress.bind(this));n.addEventListener(t,'keydown',this._keydown.bind(this))}return n.prototype._keydown=function(n){var t=this._g,c=t.selection,a=n.ctrlKey||n.metaKey,l=n.shiftKey,nt=n.target,e=!0,k,g,d,r,v,b;if((this._altDown=!1,t.isRangeValid(c)&&!n.defaultPrevented)&&!t._wantsInput(n.target)&&(!t.activeEditor||!t._edtHdl._keydown(n))){var w=i.tryCast(t.rows[c.row],h),y=t.editableCollectionView,p=n.keyCode;if(t.autoClipboard){if(a&&(p==67||p==45)){if(k=new s(t.cells,c),t.onCopying(k)){g=t.getClipString()+'\r\n';i.Clipboard.copy(g);t.onCopied(k)}n.stopPropagation();return}if(a&&p==86||l&&p==45){t.isReadOnly||(d=new s(t.cells,c),t.onPasting(d)&&i.Clipboard.paste(function(n){t.setClipString(n);t.onPasted(d)}));n.stopPropagation();return}}if(t.rightToLeft)switch(p){case i.Key.Left:p=i.Key.Right;break;case i.Key.Right:p=i.Key.Left}r=o;v=f;switch(p){case i.Key.Space:if(l&&c.isValid)switch(t.selectionMode){case v.CellRange:case v.Row:case v.RowRange:case v.ListBox:t.select(new u(c.row,0,c.row,t.columns.length-1))}else if(a&&c.isValid)switch(t.selectionMode){case v.CellRange:t.select(new u(0,c.col,t.rows.length-1,c.col))}else e=this._startEditing(!0,n),e&&setTimeout(function(){var n=t.activeEditor;n&&(n.disabled||n.readOnly?t.finishEditing():n.type=='checkbox'?(n.checked=!n.checked,t.finishEditing()):i.setSelectionRange(n,n.value.length))});break;case 65:if(a)switch(t.selectionMode){case v.CellRange:case v.Row:case v.RowRange:case v.ListBox:t.select(new u(0,0,t.rows.length-1,t.columns.length-1))}else e=!1;break;case i.Key.Left:a||n.altKey?e=!1:c.isValid&&c.col==0&&w!=null&&!w.isCollapsed&&w.hasChildren?w.isCollapsed=!0:this._moveSel(r.None,a?r.Home:r.Prev,l);break;case i.Key.Right:a||n.altKey?e=!1:c.isValid&&c.col==0&&w!=null&&w.isCollapsed?w.isCollapsed=!1:this._moveSel(r.None,a?r.End:r.Next,l);break;case i.Key.Up:a?e=!1:(this._altDown=n.altKey,n.altKey?e=t._edtHdl._toggleListBox(n):this._moveSel(r.Prev,r.None,l));break;case i.Key.Down:a?e=!1:(this._altDown=n.altKey,n.altKey?e=t._edtHdl._toggleListBox(n):this._moveSel(r.Next,r.None,l));break;case i.Key.PageUp:this._altDown=n.altKey;this._moveSel(n.altKey?r.Home:r.PrevPage,r.None,l);break;case i.Key.PageDown:this._altDown=n.altKey;this._moveSel(n.altKey?r.End:r.NextPage,r.None,l);break;case i.Key.Home:this._moveSel(a?r.Home:r.None,r.Home,l);break;case i.Key.End:this._moveSel(a?r.End:r.None,r.End,l);break;case i.Key.Tab:e=this._performKeyAction(t.keyActionTab,l);break;case i.Key.Enter:e=this._performKeyAction(t.keyActionEnter,l);!l&&y&&y.currentEditItem!=null&&t._edtHdl._commitRowEdits();break;case i.Key.Escape:if(e=!1,y&&(y.currentAddItem||y.currentEditItem)){b=new s(t.cells,t.selection);b.cancel=!0;t.onRowEditEnding(b);y.currentAddItem&&y.cancelNew();y.currentEditItem&&y.cancelEdit();t.onRowEditEnded(b);e=!0}t._mouseHdl.resetMouseState();break;case i.Key.Delete:case i.Key.Back:e=this._deleteSel(n);break;case i.Key.F2:e=this._startEditing(!0,n);break;case i.Key.F4:e=t._edtHdl._toggleListBox(n);break;default:e=!1}e&&(t.containsFocus()||t.focus(),n.preventDefault(),n.stopPropagation())}},n.prototype._performKeyAction=function(n,t){var i=o;switch(n){case g.MoveDown:return this._moveSel(t?i.Prev:i.Next,i.None,!1),!0;case g.MoveAcross:return this._moveSel(i.None,t?i.Prev:i.Next,!1),!0;case g.Cycle:return this._moveSel(i.None,t?i.PrevCell:i.NextCell,!1),!0}return!1},n.prototype._keypress=function(n){var t=this._g;if(!t._wantsInput(n.target)&&!n.defaultPrevented){if(this._altDown){n.preventDefault();return}t.activeEditor?t._edtHdl._keypress(n):n.charCode>i.Key.Space&&this._startEditing(!1,n)&&t.activeEditor&&setTimeout(function(){var r=t.activeEditor;if(r&&r.type!='checkbox'){var u=t.selection,f=t.getCellData(u.row,u.col,!0),e=t.getCellData(u.row,u.col,!1);r.value=String.fromCharCode(n.charCode);i.isNumber(e)&&f.indexOf('%')>-1&&(r.value+='%');i.setSelectionRange(r,1);r.dispatchEvent(t._edtHdl._evtInput);t._edtHdl._keypress(n)}});n.stopPropagation()}},n.prototype._moveSel=function(n,t,i){this._g.selectionMode!=f.None&&this._g._selHdl.moveSelection(n,t,i)},n.prototype._deleteSel=function(n){var t=this._g,r=t.editableCollectionView,e=t.selection,c=t.rows,o=[],y=new u,l=new st(t.cells,y,n),i,a,v,s,p,h,w;if(t.allowDelete&&!t.isReadOnly&&(r==null||r.canRemove&&!r.isAddingNew&&!r.isEditingItem))switch(t.selectionMode){case f.CellRange:if(e.leftCol==0&&e.rightCol==t.columns.length-1)for(i=e.topRow;i>-1&&i<=e.bottomRow;i++)o.push(c[i]);break;case f.ListBox:for(i=0;i<c.length;i++)c[i].isSelected&&o.push(c[i]);break;case f.Row:e.topRow>-1&&o.push(c[e.topRow]);break;case f.RowRange:for(i=e.topRow;i>-1&&i<=e.bottomRow;i++)o.push(c[i])}if(o.length>0){for(r&&r.beginUpdate(),t.beginUpdate(),i=o.length-1;i>=0;i--)if(a=o[i],y.setRange(a.index,-1),t.onDeletingRow(l)){r&&a.dataItem?r.remove(a.dataItem):t.rows.removeAt(a.index);t.onDeletedRow(l)}return t.endUpdate(),r&&r.endUpdate(),t.selectionMode==f.ListBox&&(v=t.selection.row,v>-1&&v<t.rows.length&&(t.rows[v].isSelected=!0)),t.childItemsPath&&t.collectionView&&t.collectionView.refresh(),!0}if(!t.isReadOnly&&o.length==0){for(r&&r.beginUpdate(),t.beginUpdate(),s=e.topRow;s<=e.bottomRow;s++)if(p=t.rows[s],!p.isReadOnly)for(h=e.leftCol;h<=e.rightCol;h++)if(w=t._getBindingColumn(t.cells,s,t.columns[h]),!w.getIsRequired()&&!w.isReadOnly&&t.getCellData(s,h,!0)&&(y.setRange(s,h),l.cancel=!1,t.onBeginningEdit(l))){r&&r.editItem(p.dataItem);t.setCellData(s,h,'',!0,!1);t.onCellEditEnding(l);t.onCellEditEnded(l)}return r&&(t._edtHdl._edItem=r.currentEditItem,r.endUpdate()),t.endUpdate(),t.selection=e,!0}return!1},n.prototype._startEditing=function(n,t,i,r){return this._g._edtHdl.startEditing(n,i,r,!0,t)},n}();n("_KeyboardHandler",wt);ut=4;bt='wj-state-dragsrc',function(n){n[n.None=0]="None";n[n.Columns=1]="Columns";n[n.Rows=2]="Rows";n[n.Both=3]="Both";n[n.ColumnsAllCells=n.Columns|ut]="ColumnsAllCells";n[n.RowsAllCells=n.Rows|ut]="RowsAllCells";n[n.BothAllCells=n.Both|ut]="BothAllCells"}(tt||(tt={}));n("AllowResizing",tt),function(n){n[n.None=0]="None";n[n.Headers=1]="Headers";n[n.Cells=2]="Cells";n[n.Both=3]="Both"}(it||(it={}));n("AutoSizeMode",it),function(n){n[n.None=0]="None";n[n.Columns=1]="Columns";n[n.Rows=2]="Rows";n[n.Both=3]="Both"}(b||(b={}));n("AllowDragging",b);vt=function(){function n(n){var u=this,t,f,e;this._tsLast=0;t=n.hostElement;this._g=n;this._dvMarker=i.createElement('<div class="wj-marker">&nbsp;</div>');n.addEventListener(t,'mousedown',function(t){var s,o,h;if(n._rcBounds=null,!t.defaultPrevented&&t.button==0){if(n.focus(),setTimeout(function(){t.defaultPrevented||n.focus()}),s=t.target,!n.activeEditor&&n._isInputElement(s)){if(i.getActiveElement()!=s&&s.tagName!='OPTION'){o=n.hitTest(t);switch(o.cellType){case r.Cell:n.select(o.range);break;case r.ColumnHeader:case r.ColumnFooter:n.scrollIntoView(-1,o.col);break;case r.RowHeader:n.scrollIntoView(o.row,-1)}}return}h=i.closest(t.target,'.wj-flexgrid');h&&h!=n.hostElement||u._isDown||(u._isDown=!0,n.addEventListener(document,'mousemove',f),n.addEventListener(document,'mouseup',e),u._mousedown(t))}});f=function(n){u._mousemove(n)};e=function(t){u._isDown=!1;n.removeEventListener(document,'mousemove');n.removeEventListener(document,'mouseup');u._mouseup(t)};n.addEventListener(t,'mousemove',this._hover.bind(this));n.addEventListener(t,'dblclick',this._dblclick.bind(this));n.addEventListener(t,'click',this._click.bind(this));n.addEventListener(t,'selectstart',function(t){n._isInputElement(t.target)||t.preventDefault()});n.addEventListener(t,'wheel',function(t){var r=n.cells.hostElement.parentElement;t.deltaY&&!t.ctrlKey&&!t.metaKey&&r.scrollHeight>r.offsetHeight&&i.closest(t.target,'.wj-flexgrid')==n.hostElement&&(r.scrollTop+=120*(t.deltaY<0?-1:1),t.preventDefault(),t.stopImmediatePropagation())});n.addEventListener(t,'dragstart',this._dragstart.bind(this));n.addEventListener(t,'dragover',this._dragover.bind(this));n.addEventListener(t,'dragleave',this._dragover.bind(this));n.addEventListener(t,'drop',this._drop.bind(this));n.addEventListener(t,'dragend',this._dragend.bind(this))}return n.prototype.resetMouseState=function(){var n,t;this._dragSource&&i.removeClass(this._dragSource,bt);this._showDragMarker(null);n=this._g.hostElement;n&&(n.style.cursor=null);t=this._g;t.removeEventListener(document,'mousemove');t.removeEventListener(document,'mouseup');this._tsLast=Date.now();this._eMouse=null;this._isDown=null;this._htDown=null;this._lbSelRows=null;this._szRowCol=null;this._szArgs=null;this._dragSource=null},n.prototype._mousedown=function(n){var t=this._g,u=t.hitTest(n),o=u.cellType,s,e;if(this._selDown=t.selection,u.panel==t.cells){if(i.closest(n.target,'.'+k._WJC_DROPDOWN)){n.preventDefault();t._edtHdl._toggleListBox(n,u.range);return}if(t.editRange&&t.editRange.contains(u.range))return}if(s=i.getActiveElement(),n.target!=s||!t._isInputElement(n.target)){if(o==r.None){t._edtHdl._commitRowEdits();return}if(this._htDown=u,this._eMouse=n,this._szRowCol!=null){this._handleResizing(n);return}switch(o){case r.Cell:n.ctrlKey&&t.selectionMode==f.ListBox&&this._startListBoxSelection(u.row);this._mouseSelect(n,n.shiftKey);break;case r.RowHeader:(this._g.allowDragging&b.Rows)==0&&(n.ctrlKey&&t.selectionMode==f.ListBox&&this._startListBoxSelection(u.row),this._mouseSelect(n,n.shiftKey))}if(o==r.Cell&&t.rows.maxGroupLevel>-1&&i.closest(n.target,'.'+k._WJC_COLLAPSE)&&(e=i.tryCast(t.rows[u.row],h),e)){n.ctrlKey?t.collapseGroupsToLevel(e.isCollapsed?e.level+1:e.level):e.isCollapsed=!e.isCollapsed;this.resetMouseState();return}}},n.prototype._mousemove=function(n){if(this._htDown!=null){if(n.buttons==0&&this._eMouse&&n.timeStamp-this._eMouse.timeStamp>600){this.resetMouseState();return}if(this._eMouse=n,this._szRowCol)this._handleResizing(n);else switch(this._htDown.cellType){case r.Cell:this._mouseSelect(n,!0);break;case r.RowHeader:(this._g.allowDragging&b.Rows)==0&&this._mouseSelect(n,!0)}}},n.prototype._mouseup=function(n){if(!this._dragSource||!this._g.isTouching){var i=this._g,r=i.hitTest(n),t=this._htDown,e=f;if(t&&!n.defaultPrevented)if(this._szArgs)this._finishResizing(n);else if(t.panel!=i.topLeftCells||this._szArgs)t.panel!=i.columnHeaders||n.dataTransfer?t.panel==i.cells&&(n.ctrlKey||n.metaKey||n.shiftKey||r.panel==t.panel&&r.range.equals(t.range)&&i.selection.equals(this._selDown)&&i.startEditing(!0)):r.panel==t.panel&&r.col==t.col&&!r.edgeRight&&r.col>-1&&this._clickSort(n,r);else if(r.panel==t.panel&&r.row==t.row&&r.col==t.col)switch(i.selectionMode){case e.CellRange:case e.RowRange:case e.ListBox:i.select(new u(0,0,i.rows.length-1,i.columns.length-1))}this.resetMouseState()}},n.prototype._click=function(n){Date.now()-this._tsLast>50&&this._handleClick(n)},n.prototype._handleClick=function(n){var t=this._g,e=n.target,r=new rt(e,null),f;n.defaultPrevented||r.grid!=t||t._isInputElement(e)||(r.panel==t.topLeftCells?t.select(new u(0,0,t.rows.length-1,t.columns.length-1)):r.panel==t.columnHeaders?this._clickSort(n,r):r.panel==t.rowHeaders?t.select(new u(r.row,0,r.row,t.columns.length-1)):r.panel==t.cells&&(r.row<0?this._clickSort(n,r):i.closest(e,'.'+k._WJC_COLLAPSE)?(f=t.rows[r.row],f instanceof h&&(n.ctrlKey?t.collapseGroupsToLevel(f.isCollapsed?f.level+1:f.level):f.isCollapsed=!f.isCollapsed)):i.closest(e,'.'+k._WJC_DROPDOWN)?t._edtHdl._toggleListBox(n,r.range):t.select(r.range)))},n.prototype._clickSort=function(n,t){var r=this._g,c=r.collectionView,u,e,o,h;if(c&&c.canSort&&r.allowSorting){var l=t.range.bottomRow,a=t.panel.columns[t.col],f=r._getBindingColumn(t.panel,t.row,a);if((!(l>-1)||l==r._getSortRowIndex()||a!=f)&&f.allowSorting&&f.binding){for(u=t.grid.collectionView.sortDescriptions,e=null,o=0;o<u.length;o++)if(u[o].property==f.binding){e=!u[o].ascending;break}if(e==null){if(n.ctrlKey)return;e=!0}if(h=new s(t.panel,t.range),r.onSortingColumn(h)){r._edtHdl._commitRowEdits();n.ctrlKey?u.clear():u.splice(0,u.length,new i.SortDescription(f._getBindingSort(),e));r.onSortedColumn(h)}}}},n.prototype._dblclick=function(n){var t=this._g,f=t.hitTest(n),e=f.cellType,l=t.selection,o=f.range,i,h,c,a;if(!n.defaultPrevented){if(f.edgeRight&&t.allowResizing&tt.Columns){if(e==r.ColumnHeader||e==r.Cell&&t.allowResizing&ut){for(n.preventDefault(),n.ctrlKey&&l.containsColumn(f.col)&&(o=l),h=o.leftCol;h<=o.rightCol;h++)if(t.columns[h].allowResizing&&(i=new s(t.cells,new u(-1,h)),t.onAutoSizingColumn(i)&&t.onResizingColumn(i))){t.autoSizeColumn(h);t.onResizedColumn(i);t.onAutoSizedColumn(i)}}else if(e==r.TopLeft&&f.panel.columns[f.col].allowResizing&&(n.preventDefault(),i=new s(f.panel,new u(-1,f.col)),t.onAutoSizingColumn(i)&&t.onResizingColumn(i))){t.autoSizeColumn(f.col,!0);t.onAutoSizedColumn(i);t.onResizedColumn(i)}this.resetMouseState();return}if(f.edgeBottom&&t.allowResizing&tt.Rows){if(e==r.RowHeader||e==r.Cell&&t.allowResizing&ut){for(n.ctrlKey&&l.containsRow(f.row)&&(o=l),c=o.topRow;c<=o.bottomRow;c++)if(t.rows[c].allowResizing&&(i=new s(t.cells,new u(c,-1)),t.onAutoSizingRow(i)&&t.onResizingRow(i))){t.autoSizeRow(c);t.onResizedRow(i);t.onAutoSizedRow(i)}}else if(e==r.TopLeft&&f.panel.rows[f.row].allowResizing&&(i=new s(f.panel,new u(f.row,-1)),t.onAutoSizingRow(i)&&t.onResizingRow(i))){t.autoSizeRow(f.row,!0);t.onResizedRow(i);t.onAutoSizedRow(i)}this.resetMouseState();return}if(e==r.Cell&&!t.activeEditor&&!t._isInputElement(n.target)&&(a=t._selHdl.selection,f.range.contains(a))){t.startEditing(!0);this.resetMouseState();return}}},n.prototype._hover=function(n){if(this._htDown==null){var i=this._g,t=i.hitTest(n),e=t.panel,u=t.cellType,f='default';return this._szRowCol=null,(u==r.ColumnHeader||u==r.TopLeft||u==r.Cell&&i.allowResizing&ut)&&t.edgeRight&&(i.allowResizing&tt.Columns)!=0&&(this._szRowCol=this._getResizeCol(t)),(u==r.RowHeader||u==r.TopLeft||u==r.Cell&&i.allowResizing&ut)&&t.edgeBottom&&(i.allowResizing&tt.Rows)!=0&&(this._szRowCol=this._getResizeRow(t)),this._szRowCol instanceof v?f='col-resize':this._szRowCol instanceof nt&&(f='row-resize'),this._szStart=this._szRowCol?this._szRowCol.renderSize:0,i.hostElement.style.cursor=f,t}return null},n.prototype._getResizeCol=function(n){for(var t,i=n.panel.columns,f=i[n.col],u=n.col+1;u<i.length;u++)if(t=i[u],t.visible){t.size<1&&(f=t);break}if(n.col==i.length-1&&(n.cellType==r.TopLeft||n.cellType==r.RowHeader))for(i=this._g.columns,u=0;u<i.length;u++)if(t=i[u],t.visible){t.size<1&&(f=t);break}return f.allowResizing?f:null},n.prototype._getResizeRow=function(n){for(var t,i=n.panel.rows,f=i[n.row],u=n.row+1;u<i.length;u++)if(t=i[u],t.visible){t.size<1&&(f=t);break}if(n.row==i.length-1&&(n.cellType==r.TopLeft||n.cellType==r.ColumnHeader))for(i=this._g.rows,u=0;u<i.length;u++)if(t=i[u],t.visible){t.size<1&&(f=t);break}return f.allowResizing?f:null},n.prototype._mouseSelect=function(n,t){var e=this,o=this._g,u;this._htDown&&this._htDown.panel&&o.selectionMode!=f.None&&(u=new rt(this._htDown.panel,n),this._handleSelection(u,t),!i.isIE9()&&n.button>=0&&(u=new rt(o,n),u.cellType!=r.Cell&&u.cellType!=r.RowHeader&&setTimeout(function(){e._mouseSelect(e._eMouse,t)},100)))},n.prototype._handleResizing=function(t){var f;if(t.preventDefault(),this._szRowCol instanceof v){var i=this._g,e=t.clientX+pageXOffset,r=Math.round(Math.max(n._SZ_MIN,this._szStart+(e-this._htDown.point.x)*(i.rightToLeft?-1:1)));this._szRowCol.renderSize!=r&&(this._szArgs==null&&(f=i.rowHeaders.columns.indexOf(this._szRowCol)>-1?i.rowHeaders:i.cells,this._szArgs=new s(f,new u(-1,this._szRowCol.index))),this._szArgs.cancel=!1,i.onResizingColumn(this._szArgs)&&(i.deferResizing||i.isTouching?this._showResizeMarker(r):this._szRowCol.width=r))}if(this._szRowCol instanceof nt){var i=this._g,o=t.clientY+pageYOffset,r=Math.round(Math.max(n._SZ_MIN,this._szStart+(o-this._htDown.point.y)));this._szRowCol.renderSize!=r&&(this._szArgs==null&&(f=i.columnHeaders.rows.indexOf(this._szRowCol)>-1?i.columnHeaders:i.cells,this._szArgs=new s(f,new u(this._szRowCol.index,-1))),this._szArgs.cancel=!1,i.onResizingRow(this._szArgs)&&(i.deferResizing||i.isTouching?this._showResizeMarker(r):this._szRowCol.height=r))}},n.prototype._dragstart=function(n){var u=this._g,t=this._htDown,f,e;t&&(this._dragSource=null,this._szRowCol||(f=new s(t.panel,t.range),t.cellType==r.ColumnHeader&&u.allowDragging&b.Columns&&t.col>-1&&u.columns[t.col].allowDragging?u.onDraggingColumn(f)?this._dragSource=n.target:n.preventDefault():t.cellType==r.RowHeader&&u.allowDragging&b.Rows&&t.row>-1&&u.rows[t.row].allowDragging&&(e=u.rows[t.row],e instanceof h||e instanceof a||(u.onDraggingRow(f)?this._dragSource=n.target:n.preventDefault()))),this._dragSource&&n.dataTransfer&&!n.defaultPrevented&&(i._startDrag(n.dataTransfer,'move'),n.stopPropagation(),i.addClass(this._dragSource,bt),u.beginUpdate(),this._updating=!0))},n.prototype._dragend=function(){this._updating&&(this._g.endUpdate(),this._updating=!1);this.resetMouseState()},n.prototype._dragover=function(n){var i=this._g,t=i.hitTest(n),f=!1,u=new s(i.cells,t.range);this._htDown&&t.cellType==this._htDown.cellType&&(t.cellType==r.ColumnHeader?(u.cancel=!i.columns.canMoveElement(this._htDown.col,t.col),f=i.onDraggingColumnOver(u)):t.cellType==r.RowHeader&&(u.cancel=!i.rows.canMoveElement(this._htDown.row,t.row),f=i.onDraggingRowOver(u)));f?(n.dataTransfer.dropEffect='move',this._showDragMarker(t),n.preventDefault(),n.stopPropagation()):this._showDragMarker(null)},n.prototype._drop=function(n){var t=this._g,i=t.hitTest(n),f=new s(t.cells,i.range),u;if(this._htDown&&i.cellType==this._htDown.cellType)if(u=t.selection,i.cellType==r.ColumnHeader){t.columns.moveElement(this._htDown.col,i.col);t.select(u.row,i.col);t.onDraggedColumn(f)}else if(i.cellType==r.RowHeader){t.rows.moveElement(this._htDown.row,i.row);t.select(i.row,u.col);t.onDraggedRow(f)}this.resetMouseState()},n.prototype._showResizeMarker=function(n){var u=this._g,e=this._dvMarker,f,t;e.parentElement||u.cells.hostElement.appendChild(e);f=this._szArgs.panel.cellType;this._szRowCol instanceof v?(t={display:'',left:this._szRowCol.pos+n-1,top:0,right:'',bottom:0,width:3,height:''},u.rightToLeft&&(t.left=u.cells.hostElement.clientWidth-t.left-t.width),(f==r.TopLeft||f==r.RowHeader)&&(t.left-=u.topLeftCells.hostElement.offsetWidth)):(t={left:0,top:this._szRowCol.pos+n-1,right:0,bottom:'',width:'',height:3},(f==r.TopLeft||f==r.ColumnHeader)&&(t.top-=u.topLeftCells.hostElement.offsetHeight));i.setCss(e,t)},n.prototype._showDragMarker=function(n){var f=this._g,u=this._dvMarker,t,e,o;if(!n){u.parentElement&&u.parentElement.removeChild(u);this._rngTarget=null;return}if(!n.range.equals(this._rngTarget)){this._rngTarget=n.range;u.parentElement||n.panel.hostElement.appendChild(u);t={display:'',left:0,top:0,width:6,height:6};switch(n.cellType){case r.ColumnHeader:t.height=n.panel.height;e=f.columns[n.col];t.left=e.pos-t.width/2;n.col>this._htDown.col&&(t.left+=e.renderWidth);f.rightToLeft&&(t.left=u.parentElement.clientWidth-t.left-t.width);break;case r.RowHeader:t.width=n.panel.width;o=f.rows[n.row];t.top=o.pos-t.height/2;n.row>this._htDown.row&&(t.top+=o.renderHeight)}i.setCss(u,t)}},n.prototype._finishResizing=function(t){var f=this._g,c=f.selection,a=this._eMouse.ctrlKey,i=this._szArgs,v=t.clientX+pageXOffset,y=t.clientY+pageYOffset,o,e,l,h;if(i&&!i.cancel&&i.col>-1){e=i.col;l=Math.round(Math.max(n._SZ_MIN,this._szStart+(v-this._htDown.point.x)*(this._g.rightToLeft?-1:1)));i.panel.columns[e].width=Math.round(l);f.onResizedColumn(i);if(a&&this._htDown.cellType==r.ColumnHeader&&c.containsColumn(e))for(o=c.leftCol;o<=c.rightCol;o++)if(f.columns[o].allowResizing&&o!=e&&(i=new s(f.cells,new u(-1,o)),f.onResizingColumn(i))){f.columns[o].size=f.columns[e].size;f.onResizedColumn(i)}}if(i&&!i.cancel&&i.row>-1){e=i.row;l=Math.round(Math.max(n._SZ_MIN,this._szStart+(y-this._htDown.point.y)));i.panel.rows[e].height=Math.round(l);f.onResizedRow(i);if(a&&this._htDown.cellType==r.RowHeader&&c.containsRow(e))for(h=c.topRow;h<=c.bottomRow;h++)if(f.rows[h].allowResizing&&h!=e&&(i=new s(f.cells,new u(h,-1)),f.onResizingRow(i))){f.rows[h].size=f.rows[e].size;f.onResizedRow(i)}}},n.prototype._startListBoxSelection=function(n){var i=this._g.rows,t;for(this._lbSelState=!i[n].isSelected,this._lbSelRows={},t=0;t<i.length;t++)i[t].isSelected&&(this._lbSelRows[t]=!0)},n.prototype._handleSelection=function(n,t){var i=this._g,c=i.rows,h=i._selHdl.selection,o=new u(n.row,n.col),l,f,a,v;if(n.row>-1&&n.col>-1)if(this._lbSelRows!=null){for(l=!1,o=new u(n.row,n.col,this._htDown.row,this._htDown.col),f=0;f<c.length;f++)if(a=o.containsRow(f)?this._lbSelState:this._lbSelRows[f]!=null,a!=c[f].isSelected&&(v=new s(i.cells,new u(f,h.col,f,h.col2)),i.onSelectionChanging(v))){c[f]._setFlag(e.Selected,a,!0);l=!0;i.onSelectionChanged(v)}l&&i.refreshCells(!1,!0,!0);i.scrollIntoView(n.row,n.col)}else n.cellType==r.RowHeader&&(o.col=0,o.col2=i.columns.length-1),t&&(o.row2=h.row2,o.col2=h.col2),i.select(o)},n}();vt._SZ_MIN=0;n("_MouseHandler",vt);ti='wj-cell-check';kt=function(){function n(n){var t=this;this._fullEdit=!1;this._list=null;this._g=n;this._evtInput=document.createEvent('HTMLEvents');this._evtInput.initEvent('input',!0,!1);n.selectionChanging.addHandler(function(i,r){var u;if(t.finishEditing()){if(u=n._selHdl.selection.row,u!=r.row){var f=n.rows.length,e=u>-1&&u<f?n.rows[u].dataItem:null,o=r.row>-1&&r.row<f?n.rows[r.row].dataItem:null;e!=o&&t._commitRowEdits()}}else r.cancel=!0});n.lostFocus.addHandler(function(){if(!n.containsFocus()){var r=i.getActiveElement();r&&getComputedStyle(r).position=='fixed'||t._commitRowEdits()}});n.addEventListener(n.hostElement,'mousedown',function(u){var o,e,f;u.defaultPrevented||u.button!=0||n._mouseHdl._szRowCol||(o=n.selection,e=n.hitTest(u),e.cellType!=r.Cell&&e.cellType!=r.None?t.finishEditing():e.cellType!=r.None&&(f=i.tryCast(u.target,HTMLInputElement),f&&f.type=='checkbox'&&!f.disabled&&!f.readOnly&&i.hasClass(f,ti)&&i.closest(f,'.wj-flexgrid')==n.hostElement&&(u.preventDefault(),t.startEditing(!1,e.row,e.col)&&(f=t.activeEditor,!f||f.type!='checkbox'||f.disabled||f.readOnly||(f.checked=!f.checked,f.focus(),t.finishEditing())))))},!0)}return n.prototype.startEditing=function(n,t,r,f,e){var o,c,l,a,y,v,p,h;if((n===void 0&&(n=!0),o=this._g,t=i.asNumber(t,!0,!0),r=i.asNumber(r,!0,!0),t==null&&(t=o.selection.row),r==null&&(r=o.selection.col),f==null&&(f=!0),!this._allowEditing(t,r))||(c=o.getMergedRange(o.cells,t,r),c||(c=new u(t,r)),l=o.rows[t].dataItem,o.select(c,!0),!o.rows[t]||l!=o.rows[t].dataItem))return!1;if(c.equals(this._rng))return!0;if(this.activeEditor&&!this.finishEditing()||(a=new s(o.cells,c,e),!o.onBeginningEdit(a)))return!1;if(y=o.editableCollectionView,v=!1,y){if(l=o.rows[t].dataItem,v=l!=y.currentEditItem,v)o.onRowEditStarting(a);if(y.editItem(l),v){o.onRowEditStarted(a);this._edItem=l}}if(this._fullEdit=i.asBoolean(n),this._rng=c,this._list=null,p=o.columns[r].dataMap,p&&(this._list=p.getDisplayValues(l)),c.isSingleCell?this._updateEditorCell(t,r,v):o.refresh(!1),h=this._edt,h){h.type=='checkbox'?this._fullEdit=!1:f&&i.setSelectionRange(h,0,h.value.length);o.onPrepareCellForEdit(a);if(h=this._edt,!h||h.disabled||h.readOnly)return!1;h&&f&&h.focus()}return!0},n.prototype.finishEditing=function(n){var f,h,c,s,y,e,o,l;if(n===void 0&&(n=!1),f=this._edt,!f)return this._removeListBox(),!0;var t=this._g,r=this._rng,u=new st(t.cells,r),a=t.containsFocus(),v=t.hostElement.querySelector('.wj-control.wj-state-focused');if(v&&(h=i.Control.getControl(v),h))h.onLostFocus(u);if(u.cancel=n,!n&&t.validateEdits&&(c=this._getValidationError(),c&&(u.cancel=!0,s=f.parentElement,s&&(i.toggleClass(s,'wj-state-invalid',!0),s.title=c,u.stayInEditMode=!0))),!t.onCellEditEnding(u)&&u.stayInEditMode)return a?setTimeout(function(){f.select()}):f.select(),!1;if(!u.cancel)for(u.data=t.cells.getCellData(r.topRow,r.leftCol,!1),y=t.cellFactory.getEditorValue(t),e=r.topRow;e<=r.bottomRow&&e<t.rows.length;e++)for(o=r.leftCol;o<=r.rightCol&&o<t.columns.length;o++)t.cells.setCellData(e,o,y,!0,!1);this._edt=null;this._rng=null;this._list=null;this._removeListBox();l=i.closest(f,'.wj-cell');i.contains(l,i.getActiveElement())&&l.focus();n?this._updateEditorCell(r.row,r.col,!1):t.refresh(!1);a&&t.focus();t.onCellEditEnded(u);return!0},Object.defineProperty(n.prototype,"activeEditor",{get:function(){return this._edt},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"editRange",{get:function(){return this._rng},enumerable:!0,configurable:!0}),n.prototype.getClipString=function(n){var t=this._g,r='',l=!0,o,s,h,c,e;if(!n){n=t.selection;switch(t.selectionMode){case f.Row:case f.RowRange:n.col=0;n.col2=t.columns.length-1;break;case f.ListBox:for(n.col=0,n.col2=t.columns.length-1,o=0;o<t.rows.length;o++)t.rows[o].isSelected&&t.rows[o].isVisible&&(n.row=n.row2=o,r&&(r+='\n'),r+=this.getClipString(n));return r}}for(n=i.asType(n,u),s=n.topRow;s<=n.bottomRow;s++)if(t.rows[s].isVisible)for(l||(r+='\n'),l=!1,h=n.leftCol,c=!0;h<=n.rightCol;h++)t.columns[h].isVisible&&(c||(r+='\t'),c=!1,e=t.cells.getCellData(s,h,!0).toString(),e=e.replace(/\t/g,' '),(e.indexOf('\n')>-1||e.indexOf('"')>-1)&&(e='"'+e.replace(/"/g,'""')+'"'),r+=e);return r},n.prototype.setClipString=function(n,t){var l=this,r=this._g,v=t==null;if(!t){t=r.selection;switch(r.selectionMode){case f.Row:case f.RowRange:case f.ListBox:t.col=0;t.col2=r.columns.length-1}}t=i.asType(t,u);n=i.asString(n).replace(/\r\n/g,'\n').replace(/\r/g,'\n');n&&n[n.length-1]=='\n'&&(n=n.substring(0,n.length-1));v&&!t.isSingleCell&&(n=this._expandClipString(n,t));var h=new u(t.topRow,t.leftCol),o=r.editableCollectionView,e=t.topRow,a=this._clipToRows(n),y=!1,c;r.deferUpdate(function(){var i,v,n,f;for(o&&o.beginUpdate(),i=0;i<a.length&&e<r.rows.length;i++,e++){if(!r.rows[e].isVisible){i--;continue}for(v=l._clipToCells(a[i]),n=t.leftCol,f=0;f<v.length&&n<r.columns.length;f++,n++){if(!r.columns[n].isVisible){f--;continue}if(l._allowEditing(e,n)){if(c=new s(r.cells,new u(e,n),v[f]),r.onPastingCell(c)&&(o&&(o.editItem(r.rows[e].dataItem),l._edItem=o.currentEditItem),r.cells.setCellData(e,n,c.data))){r.onPastedCell(c);y=!0}h.row2=Math.max(h.row2,e);h.col2=Math.max(h.col2,n)}}}o&&o.endUpdate();r.select(h)})},n.prototype._clipToRows=function(n){for(var r=[],i=0,u=!1,t=0;t<n.length;t++)switch(n[t]){case'"':u=!u;break;case'\n':u||(r.push(n.substr(i,t-i)),i=t+1)}return r.push(n.substr(i)),r},n.prototype._clipToCells=function(n){for(var t,u,i=n.split('\t'),r=0;r<i.length;r++)t=i[r],u=t.length,u>1&&t[0]=='"'&&t[u-1]=='"'&&(t=t.substr(1,u-2),t=t.replace(/""/g,'"')),i[r]=t;return i},n.prototype._expandClipString=function(n,t){var s,i,r;if(!n)return n;var h=n.split('\n'),o=h.length,e=0,c=[];for(i=0;i<o;i++){if(s=h[i].split('\t'),c.push(s),i>1&&s.length!=e)return n;e=s.length}var l=this._g,u=0,f=0;for(i=t.topRow;i<=t.bottomRow;i++)l.rows[i].isVisible&&u++;for(r=t.leftCol;r<=t.rightCol;r++)l.columns[r].isVisible&&f++;if((u>1||f>1)&&(u==1&&(u=o),f==1&&(f=e),f%e==0&&u%o==0))for(n='',i=0;i<u;i++)for(r=0;r<f;r++)i>0&&r==0&&(n+='\n'),r>0&&(n+='\t'),n+=c[i%o][r%e];return n},n.prototype._updateEditorCell=function(n,t,i){var r=this._g,u=r.cells.getCellElement(n,t),o=r._useFrozenDiv()&&(n<r.frozenRows||t<r.frozenColumns);if(!u||o||r._hasPendingUpdates())r.refresh(!1);else if(this._updateCell(u),i=i||r._getShowErrors(),i&&r.headersVisibility&l.Row){var f=r.rowHeaders,s=f.columns.length-1,e=f.getCellElement(n,s);e&&this._updateCell(e)}},n.prototype._updateCell=function(n){var t=new rt(n,null);t.panel&&(n.classList.add(y._WJS_UPDATING),t.grid.cellFactory.updateCell(t.panel,t.row,t.col,n,t.range),n.classList.remove(y._WJS_UPDATING))},n.prototype._getValidationError=function(){var n=this._g,r;if(n._getShowErrors()){var t=this._rng.row,i=this._rng.col,u=n.cellFactory.getEditorValue(n),f=n.getCellData(t,i,!1);if(n.setCellData(t,i,u,!0,!1))return r=n._getError(n.cells,t,i),n.setCellData(t,i,f,!0,!1),r}return null},n.prototype._allowEditing=function(n,t){var i=this._g,r;return i.isReadOnly||i.selectionMode==f.None?!1:n<0||n>=i.rows.length||i.rows[n].isReadOnly||!i.rows[n].isVisible?!1:t<0||t>=i.columns.length?!1:(r=i._getBindingColumn(i.cells,n,i.columns[t]),!r||r.isReadOnly||!r.isVisible)?!1:!0},n.prototype._commitRowEdits=function(){var n=this._g,t,i;if(this.finishEditing()&&this._edItem){if(t=n.editableCollectionView,t&&t.currentEditItem){i=new s(n.cells,n.selection);n.onRowEditEnding(i);t.commitEdit();n.onRowEditEnded(i)}this._edItem=null}},n.prototype._keydown=function(n){switch(n.keyCode){case i.Key.F2:return this._fullEdit=!this._fullEdit,n.preventDefault(),!0;case i.Key.F4:return this._toggleListBox(n),n.preventDefault(),!0;case i.Key.Space:var t=this._edt;return!t||t.type!='checkbox'||t.disabled||t.readOnly||(t.checked=!t.checked,this.finishEditing(),n.preventDefault()),!0;case i.Key.Enter:case i.Key.Tab:return n.preventDefault(),!this.finishEditing();case i.Key.Escape:return n.preventDefault(),this.finishEditing(!0),!0;case i.Key.Up:case i.Key.Down:case i.Key.Left:case i.Key.Right:case i.Key.PageUp:case i.Key.PageDown:case i.Key.Home:case i.Key.End:if(this._lbx)return this._keydownListBox(n);if(n.altKey)switch(n.keyCode){case i.Key.Up:case i.Key.Down:return this._toggleListBox(n),n.preventDefault(),!0}if(!this._fullEdit&&this.finishEditing())return!1}return!0},n.prototype._keydownListBox=function(n){var t=!0;if(this._lbx)switch(n.keyCode){case i.Key.Up:n.altKey?this._toggleListBox(n):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case i.Key.Down:n.altKey?this._toggleListBox(n):this._lbx.selectedIndex++;break;case i.Key.Home:case i.Key.PageUp:this._lbx.selectedIndex=0;break;case i.Key.End:case i.Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}return t?(n.preventDefault(),!0):!1},n.prototype._keypress=function(n){var t=this._edt,f,u,r;if(t&&t.type!='checkbox'&&this._list&&this._list.length>0&&n.charCode>=32)for(f=t.selectionStart,u=t.value.substr(0,f),n.target==t&&(f++,u+=String.fromCharCode(n.charCode)),u=u.toLowerCase(),r=0;r<this._list.length;r++)if(this._list[r].toLowerCase().indexOf(u)==0){t.value=this._list[r];i.setSelectionRange(t,f,this._list[r].length);t.dispatchEvent(this._evtInput);n.preventDefault();break}},n.prototype._toggleListBox=function(n,t){var i=this._g,f=i._selHdl.selection,r,u;return(t||(t=f),this._lbx&&(this._removeListBox(),f.contains(t)))?(i.activeEditor?i.activeEditor.focus():i.containsFocus()||i.focus(),!0):(r=i.isTouching,u=i._getBindingColumn(i.cells,t.row,i.columns[t.col]),!ot()||!u.dataMap||u.showDropDown===!1)?!1:!ot()||!this.startEditing(!0,t.row,t.col,!r,n)?!1:(this._lbx=this._createListBox(),this._lbx.showSelection(),r&&this._lbx.focus(),!0)},n.prototype._createListBox=function(){var f=this,n=this._g,t=this._rng,o=n.rows[t.row],s=n._getBindingColumn(n.cells,t.row,n.columns[t.col]),u=document.createElement('div'),r=new(ot().ListBox)(u),e;return u.classList.add('wj-dropdown-panel','wj-grid-listbox'),r.maxHeight=o.renderHeight*4,r.itemsSource=s.dataMap.getDisplayValues(o.dataItem),r.selectedValue=n.activeEditor?n.activeEditor.value:n.getCellData(t.row,t.col,!0),i.addClass(u,s.dropDownCssClass),r.addEventListener(r.hostElement,'click',function(){f._removeListBox();n.focus();f.finishEditing()}),r.lostFocus.addHandler(function(){f._removeListBox()}),r.selectedIndexChanged.addHandler(function(){var t=n.activeEditor;t&&(t.value=f._lbx.selectedValue,t.dispatchEvent(f._evtInput),i.setSelectionRange(t,0,t.value.length))}),e=n.cells.getCellElement(t.row,t.col),e?i.showPopup(u,e,!1,!1,!1):(i.showPopup(u,n.getCellBoundingRect(t.row,t.col)),u[i.Control._OWNR_KEY]=n.hostElement),r},n.prototype._removeListBox=function(){this._lbx&&(i.hidePopup(this._lbx.hostElement,!0),this._lbx.dispose(),this._lbx=null)},n}();n("_EditHandler",kt);dt=function(){function n(n){this._nrt=new a;this._g=n;this._keydownBnd=this._keydown.bind(this);this._attach()}return Object.defineProperty(n.prototype,"newRowAtTop",{get:function(){return this._top},set:function(n){n!=this.newRowAtTop&&(this._top=i.asBoolean(n),this.updateNewRowTemplate())},enumerable:!0,configurable:!0}),n.prototype.updateNewRowTemplate=function(){var n=this._g,f=n.editableCollectionView,t=n.rows,o=f&&f.canAddNew&&n.allowAddNew&&!n.isReadOnly,i=t.indexOf(this._nrt),s=this._top?0:t.length-1,u=!1,r;!o&&i>-1?(r=n.selection,r.row==i&&n.select(r.row-1,r.col),t.removeAt(i)):o&&(i<0?u=!0:i!=s&&(t.removeAt(i),u=!0),u&&(this._top?t.insert(0,this._nrt):t.push(this._nrt)),this._nrt&&this._nrt._setFlag(e.ParentCollapsed,!1))},n.prototype._attach=function(){var n=this._g;n&&(n.beginningEdit.addHandler(this._beginningEdit,this),n.pastingCell.addHandler(this._beginningEdit,this),n.rowEditEnded.addHandler(this._rowEditEnded,this),n.loadedRows.addHandler(this.updateNewRowTemplate,this),n.hostElement.addEventListener('keydown',this._keydownBnd,!0))},n.prototype._detach=function(){var n=this._g;n&&(n.beginningEdit.removeHandler(this._beginningEdit),n.pastingCell.removeHandler(this._beginningEdit),n.rowEditEnded.removeHandler(this._rowEditEnded),n.loadedRows.removeHandler(this.updateNewRowTemplate),n.hostElement.removeEventListener('keydown',this._keydownBnd,!0))},n.prototype._keydown=function(n){n.defaultPrevented||n.keyCode!=i.Key.Escape||this._g.activeEditor==null&&this._top&&this._nrt.dataItem&&(this._nrt.dataItem=null,this._g.invalidate())},n.prototype._beginningEdit=function(n,t){var f,r,u;if(!t.cancel&&(f=this._g.rows[t.row],i.tryCast(f,a)&&(r=this._g.editableCollectionView,r&&r.canAddNew)))if(this._top){if(this._nrt.dataItem==null){var u=null,e=r.sourceCollection,o=r.newItemCreator;u=i.isFunction(o)?o():e&&e.length?new e[0].constructor:{};this._nrt.dataItem=u}}else{u=r.currentAddItem&&r.currentAddItem==f.dataItem?r.currentAddItem:r.addNew();r.moveCurrentTo(u);this.updateNewRowTemplate();this._g.refresh(!0);this._g.onRowAdded(t);t.cancel&&r.cancelNew()}},n.prototype._rowEditEnded=function(n,t){var r=this,i=this._g.editableCollectionView,u=this._nrt.dataItem,e,f;if(i)if(i.isAddingNew)i.commitNew();else if(u&&!t.cancel){this._nrt.dataItem=null;e=i.addNew();for(f in u)e[f]=u[f];this._g.onRowAdded(t);t.cancel?i.cancelNew():i.commitNew();setTimeout(function(){r._g.select(0,r._g.columns.firstVisibleIndex);r.updateNewRowTemplate()},20)}},n}();n("_AddNewHandler",dt);a=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(nt);n("_NewRowTemplate",a);gt=function(){function n(n){this._g=n;this._tbx=i.createElement('<input class="wj-grid-editor wj-form-control" wj-part="ime-target"/>');this._cssHidden={position:'fixed',pointerEvents:'none',opacity:0,left:-10,top:-10,width:0};i.setCss(this._tbx,this._cssHidden);n.cells.hostElement.parentElement.appendChild(this._tbx);this._updateImeFocus();var t=n.hostElement;n.addEventListener(this._tbx,'compositionstart',this._compositionstart.bind(this));n.addEventListener(this._tbx,'keydown',this._keydown.bind(this));n.addEventListener(t,'blur',this._updateImeFocus.bind(this),!0);n.addEventListener(t,'focus',this._updateImeFocus.bind(this),!0);n.addEventListener(t,'mousedown',this._mousedown.bind(this),!0);n.addEventListener(t,'mouseup',this._mouseup.bind(this),!0);n.cellEditEnded.addHandler(this._cellEditEnded,this);n.selectionChanged.addHandler(this._updateImeFocus,this)}return n.prototype.dispose=function(){var n=this._g,t=n.hostElement;n.removeEventListener(this._tbx,'compositionstart');n.removeEventListener(t,'blur');n.removeEventListener(t,'focus');n.removeEventListener(t,'mousedown');n.removeEventListener(t,'mouseup');n.cellEditEnded.removeHandler(this._cellEditEnded);n.selectionChanged.removeHandler(this._updateImeFocus);this._tbx.parentElement&&this._tbx.parentElement.removeChild(this._tbx)},n.prototype._cellEditEnded=function(){i.setCss(this._tbx,this._cssHidden);this._tbx.value=''},n.prototype._compositionstart=function(){var n=this._g,t;if(n.activeEditor==null&&(t=n._selHdl.selection,n.startEditing(!1,t.row,t.col,!1))){var u=n.getCellBoundingRect(t.row,t.col),r=n.cells.hostElement,f=n.columns[t.col].pos+r.offsetLeft,e=n.rows[t.row].pos+r.offsetTop;t.row<n.frozenRows&&(e+=r.parentElement.scrollTop);t.col<n.frozenColumns&&(f+=r.parentElement.scrollLeft);i.setCss(this._tbx,{position:'absolute',pointerEvents:'',opacity:'',left:f,top:e,width:u.width-1,height:u.height-1});n._edtHdl._edt=this._tbx}},n.prototype._keydown=function(n){switch(n.keyCode){case i.Key.Up:case i.Key.Down:case i.Key.PageUp:case i.Key.PageDown:this._g._keyHdl._keydown(n)}},n.prototype._mousedown=function(){this._mouseDown=!0;this._updateImeFocus()},n.prototype._mouseup=function(){this._mouseDown=!1;this._updateImeFocus()},n.prototype._updateImeFocus=function(){var t=this._g,r=i.getActiveElement(),n;t.activeEditor||t.isTouching||this._mouseDown||!i.contains(t.hostElement,r)||(n=this._tbx,this._enableIme()?r!=n&&(n.disabled=!1,n.select()):n.disabled=!0)},n.prototype._enableIme=function(){var n=this._g,t=n.selection;return n.canEditCell(t.row,t.col)?n.columns[t.col].dataType==i.DataType.Boolean?!1:!0:!1},n}();n("_ImeHandler",gt)}}})