<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.sale.status.table.day.service.impl.TableDayMapper">
	<select id="getTableDayList" parameterType="tableDayVO" resultType="DefaultMap">
		<include refid="CmmSQL.PagingTemplateHeader"/>
		SELECT SALE_DATE SALE_DATE
       		, TO_CHAR(TO_DATE(SALE_DATE, 'YYYYMMDD'), 'DY') SALE_DAY
       		, NVL(SUM(REAL_SALE_AMT), 0) TOT_REAL_SALE_AMT
       		, NVL(SUM(SALE_CNT), 0) TOT_SALE_CNT
       		, NVL(SUM(GUEST_CNT_1), 0) TOT_GUEST_CNT
       		${sQuery1}
     	<include refid="CmmSQL.PagingTemplateCount"/>
		FROM TB_SL_DAILY_TABLE TSDT
		WHERE 1 = 1
			  AND HQ_OFFICE_CD = #{hqOfficeCd}
			  <if test='arrTableCd != null and arrTableCd.length >= 0'>
			  	AND STORE_CD||'||'||TBL_CD IN
			  	<foreach collection="arrTableCd" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			  </if>
			  <if test='startDate != null and startDate != ""'>
			  	AND TSDT.SALE_DATE <![CDATA[>= ]]> #{startDate}
			  </if>
			  <if test='endDate != null and endDate != ""'>
			  	AND TSDT.SALE_DATE <![CDATA[<= ]]> #{endDate}
			  </if>
<!-- 			  <if test='arrStoreCd != null and arrStoreCd != ""'>
			  	AND STORE_CD IN
			  	<foreach collection="arrStoreCd" item="item" open="(" close=")" separator=",">
			  		#{item}
			  	</foreach>
			  </if> -->
<!-- 			  AND TBL_CD in (${sQuery2})
			  <![CDATA[
   			  AND TSDT.SALE_DATE >= #{startDate}
   			  AND TSDT.SALE_DATE <= #{endDate}
   			  ]]> -->
		GROUP
		BY 	  SALE_DATE
		ORDER
		BY    SALE_DATE DESC
		<include refid="CmmSQL.PagingTemplateBottom"/>
	</select>

	<select id="getTableDayExcelList" parameterType="tableDayVO" resultType="DefaultMap">

        SELECT SALE_DATE SALE_DATE
            , TO_CHAR(TO_DATE(SALE_DATE, 'YYYYMMDD'), 'DY') SALE_DAY
            , NVL(SUM(REAL_SALE_AMT), 0) TOT_REAL_SALE_AMT
            , NVL(SUM(SALE_CNT), 0) TOT_SALE_CNT
            , NVL(SUM(GUEST_CNT_1), 0) TOT_GUEST_CNT
            ${sQuery1}
        FROM TB_SL_DAILY_TABLE TSDT
        WHERE 1 = 1
              AND HQ_OFFICE_CD = #{hqOfficeCd}
              <if test='arrTableCd != null and arrTableCd.length >= 0'>
                AND STORE_CD||'||'||TBL_CD IN
                <foreach collection="arrTableCd" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
              </if>
              <if test='startDate != null and startDate != ""'>
                AND TSDT.SALE_DATE <![CDATA[>= ]]> #{startDate}
              </if>
              <if test='endDate != null and endDate != ""'>
                AND TSDT.SALE_DATE <![CDATA[<= ]]> #{endDate}
              </if>
        GROUP
        BY    SALE_DATE
        ORDER
        BY    SALE_DATE DESC
    </select>


 	<select id="getStoreTableList" parameterType="tableDayVO" resultType="DefaultMap">

		SELECT	TMP.STORE_CD||'||'||TMP.TBL_CD AS TABLE_CD
				, TMP.TBL_NM AS TABLE_NM
				, (SELECT STORE_NM FROM TB_MS_STORE WHERE STORE_CD = TMP.STORE_CD) AS STORE_NM
				, TMP.TBL_GRP_CD
				, TMP.TBL_CD	AS	TABLE_CD_ORG
		FROM    TB_MS_TABLE TMP
		WHERE	1=1
		  AND EXISTS (SELECT * FROM TB_MS_STORE Z WHERE Z.STORE_CD = TMP.STORE_CD AND Z.HQ_OFFICE_CD = #{hqOfficeCd})
			<if test='arrStoreCd != null and arrStoreCd.length >= 0'>
               	AND TMP.STORE_CD IN
               	<foreach collection="arrStoreCd" item="item" open="(" close=")" separator=",">
                   	#{item}
               	</foreach>
           	</if>
           	<if test='arrTableCd != null and arrTableCd.length >= 0'>
               	AND TMP.STORE_CD||'||'||TMP.TBL_CD IN
               	<foreach collection="arrTableCd" item="item" open="(" close=")" separator=",">
                   	#{item}
               	</foreach>
           	</if>
        ORDER BY TMP.STORE_CD||'||'||TMP.TBL_CD

        <!-- SELECT  tmp.TBL_CD AS NMCODE_CD
        		, tmp.TBL_NM AS NMCODE_NM
        		${sQuery1}
        FROM    TB_MS_TABLE tmp
        WHERE   1=1
        		<if test='arrStoreCd != null and arrStoreCd != ""'>
					AND tmp.STORE_CD IN
					<foreach collection="arrStoreCd" item="item" open="(" close=")" separator=",">
						#{item}
					</foreach>
				</if>
        		<if test='tblCd != null and tblCd != ""'>
        		AND tmp.TBL_CD = #{tblCd}
        		</if>
        ORDER
        BY      tmp.TBL_NM -->

    </select>

</mapper>
