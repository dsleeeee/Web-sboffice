<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.application.persistence.cmm.CmmMenuMapper">
  
  <insert id="insertMenuUseHist" parameterType="menuUseHist">
  <![CDATA[
    /* CmmMenuMapper.insertMenuHist */
    INSERT INTO TB_WB_MENU_USE_HIST
    (
      SEQ,
      USER_ID,
      RESRCE_CD,
      USE_DATE,
      USE_DT
    )
    VALUES
    (
      SQ_WB_MENU_HIST.NEXTVAL,
      #{userId},
      #{resrceCd},
      #{useDate},
      #{useDt}
    )
  ]]>
  </insert>
  
  <!-- 즐겨찾기 가져오기 -->
  <select id="selectBkmkMenu" parameterType="sessionInfo" resultType="resrceInfoBase">
  <![CDATA[
    /* CmmMenuMapper.selectBkmkMenu */
    SELECT B.RESRCE_CD,
           B.P_RESRCE,
           B.RESRCE_NM,
           B.URL
      FROM TB_WB_BKMK A
      LEFT OUTER JOIN 
           TB_WB_RESRCE_INFO B
        ON A.RESRCE_CD = B.RESRCE_CD
     WHERE A.USER_ID = #{userId}
       AND A.USE_YN = 'Y'
  ]]>
  </select>
  
  <!-- 즐겨찾기 조회 -->
  
  <select id="selectBkmkMenu1" parameterType="sessionInfo" resultType="resrceInfo">
  <![CDATA[
    /* CmmMenuMapper.selectBkmkMenu1 */
    WITH CHILD_TAB AS (
      SELECT B.RESRCE_CD,
             B.P_RESRCE,
             B.RESRCE_NM,
             B.URL
        FROM TB_WB_BKMK A
        LEFT OUTER JOIN 
             TB_WB_RESRCE_INFO B
          ON A.RESRCE_CD = B.RESRCE_CD
       WHERE A.USER_ID = #{userId}
         AND A.USE_YN = 'Y'
         AND B.DISP_LEVEL = 2
    )
    SELECT DISTINCT B.RESRCE_CD, B.P_RESRCE, B.RESRCE_FG, B.FUNC_FG, B.RESRCE_NM, B.URL,
           B.SPCL_AUTHOR, B.DISP_LEVEL, B.DISP_IDX, B.USE_YN
      FROM (SELECT DISTINCT B.P_RESRCE
              FROM CHILD_TAB A,
                   TB_WB_RESRCE_INFO B
             WHERE B.RESRCE_CD = A.P_RESRCE
               AND B.DISP_LEVEL = '1'
            )A,
            TB_WB_RESRCE_INFO B
     WHERE B.RESRCE_CD = A.P_RESRCE
     ORDER
        BY B.P_RESRCE ASC, B.DISP_IDX ASC
  ]]>
  </select>
  
  <select id="selectBkmkMenu2" parameterType="sessionInfo" resultType="resrceInfo">
  <![CDATA[
    /* CmmMenuMapper.selectBkmkMenu2 */
    WITH CHILD_TAB AS (
      SELECT B.RESRCE_CD,
             B.P_RESRCE,
             B.RESRCE_NM,
             B.URL
        FROM TB_WB_BKMK A
        LEFT OUTER JOIN 
             TB_WB_RESRCE_INFO B
          ON A.RESRCE_CD = B.RESRCE_CD
       WHERE A.USER_ID = #{userId}
         AND A.USE_YN = 'Y'
         AND B.DISP_LEVEL = 2
    )
    SELECT DISTINCT B.RESRCE_CD, B.P_RESRCE, B.RESRCE_FG, B.FUNC_FG, B.RESRCE_NM, B.URL,
           B.SPCL_AUTHOR, B.DISP_LEVEL, B.DISP_IDX, B.USE_YN
      FROM CHILD_TAB A,
           TB_WB_RESRCE_INFO B
     WHERE B.RESRCE_CD = A.P_RESRCE
       AND B.DISP_LEVEL = '1'
     ORDER
        BY B.P_RESRCE ASC, B.DISP_IDX ASC
  ]]>
  </select>
  
  <select id="selectBkmkMenu3" parameterType="sessionInfo" resultType="resrceInfo">
  <![CDATA[
    /* CmmMenuMapper.selectBkmkMenu3 */
    SELECT B.RESRCE_CD,
           B.P_RESRCE,
           B.RESRCE_NM,
           B.URL
      FROM TB_WB_BKMK A
      LEFT OUTER JOIN 
           TB_WB_RESRCE_INFO B
        ON A.RESRCE_CD = B.RESRCE_CD
     WHERE A.USER_ID = #{userId}
       AND A.USE_YN = 'Y'
       AND B.DISP_LEVEL = 2
  ]]>
  </select>
  
  <!-- 고정 메뉴 가져오기 -->
  <select id="selectFixingMenu" parameterType="sessionInfo" resultType="resrceInfoBase">
  <![CDATA[
    /* CmmMenuMapper.selectFixingMenu */
    SELECT B.RESRCE_CD,
           B.P_RESRCE,
           B.RESRCE_NM,
           B.URL
      FROM TB_WB_FIXING A
      LEFT OUTER JOIN 
           TB_WB_RESRCE_INFO B
        ON A.RESRCE_CD = B.RESRCE_CD
     WHERE A.USER_ID = #{userId}
       AND A.USE_YN = 'Y'
  ]]>
  </select>
  
  <!-- 메뉴 조회 -->
  <select id="selectMenu1" parameterType="sessionInfo" resultType="resrceInfo">
  <![CDATA[
    /* CmmMenuMapper.selectMenu1 */
    WITH CHILD_TAB AS (
      SELECT A.*
        FROM TB_WB_RESRCE_INFO A,
             (SELECT A.RESRCE_CD
                FROM TB_WB_AUTHOR_GRP_RESRCE A,
                     TB_WB_USER_INFO B
               WHERE A.USE_YN   = 'Y'
                 AND B.GRP_CD   = A.GRP_CD
                 AND B.USER_ID  = #{userId}
               UNION
              SELECT A.RESRCE_CD
                FROM TB_WB_AUTHOR_EXCEPT A
               WHERE A.INCLD_EXCLD_FG = 'I'
                 AND A.USER_ID = #{userId}
               MINUS
              SELECT A.RESRCE_CD
                FROM TB_WB_AUTHOR_EXCEPT A
               WHERE A.INCLD_EXCLD_FG = 'E'
                 AND A.USER_ID = #{userId}  
              ) B
       WHERE B.RESRCE_CD = A.RESRCE_CD
         AND A.DISP_LEVEL = '2'
         AND A.RESRCE_FG = 'M' 
         AND A.USE_YN = 'Y'
    )
    SELECT DISTINCT B.RESRCE_CD, B.P_RESRCE, B.RESRCE_FG, B.FUNC_FG, B.RESRCE_NM, B.URL, B.SPCL_AUTHOR,
           B.DISP_LEVEL, B.DISP_IDX, B.USE_YN
      FROM (SELECT DISTINCT B.P_RESRCE
             FROM CHILD_TAB A,
                  TB_WB_RESRCE_INFO B
            WHERE B.RESRCE_CD = A.P_RESRCE
              AND B.DISP_LEVEL = '1'
            ) A,
           TB_WB_RESRCE_INFO B
     WHERE B.RESRCE_CD = A.P_RESRCE
     ORDER
        BY B.DISP_LEVEL ASC, B.DISP_IDX ASC
  ]]>
  </select>
  
  
  <select id="selectMenu2" parameterType="sessionInfo" resultType="resrceInfo">
  <![CDATA[
    /* CmmMenuMapper.selectMenu2 */
    WITH CHILD_TAB AS (
      SELECT A.*
        FROM TB_WB_RESRCE_INFO A,
             (SELECT A.RESRCE_CD
                FROM TB_WB_AUTHOR_GRP_RESRCE A,
                     TB_WB_USER_INFO B
               WHERE A.USE_YN   = 'Y'
                 AND B.GRP_CD   = A.GRP_CD
                 AND B.USER_ID  = #{userId}
               UNION
              SELECT A.RESRCE_CD
                FROM TB_WB_AUTHOR_EXCEPT A
               WHERE A.INCLD_EXCLD_FG = 'I'
                 AND A.USER_ID = #{userId}
               MINUS
              SELECT A.RESRCE_CD
                FROM TB_WB_AUTHOR_EXCEPT A
               WHERE A.INCLD_EXCLD_FG = 'E'
                 AND A.USER_ID = #{userId}
              ) B
       WHERE B.RESRCE_CD = A.RESRCE_CD
         AND A.DISP_LEVEL = '2'
         AND A.RESRCE_FG = 'M' 
         AND A.USE_YN = 'Y'
    )
    SELECT DISTINCT B.RESRCE_CD, B.P_RESRCE, B.RESRCE_FG, B.FUNC_FG, B.RESRCE_NM, B.URL, B.SPCL_AUTHOR,
           B.DISP_LEVEL, B.DISP_IDX, B.USE_YN
      FROM CHILD_TAB A,
           TB_WB_RESRCE_INFO B
     WHERE B.RESRCE_CD = A.P_RESRCE
     ORDER
        BY B.DISP_LEVEL ASC, B.DISP_IDX ASC
  ]]>
  </select>

  <select id="selectMenu3" parameterType="sessionInfo" resultType="resrceInfo">
  <![CDATA[
    /* CmmMenuMapper.selectMenu3 */
    SELECT A.*
      FROM TB_WB_RESRCE_INFO A
      ,    (
              SELECT A.RESRCE_CD
              FROM TB_WB_AUTHOR_GRP_RESRCE A
              ,    TB_WB_USER_INFO B
             WHERE A.USE_YN   = 'Y'
               AND B.GRP_CD   = A.GRP_CD
               AND B.USER_ID  = #{userId}
            UNION
            SELECT A.RESRCE_CD
              FROM TB_WB_AUTHOR_EXCEPT A
             WHERE A.INCLD_EXCLD_FG = 'I'
               AND A.USER_ID = #{userId}
            MINUS
            SELECT A.RESRCE_CD
              FROM TB_WB_AUTHOR_EXCEPT A
             WHERE A.INCLD_EXCLD_FG = 'E'
               AND A.USER_ID = #{userId}
          ) B
     WHERE B.RESRCE_CD = A.RESRCE_CD
       AND A.DISP_LEVEL = '2'
       AND A.RESRCE_FG = 'M' 
       AND A.USE_YN = 'Y'
     ORDER 
        BY A.DISP_LEVEL ASC, A.DISP_IDX ASC 
  ]]>
  </select>
  
</mapper>





