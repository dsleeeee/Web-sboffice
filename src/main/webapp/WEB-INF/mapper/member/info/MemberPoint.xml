<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.membr.info.point.service.impl.MemberPointMapper">

    <!-- 회원 포인트 리스트 조회-->
    <!--
        TABLE    : TB_MB_MEMBER_POINT
        COMMENTS : 회원 포인트 조회
    -->
    <select id="getMemberPointList" parameterType="memberPointVO" resultType="DefaultMap">
      /* MemberPointMapper.getMemberClassList */
      SELECT
          MEMBR_ORGN_CD
          ,MEMBR_NO
          ,AVABL_POINT
      FROM
          TB_MB_MEMBER_POINT
  </select>

    <!--  <insert id="adjustAllBackUp" parameterType="DefaultMap">-->
    <!--    INSERT INTO-->
    <!--      TB_MB_MEMBER_POINT_HIST-->
    <!--        (MEMBR_ORGN_CD,-->
    <!--        MEMBR_NO,-->
    <!--        CHG_DATE,-->
    <!--        CHG_SEQ,-->
    <!--        POINT_CHG_FG,-->
    <!--        CHG_POINT,-->
    <!--        REMARK,-->
    <!--        ORGN_APPR_NO,-->
    <!--        REG_DT,-->
    <!--        REG_ID,-->
    <!--        MOD_DT,-->
    <!--        MOD_ID)-->
    <!--    VALUES (-->
    <!--        #{membrOrgnCd},-->
    <!--        #{membrNo},-->
    <!--        #{chgDate},-->
    <!--        #{chgSeq},-->
    <!--        3,-->
    <!--        #{totAjdPoint},-->
    <!--        #{adjustPartRemark},-->
    <!--        #{orgnApprNo},-->
    <!--        #{regDt},-->
    <!--        #{regId},-->
    <!--        #{modDt},-->
    <!--        #{modId}-->
    <!--    )-->
    <!--  </insert>-->

    <insert id="adjustAll" parameterType="DefaultMap">
    INSERT INTO
	    TB_MB_MEMBER_POINT_HIST ( MEMBR_ORGN_CD , MEMBR_NO , CHG_DATE , CHG_SEQ , POINT_CHG_FG , CHG_POINT , REMARK , REG_DT , REG_ID, MOD_DT , MOD_ID )
    SELECT
        tmmp.MEMBR_ORGN_CD,
        tmmp.MEMBR_NO,
        #{chgDate},
        SQ_TB_MEMBER_POINT_HIST.NEXTVAL,
        '3',
        #{totAjdPoint} - tmmp.AVABL_POINT,
        #{remark},
        #{regDt},
        #{regId},
        #{modDt},
        #{modId}
    FROM
        TB_MB_MEMBER_POINT tmmp
    WHERE
        MEMBR_ORGN_CD = #{membrOrgnCd}
    </insert>

    <select id="getMemberPointListChk" parameterType="memberPointVO" resultType="DefaultMap">
      /* MemberPointMapper.getMemberPointListChk */
        SELECT
        	tmm.MEMBR_CLASS_CD ,
        	SBPENC.D (tmm.MEMBR_NM) AS MEMBR_NM,
        	tmm.MEMBR_CARD_NO,
        	tmm.MEMBR_ORGN_CD ,
        	tmm.MEMBR_NO,
        	tmmp.AVABL_POINT
        FROM
        	TB_MB_MEMBER tmm, TB_MB_MEMBER_POINT tmmp
        WHERE 1=1
            AND tmm.MEMBR_ORGN_CD = tmmp.MEMBR_ORGN_CD
            AND tmm.MEMBR_NO = tmmp.MEMBR_NO
        	AND tmm.MEMBR_ORGN_CD = #{membrOrgnCd}
        	AND tmm.MEMBR_NO = #{membrNo}
  </select>


    <!-- 회원포인트조정 수정 -->
    <!--
        TABLE    : TB_MB_MEMBER_POINT
        COMMENTS : 회원포인트조정 수정
    -->
    <update id="updateMemberPoint" parameterType="memberPointVO">
        /* MemberPointMapper.updateMemberPoint */
        UPDATE
        	TB_MB_MEMBER_POINT
        SET
        	TOT_SALE_CNT = 0,
        	TOT_SALE_AMT = 0,
        	TOT_DC_AMT = 0,
        	TOT_SAVE_POINT = 0,
        	TOT_USE_POINT = 0,
        	AVABL_POINT = #{avablPoint},
        	TOT_ADJ_POINT = #{totAdjPoint},
        	MOD_DT = #{modDt},
        	MOD_ID = #{modId}
        WHERE
        	MEMBR_ORGN_CD = #{membrOrgnCd}
        	AND MEMBR_NO = #{membrNo}
    </update>

    <!-- 회원포인트조정 저장 -->
    <!--
        TABLE    : TB_MB_MEMBER_POINT_HIST
        COMMENTS : 회원포인트조정 저장
    -->
    <insert id="insertMemberPointHist" parameterType="memberPointVO">
        /* MemberPointMapper.insertMemberPointHist */
        INSERT INTO TB_MB_MEMBER_POINT_HIST (
	         MEMBR_ORGN_CD ,
	         MEMBR_NO ,
	         CHG_DATE ,
	         CHG_SEQ ,
	         POINT_CHG_FG ,
	         CHG_POINT ,
	         REMARK ,
	         REG_DT ,
	         REG_ID,
	         MOD_DT , 
	         MOD_ID
	    ) VALUES (
            #{membrOrgnCd},
            #{membrNo},
            #{chgDate},
            SQ_TB_MEMBER_POINT_HIST.NEXTVAL,
            '3',
            #{avablPoint},
            #{remark},
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
    </insert>


</mapper>
