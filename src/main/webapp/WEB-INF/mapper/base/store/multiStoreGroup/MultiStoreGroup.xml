<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    MultiStoreGroup.xml
    다중매장그룹관리
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       이다솜     2021.07.28     최초작성
-->

<mapper namespace="kr.co.solbipos.base.store.multiStoreGroup.service.impl.MultiStoreGroupMapper">

    <!-- 그룹조회 -->
    <!--
        TABLE    : TB_MS_MULTISTORE_HDR
        PARAM    : multiStoreGroupVO
        COMMENTS : 다중매장관리그룹을 조회한다.
    -->
    <select id="getMultiStoreGroup" parameterType="multiStoreGroupVO" resultType="DefaultMap">
        /* USE : MultiStoreGroupMapper.getMultiStoreGroup */
        SELECT HQ_OFFICE_CD,
                MULTISTORE_CD,
                MULTISTORE_NM,
                USE_YN,
                REMARK
          FROM TB_MS_MULTISTORE_HDR
         WHERE HQ_OFFICE_CD = #{hqOfficeCd}
        <if test="multistoreNm != null and multistoreNm != ''">
            AND MULTISTORE_NM LIKE '%' || #{multistoreNm} || '%'
        </if>
        <if test="useYn != null and useYn != ''">
            AND USE_YN = #{useYn}
        </if>
        ORDER
           BY MULTISTORE_CD ASC
    </select>

    <!-- 그룹코드 생성 -->
    <!--
        TABLE    : TB_MS_MULTISTORE_HDR
        PARAM    : multiStoreGroupVO
        COMMENTS : 다중매장관리그룹 코드를 생성한다.
    -->
    <select id="getMultiStoreGroupCode" parameterType="multiStoreGroupVO" resultType="String">
        /* USE : MultiStoreGroupMapper.getMultiStoreGroupCode */
        SELECT LPAD(NVL(MAX(MULTISTORE_CD), '0') + 1, 4, '0')
          FROM TB_MS_MULTISTORE_HDR
         WHERE HQ_OFFICE_CD = #{hqOfficeCd}
    </select>

    <!-- 그룹생성 -->
    <!--
        TABLE    : TB_MS_MULTISTORE_HDR
        PARAM    : multiStoreGroupVO
        COMMENTS : 새로운 다중매장관리그룹을 생성한다.
    -->
    <insert id="insertMultiStoreGroup" parameterType="multiStoreGroupVO">
        /* USE : MultiStoreGroupMapper.insertMultiStoreGroup */
        INSERT INTO TB_MS_MULTISTORE_HDR
                    (
                        HQ_OFFICE_CD,
                        MULTISTORE_CD,
                        MULTISTORE_NM,
                        USE_YN,
                        REMARK,
                        REG_DT,
                        REG_ID,
                        MOD_DT,
                        MOD_ID
                    )
                    VALUES
                    (
                        #{hqOfficeCd},
                        #{multistoreCd},
                        #{multistoreNm},
                        #{useYn},
                        #{remark},
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId}
                    )
    </insert>

    <!-- 그룹수정 -->
    <!--
        TABLE    : TB_MS_MULTISTORE_HDR
        PARAM    : multiStoreGroupVO
        COMMENTS : 다중매장관리그룹을 수정한다.
    -->
    <update id="updateMultiStoreGroup" parameterType="multiStoreGroupVO">
        /* USE : MultiStoreGroupMapper.updateMultiStoreGroup */
        UPDATE TB_MS_MULTISTORE_HDR
           SET MULTISTORE_NM = #{multistoreNm},
                USE_YN = #{useYn},
                REMARK = #{remark},
                MOD_DT = #{modDt},
                MOD_ID = #{modId}
         WHERE HQ_OFFICE_CD = #{hqOfficeCd}
           AND MULTISTORE_CD = #{multistoreCd}
    </update>







    <!-- 매장조회 -->
    <!--
        TABLE    : TB_MS_STORE
        PARAM    : multiStoreGroupVO
        COMMENTS : 매장을 조회한다.
    -->
    <select id="getStoreList" parameterType="multiStoreGroupVO" resultType="DefaultMap">
        /* MultiStoreGroupMapper.getStoreList */
        SELECT HQ_OFFICE_CD,
                STORE_CD,
                STORE_NM,
                SYS_STAT_FG
          FROM TB_MS_STORE
         WHERE HQ_OFFICE_CD = #{hqOfficeCd}
        <if test="storeCd != null and storeCd != ''">
            AND STORE_CD LIKE '%'||#{storeCd}||'%' --매장코드
        </if>
        <if test="storeNm != null and storeNm != ''">
            AND STORE_NM LIKE '%'||#{storeNm}||'%' --매장명
        </if>
        <if test="sysStatFg != null and sysStatFg != ''">
            AND SYS_STAT_FG = #{sysStatFg} --매장상태구분
        </if>
          AND STORE_CD NOT IN (SELECT STORE_CD FROM TB_MS_MULTISTORE_DTL WHERE HQ_OFFICE_CD = #{hqOfficeCd})
        ORDER
           BY STORE_CD ASC
    </select>

</mapper>