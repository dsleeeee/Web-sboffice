<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    PwdManageSaleChk.xml
    매출조회 비밀번호 관리 sql
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김유승     2025.08.05      최초작성
-->
<mapper namespace="kr.co.solbipos.store.manage.pwdManageSaleChk.service.impl.PwdManageSaleChkMapper">
    <!-- 매출조회 비밀번호 관리 - 조회 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <select id="getPwdManageSaleChkList" parameterType="PwdManageSaleChkVO" resultType="DefaultMap">
        /* PwdManageSaleChkMapper.getPwdManageSaleChkList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT 	'매장'            AS EMP_ORGN_FG
        ,		D.AGENCY_CD
        ,		D.AGENCY_NM
        ,		C.HQ_OFFICE_CD
        ,		C.HQ_OFFICE_NM
        ,		A.STORE_CD
        ,		B.STORE_NM
        ,		A.USER_ID
        ,		NVL(A.SALE_PWD_YN,'N') AS SALE_PWD_YN
        ,       A.SALE_PWD
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM 	TB_MS_EMPLOYEE A
        ,		TB_MS_STORE B
        ,		TB_HQ_OFFICE C
        ,		TB_CM_AGENCY D
        WHERE 	B.STORE_CD 		= A.STORE_CD
        AND 	B.HQ_OFFICE_CD 	= C.HQ_OFFICE_CD
        AND 	B.AGENCY_CD 	= D.AGENCY_CD
        AND 	B.HQ_OFFICE_CD  = #{hqOfficeCd}
        <if test='storeCd != null and storeCd != ""'>
            AND A.STORE_CD LIKE '%'||#{storeCd}||'%'
        </if>
        <if test='storeNm != null and storeNm != ""'>
            AND A.STORE_NM LIKE '%'||#{storeNm}||'%'
        </if>
        ORDER
        BY      A.STORE_CD
        ,       A.EMP_NO
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 비밀번호 초기화 -->
    <!--
        TABLE    : TB_WB_USER_INFO, TB_MS_EMPLOYEE
        PARAM    : pwdManageVO
        COMMENTS : 사용자의 비밀번호를 변경한다.
    -->
    <update id="getClearPwdSave" parameterType="pwdManageSaleChkVO">
        /* USE : PwdManageSaleChkMapper.getClearPwdSave */
        UPDATE  TB_MS_EMPLOYEE
        SET     SALE_PWD    = #{newPassword}
        ,       MOD_ID      = #{modId}
        ,       MOD_DT      = #{modDt}
        WHERE   USER_ID     = #{userId}
    </update>

    <!-- 비밀번호 변경 -->
    <!--
        TABLE    : TB_WB_USER_INFO, TB_MS_EMPLOYEE
        PARAM    : pwdManageVO
        COMMENTS : 사용자의 비밀번호를 변경한다.
    -->
    <update id="getModifySalePwd" parameterType="pwdManageSaleChkVO">
        /* USE : PwdManageSaleChkMapper.getModifySalePwd */
        UPDATE  TB_MS_EMPLOYEE
        SET     SALE_PWD    = #{newPassword}
        ,       SALE_PWD_YN = #{salePwdYn}
        ,       MOD_ID      = #{modId}
        ,       MOD_DT      = #{modDt}
        WHERE   USER_ID     = #{userId}
    </update>
</mapper>