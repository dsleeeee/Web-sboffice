<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    OmsLinkSample.xml
    OMS연동샘플 sql
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       이다솜     2025.09.11      최초작성
-->
<mapper namespace="kr.co.solbipos.sys.link.omsLinkSample.service.impl.OmsLinkSampleMapper">

    <!-- Clob -->
    <resultMap id="OmsLinkSampleMap" type="DefaultMap">
        <result column="REQUEST" property="request" javaType="java.lang.String"/>
        <result column="RESPONSE" property="response" javaType="java.lang.String"/>
    </resultMap>

    <!-- OMS연동샘플 API 호출 목록 조회 -->
    <!--
        TABLE    : TB_CM_API_LINK
        PARAM    : omsLinkSampleVO
        COMMENTS : API 호출 목록을 조회한다.
    -->
    <select id="getOmsLinkSampleReqList" parameterType="apiLinkVO" resultMap="OmsLinkSampleMap">
        /* USE : OmsLinkSampleMapper.getOmsLinkSampleReqList */
        SELECT SEQ
        ,      LINK_TYPE
        ,      URL
        ,      REQUEST_METHOD
        ,      REQUEST
        ,      RESPONSE
        ,      TO_CHAR(TO_DATE(REQUEST_DT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUEST_DT
        ,      TO_CHAR(TO_DATE(RESPONSE_DT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS RESPONSE_DT
        ,      STATUS_CODE
        ,      TO_CHAR(TO_DATE(REG_DT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REG_DT
        ,      REG_ID
        FROM   TB_CM_API_LINK
        WHERE  1=1
        <if test='seq != null and seq != 0'>
        AND    SEQ = #{seq}
        </if>
        ORDER
           BY  SEQ DESC
    </select>

    <!-- API 호출 로그 저장 -->
    <!--
        TABLE    : TB_CM_API_LINK
        PARAM    : omsLinkSampleVO
        COMMENTS : API 호출 로그를 저장하고, 로그 seq 값을 리턴한다.
    -->
    <insert id="saveApiLog" parameterType="apiLinkVO">
        /* OmsLinkSampleMapper.saveApiLog */
        <selectKey keyProperty="seq" resultType="int" order="AFTER">
            SELECT SQ_CM_API_LINK.CURRVAL FROM DUAL
        </selectKey>
        INSERT INTO TB_CM_API_LINK
        (
               SEQ
           ,   LINK_TYPE
           ,   URL
           ,   REQUEST_METHOD
           ,   REQUEST
           ,   RESPONSE
           ,   REQUEST_DT
           ,   RESPONSE_DT
           ,   STATUS_CODE
           ,   REG_DT
           ,   REG_ID
        )
        VALUES
        (
               SQ_CM_API_LINK.NEXTVAL
           ,   #{linkType}
           ,   #{url}
           ,   #{requestMethod}
           ,   #{request}
           ,   #{response}
           ,   #{requestDt}
           ,   #{responseDt}
           ,   #{statusCode}
           ,   #{regDt}
           ,   #{regId}
        )
    </insert>

</mapper>