<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SalePerfCompare.xml
    매출실적비교
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김유승     2025.07.31     최초작성
-->
<mapper namespace="kr.co.solbipos.sale.marketing.salePerfCompare.service.impl.SalePerfCompareMapper">
    <!-- 매출실적비교 - 조회 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <select id="getSalePerfCompareList" parameterType="SalePerfCompareVO" resultType="DefaultMap">
        /* SalePerfCompareMapper.getSalePerfCompareList */
        <choose>
            <when test='dateFg != null and (dateFg == "day" or dateFg == "dayPeriod")'>
                SELECT 	DECODE(A.DLVR_ORDER_FG,'1','내점','2','배달','3','포장','4','포장','') AS DLVR_ORDER_FG
                ,		SUM(A.COMP_SALE_CNT_FRAN)   AS COMP_SALE_CNT_FRAN
                ,		SUM(A.COMP_SALE_AMT_FRAN)   AS COMP_SALE_AMT_FRAN
                ,		SUM(A.COMP_SALE_CNT_DM)     AS COMP_SALE_CNT_DM
                ,		SUM(A.COMP_SALE_AMT_DM)     AS COMP_SALE_AMT_DM
                ,		SUM(A.COMP_SALE_CNT_DM) + SUM(A.COMP_SALE_CNT_FRAN)     AS COMP_TOT_SALE_CNT
                ,		SUM(A.COMP_SALE_AMT_DM) + SUM(A.COMP_SALE_AMT_FRAN)     AS COMP_TOT_SALE_AMT
                ,		SUM(A.SRCH_SALE_CNT_FRAN)   AS SRCH_SALE_CNT_FRAN
                ,		SUM(A.SRCH_SALE_AMT_FRAN)   AS SRCH_SALE_AMT_FRAN
                ,		SUM(A.SRCH_SALE_CNT_DM)     AS SRCH_SALE_CNT_DM
                ,		SUM(A.SRCH_SALE_AMT_DM)     AS SRCH_SALE_AMT_DM
                ,		SUM(A.SRCH_SALE_CNT_DM) + SUM(A.SRCH_SALE_CNT_FRAN)     AS SRCH_TOT_SALE_CNT
                ,		SUM(A.SRCH_SALE_AMT_DM) + SUM(A.SRCH_SALE_AMT_FRAN)     AS SRCH_TOT_SALE_AMT
                ,		(NULLIF(SUM(A.SRCH_SALE_CNT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_CNT_FRAN),0))     AS GR_SALE_CNT_FRAN
                ,		(NULLIF(SUM(A.SRCH_SALE_AMT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_AMT_FRAN),0))     AS GR_SALE_AMT_FRAN
                ,		(NULLIF(SUM(A.SRCH_SALE_CNT_DM),0) / NULLIF(SUM(A.COMP_SALE_CNT_DM),0))         AS GR_SALE_CNT_DM
                ,		(NULLIF(SUM(A.SRCH_SALE_AMT_DM),0) / NULLIF(SUM(A.COMP_SALE_AMT_DM),0))         AS GR_SALE_AMT_DM
                ,       (NULLIF(SUM(A.SRCH_SALE_AMT_DM) + SUM(A.SRCH_SALE_AMT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_AMT_DM) + SUM(A.COMP_SALE_AMT_FRAN),0)) AS GR_TOT_SALE_AMT
                ,       (NULLIF(SUM(A.SRCH_SALE_CNT_DM) + SUM(A.SRCH_SALE_CNT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_CNT_DM) + SUM(A.COMP_SALE_CNT_FRAN),0)) AS GR_TOT_SALE_CNT
                FROM 	(
                            SELECT 	SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_DM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_DM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_FRAN
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_DM
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_DM
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_FRAN
                            ,		DECODE(A.DLVR_ORDER_FG,'4','3',A.DLVR_ORDER_FG) AS DLVR_ORDER_FG
                            FROM	TB_SL_DAILY_TOTAL_DLVR A
                            ,		TB_MS_STORE B
                            WHERE 	A.STORE_CD      = B.STORE_CD
                            AND 	A.HQ_OFFICE_CD  = #{hqOfficeCd}
                            AND 	(A.SALE_DATE BETWEEN #{startDate} AND #{endDate} OR A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate})
                            GROUP
                            BY 		A.DLVR_ORDER_FG
                        ) A
                GROUP
                BY 		A.DLVR_ORDER_FG
                ORDER
                BY 		A.DLVR_ORDER_FG
            </when>
            <when test='dateFg != null and (dateFg == "month" or dateFg == "monthPeriod")'>
                SELECT 	DECODE(A.DLVR_ORDER_FG,'1','내점','2','배달','3','포장','4','포장','') AS DLVR_ORDER_FG
                ,		SUM(A.COMP_SALE_CNT_FRAN)   AS COMP_SALE_CNT_FRAN
                ,		SUM(A.COMP_SALE_AMT_FRAN)   AS COMP_SALE_AMT_FRAN
                ,		SUM(A.COMP_SALE_CNT_DM)     AS COMP_SALE_CNT_DM
                ,		SUM(A.COMP_SALE_AMT_DM)     AS COMP_SALE_AMT_DM
                ,		SUM(A.COMP_SALE_CNT_DM) + SUM(A.COMP_SALE_CNT_FRAN)     AS COMP_TOT_SALE_CNT
                ,		SUM(A.COMP_SALE_AMT_DM) + SUM(A.COMP_SALE_AMT_FRAN)     AS COMP_TOT_SALE_AMT
                ,		SUM(A.SRCH_SALE_CNT_FRAN)   AS SRCH_SALE_CNT_FRAN
                ,		SUM(A.SRCH_SALE_AMT_FRAN)   AS SRCH_SALE_AMT_FRAN
                ,		SUM(A.SRCH_SALE_CNT_DM)     AS SRCH_SALE_CNT_DM
                ,		SUM(A.SRCH_SALE_AMT_DM)     AS SRCH_SALE_AMT_DM
                ,		SUM(A.SRCH_SALE_CNT_DM) + SUM(A.SRCH_SALE_CNT_FRAN)     AS SRCH_TOT_SALE_CNT
                ,		SUM(A.SRCH_SALE_AMT_DM) + SUM(A.SRCH_SALE_AMT_FRAN)     AS SRCH_TOT_SALE_AMT
                ,		(NULLIF(SUM(A.SRCH_SALE_CNT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_CNT_FRAN),0))     AS GR_SALE_CNT_FRAN
                ,		(NULLIF(SUM(A.SRCH_SALE_AMT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_AMT_FRAN),0))     AS GR_SALE_AMT_FRAN
                ,		(NULLIF(SUM(A.SRCH_SALE_CNT_DM),0) / NULLIF(SUM(A.COMP_SALE_CNT_DM),0))         AS GR_SALE_CNT_DM
                ,		(NULLIF(SUM(A.SRCH_SALE_AMT_DM),0) / NULLIF(SUM(A.COMP_SALE_AMT_DM),0))         AS GR_SALE_AMT_DM
                ,       (NULLIF(SUM(A.SRCH_SALE_AMT_DM) + SUM(A.SRCH_SALE_AMT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_AMT_DM) + SUM(A.COMP_SALE_AMT_FRAN),0)) AS GR_TOT_SALE_AMT
                ,       (NULLIF(SUM(A.SRCH_SALE_CNT_DM) + SUM(A.SRCH_SALE_CNT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_CNT_DM) + SUM(A.COMP_SALE_CNT_FRAN),0)) AS GR_TOT_SALE_CNT
                FROM 	(
                            SELECT 	SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_DM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_DM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_FRAN
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_FRAN
                            ,		DECODE(A.DLVR_ORDER_FG,'4','3',A.DLVR_ORDER_FG) AS DLVR_ORDER_FG
                            FROM	TB_SL_MONTHLY_TOTAL_DLVR A
                            ,		TB_MS_STORE B
                            WHERE 	A.STORE_CD      = B.STORE_CD
                            AND 	A.HQ_OFFICE_CD  = #{hqOfficeCd}
                            AND 	(A.SALE_YM BETWEEN #{startDate} AND #{endDate} OR A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate})
                            GROUP
                            BY 		A.DLVR_ORDER_FG
                        ) A
                GROUP
                BY 		A.DLVR_ORDER_FG
                ORDER
                BY 		A.DLVR_ORDER_FG
            </when>
            <when test='dateFg != null and (dateFg == "year" or dateFg == "yearPeriod")'>
                SELECT 	DECODE(A.DLVR_ORDER_FG,'1','내점','2','배달','3','포장','4','포장','') AS DLVR_ORDER_FG
                ,		SUM(A.COMP_SALE_CNT_FRAN)   AS COMP_SALE_CNT_FRAN
                ,		SUM(A.COMP_SALE_AMT_FRAN)   AS COMP_SALE_AMT_FRAN
                ,		SUM(A.COMP_SALE_CNT_DM)     AS COMP_SALE_CNT_DM
                ,		SUM(A.COMP_SALE_AMT_DM)     AS COMP_SALE_AMT_DM
                ,		SUM(A.COMP_SALE_CNT_DM) + SUM(A.COMP_SALE_CNT_FRAN)     AS COMP_TOT_SALE_CNT
                ,		SUM(A.COMP_SALE_AMT_DM) + SUM(A.COMP_SALE_AMT_FRAN)     AS COMP_TOT_SALE_CNT
                ,		SUM(A.SRCH_SALE_CNT_FRAN)   AS SRCH_SALE_CNT_FRAN
                ,		SUM(A.SRCH_SALE_AMT_FRAN)   AS SRCH_SALE_AMT_FRAN
                ,		SUM(A.SRCH_SALE_CNT_DM)     AS SRCH_SALE_CNT_DM
                ,		SUM(A.SRCH_SALE_AMT_DM)     AS SRCH_SALE_AMT_DM
                ,		SUM(A.SRCH_SALE_CNT_DM) + SUM(A.SRCH_SALE_CNT_FRAN)     AS SRCH_TOT_SALE_CNT
                ,		SUM(A.SRCH_SALE_AMT_DM) + SUM(A.SRCH_SALE_AMT_FRAN)     AS SRCH_TOT_SALE_AMT
                ,		(NULLIF(SUM(A.SRCH_SALE_CNT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_CNT_FRAN),0))    AS GR_SALE_CNT_FRAN
                ,		(NULLIF(SUM(A.SRCH_SALE_AMT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_AMT_FRAN),0))    AS GR_SALE_AMT_FRAN
                ,		(NULLIF(SUM(A.SRCH_SALE_CNT_DM),0) / NULLIF(SUM(A.COMP_SALE_CNT_DM),0))        AS GR_SALE_CNT_DM
                ,		(NULLIF(SUM(A.SRCH_SALE_AMT_DM),0) / NULLIF(SUM(A.COMP_SALE_AMT_DM),0))        AS GR_SALE_AMT_DM
                ,       (NULLIF(SUM(A.SRCH_SALE_CNT_DM) + SUM(A.SRCH_SALE_CNT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_CNT_DM) + SUM(A.COMP_SALE_CNT_FRAN),0))  AS GR_TOT_SALE_CNT
                ,       (NULLIF(SUM(A.SRCH_SALE_AMT_DM) + SUM(A.SRCH_SALE_AMT_FRAN),0) / NULLIF(SUM(A.COMP_SALE_AMT_DM) + SUM(A.COMP_SALE_AMT_FRAN),0))  AS GR_TOT_SALE_AMT
                FROM 	(
                            SELECT 	SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_DM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_DM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_FRAN
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_FRAN
                            ,		DECODE(A.DLVR_ORDER_FG,'4','3',A.DLVR_ORDER_FG) AS DLVR_ORDER_FG
                            FROM	TB_SL_MONTHLY_TOTAL_DLVR A
                            ,		TB_MS_STORE B
                            WHERE 	A.STORE_CD      = B.STORE_CD
                            AND 	A.HQ_OFFICE_CD  = #{hqOfficeCd}
                            AND 	(A.SALE_YM LIKE #{startDate}||'%' OR A.SALE_YM LIKE #{compStartDate}||'%')
                            GROUP
                            BY 		A.DLVR_ORDER_FG
                        ) A
                GROUP
                BY 		A.DLVR_ORDER_FG
                ORDER
                BY 		A.DLVR_ORDER_FG
            </when>
        </choose>
    </select>

    <!-- 매출실적비교 - 채널별 조회 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <select id="getSalePerfCompareDtlList" parameterType="SalePerfCompareVO" resultType="DefaultMap">
        /* SalePerfCompareMapper.getSalePerfCompareDtlList */
        <choose>
            <when test='dateFg != null and (dateFg == "day" or dateFg == "dayPeriod")'>
                SELECT 	A.DLVR_IN_FG
                ,		A.COMP_SALE_CNT_FRAN
                ,		A.COMP_SALE_AMT_FRAN
                ,		A.COMP_SALE_CNT_DM
                ,		A.COMP_SALE_AMT_DM
                ,		A.COMP_SALE_CNT_DM + A.COMP_SALE_CNT_FRAN     AS COMP_TOT_SALE_CNT
                ,		A.COMP_SALE_AMT_DM + A.COMP_SALE_AMT_FRAN     AS COMP_TOT_SALE_AMT
                ,		A.SRCH_SALE_CNT_FRAN   AS SRCH_SALE_CNT_FRAN
                ,		A.SRCH_SALE_AMT_FRAN   AS SRCH_SALE_AMT_FRAN
                ,		A.SRCH_SALE_CNT_DM     AS SRCH_SALE_CNT_DM
                ,		A.SRCH_SALE_AMT_DM     AS SRCH_SALE_AMT_DM
                ,		A.SRCH_SALE_CNT_DM + A.SRCH_SALE_CNT_FRAN     AS SRCH_TOT_SALE_CNT
                ,		A.SRCH_SALE_AMT_DM + A.SRCH_SALE_AMT_FRAN     AS SRCH_TOT_SALE_AMT
                ,		(NULLIF(A.SRCH_SALE_CNT_FRAN,0) / NULLIF(A.COMP_SALE_CNT_FRAN,0))     AS GR_SALE_CNT_FRAN
                ,		(NULLIF(A.SRCH_SALE_AMT_FRAN,0) / NULLIF(A.COMP_SALE_AMT_FRAN,0))     AS GR_SALE_AMT_FRAN
                ,		(NULLIF(A.SRCH_SALE_CNT_DM,0) / NULLIF(A.COMP_SALE_CNT_DM,0))         AS GR_SALE_CNT_DM
                ,		(NULLIF(A.SRCH_SALE_AMT_DM,0) / NULLIF(A.COMP_SALE_AMT_DM,0))         AS GR_SALE_AMT_DM
                ,       (NULLIF(A.SRCH_SALE_AMT_DM + A.SRCH_SALE_AMT_FRAN,0) / NULLIF(A.COMP_SALE_AMT_DM + A.COMP_SALE_AMT_FRAN,0)) AS GR_TOT_SALE_AMT
                ,       (NULLIF(A.SRCH_SALE_CNT_DM + A.SRCH_SALE_CNT_FRAN,0) / NULLIF(A.COMP_SALE_CNT_DM + A.COMP_SALE_CNT_FRAN,0)) AS GR_TOT_SALE_CNT
                FROM 	(
                            SELECT 	SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_DM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_DM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_FRAN
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_DM
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_DM
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_FRAN
                            ,		NVL(C.NMCODE_NM,'일반') AS DLVR_IN_FG
                            ,		NVL(C.NMCODE_CD,'0')	AS NMCODE_CD
                            FROM 	TB_SL_DAILY_TOTAL_ORDAPP A
                            ,		TB_MS_STORE B
                            ,		TB_CM_NMCODE C
                            WHERE 	A.HQ_OFFICE_CD = #{hqOfficeCd}
                            AND 	(A.SALE_DATE BETWEEN #{startDate} AND #{endDate} OR A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate})
                            AND 	B.STORE_CD = A.STORE_CD
                            AND 	C.NMCODE_CD (+) = A.DLVR_IN_FG
                            AND 	C.NMCODE_GRP_CD (+) = '112'
                            GROUP
                            BY 		C.NMCODE_NM
                            ,       C.NMCODE_CD
                        ) A
                ORDER
                BY      TO_NUMBER(A.NMCODE_CD)
            </when>
            <when test='dateFg != null and (dateFg == "month" or dateFg == "monthPeriod")'>
                SELECT 	A.DLVR_IN_FG
                ,		A.COMP_SALE_CNT_FRAN
                ,		A.COMP_SALE_AMT_FRAN
                ,		A.COMP_SALE_CNT_DM
                ,		A.COMP_SALE_AMT_DM
                ,		A.COMP_SALE_CNT_DM + A.COMP_SALE_CNT_FRAN     AS COMP_TOT_SALE_CNT
                ,		A.COMP_SALE_AMT_DM + A.COMP_SALE_AMT_FRAN     AS COMP_TOT_SALE_AMT
                ,		A.SRCH_SALE_CNT_FRAN   AS SRCH_SALE_CNT_FRAN
                ,		A.SRCH_SALE_AMT_FRAN   AS SRCH_SALE_AMT_FRAN
                ,		A.SRCH_SALE_CNT_DM     AS SRCH_SALE_CNT_DM
                ,		A.SRCH_SALE_AMT_DM     AS SRCH_SALE_AMT_DM
                ,		A.SRCH_SALE_CNT_DM + A.SRCH_SALE_CNT_FRAN     AS SRCH_TOT_SALE_CNT
                ,		A.SRCH_SALE_AMT_DM + A.SRCH_SALE_AMT_FRAN     AS SRCH_TOT_SALE_AMT
                ,		(NULLIF(A.SRCH_SALE_CNT_FRAN,0) / NULLIF(A.COMP_SALE_CNT_FRAN,0))     AS GR_SALE_CNT_FRAN
                ,		(NULLIF(A.SRCH_SALE_AMT_FRAN,0) / NULLIF(A.COMP_SALE_AMT_FRAN,0))     AS GR_SALE_AMT_FRAN
                ,		(NULLIF(A.SRCH_SALE_CNT_DM,0) / NULLIF(A.COMP_SALE_CNT_DM,0))         AS GR_SALE_CNT_DM
                ,		(NULLIF(A.SRCH_SALE_AMT_DM,0) / NULLIF(A.COMP_SALE_AMT_DM,0))         AS GR_SALE_AMT_DM
                ,       (NULLIF(A.SRCH_SALE_AMT_DM + A.SRCH_SALE_AMT_FRAN,0) / NULLIF(A.COMP_SALE_AMT_DM + A.COMP_SALE_AMT_FRAN,0)) AS GR_TOT_SALE_AMT
                ,       (NULLIF(A.SRCH_SALE_CNT_DM + A.SRCH_SALE_CNT_FRAN,0) / NULLIF(A.COMP_SALE_CNT_DM + A.COMP_SALE_CNT_FRAN,0)) AS GR_TOT_SALE_CNT
                FROM 	(
                            SELECT 	SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_DM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_DM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_FRAN
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_FRAN
                            ,		NVL(C.NMCODE_NM,'일반') AS DLVR_IN_FG
                            ,		NVL(C.NMCODE_CD,'0')	AS NMCODE_CD
                            FROM 	TB_SL_MONTHLY_TOTAL_ORDAPP A
                            ,		TB_MS_STORE B
                            ,		TB_CM_NMCODE C
                            WHERE 	A.HQ_OFFICE_CD = #{hqOfficeCd}
                            AND 	(A.SALE_YM BETWEEN #{startDate} AND #{endDate} OR A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate})
                            AND 	B.STORE_CD = A.STORE_CD
                            AND 	C.NMCODE_CD (+) = A.DLVR_IN_FG
                            AND 	C.NMCODE_GRP_CD (+) = '112'
                            GROUP
                            BY 		C.NMCODE_NM
                            ,       C.NMCODE_CD
                        ) A
                ORDER
                BY      TO_NUMBER(A.NMCODE_CD)
            </when>
            <when test='dateFg != null and (dateFg == "year" or dateFg == "yearPeriod")'>
                SELECT 	A.DLVR_IN_FG
                ,		A.COMP_SALE_CNT_FRAN
                ,		A.COMP_SALE_AMT_FRAN
                ,		A.COMP_SALE_CNT_DM
                ,		A.COMP_SALE_AMT_DM
                ,		A.COMP_SALE_CNT_DM + A.COMP_SALE_CNT_FRAN     AS COMP_TOT_SALE_CNT
                ,		A.COMP_SALE_AMT_DM + A.COMP_SALE_AMT_FRAN     AS COMP_TOT_SALE_AMT
                ,		A.SRCH_SALE_CNT_FRAN   AS SRCH_SALE_CNT_FRAN
                ,		A.SRCH_SALE_AMT_FRAN   AS SRCH_SALE_AMT_FRAN
                ,		A.SRCH_SALE_CNT_DM     AS SRCH_SALE_CNT_DM
                ,		A.SRCH_SALE_AMT_DM     AS SRCH_SALE_AMT_DM
                ,		A.SRCH_SALE_CNT_DM + A.SRCH_SALE_CNT_FRAN     AS SRCH_TOT_SALE_CNT
                ,		A.SRCH_SALE_AMT_DM + A.SRCH_SALE_AMT_FRAN     AS SRCH_TOT_SALE_AMT
                ,		(NULLIF(A.SRCH_SALE_CNT_FRAN,0) / NULLIF(A.COMP_SALE_CNT_FRAN,0))     AS GR_SALE_CNT_FRAN
                ,		(NULLIF(A.SRCH_SALE_AMT_FRAN,0) / NULLIF(A.COMP_SALE_AMT_FRAN,0))     AS GR_SALE_AMT_FRAN
                ,		(NULLIF(A.SRCH_SALE_CNT_DM,0) / NULLIF(A.COMP_SALE_CNT_DM,0))         AS GR_SALE_CNT_DM
                ,		(NULLIF(A.SRCH_SALE_AMT_DM,0) / NULLIF(A.COMP_SALE_AMT_DM,0))         AS GR_SALE_AMT_DM
                ,       (NULLIF(A.SRCH_SALE_AMT_DM + A.SRCH_SALE_AMT_FRAN,0) / NULLIF(A.COMP_SALE_AMT_DM + A.COMP_SALE_AMT_FRAN,0)) AS GR_TOT_SALE_AMT
                ,       (NULLIF(A.SRCH_SALE_CNT_DM + A.SRCH_SALE_CNT_FRAN,0) / NULLIF(A.COMP_SALE_CNT_DM + A.COMP_SALE_CNT_FRAN,0)) AS GR_TOT_SALE_CNT
                FROM 	(
                            SELECT 	SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_DM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_DM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS SRCH_SALE_CNT_FRAN
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS SRCH_SALE_AMT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'Y' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_DM
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_CNT  ELSE 0 END) AS COMP_SALE_CNT_FRAN
                            ,	  	SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND NVL(B.DIRECT_MANAGE_YN,'N') = 'N' THEN REAL_SALE_AMT  ELSE 0 END) AS COMP_SALE_AMT_FRAN
                            ,		NVL(C.NMCODE_NM,'일반') AS DLVR_IN_FG
                            ,		NVL(C.NMCODE_CD,'0')	AS NMCODE_CD
                            FROM 	TB_SL_MONTHLY_TOTAL_ORDAPP A
                            ,		TB_MS_STORE B
                            ,		TB_CM_NMCODE C
                            WHERE 	A.HQ_OFFICE_CD = #{hqOfficeCd}
                            AND 	(A.SALE_YM LIKE #{startDate} ||'%' OR A.SALE_YM LIKE #{compStartDate} ||'%')
                            AND 	B.STORE_CD = A.STORE_CD
                            AND 	C.NMCODE_CD (+) = A.DLVR_IN_FG
                            AND 	C.NMCODE_GRP_CD (+) = '112'
                            GROUP
                            BY 		C.NMCODE_NM
                            ,       C.NMCODE_CD
                        ) A
                ORDER
                BY      TO_NUMBER(A.NMCODE_CD)
            </when>
        </choose>
    </select>

    <select id="getSalePerfCompareStoreList" parameterType="SalePerfCompareVO" resultType="DefaultMap">
        /* SalePerfCompareMapper.getSalePerfCompareStoreList */
        <choose>
            <when test='dateFg != null and (dateFg == "day" or dateFg == "dayPeriod")'>
                SELECT 	A.STORE_CD
                ,		A.STORE_NM
                ,		SRCH_SALE_CNT_COMM
                ,		SRCH_SALE_AMT_COMM
                ,		SRCH_SALE_CNT_DLVR
                ,		SRCH_SALE_AMT_DLVR
                ,		SRCH_SALE_CNT_PACK
                ,		SRCH_SALE_AMT_PACK
                ,		COMP_SALE_CNT_COMM
                ,		COMP_SALE_AMT_COMM
                ,		COMP_SALE_CNT_DLVR
                ,		COMP_SALE_AMT_DLVR
                ,		COMP_SALE_CNT_PACK
                ,		COMP_SALE_AMT_PACK
                ,		NULLIF(SRCH_SALE_CNT_COMM,0) / NULLIF(COMP_SALE_CNT_COMM,0) AS GR_SALE_CNT_COMM
                ,		NULLIF(SRCH_SALE_AMT_COMM,0) / NULLIF(COMP_SALE_AMT_COMM,0) AS GR_SALE_AMT_COMM
                ,		NULLIF(SRCH_SALE_CNT_DLVR,0) / NULLIF(COMP_SALE_CNT_DLVR,0) AS GR_SALE_CNT_DLVR
                ,		NULLIF(SRCH_SALE_AMT_DLVR,0) / NULLIF(COMP_SALE_AMT_DLVR,0) AS GR_SALE_AMT_DLVR
                ,		NULLIF(SRCH_SALE_CNT_PACK,0) / NULLIF(COMP_SALE_CNT_PACK,0) AS GR_SALE_CNT_PACK
                ,		NULLIF(SRCH_SALE_AMT_PACK,0) / NULLIF(COMP_SALE_AMT_PACK,0) AS GR_SALE_AMT_PACK
                FROM 	(
                            SELECT 	A.STORE_CD
                            ,		B.STORE_NM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_COMM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_COMM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_DLVR
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_DLVR
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_PACK
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_PACK
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_COMM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_COMM
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_DLVR
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_DLVR
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_PACK
                            ,		SUM(CASE WHEN A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_PACK
                            FROM 	TB_SL_DAILY_TOTAL_DLVR A
                            ,		TB_MS_STORE B
                            WHERE 	B.STORE_CD = A.STORE_CD
                            AND 	A.HQ_OFFICE_CD = #{hqOfficeCd}
                            AND 	(A.SALE_DATE BETWEEN #{startDate} AND #{endDate} OR A.SALE_DATE BETWEEN #{compStartDate} AND #{compEndDate})
                            <if test='storeCdQuery != null and storeCdQuery != ""'>
                                AND A.STORE_CD IN (${storeCdQuery})
                            </if>
                            GROUP
                            BY 		A.STORE_CD
                            ,		B.STORE_NM
                        ) A
                ORDER 
                BY      A.STORE_CD
            </when>
            <when test='dateFg != null and (dateFg == "month" or dateFg == "monthPeriod")'>
                SELECT 	A.STORE_CD
                ,		A.STORE_NM
                ,		SRCH_SALE_CNT_COMM
                ,		SRCH_SALE_AMT_COMM
                ,		SRCH_SALE_CNT_DLVR
                ,		SRCH_SALE_AMT_DLVR
                ,		SRCH_SALE_CNT_PACK
                ,		SRCH_SALE_AMT_PACK
                ,		COMP_SALE_CNT_COMM
                ,		COMP_SALE_AMT_COMM
                ,		COMP_SALE_CNT_DLVR
                ,		COMP_SALE_AMT_DLVR
                ,		COMP_SALE_CNT_PACK
                ,		COMP_SALE_AMT_PACK
                ,		NULLIF(SRCH_SALE_CNT_COMM,0) / NULLIF(COMP_SALE_CNT_COMM,0) AS GR_SALE_CNT_COMM
                ,		NULLIF(SRCH_SALE_AMT_COMM,0) / NULLIF(COMP_SALE_AMT_COMM,0) AS GR_SALE_AMT_COMM
                ,		NULLIF(SRCH_SALE_CNT_DLVR,0) / NULLIF(COMP_SALE_CNT_DLVR,0) AS GR_SALE_CNT_DLVR
                ,		NULLIF(SRCH_SALE_AMT_DLVR,0) / NULLIF(COMP_SALE_AMT_DLVR,0) AS GR_SALE_AMT_DLVR
                ,		NULLIF(SRCH_SALE_CNT_PACK,0) / NULLIF(COMP_SALE_CNT_PACK,0) AS GR_SALE_CNT_PACK
                ,		NULLIF(SRCH_SALE_AMT_PACK,0) / NULLIF(COMP_SALE_AMT_PACK,0) AS GR_SALE_AMT_PACK
                FROM 	(
                            SELECT 	A.STORE_CD
                            ,		B.STORE_NM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_PACK
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{startDate} AND #{endDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_PACK
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_PACK
                            ,		SUM(CASE WHEN A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate} AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_PACK
                            FROM 	TB_SL_MONTHLY_TOTAL_DLVR A
                            ,		TB_MS_STORE B
                            WHERE 	B.STORE_CD = A.STORE_CD
                            AND 	A.HQ_OFFICE_CD = #{hqOfficeCd}
                            AND 	(A.SALE_YM BETWEEN #{startDate} AND #{endDate} OR A.SALE_YM BETWEEN #{compStartDate} AND #{compEndDate})
                            <if test='storeCdQuery != null and storeCdQuery != ""'>
                                AND A.STORE_CD IN (${storeCdQuery})
                            </if>
                            GROUP
                            BY 		A.STORE_CD
                            ,		B.STORE_NM
                        ) A
                ORDER
                BY 		A.STORE_CD
            </when>
            <when test='dateFg != null and (dateFg == "year" or dateFg == "yearPeriod")'>
                SELECT 	A.STORE_CD
                ,		A.STORE_NM
                ,		SRCH_SALE_CNT_COMM
                ,		SRCH_SALE_AMT_COMM
                ,		SRCH_SALE_CNT_DLVR
                ,		SRCH_SALE_AMT_DLVR
                ,		SRCH_SALE_CNT_PACK
                ,		SRCH_SALE_AMT_PACK
                ,		COMP_SALE_CNT_COMM
                ,		COMP_SALE_AMT_COMM
                ,		COMP_SALE_CNT_DLVR
                ,		COMP_SALE_AMT_DLVR
                ,		COMP_SALE_CNT_PACK
                ,		COMP_SALE_AMT_PACK
                ,		NULLIF(SRCH_SALE_CNT_COMM,0) / NULLIF(COMP_SALE_CNT_COMM,0) AS GR_SALE_CNT_COMM
                ,		NULLIF(SRCH_SALE_AMT_COMM,0) / NULLIF(COMP_SALE_AMT_COMM,0) AS GR_SALE_AMT_COMM
                ,		NULLIF(SRCH_SALE_CNT_DLVR,0) / NULLIF(COMP_SALE_CNT_DLVR,0) AS GR_SALE_CNT_DLVR
                ,		NULLIF(SRCH_SALE_AMT_DLVR,0) / NULLIF(COMP_SALE_AMT_DLVR,0) AS GR_SALE_AMT_DLVR
                ,		NULLIF(SRCH_SALE_CNT_PACK,0) / NULLIF(COMP_SALE_CNT_PACK,0) AS GR_SALE_CNT_PACK
                ,		NULLIF(SRCH_SALE_AMT_PACK,0) / NULLIF(COMP_SALE_AMT_PACK,0) AS GR_SALE_AMT_PACK
                FROM 	(
                            SELECT 	A.STORE_CD
                            ,		B.STORE_NM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_CNT  ELSE 0 END)	AS SRCH_SALE_CNT_PACK
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{startDate}||'%' AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_AMT  ELSE 0 END)	AS SRCH_SALE_AMT_PACK
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND A.DLVR_ORDER_FG ='1' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_COMM
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND A.DLVR_ORDER_FG ='2' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_DLVR
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_CNT  ELSE 0 END)	AS COMP_SALE_CNT_PACK
                            ,		SUM(CASE WHEN A.SALE_YM LIKE #{compStartDate}||'%' AND A.DLVR_ORDER_FG ='3' THEN REAL_SALE_AMT  ELSE 0 END)	AS COMP_SALE_AMT_PACK
                            FROM 	TB_SL_MONTHLY_TOTAL_DLVR A
                            ,		TB_MS_STORE B
                            WHERE 	B.STORE_CD = A.STORE_CD
                            AND 	A.HQ_OFFICE_CD = #{hqOfficeCd}
                            AND 	(A.SALE_YM LIKE #{startDate} ||'%' OR A.SALE_YM LIKE #{compStartDate} ||'%')
                            <if test='storeCdQuery != null and storeCdQuery != ""'>
                                AND A.STORE_CD IN (${storeCdQuery})
                            </if>
                            GROUP
                            BY 		A.STORE_CD
                            ,		B.STORE_NM
                        ) A
                ORDER
                BY 		A.STORE_CD
            </when>
        </choose>
    </select>
</mapper>