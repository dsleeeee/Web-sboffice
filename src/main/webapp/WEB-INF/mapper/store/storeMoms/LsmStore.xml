<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    LsmStore.xml
    LSM사용매장조회
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       권지현     2023.04.26      최초작성
-->
<mapper namespace="kr.co.solbipos.store.storeMoms.lsmStore.service.impl.LsmStoreMapper">

    <!-- LSM사용매장 조회 -->
    <!--
        TABLE    : TB_HQ_BRANCH_MOMS, TB_MS_STORE
        PARAM    : lsmStoreVO
        COMMENTS : LSM사용매장을 조회한다.
    -->
    <select id="getLsmStoreList" parameterType="lsmStoreVO" resultType="DefaultMap">
        /* USE : LsmStoreMapper.getLsmStoreList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT  A.STORE_CD
        ,		E.STORE_NM
        ,       E.SYS_STAT_FG
        ,		F.POS_NO
        ,		A.TUKEY_GRP_CD
        ,		B.TUKEY_GRP_NM
        ,		A.TUKEY_CLASS_CD
        ,		A.TUKEY_CLASS_NM
        ,		C.PROD_CD
        ,		D.PROD_NM
        ,		J.SALE_UPRC
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM    TB_MS_TOUCH_KEY_CLASS A
        ,       TB_MS_TOUCH_KEY_GROUP B
        ,       TB_MS_TOUCH_KEY C
        ,		TB_MS_PRODUCT D
        ,		TB_MS_STORE E
        ,		TB_MS_POS_ENVST F
        ,		TB_MS_STORE_ENVST G
        ,		TB_HQ_TOUCH_KEY_CLASS H
        ,		TB_HQ_NMCODE I
        ,		TB_MS_PRODUCT_SALE_PRICE_V01 J --view
        ,       (
                    SELECT 	STORE_CD
                    ,       POS_NO
                    FROM 	TB_MS_POS_ENVST
                    WHERE 	ENVST_CD = '4019'
                    AND 	ENVST_VAL IN ('1', '2', '3')
                    AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                ) K
        WHERE 	A.STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
        AND 	B.STORE_CD (+) = A.STORE_CD
        AND 	B.TUKEY_GRP_CD (+) = A.TUKEY_GRP_CD
        AND 	C.STORE_CD (+) = A.STORE_CD
        AND 	C.TUKEY_GRP_CD (+) = A.TUKEY_GRP_CD
        AND 	C.TUKEY_CLASS_CD (+) = A.TUKEY_CLASS_CD
        AND 	C.TUKEY_FG (+) = '01'
        AND 	D.STORE_CD (+) = A.STORE_CD
        AND 	D.PROD_CD (+) = C.PROD_CD
        AND 	E.STORE_CD = A.STORE_CD
        AND 	F.STORE_CD = A.STORE_CD
        AND 	F.ENVST_CD = '4038'
        AND 	F.ENVST_VAL != '*'
        AND 	F.ENVST_VAL = A.TUKEY_GRP_CD
        AND 	G.STORE_CD = A.STORE_CD
        AND 	G.ENVST_CD = '1248'
        AND 	G.ENVST_VAL = '2'
        AND 	H.HQ_OFFICE_CD = #{hqOfficeCd}
        AND 	H.HQ_OFFICE_CD = I.HQ_OFFICE_CD(+)
        AND 	H.TUKEY_GRP_CD = I.NMCODE_NM(+)
        AND 	H.TUKEY_CLASS_CD = I.NMCODE_ITEM_1(+)
        AND 	'228' = I.NMCODE_GRP_CD(+)
        AND 	I.NMCODE_ITEM_2 = 'Y'
        AND 	H.TUKEY_GRP_CD = A.TUKEY_GRP_CD
        AND 	H.TUKEY_CLASS_CD = A.TUKEY_CLASS_CD
        AND 	J.STORE_CD = A.STORE_CD
        AND 	J.PROD_CD = C.PROD_CD
        AND     J.SALE_DATE = TO_CHAR(SYSDATE, 'yyyyMMdd')
        AND     K.STORE_CD = A.STORE_CD
        AND     K.POS_NO = F.POS_NO
        <if test="tukeyGrpCd != null and tukeyGrpCd !=''">
            AND A.TUKEY_GRP_CD LIKE '%'||#{tukeyGrpCd}||'%'
        </if>
        <if test="tukeyGrpNm != null and tukeyGrpNm !=''">
            AND B.TUKEY_GRP_NM LIKE '%'||#{tukeyGrpNm}||'%'
        </if>
        <if test='storeHqBrandCd != null and storeHqBrandCd != ""'>
            AND E.HQ_BRAND_CD = #{storeHqBrandCd} -- 매장브랜드 선택일때
        </if>
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND A.STORE_CD IN (${storeCdQuery})
        </if>
        ORDER BY A.STORE_CD, F.POS_NO, A.TUKEY_GRP_CD, A.PAGE_NO, A.Y, A.X, C.PAGE_NO, C.Y, C.X
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- LSM사용매장 조회 -->
    <!--
        TABLE    : TB_HQ_BRANCH_MOMS, TB_MS_STORE
        PARAM    : lsmStoreVO
        COMMENTS : LSM사용매장을 조회한다.
    -->
    <select id="getLsmStoreExcelList" parameterType="lsmStoreVO" resultType="DefaultMap">
        /* USE : LsmStoreMapper.getLsmStoreExcelList */
        SELECT  A.STORE_CD
        ,		E.STORE_NM
        <if test='downFg != null and downFg =="A"'>
            ,       E.SYS_STAT_FG
            ,       F.POS_NO
        </if>
        ,		A.TUKEY_GRP_CD
        ,		B.TUKEY_GRP_NM
        ,		A.TUKEY_CLASS_CD
        ,		A.TUKEY_CLASS_NM
        ,		C.PROD_CD
        ,		D.PROD_NM
        ,		J.SALE_UPRC
        FROM    TB_MS_TOUCH_KEY_CLASS A
        ,       TB_MS_TOUCH_KEY_GROUP B
        ,       TB_MS_TOUCH_KEY C
        ,		TB_MS_PRODUCT D
        ,		TB_MS_STORE E
        <if test='downFg != null and downFg =="S"'>
        ,       (SELECT DISTINCT F.STORE_CD, F.ENVST_VAL FROM TB_MS_POS_ENVST F WHERE F.ENVST_CD = '4038') F
        </if>
        <if test='downFg != null and downFg =="A"'>
            ,       TB_MS_POS_ENVST F
        </if>
        ,		TB_MS_STORE_ENVST G
        ,		TB_HQ_TOUCH_KEY_CLASS H
        ,		TB_HQ_NMCODE I
        ,		TB_MS_PRODUCT_SALE_PRICE_V01 J --view
        ,       (
                    SELECT
                            <if test='downFg != null and downFg =="S"'>
                                    DISTINCT STORE_CD
                            </if>
                            <if test='downFg != null and downFg =="A"'>
                                        STORE_CD
                                ,       POS_NO
                            </if>
                    FROM 	TB_MS_POS_ENVST
                    WHERE 	ENVST_CD = '4019'
                    AND 	ENVST_VAL IN ('1', '2', '3')
                    AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                ) K
        WHERE 	A.STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
        AND 	B.STORE_CD (+) = A.STORE_CD
        AND 	B.TUKEY_GRP_CD (+) = A.TUKEY_GRP_CD
        AND 	C.STORE_CD (+) = A.STORE_CD
        AND 	C.TUKEY_GRP_CD (+) = A.TUKEY_GRP_CD
        AND 	C.TUKEY_CLASS_CD (+) = A.TUKEY_CLASS_CD
        AND 	C.TUKEY_FG (+) = '01'
        AND 	D.STORE_CD (+) = A.STORE_CD
        AND 	D.PROD_CD (+) = C.PROD_CD
        AND 	E.STORE_CD = A.STORE_CD
        AND 	F.STORE_CD = A.STORE_CD
        <if test='downFg != null and downFg =="A"'>
            AND 	F.ENVST_CD = '4038'
        </if>
        AND 	F.ENVST_VAL != '*'
        AND 	F.ENVST_VAL = A.TUKEY_GRP_CD
        AND 	G.STORE_CD = A.STORE_CD
        AND 	G.ENVST_CD = '1248'
        AND 	G.ENVST_VAL = '2'
        AND 	H.HQ_OFFICE_CD = #{hqOfficeCd}
        AND 	H.HQ_OFFICE_CD = I.HQ_OFFICE_CD(+)
        AND 	H.TUKEY_GRP_CD = I.NMCODE_NM(+)
        AND 	H.TUKEY_CLASS_CD = I.NMCODE_ITEM_1(+)
        AND 	'228' = I.NMCODE_GRP_CD(+)
        AND 	I.NMCODE_ITEM_2 = 'Y'
        AND 	H.TUKEY_GRP_CD = A.TUKEY_GRP_CD
        AND 	H.TUKEY_CLASS_CD = A.TUKEY_CLASS_CD
        AND 	J.STORE_CD = A.STORE_CD
        AND 	J.PROD_CD = C.PROD_CD
        AND     J.SALE_DATE = TO_CHAR(SYSDATE, 'yyyyMMdd')
        AND     K.STORE_CD = A.STORE_CD
        <if test='downFg != null and downFg =="A"'>
            AND     K.POS_NO = F.POS_NO
        </if>
        <if test="tukeyGrpCd != null and tukeyGrpCd !=''">
            AND A.TUKEY_GRP_CD LIKE '%'||#{tukeyGrpCd}||'%'
        </if>
        <if test="tukeyGrpNm != null and tukeyGrpNm !=''">
            AND B.TUKEY_GRP_NM LIKE '%'||#{tukeyGrpNm}||'%'
        </if>
        <if test='storeHqBrandCd != null and storeHqBrandCd != ""'>
            AND E.HQ_BRAND_CD = #{storeHqBrandCd} -- 매장브랜드 선택일때
        </if>
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND A.STORE_CD IN (${storeCdQuery})
        </if>
        ORDER BY A.STORE_CD,
        <if test='downFg != null and downFg =="A"'>
            F.POS_NO,
        </if>
        A.TUKEY_GRP_CD, A.PAGE_NO, A.Y, A.X, C.PAGE_NO, C.Y, C.X
    </select>

    <!-- 키오스크 리스트 조회 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_GROUP
        PARAM    : lsmStoreVO
        COMMENTS : 키오스크 리스트를 조회한다.
    -->
    <select id="getLsmKioskStoreList" parameterType="lsmStoreVO" resultType="DefaultMap">
        /* USE : LsmStoreMapper.getLsmKioskStoreList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT 	A.STORE_CD
        ,		E.STORE_NM
        ,       E.SYS_STAT_FG
        ,		A.POS_NO
        ,		A.TU_CLS_TYPE
        ,		B.TU_CLS_TYPE_NM
        ,		A.TU_CLS_CD
        ,		A.TU_CLS_NM
        ,		C.PROD_CD
        ,		D.PROD_NM
        ,		J.SALE_UPRC
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM 	TB_MS_KIOSK_CLS A
        ,		TB_MS_KIOSK_GROUP B
        ,		TB_MS_KIOSK_KEY C
        ,		TB_MS_PRODUCT D
        ,		TB_MS_STORE	E
        ,       (SELECT DISTINCT F.STORE_CD, F.POS_NO, F.ENVST_VAL FROM TB_MS_POS_ENVST F WHERE F.ENVST_CD IN ('4068', '4069')) F
        ,		TB_MS_STORE_ENVST G
        ,		TB_HQ_KIOSK_CLS H
        ,		TB_HQ_NMCODE I
        ,		TB_MS_PRODUCT_SALE_PRICE_V01 J --view
        ,       (
                    SELECT 	STORE_CD
                    ,		POS_NO
                    FROM 	TB_MS_POS_ENVST tmpe
                    WHERE 	ENVST_CD = '4019'
                    AND 	ENVST_VAL = '6'
                    AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                ) K
        WHERE 	A.STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd} )
        AND 	A.TU_CLS_TYPE   NOT IN ('00')
        AND 	B.STORE_CD    (+)   = A.STORE_CD
        AND 	B.TU_CLS_TYPE (+)   = A.TU_CLS_TYPE
        AND 	B.POS_NO      (+)   = A.POS_NO
        AND 	C.STORE_CD    (+)   = A.STORE_CD
        AND 	C.POS_NO      (+)   = A.POS_NO
        AND 	C.TU_CLS_CD   (+)   = A.TU_CLS_CD
        AND 	C.TU_CLS_TYPE (+)   = A.TU_CLS_TYPE
        AND 	D.STORE_CD    (+)   = C.STORE_CD
        AND 	D.PROD_CD     (+)   = C.PROD_CD
        AND 	E.STORE_CD          = A.STORE_CD
        AND 	F.STORE_CD          = A.STORE_CD
        AND 	F.ENVST_VAL         = A.TU_CLS_TYPE
        AND 	F.ENVST_VAL         != '*'
        AND 	F.POS_NO            = A.POS_NO
        AND 	G.STORE_CD          = A.STORE_CD
        AND 	G.ENVST_CD          = '1249'
        AND 	G.ENVST_VAL         = '2'
        AND 	H.HQ_OFFICE_CD      = #{hqOfficeCd}
        AND 	H.TU_CLS_TYPE       = A.TU_CLS_TYPE
        AND 	H.TU_CLS_CD         = A.TU_CLS_CD
        AND 	H.TU_CLS_NM         = A.TU_CLS_NM
        AND 	H.HQ_OFFICE_CD      = I.HQ_OFFICE_CD  (+)
        AND 	H.TU_CLS_TYPE       = I.NMCODE_NM     (+)
        AND 	H.TU_CLS_CD         = I.NMCODE_ITEM_1 (+)
        AND 	'229'               = I.NMCODE_GRP_CD (+)
        AND 	I.NMCODE_ITEM_2     = 'Y'
        AND 	I.NMCODE_NM	        = A.TU_CLS_TYPE
        AND 	I.NMCODE_ITEM_1	    = A.TU_CLS_CD
        AND 	J.STORE_CD          = A.STORE_CD
        AND 	J.PROD_CD           = C.PROD_CD
        AND     J.SALE_DATE = TO_CHAR(SYSDATE, 'yyyyMMdd')
        AND     K.STORE_CD          = A.STORE_CD
        AND     K.POS_NO            = A.POS_NO
        <if test="tuClsType != null and tuClsType !=''">
            AND A.TU_CLS_TYPE LIKE '%'||#{tuClsType}||'%'
        </if>
        <if test="tuClsTypeNm != null and tuClsTypeNm !=''">
            AND B.TU_CLS_TYPE_NM LIKE '%'||#{tuClsTypeNm}||'%'
        </if>
        <if test='storeHqBrandCd != null and storeHqBrandCd != ""'>
            AND E.HQ_BRAND_CD = #{storeHqBrandCd} -- 매장브랜드 선택일때
        </if>
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND A.STORE_CD IN (${storeCdQuery})
        </if>
        ORDER
        BY 		A.STORE_CD, F.POS_NO, A.TU_CLS_TYPE, A.TU_PAGE, A.Y, A.X, C.TU_PAGE, C.Y, C.X
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 키오스크 엑셀 조회 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_GROUP
        PARAM    : lsmStoreVO
        COMMENTS : 키오스크 엑셀리스트를 조회한다.
    -->
    <select id="getLsmKioskStoreExcelList" parameterType="lsmStoreVO" resultType="DefaultMap">
        /* USE : LsmStoreMapper.getLsmKioskStoreExcelList */
        SELECT 	A.STORE_CD
        ,		E.STORE_NM
        ,       E.SYS_STAT_FG
        ,		A.POS_NO
        ,		A.TU_CLS_TYPE
        ,		B.TU_CLS_TYPE_NM
        ,		A.TU_CLS_CD
        ,		A.TU_CLS_NM
        ,		C.PROD_CD
        ,		D.PROD_NM
        ,		J.SALE_UPRC
        FROM 	TB_MS_KIOSK_CLS A
        ,		TB_MS_KIOSK_GROUP B
        ,		TB_MS_KIOSK_KEY C
        ,		TB_MS_PRODUCT D
        ,		TB_MS_STORE	E
        ,       (SELECT DISTINCT F.STORE_CD, F.POS_NO, F.ENVST_VAL FROM TB_MS_POS_ENVST F WHERE F.ENVST_CD IN ('4068', '4069')) F
        ,		TB_MS_STORE_ENVST G
        ,		TB_HQ_KIOSK_CLS H
        ,		TB_HQ_NMCODE I
        ,		TB_MS_PRODUCT_SALE_PRICE_V01 J --view
        ,       (
                    SELECT 	STORE_CD
                    ,		POS_NO
                    FROM 	TB_MS_POS_ENVST tmpe
                    WHERE 	ENVST_CD = '4019'
                    AND 	ENVST_VAL = '6'
                    AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                ) K
        WHERE 	A.STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd} )
        AND 	A.TU_CLS_TYPE   NOT IN ('00')
        AND 	B.STORE_CD    (+)   = A.STORE_CD
        AND 	B.TU_CLS_TYPE (+)   = A.TU_CLS_TYPE
        AND 	B.POS_NO      (+)   = A.POS_NO
        AND 	C.STORE_CD    (+)   = A.STORE_CD
        AND 	C.POS_NO      (+)   = A.POS_NO
        AND 	C.TU_CLS_CD   (+)   = A.TU_CLS_CD
        AND 	C.TU_CLS_TYPE (+)   = A.TU_CLS_TYPE
        AND 	D.STORE_CD    (+)   = C.STORE_CD
        AND 	D.PROD_CD     (+)   = C.PROD_CD
        AND 	E.STORE_CD          = A.STORE_CD
        AND 	F.STORE_CD          = A.STORE_CD
        AND 	F.ENVST_VAL         = A.TU_CLS_TYPE
        AND 	F.ENVST_VAL         != '*'
        AND 	F.POS_NO            = A.POS_NO
        AND 	G.STORE_CD          = A.STORE_CD
        AND 	G.ENVST_CD          = '1249'
        AND 	G.ENVST_VAL         = '2'
        AND 	H.HQ_OFFICE_CD      = #{hqOfficeCd}
        AND 	H.TU_CLS_TYPE       = A.TU_CLS_TYPE
        AND 	H.TU_CLS_CD         = A.TU_CLS_CD
        AND 	H.TU_CLS_NM         = A.TU_CLS_NM
        AND 	H.HQ_OFFICE_CD      = I.HQ_OFFICE_CD  (+)
        AND 	H.TU_CLS_TYPE       = I.NMCODE_NM     (+)
        AND 	H.TU_CLS_CD         = I.NMCODE_ITEM_1 (+)
        AND 	'229'               = I.NMCODE_GRP_CD (+)
        AND 	I.NMCODE_ITEM_2     = 'Y'
        AND 	I.NMCODE_NM	        = A.TU_CLS_TYPE
        AND 	I.NMCODE_ITEM_1	    = A.TU_CLS_CD
        AND 	J.STORE_CD          = A.STORE_CD
        AND 	J.PROD_CD           = C.PROD_CD
        AND     J.SALE_DATE = TO_CHAR(SYSDATE, 'yyyyMMdd')
        AND     K.STORE_CD          = A.STORE_CD
        AND     K.POS_NO            = A.POS_NO
        <if test="tuClsType != null and tuClsType !=''">
            AND A.TU_CLS_TYPE LIKE '%'||#{tuClsType}||'%'
        </if>
        <if test="tuClsTypeNm != null and tuClsTypeNm !=''">
            AND B.TU_CLS_TYPE_NM LIKE '%'||#{tuClsTypeNm}||'%'
        </if>
        <if test='storeHqBrandCd != null and storeHqBrandCd != ""'>
            AND E.HQ_BRAND_CD = #{storeHqBrandCd} -- 매장브랜드 선택일때
        </if>
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND A.STORE_CD IN (${storeCdQuery})
        </if>
        ORDER
        BY 		A.STORE_CD, F.POS_NO, A.TU_CLS_TYPE, A.TU_PAGE, A.Y, A.X, C.TU_PAGE, C.Y, C.X
    </select>

    <!-- 키오스크 탭 엑셀 업로드 - 임시 저장 테이블 삭제 -->
    <!--
        TABLE    : TB_TMP_LSM_STORE_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : KIOSK키맵 임시 데이터 삭제
    -->
    <delete id="getKioskKeyTempDeleteAll" parameterType="lsmStoreVO">
        /* USE : LsmStoreMapper.getKioskKeyTempDeleteAll */
            DELETE  TB_TMP_LSM_STORE_MS_KIOSK_KEY
            WHERE   SESSION_ID = #{sessionId}
    </delete>

    <!-- 상품코드 유효여부 체크 -->
    <!--
        TABLE    : TB_MS_PRODUCT
        PARAM    : lsmStoreVO
        COMMENTS : 상품코드 유효여부 체크
    -->
    <select id="getChkProdCd" parameterType="lsmStoreVO" resultType="Integer">
        /* USE : LsmStoreMapper.getChkProdCd */
        SELECT 	count(*)
        FROM	TB_MS_PRODUCT
        WHERE 	STORE_CD = #{storeCd}
        AND 	PROD_CD  = #{prodCd}
    </select>

    <!-- 키오스크 탭 엑셀 업로드 - 데이터 임시 저장 -->
    <!--
        TABLE    :  TB_TMP_LSM_STORE_MS_KIOSK_KEY
        PARAM    :  lsmStoreVO
        COMMENTS :  KIOSK키맵 임시 데이터 등록
    -->
    <insert id="getKioskKeyTempInsertAll" parameterType="lsmStoreVO" >
        /* LsmStoreMapper.getKioskKeyTempInsertAll */
        INSERT INTO TB_TMP_LSM_STORE_MS_KIOSK_KEY
        (
            SESSION_ID
        ,   STORE_CD
        ,   POS_NO
        ,   TU_CLS_TYPE
        ,   TU_CLS_CD
        ,   TU_KEY_CD
        ,   PROD_CD
        ,   TU_PAGE
        ,   X
        ,   Y
        ,   WIDTH
        ,   HEIGHT
        ,   INDEX_NO
        ,   CLS_FG
        ,   REG_DT
        ,   REG_ID
        ,   MOD_DT
        ,   MOD_ID
        )
        SELECT  #{sessionId}
        ,       STORE_CD
        ,       #{posNo}
        ,       #{tuClsType}
        ,       #{tuClsCd}
        ,       null
        ,       DECODE(#{prodCd}, NULL, 'DEL', #{prodCd})
        ,       #{tuPage}
        ,       null
        ,       null
        ,       null
        ,       null
        ,       #{indexNo}
        ,       #{clsFg}
        ,       #{regDt}
        ,       #{regId}
        ,       #{modDt}
        ,       #{modId}
        FROM    TB_MS_PRODUCT
        WHERE 	STORE_CD = #{storeCd}
        AND 	PROD_CD  = DECODE(#{prodCd}, NULL, '0ADLVFEE0000', #{prodCd})
    </insert>

    <!-- 키오스크 탭 엑셀 업로드 - 키맵 관련 코드 조회 -->
    <!--
        TABLE    : TB_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 키를 등록하기 위한 코드값 조회한다. ( 본사/매장 )
    -->
    <select id="getKioskKeyMapCode" parameterType="lsmStoreVO" resultType="DefaultMap">
        /* USE : LsmStoreMapper.getKioskKeyMapCode */
            SELECT  LPAD(NVL(MAX(A.TU_KEY_CD),0)+1, 3, 0) AS TU_KEY_CD,
                    NVL(MAX(A.INDEX_NO),0)+1 AS INDEX_NO
            FROM    TB_TMP_LSM_STORE_MS_KIOSK_KEY A
            ,       TB_MS_PRODUCT B
            WHERE   A.STORE_CD      = #{storeCd}
            AND     A.POS_NO        = #{posNo}
            AND     A.TU_CLS_TYPE   = #{tuClsType}
            AND     A.TU_CLS_CD     = #{tuClsCd}
            AND     A.SESSION_ID    = #{sessionId}
            AND     B.STORE_CD      = A.STORE_CD
            AND     B.PROD_CD       = A.PROD_CD
    </select>

    <!-- 키오스크 탭 엑셀 업로드 - 키오스크키맵 삭제 -->
    <!--
        TABLE    : TB_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 키오스크키맵 삭제
    -->
    <delete id="getDeleteKioskKey" parameterType="lsmStoreVO">
        /* USE : LsmStoreMapper.getDeleteKioskKey */
        DELETE
        FROM    TB_MS_KIOSK_KEY A
        WHERE   (
                    STORE_CD
                ,	POS_NO
                ,	TU_CLS_CD
                ,	TU_CLS_TYPE
                )   IN  (
                            SELECT 	DISTINCT A.STORE_CD
                             ,		A.POS_NO
                             ,		A.TU_CLS_CD
                             ,		A.TU_CLS_TYPE
                            FROM 	TB_TMP_LSM_STORE_MS_KIOSK_KEY A
                            ,		(
                                        SELECT 	NMCODE_NM
                                        ,		NMCODE_ITEM_1
                                        ,		NMCODE_ITEM_2
                                        FROM 	TB_HQ_NMCODE
                                        WHERE 	NMCODE_GRP_CD 	= '229'
                                        AND 	NMCODE_ITEM_2 	= 'Y'
                                        AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                                    ) B
                            ,		(
                                        SELECT 	STORE_CD
                                        ,		POS_NO
                                        FROM 	TB_MS_POS_ENVST tmpe
                                        WHERE 	ENVST_CD = '4019'
                                        AND 	ENVST_VAL = '6'
                                        AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                                    ) C
                            WHERE 	A.SESSION_ID 	= #{sessionId}
                            AND     B.NMCODE_NM     = A.TU_CLS_TYPE
                            AND 	B.NMCODE_ITEM_1 = A.TU_CLS_CD
                            AND 	C.STORE_CD		= A.STORE_CD
                            AND 	C.POS_NO		= A.POS_NO
                        )
    </delete>

    <!-- 키오스크 탭 엑셀 업로드 - 데이터 중 LSM 사용인 데이터 수 조회 -->
    <!--
        TABLE    : TB_TMP_LSM_STORE_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 데이터 중 LSM 사용인 데이터 수 조회
    -->
    <select id="getKioskKeyCnt" parameterType="lsmStoreVO" resultType="Integer">
        /* USE : LsmStoreMapper.getKioskKeyCnt */
        SELECT 	count(*)
        FROM 	TB_TMP_LSM_STORE_MS_KIOSK_KEY A
        ,		(
                    SELECT 	NMCODE_NM
                    ,		NMCODE_ITEM_1
                    ,		NMCODE_ITEM_2
                    FROM 	TB_HQ_NMCODE
                    WHERE 	NMCODE_GRP_CD 	= '229'
                    AND 	NMCODE_ITEM_2 	= 'Y'
                    AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                ) B
        ,		TB_MS_POS C
        WHERE 	A.SESSION_ID 	= #{sessionId}
        AND     B.NMCODE_NM     = A.TU_CLS_TYPE
        AND 	B.NMCODE_ITEM_1 = A.TU_CLS_CD
        AND 	C.STORE_CD		= A.STORE_CD
        AND 	C.POS_NO		= A.POS_NO
    </select>

    <!-- 키오스크 탭 엑셀 업로드 - 데이터 저장 -->
    <!--
        TABLE    : TB_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 데이터 저장
    -->
    <insert id="getInsertKioskKey" parameterType="lsmStoreVO">
        /* USE : LsmStoreMapper.getInsertKioskKey */
        MERGE INTO TB_MS_KIOSK_KEY A
        USING
            (
                SELECT 	A.STORE_CD
                ,		A.POS_NO
                ,		A.TU_CLS_CD
                ,		LPAD(NVL(A.INDEX_NO ,0), 3, 0) AS TU_KEY_CD
                ,		A.PROD_CD
                ,		A.TU_PAGE
                ,		A.X
                ,		A.Y
                ,		A.WIDTH
                ,		A.HEIGHT
                ,		A.INDEX_NO
                ,		A.CLS_FG
                ,		#{regDt}        AS REG_DT
                ,		#{regId}        AS REG_ID
                ,		#{modDt}        AS MOD_DT
                ,		#{modId}        AS MOD_ID
                ,		A.TU_CLS_TYPE
                FROM 	TB_TMP_LSM_STORE_MS_KIOSK_KEY A
                ,		(
                            SELECT 	NMCODE_NM
                            ,		NMCODE_ITEM_1
                            ,		NMCODE_ITEM_2
                            FROM 	TB_HQ_NMCODE
                            WHERE 	NMCODE_GRP_CD 	= '229'
                            AND 	NMCODE_ITEM_2 	= 'Y'
                            AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                        ) B
                ,		(
                            SELECT 	STORE_CD
                            ,		POS_NO
                            FROM 	TB_MS_POS_ENVST tmpe
                            WHERE 	ENVST_CD = '4019'
                            AND 	ENVST_VAL = '6'
                            AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                        ) C
                ,       TB_MS_STORE D
                ,       TB_MS_PRODUCT E
                WHERE 	A.SESSION_ID	= #{sessionId}
                <![CDATA[
                    AND     A.PROD_CD    <> 'DEL'
                ]]>
                AND     B.NMCODE_NM     = A.TU_CLS_TYPE
                AND 	B.NMCODE_ITEM_1 = A.TU_CLS_CD
                AND 	C.STORE_CD		= A.STORE_CD
                AND 	C.POS_NO		= A.POS_NO
                AND     D.HQ_OFFICE_CD  = #{hqOfficeCd}
                AND     D.STORE_CD      = A.STORE_CD
                AND		E.STORE_CD		= A.STORE_CD
                AND 	E.PROD_CD		= A.PROD_CD
            ) B
        ON
            (
                    A.STORE_CD 		= B.STORE_CD
                AND A.POS_NO 		= B.POS_NO
                AND A.TU_CLS_CD 	= B.TU_CLS_CD
                AND A.TU_CLS_TYPE 	= B.TU_CLS_TYPE
            )
        WHEN NOT MATCHED THEN
        INSERT
                (
                    STORE_CD
                ,	POS_NO
                ,	TU_CLS_CD
                ,	TU_KEY_CD
                ,	PROD_CD
                ,	TU_PAGE
                ,	X
                ,	Y
                ,	WIDTH
                ,	HEIGHT
                ,	INDEX_NO
                ,	CLS_FG
                ,	REG_DT
                ,	REG_ID
                ,	MOD_DT
                ,	MOD_ID
                ,	TU_CLS_TYPE
                )
        VALUES
                (
                    B.STORE_CD
                ,	B.POS_NO
                ,	B.TU_CLS_CD
                ,	B.TU_KEY_CD
                ,	B.PROD_CD
                ,	B.TU_PAGE
                ,	B.X
                ,	B.Y
                ,	B.WIDTH
                ,	B.HEIGHT
                ,	B.INDEX_NO
                ,	B.CLS_FG
                ,	B.REG_DT
                ,	B.REG_ID
                ,	B.MOD_DT
                ,	B.MOD_ID
                ,	B.TU_CLS_TYPE
                )
    </insert>

    <!-- 판매터치키 임시테이블 삭제 -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY
        PARAM    : storeEnvVO
        COMMENTS : 판매터치키 임시테이블 정보를 삭제한다.
    -->
    <delete id="getTukeyTempDeleteAll" parameterType="lsmStoreVo">
        /* USE : LsmStoreMapper.getTukeyTempDeleteAll */
        DELETE
        FROM    TB_TMP_TOUCH_KEY
        WHERE   1=1
        AND     SESSION_ID = #{sessionId}
    </delete>

    <!-- 터치키 탭 엑셀 업로드 - 데이터 임시 저장(01: 셀 사이즈) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 데이터 임시 저장
    -->
    <insert id="getTukeyTempInsert01" parameterType="lsmStoreVO">
        /* LsmStoreMapper.getTukeyTempInsert01 */
        INSERT INTO TB_TMP_TOUCH_KEY
        (
            SESSION_ID
        ,   SEQ
        ,   HQ_OFFICE_CD
        ,   STORE_CD
        ,   TUKEY_CLASS_CD
        ,   TUKEY_CD
        ,   TUKEY_FG
        ,   PROD_CD
        ,   PAGE_NO
        ,   X
        ,   Y
        ,   WIDTH
        ,   HEIGHT
        ,   STYLE_CD
        ,   FONT_SIZE
        ,   FONT_COLOR
        ,   FILL_COLOR
        ,   IMG_NM
        ,   IN_FG
        ,   REG_DT
        ,   REG_ID
        ,   MOD_DT
        ,   MOD_ID
        ,   TUKEY_GRP_CD
        )
        SELECT  #{sessionId}
        ,       (SELECT NVL(MAX(SEQ),0) +1 FROM TB_TMP_TOUCH_KEY WHERE SESSION_ID = #{sessionId})
        ,       #{hqOfficeCd}
        ,       STORE_CD
        ,       #{tukeyClassCd}
        ,       (
                    SELECT  LPAD(NVL(MAX(A.TUKEY_CD),0)+1, 3,'0')
                    FROM    TB_TMP_TOUCH_KEY A
                    ,		TB_MS_PRODUCT B
                    WHERE   A.SESSION_ID        = #{sessionId}
                    AND     A.TUKEY_FG          = '01'
                    AND     A.TUKEY_CLASS_CD    = #{tukeyClassCd}
                    AND     A.TUKEY_GRP_CD      = #{tukeyGrpCd}
                    AND     A.STORE_CD          = #{storeCd}
                    AND  	B.STORE_CD 		    = A.STORE_CD
                    AND 	B.PROD_CD 		    = A.PROD_CD
                )
        ,       '01'
        ,       DECODE(#{prodCd}, NULL, 'DEL', #{prodCd})
        ,       #{pageNo}
        ,       #{x}
        ,       #{y}
        ,       #{width}
        ,       #{height}
        ,       #{styleCd}
        ,       #{fontSize}
        ,       #{fontColor}
        ,       #{fillColor}
        ,       #{imgNm}
        ,       #{inFg}
        ,       #{regDt}
        ,       #{regId}
        ,       #{modDt}
        ,       #{modId}
        ,       #{tukeyGrpCd}
        FROM    TB_MS_PRODUCT
        WHERE 	STORE_CD = #{storeCd}
        AND 	PROD_CD  = DECODE(#{prodCd}, NULL, '0ADLVFEE0000', #{prodCd})
    </insert>

    <!-- 터치키 탭 엑셀 업로드 - 데이터 임시 저장(02: 상품명) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 데이터 임시 저장
    -->
    <insert id="getTukeyTempInsert02" parameterType="lsmStoreVO">
        /* LsmStoreMapper.getTukeyTempInsert02 */
        INSERT INTO TB_TMP_TOUCH_KEY
        (
            SESSION_ID
        ,   SEQ
        ,   HQ_OFFICE_CD
        ,   STORE_CD
        ,   TUKEY_CLASS_CD
        ,   TUKEY_CD
        ,   TUKEY_FG
        ,   PROD_CD
        ,   PAGE_NO
        ,   X
        ,   Y
        ,   WIDTH
        ,   HEIGHT
        ,   STYLE_CD
        ,   FONT_SIZE
        ,   FONT_COLOR
        ,   FILL_COLOR
        ,   IMG_NM
        ,   IN_FG
        ,   REG_DT
        ,   REG_ID
        ,   MOD_DT
        ,   MOD_ID
        ,   TUKEY_GRP_CD
        )
        SELECT  #{sessionId}
        ,       (SELECT NVL(MAX(SEQ),0) +1 FROM TB_TMP_TOUCH_KEY WHERE SESSION_ID = #{sessionId})
        ,       #{hqOfficeCd}
        ,       STORE_CD
        ,       #{tukeyClassCd}
        ,       (
                    SELECT  LPAD(NVL(MAX(A.TUKEY_CD),0)+1, 3,'0')
                    FROM    TB_TMP_TOUCH_KEY A
                    ,		TB_MS_PRODUCT B
                    WHERE   A.SESSION_ID        = #{sessionId}
                    AND     A.TUKEY_FG          = '02'
                    AND     A.TUKEY_CLASS_CD    = #{tukeyClassCd}
                    AND     A.TUKEY_GRP_CD      = #{tukeyGrpCd}
                    AND     A.STORE_CD          = #{storeCd}
                    AND  	B.STORE_CD 		    = A.STORE_CD
                    AND 	B.PROD_CD 		    = A.PROD_CD
                )
        ,       '02'
        ,       DECODE(#{prodCd}, NULL, 'DEL', #{prodCd})
        ,       #{pageNo}
        ,       #{x}
        ,       #{y}
        ,       #{width}
        ,       #{height}
        ,       #{styleCd}
        ,       #{fontSize}
        ,       #{fontColor}
        ,       #{fillColor}
        ,       #{imgNm}
        ,       #{inFg}
        ,       #{regDt}
        ,       #{regId}
        ,       #{modDt}
        ,       #{modId}
        ,       #{tukeyGrpCd}
        FROM    TB_MS_PRODUCT
        WHERE 	STORE_CD = #{storeCd}
        AND 	PROD_CD  = DECODE(#{prodCd}, NULL, '0ADLVFEE0000', #{prodCd})
    </insert>

    <!-- 터치키 탭 엑셀 업로드 - 데이터 임시 저장(03: 가격) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 데이터 임시 저장
    -->
    <insert id="getTukeyTempInsert03" parameterType="lsmStoreVO">
        /* LsmStoreMapper.getTukeyTempInsert03 */
        INSERT INTO TB_TMP_TOUCH_KEY
        (
            SESSION_ID
        ,   SEQ
        ,   HQ_OFFICE_CD
        ,   STORE_CD
        ,   TUKEY_CLASS_CD
        ,   TUKEY_CD
        ,   TUKEY_FG
        ,   PROD_CD
        ,   PAGE_NO
        ,   X
        ,   Y
        ,   WIDTH
        ,   HEIGHT
        ,   STYLE_CD
        ,   FONT_SIZE
        ,   FONT_COLOR
        ,   FILL_COLOR
        ,   IMG_NM
        ,   IN_FG
        ,   REG_DT
        ,   REG_ID
        ,   MOD_DT
        ,   MOD_ID
        ,   TUKEY_GRP_CD
        )
        SELECT  #{sessionId}
        ,       (SELECT NVL(MAX(SEQ),0) +1 FROM TB_TMP_TOUCH_KEY WHERE SESSION_ID = #{sessionId})
        ,       #{hqOfficeCd}
        ,       STORE_CD
        ,       #{tukeyClassCd}
        ,       (
                    SELECT  LPAD(NVL(MAX(A.TUKEY_CD),0)+1, 3,'0')
                    FROM    TB_TMP_TOUCH_KEY A
                    ,		TB_MS_PRODUCT B
                    WHERE   A.SESSION_ID        = #{sessionId}
                    AND     A.TUKEY_FG          = '03'
                    AND     A.TUKEY_CLASS_CD    = #{tukeyClassCd}
                    AND     A.TUKEY_GRP_CD      = #{tukeyGrpCd}
                    AND     A.STORE_CD          = #{storeCd}
                    AND  	B.STORE_CD 		    = A.STORE_CD
                    AND 	B.PROD_CD 		    = A.PROD_CD
                )
        ,       '03'
        ,       DECODE(#{prodCd}, NULL, 'DEL', #{prodCd})
        ,       #{pageNo}
        ,       #{x}
        ,       #{y}
        ,       #{width}
        ,       #{height}
        ,       #{styleCd}
        ,       #{fontSize}
        ,       #{fontColor}
        ,       #{fillColor}
        ,       #{imgNm}
        ,       #{inFg}
        ,       #{regDt}
        ,       #{regId}
        ,       #{modDt}
        ,       #{modId}
        ,       #{tukeyGrpCd}
        FROM    TB_MS_PRODUCT
        WHERE 	STORE_CD = #{storeCd}
        AND 	PROD_CD  = DECODE(#{prodCd}, NULL, '0ADLVFEE0000', #{prodCd})
    </insert>

    <!-- 터치키 탭 엑셀 업로드 - 터치키 삭제 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 터치키 삭제
    -->
    <delete id="getDeleteTukey" parameterType="lsmStoreVO">
        /* USE : LsmStoreMapper.getDeleteTukey */
        DELETE
        FROM    TB_MS_TOUCH_KEY A
        WHERE   (
                        STORE_CD
                    ,	TUKEY_CLASS_CD
                    ,	TUKEY_GRP_CD
                )   IN  (
                            SELECT 	DISTINCT A.STORE_CD
                            ,		A.TUKEY_CLASS_CD
                            ,		A.TUKEY_GRP_CD
                            FROM 	TB_TMP_TOUCH_KEY A
                            ,		(
                                        SELECT 	NMCODE_NM
                                        ,		NMCODE_ITEM_1
                                        ,		NMCODE_ITEM_2
                                        FROM 	TB_HQ_NMCODE
                                        WHERE 	NMCODE_GRP_CD 	= '228'
                                        AND 	NMCODE_ITEM_2 	= 'Y'
                                        AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                                    ) B
                            WHERE 	A.SESSION_ID 	= #{sessionId}
                            AND     B.NMCODE_NM     = A.TUKEY_GRP_CD
                            AND 	B.NMCODE_ITEM_1 = A.TUKEY_CLASS_CD
                )
    </delete>


    <!-- 터치키 탭 엑셀 업로드 - 데이터 중 LSM 사용인 데이터 수 조회 -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 터치키 삭제
    -->
    <select id="getTukeyCnt" parameterType="lsmStoreVO" resultType="Integer">
        /* USE : LsmStoreMapper.getTukeyCnt */
        SELECT 	count(*)
        FROM 	TB_TMP_TOUCH_KEY A
        ,		(
                    SELECT 	NMCODE_NM
                    ,		NMCODE_ITEM_1
                    ,		NMCODE_ITEM_2
                    FROM 	TB_HQ_NMCODE
                    WHERE 	NMCODE_GRP_CD 	= '228'
                    AND 	NMCODE_ITEM_2 	= 'Y'
                    AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                ) B
        WHERE 	A.SESSION_ID 	= #{sessionId}
        AND     B.NMCODE_NM    	= A.TUKEY_GRP_CD
        AND 	B.NMCODE_ITEM_1 = A.TUKEY_CLASS_CD
    </select>

    <!-- 터치키 탭 엑셀 업로드 - 매장코드 조회 -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 매장코드 조회
    -->
    <select id="getSrchStoreCd" parameterType="lsmStoreVO" resultType="DefaultMap">
        /* LsmStoreMapper.getSrchStoreCd */
        SELECT  DISTINCT A.STORE_CD
        FROM    TB_TMP_TOUCH_KEY A
        ,		(
                    SELECT 	NMCODE_NM
                    ,		NMCODE_ITEM_1
                    ,		NMCODE_ITEM_2
                    FROM 	TB_HQ_NMCODE
                    WHERE 	NMCODE_GRP_CD 	= '228'
                    AND 	NMCODE_ITEM_2 	= 'Y'
                    AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                ) B
        WHERE   SESSION_ID  = #{sessionId}
    </select>

    <!-- 터치키 탭 엑셀 업로드 - 저장(01: 셀 사이즈) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 터치키 저장
    -->
    <insert id="getTukeyInsert01" parameterType="lsmStoreVO">
        /* LsmStoreMapper.getTukeyInsert01 */
        INSERT INTO TB_MS_TOUCH_KEY
        (
            STORE_CD
        ,   TUKEY_CLASS_CD
        ,   TUKEY_CD
        ,   TUKEY_FG
        ,   PROD_CD
        ,   PAGE_NO
        ,   X
        ,   Y
        ,   WIDTH
        ,   HEIGHT
        ,   STYLE_CD
        ,   FONT_SIZE
        ,   FONT_COLOR
        ,   FILL_COLOR
        ,   IMG_NM
        ,   IN_FG
        ,   REG_DT
        ,   REG_ID
        ,   MOD_DT
        ,   MOD_ID
        ,   TUKEY_GRP_CD
        )
        SELECT  tmtk.STORE_CD
        ,       tmtk.TUKEY_CLASS_CD
        ,       tmtk.TUKEY_CD
        ,       tmtk.TUKEY_FG
        ,       tmtk.PROD_CD
        ,       tmtk.PAGE_NO
        ,       tmtk.X
        ,       tmtk.Y
        ,       tmtk.WIDTH
        ,       tmtk.HEIGHT
        ,       tmtk.STYLE_CD
        ,       tmtk.FONT_SIZE
        ,       tmtk.FONT_COLOR
        ,       tmtk.FILL_COLOR
        ,       tmtk.IMG_NM
        ,       tmtk.IN_FG
        ,       #{regDt} AS REG_DT
        ,       #{regId} AS REG_ID
        ,       #{modDt} AS MOD_DT
        ,       #{modId} AS MOD_ID
        ,       tmtk.TUKEY_GRP_CD
        FROM
            (
                SELECT  tttk.GRP_ID
                ,       tttk.STORE_CD
                ,       tttk.TUKEY_CLASS_CD
                ,       tttk.TUKEY_CD
                ,       tttk.TUKEY_FG
                ,       tttk.PROD_CD
                ,       FLOOR((tttk.GRP_ID-1) / (5*(8-tttk.ENVST_VAL)-1))+1 AS PAGE_NO
                ,       MOD(MOD(tttk.GRP_ID-1,5*(8-tttk.ENVST_VAL)-1),5) * 100 AS X
                ,       (FLOOR(MOD(tttk.GRP_ID-1,5*(8-tttk.ENVST_VAL)-1)/5)) * 75 AS Y
                ,       '99' AS WIDTH
                ,       '74' AS HEIGHT
                ,       tttk.STYLE_CD
                ,       tttk.FONT_SIZE
                ,       tttk.FONT_COLOR
                ,       tttk.FILL_COLOR
                ,       tttk.IMG_NM
                ,       tttk.IN_FG
                ,       tttk.TUKEY_GRP_CD
                FROM
                    (
                        SELECT	A.*
                        ,       B.ENVST_VAL
                        FROM
                            (
                                SELECT  RANK() OVER(PARTITION BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.STORE_CD ORDER BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD) AS GRP_ID
		                        ,       tttk.*
                                FROM    TB_TMP_TOUCH_KEY tttk
                                ,		(
                                            SELECT 	NMCODE_NM
                                            ,		NMCODE_ITEM_1
                                            ,		NMCODE_ITEM_2
                                            FROM 	TB_HQ_NMCODE
                                            WHERE 	NMCODE_GRP_CD 	= '228'
                                            AND 	NMCODE_ITEM_2 	= 'Y'
                                            AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                                        ) B
                                ,       TB_MS_STORE C
                                WHERE 	tttk.SESSION_ID	= #{sessionId}
                                AND 	B.NMCODE_NM		= tttk.TUKEY_GRP_CD
                                AND 	B.NMCODE_ITEM_1	= tttk.TUKEY_CLASS_CD
                                AND     tttk.TUKEY_FG   = '01'
                                <![CDATA[
                                    AND     tttk.PROD_CD    <> 'DEL'
                                ]]>
                                AND     C.HQ_OFFICE_CD  = #{hqOfficeCd}
                                AND     C.STORE_CD      = tttk.STORE_CD
                                ORDER
                                BY      tttk.TUKEY_GRP_CD
                                ,       tttk.TUKEY_CLASS_CD
                                ,       tttk.TUKEY_CD
                            ) A
                        ,	(
                                SELECT 	B.ENVST_VAL
                                ,       B.STORE_CD
                                FROM 	TB_MS_STORE_ENVST B
                                WHERE 	B.ENVST_CD = '1041'
                            ) B
                        WHERE 	A.STORE_CD = B.STORE_CD
                    ) tttk
            ) tmtk
        WHERE   6 > tmtk.PAGE_NO
    </insert>

    <!-- 터치키 탭 엑셀 업로드 - 저장(02: 상품명) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 터치키 저장
    -->
    <insert id="getTukeyInsert02" parameterType="lsmStoreVO">
        /* LsmStoreMapper.getTukeyInsert02 */
        INSERT INTO TB_MS_TOUCH_KEY
        (
            STORE_CD
        ,   TUKEY_CLASS_CD
        ,   TUKEY_CD
        ,   TUKEY_FG
        ,   PROD_CD
        ,   PAGE_NO
        ,   X
        ,   Y
        ,   WIDTH
        ,   HEIGHT
        ,   STYLE_CD
        ,   FONT_SIZE
        ,   FONT_COLOR
        ,   FILL_COLOR
        ,   IMG_NM
        ,   IN_FG
        ,   REG_DT
        ,   REG_ID
        ,   MOD_DT
        ,   MOD_ID
        ,   TUKEY_GRP_CD
        )
        SELECT  tmtk.STORE_CD
        ,       tmtk.TUKEY_CLASS_CD
        ,       tmtk.TUKEY_CD
        ,       tmtk.TUKEY_FG
        ,       tmtk.PROD_CD
        ,       tmtk.PAGE_NO
        ,       tmtk.X
        ,       tmtk.Y
        ,       tmtk.WIDTH
        ,       tmtk.HEIGHT
        ,       tmtk.STYLE_CD
        ,       tmtk.FONT_SIZE
        ,       tmtk.FONT_COLOR
        ,       tmtk.FILL_COLOR
        ,       tmtk.IMG_NM
        ,       tmtk.IN_FG
        ,       #{regDt} AS REG_DT
        ,       #{regId} AS REG_ID
        ,       #{modDt} AS MOD_DT
        ,       #{modId} AS MOD_ID
        ,       tmtk.TUKEY_GRP_CD
        FROM
            (
                SELECT  tttk.GRP_ID
                ,       tttk.STORE_CD
                ,       tttk.TUKEY_CLASS_CD
                ,       tttk.TUKEY_CD
                ,       tttk.TUKEY_FG
                ,       tttk.PROD_CD
                ,       FLOOR((tttk.GRP_ID-1) / (5*(8-tttk.ENVST_VAL)-1))+1 AS PAGE_NO
                ,       '5' AS X
                ,       '5' AS Y
                ,       '89' AS WIDTH
                ,       '64' AS HEIGHT
                ,       tttk.STYLE_CD
                ,       tttk.FONT_SIZE
                ,       tttk.FONT_COLOR
                ,       tttk.FILL_COLOR
                ,       tttk.IMG_NM
                ,       tttk.IN_FG
                ,       tttk.TUKEY_GRP_CD
                FROM
                    (
                        SELECT 	A.*
                        ,		B.ENVST_VAL
                        FROM
                            (
                                SELECT  RANK() OVER(PARTITION BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.STORE_CD ORDER BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD) AS GRP_ID
		                        ,       tttk.*
                                FROM    TB_TMP_TOUCH_KEY tttk
                                ,		(
                                            SELECT  NMCODE_NM
                                            ,		NMCODE_ITEM_1
                                            ,		NMCODE_ITEM_2
                                            FROM 	TB_HQ_NMCODE
                                            WHERE 	NMCODE_GRP_CD 	= '228'
                                            AND 	NMCODE_ITEM_2 	= 'Y'
                                            AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                                        ) B
                                ,       TB_MS_STORE C
                                WHERE 	tttk.SESSION_ID	= #{sessionId}
                                AND 	B.NMCODE_NM		= tttk.TUKEY_GRP_CD
                                AND 	B.NMCODE_ITEM_1	= tttk.TUKEY_CLASS_CD
                                AND     tttk.TUKEY_FG   = '02'
                                <![CDATA[
                                    AND     tttk.PROD_CD    <> 'DEL'
                                ]]>
                                AND     C.HQ_OFFICE_CD  = #{hqOfficeCd}
                                AND     C.STORE_CD      = tttk.STORE_CD
                                ORDER
                                BY      tttk.TUKEY_GRP_CD
                                ,       tttk.TUKEY_CLASS_CD
                                ,       tttk.TUKEY_CD
                            ) A
                        ,	(
                                SELECT 	B.ENVST_VAL
                                , 		B.STORE_CD
                                FROM 	TB_MS_STORE_ENVST B
                                WHERE 	B.ENVST_CD = '1041'
                            ) B
                        WHERE 	A.STORE_CD = B.STORE_CD
                    ) tttk
             ) tmtk
        WHERE   6 > tmtk.PAGE_NO
    </insert>

    <!-- 매장 판매터치키 재정렬 (03: 가격) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 터치키 저장
    -->
    <insert id="getTukeyInsert03" parameterType="lsmStoreVO">
        /* LsmStoreMapper.getTukeyInsert03 */
        INSERT INTO TB_MS_TOUCH_KEY
        (
            STORE_CD
        ,   TUKEY_CLASS_CD
        ,   TUKEY_CD
        ,   TUKEY_FG
        ,   PROD_CD
        ,   PAGE_NO
        ,   X
        ,   Y
        ,   WIDTH
        ,   HEIGHT
        ,   STYLE_CD
        ,   FONT_SIZE
        ,   FONT_COLOR
        ,   FILL_COLOR
        ,   IMG_NM
        ,   IN_FG
        ,   REG_DT
        ,   REG_ID
        ,   MOD_DT
        ,   MOD_ID
        ,   TUKEY_GRP_CD
        )
        SELECT  tmtk.STORE_CD
        ,       tmtk.TUKEY_CLASS_CD
        ,       tmtk.TUKEY_CD
        ,       tmtk.TUKEY_FG
        ,       tmtk.PROD_CD
        ,       tmtk.PAGE_NO
        ,       tmtk.X
        ,       tmtk.Y
        ,       tmtk.WIDTH
        ,       tmtk.HEIGHT
        ,       tmtk.STYLE_CD
        ,       tmtk.FONT_SIZE
        ,       tmtk.FONT_COLOR
        ,       tmtk.FILL_COLOR
        ,       tmtk.IMG_NM
        ,       tmtk.IN_FG
        ,       #{regDt} AS REG_DT
        ,       #{regId} AS REG_ID
        ,       #{modDt} AS MOD_DT
        ,       #{modId} AS MOD_ID
        ,       tmtk.TUKEY_GRP_CD
        FROM
            (
                SELECT  tttk.GRP_ID
                ,       tttk.STORE_CD
                ,       tttk.TUKEY_CLASS_CD
                ,       tttk.TUKEY_CD
                ,       tttk.TUKEY_FG
                ,       tttk.PROD_CD
                ,       FLOOR((tttk.GRP_ID-1) / (5*(8-tttk.ENVST_VAL)-1))+1 AS PAGE_NO
                ,       94 - (LENGTH(tmpsp.SALE_UPRC) * 10) AS X
                ,       '49' AS Y
                ,       (LENGTH(tmpsp.SALE_UPRC) * 10) AS WIDTH
                ,       '20' AS HEIGHT
                ,       tttk.STYLE_CD
                ,       tttk.FONT_SIZE
                ,       tttk.FONT_COLOR
                ,       tttk.FILL_COLOR
                ,       tttk.IMG_NM
                ,       tttk.IN_FG
                ,       tttk.TUKEY_GRP_CD
                ,       tmpsp.SALE_UPRC
                FROM
                    (
                        SELECT 	A.*
                        ,		B.ENVST_VAL
                        FROM
                            (
                                SELECT  RANK() OVER(PARTITION BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.STORE_CD ORDER BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD) AS GRP_ID
		                        ,       tttk.*
                                FROM    TB_TMP_TOUCH_KEY tttk
                                ,		(
                                            SELECT  NMCODE_NM
                                            ,		NMCODE_ITEM_1
                                            ,		NMCODE_ITEM_2
                                            FROM 	TB_HQ_NMCODE
                                            WHERE 	NMCODE_GRP_CD 	= '228'
                                            AND 	NMCODE_ITEM_2 	= 'Y'
                                            AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                                        ) B
                                ,       TB_MS_STORE C
                                WHERE 	tttk.SESSION_ID	= #{sessionId}
                                AND 	B.NMCODE_NM		= tttk.TUKEY_GRP_CD
                                AND 	B.NMCODE_ITEM_1	= tttk.TUKEY_CLASS_CD
                                AND     tttk.TUKEY_FG   = '03'
                                <![CDATA[
                                    AND     tttk.PROD_CD    <> 'DEL'
                                ]]>
                                AND     C.HQ_OFFICE_CD  = #{hqOfficeCd}
                                AND     C.STORE_CD      = tttk.STORE_CD
                                ORDER
                                BY      tttk.TUKEY_GRP_CD
                                ,       tttk.TUKEY_CLASS_CD
                                ,       tttk.TUKEY_CD
                            ) A
                        ,	(
                                SELECT 	B.ENVST_VAL
                                , 		B.STORE_CD
                                FROM 	TB_MS_STORE_ENVST B
                                WHERE 	B.ENVST_CD = '1041'
                            ) B
                        WHERE 	A.STORE_CD = B.STORE_CD
                    ) tttk
                ,       TB_MS_PRODUCT_SALE_PRICE_V01 tmpsp
                WHERE   tttk.STORE_CD   = tmpsp.STORE_CD
                AND     tttk.PROD_CD    = tmpsp.PROD_CD
                AND     tmpsp.SALE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
            ) tmtk
        WHERE   6 > tmtk.PAGE_NO
    </insert>

    <!-- 키오스크 탭 엑셀 업로드 - 단종/미사용 상품 유무 확인 -->
    <!--
        TABLE    : TB_TMP_LSM_STORE_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 단종/미사용 상품 유무 확인
    -->
    <select id="getKioskChkUseYn" parameterType="lsmStoreVO" resultType="String">
        /* USE : LsmStoreMapper.getKioskChkUseYn */
        SELECT  DECODE(MAX(A.PROD_CD), NULL, NULL, '상품코드 ['||MAX(A.PROD_CD)    ||'] ' || '외 ['|| (COUNT(A.PROD_CD)-1) ||'] 건')
        FROM 	TB_TMP_LSM_STORE_MS_KIOSK_KEY A
        ,		TB_MS_PRODUCT B
        ,		(
                    SELECT 	NMCODE_NM
                    ,		NMCODE_ITEM_1
                    ,		NMCODE_ITEM_2
                    FROM 	TB_HQ_NMCODE
                    WHERE 	NMCODE_GRP_CD 	= '229'
                    AND 	NMCODE_ITEM_2 	= 'Y'
                    AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                ) C
        ,       (
                    SELECT 	STORE_CD
                    ,		POS_NO
                    FROM 	TB_MS_POS_ENVST tmpe
                    WHERE 	ENVST_CD = '4019'
                    AND 	ENVST_VAL = '6'
                    AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                ) D
        WHERE 	A.SESSION_ID    = #{sessionId}
        AND 	B.STORE_CD      = A.STORE_CD
        AND 	B.PROD_CD       = A.PROD_CD
        AND 	B.USE_YN        = 'N'
        AND     C.NMCODE_NM     = A.TU_CLS_TYPE
        AND 	C.NMCODE_ITEM_1 = A.TU_CLS_CD
        AND     D.STORE_CD      = A.STORE_CD
        AND     D.POS_NO        = A.POS_NO
    </select>

    <!-- 키오스크 탭 엑셀 업로드 - 카테고리별 상품수 확인 -->
    <!--
        TABLE    : TB_TMP_LSM_STORE_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 카테고리별 상품수 확인
    -->
    <select id="getKioskChkProdCnt" parameterType="lsmStoreVO" resultType="String">
        /* USE : LsmStoreMapper.getKioskChkProdCnt */
        SELECT 	    '매장코드 ['||A.STORE_CD 	||'] - '
                ||  '포스번호 ['||A.POS_NO    	||'] - '
                ||  '그룹코드 ['||A.TU_CLS_TYPE  ||'] - '
                ||  '카테고리코드 ['||A.TU_CLS_CD  	||'] - '
                ||  '최대 상품수 [999] '
        FROM	(
                    SELECT 	A.STORE_CD
                    ,	    A.POS_NO
                    ,       A.TU_CLS_TYPE
                    ,       A.TU_CLS_CD
                    ,		COUNT(A.PROD_CD) AS CNT
                    FROM 	TB_TMP_LSM_STORE_MS_KIOSK_KEY A
                    ,		(
                                SELECT 	NMCODE_NM
                                ,		NMCODE_ITEM_1
                                ,		NMCODE_ITEM_2
                                FROM 	TB_HQ_NMCODE
                                WHERE 	NMCODE_GRP_CD 	= '229'
                                AND 	NMCODE_ITEM_2 	= 'Y'
                                AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                            ) B
                    ,       (
                                SELECT 	STORE_CD
                                ,		POS_NO
                                FROM 	TB_MS_POS_ENVST tmpe
                                WHERE 	ENVST_CD = '4019'
                                AND 	ENVST_VAL = '6'
                                AND     STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd})
                            ) C
                    WHERE 	A.SESSION_ID    = #{sessionId}
                    AND     B.NMCODE_NM     = A.TU_CLS_TYPE
                    AND 	B.NMCODE_ITEM_1 = A.TU_CLS_CD
                    AND     C.STORE_CD      = A.STORE_CD
                    AND     C.POS_NO        = A.POS_NO
                    GROUP
                    BY 		A.STORE_CD
                    ,	    A.POS_NO
                    ,       A.TU_CLS_TYPE
                    ,       A.TU_CLS_CD
                ) A
        WHERE 	CNT > 999
        <![CDATA[
                  AND   ROWNUM < 2
                ]]>
    </select>

    <!-- 터치키 탭 엑셀 업로드 - 단종/미사용 상품 유무 확인 -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 단종/미사용 상품 유무 확인
    -->
    <select id="getTukeyChkUseYn" parameterType="lsmStoreVO" resultType="String">
        /* USE : LsmStoreMapper.getTukeyChkUseYn */
        SELECT 	DECODE(MAX(A.PROD_CD), NULL, NULL, '상품코드 ['||MAX(A.PROD_CD)    ||'] ' || '외 ['||(COUNT(A.PROD_CD)-1)||'] 건')
        FROM 	TB_TMP_TOUCH_KEY A
        ,		TB_MS_PRODUCT B
        ,		(
                    SELECT 	NMCODE_NM
                    ,		NMCODE_ITEM_1
                    ,		NMCODE_ITEM_2
                    FROM 	TB_HQ_NMCODE
                    WHERE 	NMCODE_GRP_CD 	= '228'
                    AND 	NMCODE_ITEM_2 	= 'Y'
                    AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                ) C
        WHERE 	A.SESSION_ID    = #{sessionId}
        AND 	A.TUKEY_FG 		= '01'
        AND 	B.STORE_CD      = A.STORE_CD
        AND 	B.PROD_CD       = A.PROD_CD
        AND 	B.USE_YN        = 'N'
        AND     C.NMCODE_NM     = A.TUKEY_GRP_CD
        AND 	C.NMCODE_ITEM_1 = A.TUKEY_CLASS_CD
    </select>

    <!-- 터치키 탭 엑셀 업로드 - 분류별 상품수 확인 -->
    <!--
        TABLE    : TB_TMP_LSM_STORE_MS_KIOSK_KEY
        PARAM    : lsmStoreVO
        COMMENTS : 분류별 상품수 확인
    -->
    <select id="getTukeyChkProdCnt" parameterType="lsmStoreVO" resultType="String">
        /* USE : LsmStoreMapper.getTukeyChkProdCnt */
        SELECT      '매장코드 ['||A.STORE_CD        ||'] - '
                ||  '그룹코드 ['||A.TUKEY_GRP_CD    ||'] - '
                ||  '분류코드 ['||A.TUKEY_CLASS_CD  ||'] - '
                ||  '최대 상품수 ['||(
                                    SELECT 	MAX((5*(8-TO_NUMBER(C.ENVST_VAL))-1)*5) AS MAX_CNT
                                    FROM 	TB_MS_STORE_ENVST C
                                    WHERE 	C.STORE_CD = A.STORE_CD
                                    AND 	C.ENVST_CD = '1041'
                                )||']'
        FROM	(
                    SELECT 	A.STORE_CD
                    ,       A.TUKEY_GRP_CD
                    ,       A.TUKEY_CLASS_CD
                    ,		COUNT(A.PROD_CD) AS CNT
                    FROM 	TB_TMP_TOUCH_KEY A
                    ,		(
                                SELECT 	NMCODE_NM
                                ,		NMCODE_ITEM_1
                                ,		NMCODE_ITEM_2
                                FROM 	TB_HQ_NMCODE
                                WHERE 	NMCODE_GRP_CD 	= '228'
                                AND 	NMCODE_ITEM_2 	= 'Y'
                                AND 	HQ_OFFICE_CD 	= #{hqOfficeCd}
                            ) B
                    WHERE 	A.SESSION_ID 	= #{sessionId}
                    AND     B.NMCODE_NM     = A.TUKEY_GRP_CD
                    AND 	B.NMCODE_ITEM_1 = A.TUKEY_CLASS_CD
                    AND     A.TUKEY_FG      = '01'
                    GROUP
                    BY 		A.STORE_CD
                    ,       A.TUKEY_GRP_CD
                    ,       A.TUKEY_CLASS_CD
                    ) A
        WHERE 	A.CNT > (
                            SELECT 	MAX((5*(8-TO_NUMBER(B.ENVST_VAL))-1)*5) AS MAX_CNT
                            FROM 	TB_MS_STORE_ENVST B
                            WHERE 	B.STORE_CD = A.STORE_CD
                            AND 	B.ENVST_CD = '1041'
                        )
        <![CDATA[
          AND     ROWNUM < 2
                ]]>
    </select>
</mapper>