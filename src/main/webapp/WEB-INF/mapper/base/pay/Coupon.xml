<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    Coupon.xml
    쿠폰등록
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김지은     2018.08.10     최초작성
-->

<mapper namespace="kr.co.solbipos.base.pay.coupon.service.impl.CouponMapper">

  <resultMap id="classListMap" type="DefaultMap">
    <result column="USE_YN" property="useYn" typeHandler="CustomBooleanTypeHandler"/>
    <result column="SER_NO_YN" property="serNoYn" typeHandler="CustomBooleanTypeHandler"/>
  </resultMap>

  <resultMap id="couponListMap" type="DefaultMap">
    <result column="USE_YN" property="useYn" typeHandler="CustomBooleanTypeHandler"/>
  </resultMap>


  <!-- 본사 쿠폰 분류 조회 -->
  <!--
      TABLE    : TB_HQ_PAY_METHOD_CLASS
      COMMENTS : 본사의 쿠폰 분류를 조회한다.
  -->
  <select id="getHqCouponClassList" parameterType="DefaultMap" resultType="DefaultMap">
    /* USE : CouponMapper.getHqCouponClassList */
    SELECT HQ_OFFICE_CD,
           PAY_CLASS_CD,
           PAY_TYPE_FG,
           PAY_CLASS_NM,
           SER_NO_YN,
           USE_YN,
           REG_ID
      FROM TB_HQ_PAY_METHOD_CLASS
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
  </select>

  <!-- 매장 쿠폰 분류 조회 -->
  <!--
      TABLE    : TB_MS_PAY_METHOD_CLASS
      COMMENTS : 매장의 쿠폰 분류를 조회한다.
  -->
  <select id="getStoreCouponClassList" parameterType="DefaultMap" resultType="DefaultMap">
    /* USE : CouponMapper.getStoreCouponClassList */
    SELECT STORE_CD,
           PAY_TYPE_FG,
           PAY_CLASS_CD,
           PAY_CLASS_NM,
           SER_NO_YN,
           USE_YN,
           REG_ID
      FROM TB_MS_PAY_METHOD_CLASS
     WHERE STORE_CD = #{storeCd}
  </select>

  <!-- 본사 쿠폰 분류 등록 -->
  <!--
      TABLE    : TB_HQ_PAY_METHOD_CLASS
      COMMENTS : 분류를 등록한다.
  -->
  <insert id="insertHqCouponClass" parameterType="DefaultMap">
    /* USE : CouponMapper.insertHqCouponClass */
    INSERT INTO TB_HQ_PAY_METHOD_CLASS
    (
      HQ_OFFICE_CD,
      PAY_CLASS_CD,
      PAY_TYPE_FG,
      PAY_CLASS_NM,
      SER_NO_YN,
      USE_YN,
      REG_DT,
      REG_ID,
      MOD_DT,
      MOD_ID
    )
    VALUES
    (
      #{hqOfficeCd},
      #{payClassCd},
      #{payTypeFg},
      #{payClassNm},
      #{serNoYn},
      #{useYn},
      #{regDt},
      #{regId},
      #{modDt},
      #{modId}
    )
  </insert>

  <!-- 본사 쿠폰 분류 수정 -->
  <!--
      TABLE    : TB_HQ_PAY_METHOD_CLASS
      COMMENTS : 분류를 수정한다.
  -->
  <update id="updateHqCouponClass" parameterType="DefaultMap">
    /* USE : CouponMapper.updateHqCouponClass */
    UPDATE TB_HQ_PAY_METHOD_CLASS
       SET PAY_CLASS_NM = #{payClassNm},
           SER_NO_YN = #{serNoYn},
           USE_YN = #{useYn},
           MOD_DT = #{modDt},
           MOD_ID = #{modId}
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
       AND PAY_CLASS_CD = #{payClassCd}
       AND PAY_TYPE_FG =  #{payTypeFg}
  </update>

  <!-- 본사 쿠폰 분류 삭제 -->
  <!--
      TABLE    : TB_HQ_PAY_METHOD_CLASS
      COMMENTS : 분류를 삭제한다.
  -->
  <delete id="deleteHqCouponClass" parameterType="DefaultMap">
    /* USE : CouponMapper.deleteHqCouponClass */
    DELETE TB_HQ_PAY_METHOD_CLASS
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
       AND PAY_CLASS_CD = #{payClassCd}
       AND PAY_TYPE_FG =  #{payTypeFg}
  </delete>

  <!-- 매장 쿠폰 분류 등록 -->
  <!--
      TABLE    : TB_HQ_PAY_METHOD_CLASS
      COMMENTS : 분류를 등록한다.
  -->
  <insert id="insertStoreCouponClass" parameterType="DefaultMap">
    /* USE : CouponMapper.insertStoreCouponClass */
    INSERT INTO TB_MS_PAY_METHOD_CLASS
    (
      STORE_CD,
      PAY_CLASS_CD,
      PAY_TYPE_FG,
      PAY_CLASS_NM,
      SER_NO_YN,
      USE_YN,
      REG_DT,
      REG_ID,
      MOD_DT,
      MOD_ID
    )
    VALUES
    (
      #{storeCd},
      #{payClassCd},
      #{payTypeFg},
      #{payClassNm},
      #{serNoYn},
      #{useYn},
      #{regDt},
      #{regId},
      #{modDt},
      #{modId}
    )
  </insert>

  <!-- 매장 쿠폰 분류 수정 -->
  <!--
      TABLE    : TB_HQ_PAY_METHOD_CLASS
      COMMENTS : 분류를 수정한다.
  -->
  <update id="updateStoreCouponClass" parameterType="DefaultMap">
    /* USE : CouponMapper.updateStoreCouponClass */
    UPDATE TB_MS_PAY_METHOD_CLASS
       SET PAY_CLASS_NM = #{payClassNm},
           SER_NO_YN = #{serNoYn},
           USE_YN = #{useYn},
           MOD_DT = #{modDt},
           MOD_ID = #{modId}
     WHERE STORE_CD = #{storeCd}
       AND PAY_CLASS_CD = #{payClassCd}
       AND PAY_TYPE_FG =  #{payTypeFg}
  </update>

  <!-- 매장 쿠폰 분류 삭제 -->
  <!--
      TABLE    : TB_HQ_PAY_METHOD_CLASS
      COMMENTS : 분류를 삭제한다.
  -->
  <delete id="deleteStoreCouponClass" parameterType="DefaultMap">
    /* USE : CouponMapper.deleteStoreCouponClass */
    DELETE TB_MS_PAY_METHOD_CLASS
     WHERE STORE_CD = #{storeCd}
       AND PAY_TYPE_FG = #{payTypeFg}
       AND PAY_CLASS_CD = #{payClassCd}
  </delete>


  <!-- 본사 쿠폰 조회 -->
  <!--
      TABLE    : TB_HQ_COUPON
      COMMENTS : 본사의 쿠폰을 조회한다.
  -->
  <select id="getHqCouponList" parameterType="DefaultMap" resultType="DefaultMap">
    /* USE : CouponMapper.getHqCouponList */
    SELECT HQ_OFFICE_CD,
           COUPN_CD,
           COUPN_NM,
           PAY_CLASS_CD,
           COUPN_DC_FG,
           COUPN_DC_RATE,
           COUPN_DC_AMT,
           COUPN_APPLY_FG,
           USE_YN,
           REG_ID
      FROM TB_HQ_COUPON
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
    <if test='payClassCd != null and payClassCd.toString() != ""'>
       AND PAY_CLASS_CD = #{payClassCd}
    </if>
    <if test='useYn != null and useYn.toString() == "Y"'>
       AND USE_YN = #{useYn}
    </if>
  </select>

  <!-- 매장 쿠폰 조회 -->
  <!--
      TABLE    : TB_MS_PAY_METHOD_CLASS
      COMMENTS : 매장의 쿠폰을 조회한다.
  -->
  <select id="getStoreCouponList" parameterType="DefaultMap" resultType="DefaultMap">
    /* USE : CouponMapper.getStoreCouponList */
    SELECT STORE_CD,
           COUPN_CD,
           COUPN_NM,
           PAY_CLASS_CD,
           COUPN_DC_FG,
           COUPN_DC_RATE,
           COUPN_DC_AMT,
           COUPN_APPLY_FG,
           USE_YN,
           REG_ID
      FROM TB_MS_COUPON
     WHERE STORE_CD = #{storeCd}
    <if test='payClassCd != null and payClassCd.toString() != ""'>
       AND PAY_CLASS_CD = #{payClassCd}
    </if>
    <if test='useYn != null and useYn.toString() == "Y"'>
       AND USE_YN = #{useYn}
    </if>
  </select>

  <!-- 본사 쿠폰 등록 -->
  <!--
      TABLE    : TB_HQ_COUPON
      COMMENTS : 쿠폰을 등록한다.
  -->
  <insert id="insertHqCoupon" parameterType="DefaultMap">
    /* USE : CouponMapper.insertHqCoupon */
    INSERT INTO TB_HQ_COUPON
    (
      HQ_OFFICE_CD,
      COUPN_CD,
      COUPN_NM,
      PAY_CLASS_CD,
      COUPN_DC_FG,
      COUPN_DC_RATE,
      COUPN_DC_AMT,
      COUPN_APPLY_FG,
      USE_YN,
      REG_DT,
      REG_ID,
      MOD_DT,
      MOD_ID
    )
    VALUES
    (
      #{hqOfficeCd},
      #{coupnCd},
      #{coupnNm},
      #{payClassCd},
      #{coupnDcFg},
      #{coupnDcRate},
      #{coupnDcAmt},
      #{coupnApplyFg},
      #{useYn},
      #{regDt},
      #{regId},
      #{modDt},
      #{modId}
    )
  </insert>

  <!-- 본사 쿠폰 수정 -->
  <!--
      TABLE    : TB_HQ_COUPON
      COMMENTS : 쿠폰을 수정한다.
  -->
  <update id="updateHqCoupon" parameterType="DefaultMap">
    /* USE : CouponMapper.updateHqCoupon */
    UPDATE TB_HQ_COUPON
       SET COUPN_NM = #{coupnNm},
           COUPN_DC_FG = #{coupnDcFg},
           COUPN_DC_RATE = #{coupnDcRate},
           COUPN_DC_AMT = #{coupnDcAmt},
           COUPN_APPLY_FG = #{coupnApplyFg},
           USE_YN = #{useYn},
           MOD_DT = #{modDt},
           MOD_ID = #{modId}
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
       AND PAY_CLASS_CD =  #{payClassCd}
       AND COUPN_CD = #{coupnCd}
  </update>

  <!-- 본사 쿠폰 삭제 -->
  <!--
      TABLE    : TB_HQ_COUPON
      COMMENTS : 쿠폰을 삭제한다.
  -->
  <delete id="deleteHqCoupon" parameterType="DefaultMap">
    /* USE : CouponMapper.deleteHqCoupon */
    DELETE TB_HQ_COUPON
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
       AND PAY_CLASS_CD =  #{payClassCd}
       AND COUPN_CD = #{coupnCd}
  </delete>

  <!-- 매장 쿠폰 등록 -->
  <!--
      TABLE    : TB_MS_COUPON
      COMMENTS : 분류를 등록한다.
  -->
  <insert id="insertStoreCoupon" parameterType="DefaultMap">
    /* USE : CouponMapper.insertStoreCoupon */
    INSERT INTO TB_MS_COUPON
    (
      STORE_CD,
      COUPN_CD,
      COUPN_NM,
      PAY_CLASS_CD,
      COUPN_DC_FG,
      COUPN_DC_RATE,
      COUPN_DC_AMT,
      COUPN_APPLY_FG,
      USE_YN,
      REG_DT,
      REG_ID,
      MOD_DT,
      MOD_ID
    )
    VALUES
    (
      #{storeCd},
      #{coupnCd},
      #{coupnNm},
      #{payClassCd},
      #{coupnDcFg},
      #{coupnDcRate},
      #{coupnDcAmt},
      #{coupnApplyFg},
      #{useYn},
      #{regDt},
      #{regId},
      #{modDt},
      #{modId}
    )
  </insert>

  <!-- 매장 쿠폰 수정 -->
  <!--
      TABLE    : TB_MS_COUPON
      COMMENTS : 쿠폰을 수정한다.
  -->
  <update id="updateStoreCoupon" parameterType="DefaultMap">
    /* USE : CouponMapper.updateStoreCoupon */
    UPDATE TB_MS_COUPON
       SET COUPN_NM = #{coupnNm},
           COUPN_DC_FG = #{coupnDcFg},
           COUPN_DC_RATE = #{coupnDcRate},
           COUPN_DC_AMT = #{coupnDcAmt},
           COUPN_APPLY_FG = #{coupnApplyFg},
           USE_YN = #{useYn},
           MOD_DT = #{modDt},
           MOD_ID = #{modId}
     WHERE STORE_CD = #{storeCd}
       AND PAY_CLASS_CD =  #{payClassCd}
       AND COUPN_CD = #{coupnCd}
  </update>

  <!-- 매장 쿠폰 삭제 -->
  <!--
      TABLE    : TB_MS_COUPON
      COMMENTS : 쿠폰을 삭제한다.
  -->
  <delete id="deleteStoreCoupon" parameterType="DefaultMap">
    /* USE : CouponMapper.deleteStoreCoupon */
    DELETE TB_MS_COUPON
     WHERE STORE_CD = #{storeCd}
       AND PAY_CLASS_CD = #{payClassCd}
       AND COUPN_CD = #{coupnCd}
  </delete>

  <!-- 본사 상품 조회 -->
  <!--
      TABLE    : TB_HQ_PRODUCT, TB_HQ_PRODUCT_CLASS, TB_HQ_COUPON_PROD
      COMMENTS : 본사의 상품을 조회한다.
  -->
  <select id="getHqProdList" parameterType="couponProdVO" resultType="DefaultMap">
    /* USE : CouponMapper.getHqProdList */
    SELECT thp.HQ_OFFICE_CD,
           thp.PROD_CLASS_CD,
           thpc.PROD_CLASS_NM,
           thp.PROD_CD,
           thp.PROD_NM,
           thp.COST_UPRC,
           NVL2(thcp.PROD_CD, 'Y', 'N') AS REG_YN
      FROM TB_HQ_PRODUCT thp,
           TB_HQ_PRODUCT_CLASS thpc,
           TB_HQ_COUPON_PROD thcp
     WHERE thp.USE_YN = 'Y'
       AND thp.HQ_OFFICE_CD = thpc.HQ_OFFICE_CD
       AND thp.PROD_CLASS_CD = thpc.PROD_CLASS_CD
       AND thcp.HQ_OFFICE_CD (+)= thp.HQ_OFFICE_CD
       AND thcp.PROD_CD (+)= thp.PROD_CD
    <if test='prodRegFg != null and prodRegFg.toString() == "Y"'>
       AND NVL2(thcp.PROD_CD, 'Y', 'N') = 'Y'
    </if>
    <if test='prodRegFg != null and prodRegFg.toString() == "N"'>
       AND NVL2(thcp.PROD_CD, 'Y', 'N') = 'N'
    </if>
  </select>

  <!-- 매장 상품 조회 -->
  <!--
      TABLE    : TB_MS_PRODUCT, TB_MS_PRODUCT_CLASS, TB_MS_COUPON_PROD
      COMMENTS : 매장의 상품을 조회한다
  -->
  <select id="getStoreProdList" parameterType="couponProdVO" resultType="DefaultMap">
    /* USE : CouponMapper.getStoreProdList */
    SELECT tmp.STORE_CD,
           tmp.PROD_CLASS_CD,
           tmpc.PROD_CLASS_NM,
           tmp.PROD_CD,
           tmp.PROD_NM,
           tmp.COST_UPRC,
           NVL2(tmcp.PROD_CD, 'Y', 'N') AS REG_YN
      FROM TB_MS_PRODUCT tmp,
           TB_MS_PRODUCT_CLASS tmpc,
           TB_MS_COUPON_PROD tmcp
    WHERE tmp.USE_YN = 'Y'
      AND tmp.STORE_CD = tmpc.STORE_CD
      AND tmp.PROD_CLASS_CD = tmpc.PROD_CLASS_CD
      AND tmcp.STORE_CD (+)= tmp.STORE_CD
      AND tmcp.PROD_CD (+)= tmp.PROD_CD
    <if test='prodRegFg != null and prodRegFg.toString() == "Y"'>
      AND NVL2(tmcp.PROD_CD, 'Y', 'N') = 'Y'
    </if>
    <if test='prodRegFg != null and prodRegFg.toString() == "N"'>
      AND NVL2(tmcp.PROD_CD, 'Y', 'N') = 'N'
    </if>
  </select>

  <!-- 본사 쿠폰 적용 상품 등록 -->
  <!--
      TABLE    : TB_HQ_COUPON_PROD
      COMMENTS : 본사 쿠폰을 적용할 상품을 등록한다.
  -->
  <insert id="insertHqCouponProd" parameterType="couponProdVO">
    /* USE : CouponMapper.insertHqCouponProd */
    INSERT  INTO TB_HQ_COUPON_PROD
    (
      HQ_OFFICE_CD,
      COUPN_CD,
      PROD_CD,
      REG_DT,
      REG_ID,
      MOD_DT,
      MOD_ID
    )
    VALUES
    (
      #{hqOfficeCd},
      #{coupnCd},
      #{prodCd},
      #{regDt},
      #{regId},
      #{modDt},
      #{modId}
    )
  </insert>

  <!-- 매장 쿠폰 적용 상품 등록 -->
  <!--
      TABLE    : TB_MS_COUPON_PROD
      COMMENTS : 본사 쿠폰을 적용할 상품을 등록한다.
  -->
  <insert id="insertStoreCouponProd" parameterType="couponProdVO">
    /* USE : CouponMapper.insertStoreCouponProd */
    INSERT  INTO TB_MS_COUPON_PROD
    (
      STORE_CD,
      COUPN_CD,
      PROD_CD,
      REG_DT,
      REG_ID,
      MOD_DT,
      MOD_ID
    )
    VALUES
    (
      #{storeCd},
      #{coupnCd},
      #{prodCd},
      #{regDt},
      #{regId},
      #{modDt},
      #{modId}
    )

  </insert>

  <!-- 본사 쿠폰 적용 상품 삭제 -->
  <!--
      TABLE    : TB_HQ_COUPON_PROD
      COMMENTS : 본사 쿠폰을 적용한 상품을 삭제한다.
  -->
  <delete id="deleteHqCouponProd">
      /* USE : CouponMapper.deleteHqCouponProd */
      DELETE TB_HQ_COUPON_PROD
       WHERE HQ_OFFICE_CD = #{hqOfficeCd}
         AND COUPN_CD = #{coupnCd}
         AND PROD_CD = #{prodCd}
  </delete>


</mapper>



