<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.application.common.service.impl.CmmMenuMapper">

  <select id="selectStoreCdList" parameterType="string" resultType="string">
    /* CmmMenuMapper.selectStore */
    SELECT STORE_CD
      FROM TB_MS_STORE
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
  </select>

  <select id="selectStore" parameterType="storeVO" resultType="storeVO">
  <![CDATA[
    /* CmmMenuMapper.selectStore */
    SELECT STORE_CD,
           STORE_NM,
           OWNER_NM,
           HQ_OFFICE_CD
      FROM TB_MS_STORE
     WHERE HQ_OFFICE_CD = #{hqOfficeCd}
  ]]>
     <if test="storeNm != null and storeNm != ''">
       AND STORE_NM LIKE '%'||#{storeNm}||'%'
     </if>
     ORDER BY REG_DT, MOD_DT DESC
  </select>


  <select id="selectHq" parameterType="hqVO" resultType="hqVO">
  <![CDATA[
    /* CmmMenuMapper.selectHq */
    SELECT HQ_OFFICE_CD,
           HQ_OFFICE_NM,
           OWNER_NM
      FROM TB_HQ_OFFICE
     WHERE SYS_STAT_FG != '9'
       AND SYS_OPEN_DATE < SYSDATE
       AND SYS_CLOSURE_DATE > SYSDATE
  ]]>
   <if test="hqOfficeNm != null and hqOfficeNm != ''">
       AND HQ_OFFICE_NM LIKE '%'||#{hqOfficeNm}||'%'
   </if>
     ORDER BY REG_DT, MOD_DT DESC
  </select>


  <insert id="insertMenuUseHist" parameterType="menuUseHistVO">
  <![CDATA[
    /* CmmMenuMapper.insertMenuHist */
    INSERT INTO TB_WB_MENU_USE_HIST
    (
      SEQ,
      USER_ID,
      RESRCE_CD,
      USE_DATE,
      USE_DT
    )
    VALUES
    (
      SQ_WB_MENU_HIST.NEXTVAL,
      #{userId},
      #{resrceCd},
      #{useDate},
      #{useDt}
    )
  ]]>
  </insert>

  <!-- 즐겨찾기 가져오기 -->
  <select id="selectBkmkMenu" parameterType="sessionInfoVO" resultType="resrceInfoBaseVO">
    /* CmmMenuMapper.selectBkmkMenu */
    SELECT B.RESRCE_CD,
           B.P_RESRCE,
           B.RESRCE_NM,
           B.URL
           <if test="vUserId != null and vUserId != ''">
           ,#{vUserId,jdbcType=VARCHAR} AS V_LOGIN_ID
           </if>
      FROM TB_WB_BKMK A
      LEFT OUTER JOIN
           TB_WB_RESRCE_INFO B
        ON A.RESRCE_CD = B.RESRCE_CD
     WHERE A.USER_ID = #{userId}
       AND A.USE_YN = 'Y'
  </select>

  <!-- 즐겨찾기 조회 -->


<!-- 고정 메뉴 가져오기 -->
  <select id="selectFixingMenu" parameterType="sessionInfoVO" resultType="resrceInfoBaseVO">
    /* CmmMenuMapper.selectFixingMenu */
    SELECT B.RESRCE_CD,
           B.P_RESRCE,
           B.RESRCE_NM,
           B.URL
           <if test="vUserId != null and vUserId != ''">
           ,#{vUserId,jdbcType=VARCHAR} AS V_LOGIN_ID
           </if>
      FROM TB_WB_FIXING A
      LEFT OUTER JOIN
           TB_WB_RESRCE_INFO B
        ON A.RESRCE_CD = B.RESRCE_CD
     WHERE A.USER_ID = #{userId}
       AND A.USE_YN = 'Y'
  </select>

  <select id="selectAllResrce" parameterType="DefaultMap" resultType="DefaultMap">
    /* CmmMenuMapper.selectAllResrce */
     SELECT A.P_RESRCE PCD,
            A.RESRCE_CD CD,
            A.RESRCE_NM NM,
            A.URL,
            (SELECT NMCODE_ITEM_2
               FROM TB_CM_NMCODE
              WHERE NMCODE_GRP_CD = '086'
                AND NMCODE_ITEM_1 = A.RESRCE_CD) ICON
            <if test="vUserId != null and vUserId != ''">
            ,#{vUserId,jdbcType=VARCHAR} AS V_LOGIN_ID
            </if>
       FROM TB_WB_RESRCE_INFO A
      WHERE A.USE_YN = 'Y'
        AND A.RESRCE_FG = 'M'
        AND (A.SPCL_AUTHOR IS NULL OR A.SPCL_AUTHOR NOT IN ('A01'))
      START WITH A.P_RESRCE = '000000'
    CONNECT BY PRIOR A.RESRCE_CD = A.P_RESRCE
      ORDER SIBLINGS BY A.DISP_IDX ASC,
            FUNC_FG ASC
  </select>

  <select id="selectAuthedResrce" parameterType="DefaultMap" resultType="DefaultMap">
    /* CmmMenuMapper.selectAuthedResrce */
     SELECT A.RESRCE_CD,
            A.RESRCE_PATH
            <if test="vUserId != null and vUserId != ''">
            ,#{vUserId,jdbcType=VARCHAR} AS V_LOGIN_ID
            </if>
       FROM (
             SELECT A.RESRCE_CD,
                    SYS_CONNECT_BY_PATH(RESRCE_CD, '/') RESRCE_PATH
               FROM TB_WB_RESRCE_INFO A
              WHERE A.USE_YN = 'Y'
              START WITH A.P_RESRCE = '000000'
            CONNECT BY PRIOR A.RESRCE_CD = A.P_RESRCE
            ) A,
            (
             SELECT B.RESRCE_CD
               FROM TB_WB_AUTHOR_GRP_INFO A,
                    TB_WB_AUTHOR_GRP_RESRCE B
              WHERE A.AUTH_GRP_CD = B.AUTH_GRP_CD
                AND B.AUTH_GRP_CD = #{authGrpCd}
                AND A.USE_YN = 'Y'
                AND B.USE_YN = 'Y'
              UNION ALL
             SELECT A.RESRCE_CD
               FROM TB_WB_AUTHOR_EXCEPT A
              WHERE A.USER_ID = #{userId}
                AND A.INCLD_EXCLD_FG = 'I'
                AND A.USE_YN = 'Y'
              MINUS
             SELECT A.RESRCE_CD
               FROM TB_WB_AUTHOR_EXCEPT A
              WHERE A.USER_ID = #{userId}
                AND A.INCLD_EXCLD_FG = 'E'
                AND A.USE_YN = 'Y'
            ) B
      WHERE A.RESRCE_CD = B.RESRCE_CD
  </select>

  <select id="selectAuthedBkmk" parameterType="DefaultMap" resultType="DefaultMap">
    /* CmmMenuMapper.selectAuthedBkmk */
     SELECT A.RESRCE_CD,
            A.RESRCE_PATH
            <if test="vUserId != null and vUserId != ''">
            ,#{vUserId,jdbcType=VARCHAR} AS V_LOGIN_ID
            </if>
       FROM (
             SELECT A.RESRCE_CD,
                    SYS_CONNECT_BY_PATH(RESRCE_CD, '/') RESRCE_PATH
               FROM TB_WB_RESRCE_INFO A
              WHERE A.USE_YN = 'Y'
              START WITH A.P_RESRCE = '000000'
            CONNECT BY PRIOR A.RESRCE_CD = A.P_RESRCE
            ) A,
            (
             SELECT B.RESRCE_CD
               FROM TB_WB_AUTHOR_GRP_INFO A,
                    TB_WB_AUTHOR_GRP_RESRCE B
              WHERE A.AUTH_GRP_CD = B.AUTH_GRP_CD
                AND B.AUTH_GRP_CD = #{authGrpCd}
                AND A.USE_YN = 'Y'
                AND B.USE_YN = 'Y'
              UNION ALL
             SELECT A.RESRCE_CD
               FROM TB_WB_AUTHOR_EXCEPT A
              WHERE A.USER_ID = #{userId}
                AND A.INCLD_EXCLD_FG = 'I'
                AND A.USE_YN = 'Y'
              MINUS
             SELECT A.RESRCE_CD
               FROM TB_WB_AUTHOR_EXCEPT A
              WHERE A.USER_ID = #{userId}
                AND A.INCLD_EXCLD_FG = 'E'
                AND A.USE_YN = 'Y'
            ) B,
            TB_WB_BKMK C
      WHERE A.RESRCE_CD = B.RESRCE_CD
        AND A.RESRCE_CD = C.RESRCE_CD
        AND C.USER_ID = #{userId}
        AND C.USE_YN = 'Y'

  </select>

</mapper>





