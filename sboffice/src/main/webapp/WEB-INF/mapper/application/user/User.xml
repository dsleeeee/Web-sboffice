<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.application.persistance.user.UserMapper">
  
  <select id="selectUserCheck" parameterType="user" resultType="String" >
  <![CDATA[
  /* UserMapper.selectUserCheck */
    SELECT USER_ID 
      FROM TB_MS_EMPLOYEE
     WHERE EMP_NM = #{empNm}
       AND MP_NO = #{mpNo}
  ]]>
  </select>
  
  <select id="selectUserByNmAndId" parameterType="user" resultType="user" >
  <![CDATA[
  /* UserMapper.selectUserByNmAndId */
    SELECT ORGN_CD,
    	   EMP_NO,
    	   EMP_NM,
    	   EMP_PWD,
    	   ORGN_FG,
    	   WEB_USE_YN,
    	   USER_ID,
    	   MP_NO,
    	   EMAIL_ADDR,
    	   POST_NO,
    	   ADDR,
    	   ADDR_DTL,
    	   HIRE_FG,
    	   SMS_RECV_YN,
    	   USE_YN,
    	   REG_DT,
    	   REG_ID,
    	   MOD_DT,
    	   MOD_ID
      FROM TB_MS_EMPLOYEE
     WHERE EMP_NM = #{empNm}
       AND USER_ID = #{userId}
  ]]>
  </select>
  
  <select id="selectOtpTopOne" parameterType="otpAuth" resultType="otpAuth">
  <![CDATA[
  /* UserMapper.selectOtpTopOne */
    SELECT *
      FROM (
    SELECT SEQ,
           USER_ID,
           AUTH_FG,
           AUTH_NO,
           RECV_MP_NO,
           REQ_IP,
           REQ_DATE,
           REQ_DT
      FROM TB_WB_OTP_AUTH_HIST
     WHERE USER_ID = #{userId}
       AND AUTH_FG = #{authFg}
       AND REQ_DATE = #{reqDate}
     ORDER BY REQ_DT DESC
     )
     WHERE ROWNUM = 1
  ]]>
  </select>
  
  <select id="selectOtpBySeq" parameterType="pwdChg" resultType="otpAuth">
  <![CDATA[
  /* UserMapper.selectOtpCheck */
    SELECT SEQ,
           USER_ID,
           AUTH_FG,
           AUTH_NO,
           RECV_MP_NO,
           REQ_IP,
           REQ_DATE,
           REQ_DT
      FROM TB_WB_OTP_AUTH_HIST
     WHERE SEQ = #{uuid}
  ]]>
  </select>
  
  <insert id="insertOtpAuth" parameterType="otpAuth">
  <![CDATA[
  /* UserMapper.insertAuthOtp */
    INSERT INTO TB_WB_OTP_AUTH_HIST
    (
      SEQ,
      USER_ID,
      AUTH_FG,
      AUTH_NO,
      RECV_MP_NO,
      REQ_IP,
      REQ_DATE,
      REQ_DT
    )
    VALUES
    (
      #{seq},
      #{userId},
      #{authFg},
      #{authNo},
      #{recvMpNo},
      #{reqIp},
      #{reqDate},
      #{reqDt}
    )
  ]]>
  </insert>
  
  <insert id="insertPwdChgHist" parameterType="pwdChgHist">
  <![CDATA[
  /* UserMapper.insertPwdChgHist */
    INSERT INTO TB_WB_PWD_CHG_HIST
    (
      USER_ID,
      IDX,
      PRIOR_PWD,
      REG_IP,
      REG_DT,
      REG_ID
    )
    VALUES
    (
      #{userId},
      (SELECT NVL(MAX(IDX),0) + 1 AS MAX FROM TB_WB_PWD_CHG_HIST WHERE USER_ID = #{userId}),
      #{priorPwd},
      #{regIp},
      #{regDt},
      #{regId}
    )
  ]]>
  </insert>
  
  <update id="updateUserPwd" parameterType="sessionInfo">
  <![CDATA[
  /* LoginMapper.updateUserPwd */
  UPDATE TB_WB_USER_INFO 
     SET USER_PWD = #{userPwd}
   WHERE USER_ID = #{userId}
  ]]>
  </update>
  
</mapper>



















