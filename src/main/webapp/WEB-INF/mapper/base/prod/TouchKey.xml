<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    TouchKey.xml
    판매터치키 sql
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       노현수     2018.09.08     파일 재생성, 주석생성
    2       노현수     2018.09.13     파일 재생성, 커밋테스트
-->
<mapper namespace="kr.co.solbipos.base.prod.touchkey.service.impl.TouchKeyMapper">

    <resultMap id="touchKeyMap" type="DefaultMap">
        <result column="TOUCHKEY_USED" property="touchKeyUsed" typeHandler="CustomBooleanTypeHandler"/>
    </resultMap>

    <!-- 판매터치키 등록 상품 목록 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT, TB_HQ_PRODUCT_SALE_PRICE, TB_HQ_PRODUCT_CLASS,
                   TB_MS_PRODUCT, TB_MS_PRODUCT_SALE_PRICE, TB_MS_PRODUCT_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 판매터치키로 등록할 상품의 목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getProductListForTouchKey" parameterType="touchKeyVO" resultMap="touchKeyMap">
        /* USE : TouchKeyMapper.getProductListForTouchKey */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thp.PROD_CD,
                    thp.PROD_NM,
                    thpc.PROD_CLASS_CD,
                    thpc.PROD_CLASS_NM,
                    NVL(thpsp.SALE_UPRC, 0) AS SALE_UPRC,
                    'N' AS TOUCHKEY_USED
                FROM
                    TB_HQ_PRODUCT thp
                LEFT OUTER JOIN TB_HQ_PRODUCT_CLASS thpc ON
                    thp.HQ_OFFICE_CD = thpc.HQ_OFFICE_CD
                    AND thp.PROD_CLASS_CD = thpc.PROD_CLASS_CD
                LEFT OUTER JOIN (
                    SELECT
                        HQ_OFFICE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                        ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_HQ_PRODUCT_SALE_PRICE
                    WHERE
                        HQ_OFFICE_CD = #{hqOfficeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                        AND SALE_PRC_FG = #{salePrcFg}
                    GROUP BY
                        HQ_OFFICE_CD, PROD_CD ) thpsp ON
                    thp.HQ_OFFICE_CD = thpsp.HQ_OFFICE_CD
                    AND thp.PROD_CD = thpsp.PROD_CD
                WHERE
                    thp.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thp.USE_YN = 'Y'
                <if test="prodClassCd != null and prodClassCd != ''">
                    AND thp.PROD_CLASS_CD IN (
                                                SELECT
                                                    PROD_CLASS_CD
                                                FROM
                                                    TB_HQ_PRODUCT_CLASS
                                                WHERE
                                                    HQ_OFFICE_CD = #{hqOfficeCd}
                                                START WITH
                                                    PROD_CLASS_CD = #{prodClassCd}
                                                    AND HQ_OFFICE_CD = #{hqOfficeCd}
                                                CONNECT BY
                                                    PRIOR PROD_CLASS_CD = P_PROD_CLASS_CD
                                                    AND HQ_OFFICE_CD = #{hqOfficeCd}
                                             )
                </if>
                <if test="prodNm != null and prodNm != ''">
                    AND thp.PROD_NM LIKE '%'||#{prodNm}||'%'
                </if>
                ORDER BY thpc.PROD_CLASS_CD, thp.PROD_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmp.PROD_CD,
                    tmp.PROD_NM,
                    tmpc.PROD_CLASS_CD,
                    tmpc.PROD_CLASS_NM,
                    NVL(tmpsp.SALE_UPRC, 0) AS SALE_UPRC,
                    'N' AS TOUCHKEY_USED
                FROM
                    TB_MS_PRODUCT tmp
                LEFT OUTER JOIN TB_MS_PRODUCT_CLASS tmpc ON
                    tmp.STORE_CD = tmpc.STORE_CD
                    AND tmp.PROD_CLASS_CD = tmpc.PROD_CLASS_CD
                LEFT OUTER JOIN (
                    SELECT
                        STORE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                        ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_MS_PRODUCT_SALE_PRICE
                    WHERE
                        STORE_CD = #{storeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                        AND SALE_PRC_FG = #{salePrcFg}
                    GROUP BY
                        STORE_CD, PROD_CD ) tmpsp ON
                    tmp.STORE_CD = tmpsp.STORE_CD
                    AND tmp.PROD_CD = tmpsp.PROD_CD
                WHERE
                    tmp.STORE_CD = #{storeCd}
                    AND tmp.USE_YN = 'Y'
                <if test="prodClassCd != null and prodClassCd != ''">
                    AND tmp.PROD_CLASS_CD IN (
                                                SELECT
                                                    PROD_CLASS_CD
                                                FROM
                                                    TB_MS_PRODUCT_CLASS
                                                WHERE
                                                    STORE_CD = #{storeCd}
                                                START WITH
                                                    PROD_CLASS_CD = #{prodClassCd}
                                                    AND STORE_CD = #{storeCd}
                                                CONNECT BY
                                                    PRIOR PROD_CLASS_CD = P_PROD_CLASS_CD
                                                    AND STORE_CD = #{storeCd}
                                             )
                </if>
                <if test="prodNm != null and prodNm != ''">
                    AND tmp.PROD_NM LIKE '%'||#{prodNm}||'%'
                </if>
                ORDER BY tmpc.PROD_CLASS_CD, tmp.PROD_CD
            </when>
        </choose>
    </select>

    <!-- 터치키 페이지 스타일코드 조회 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    :
        COMMENTS : 터치키 분류 페이지별로 적용되어 있는 스타일코드를 조회한다.
    -->
    <select id="getTouchKeyPageStyleCd" parameterType="touchKeyClassVO" resultType="java.lang.String">
        /* USE : TouchKeyMapper.getTouchKeyPageStyleCd */
        <choose>
        <!-- 본사 -->
        <when test='orgnFg != null and orgnFg == "H"'>
            SELECT
                tkc.STYLE_CD
            FROM
                (
                SELECT
                    ROWNUM AS rnum,
                    thtkc.STYLE_CD
                FROM
                    TB_HQ_TOUCH_KEY_CLASS thtkc
                WHERE
                    thtkc.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thtkc.TUKEY_GRP_CD = #{tukeyGrpCd}
                    AND thtkc.PAGE_NO = #{pageNo}
                ORDER BY
                    TUKEY_CLASS_CD ) tkc
            WHERE
                tkc.rnum = 1
        </when>
        <!-- 매장 -->
        <when test='orgnFg != null and orgnFg == "S"'>
            SELECT
                tkc.STYLE_CD
            FROM
                (
                SELECT
                    ROWNUM AS rnum,
                    tmtkc.STYLE_CD
                FROM
                    TB_MS_TOUCH_KEY_CLASS tmtkc
                WHERE
                    tmtkc.STORE_CD = #{storeCd}
                    AND tmtkc.TUKEY_GRP_CD = #{tukeyGrpCd}
                    AND tmtkc.PAGE_NO = #{pageNo}
                ORDER BY
                    tmtkc.TUKEY_CLASS_CD ) tkc
            WHERE
                tkc.rnum = 1
        </when>
        </choose>
    </select>

    <!-- 터치키 스타일코드 조회 -->
    <!--
        TABLE    : TB_CM_TOUCH_KEY_STYLE
        PARAM    :
        COMMENTS : 터치키에 적용할 스타일코드를 조회한다.
    -->
    <select id="getTouchKeyStyleCdList" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyStyleCdList */
        SELECT
            tctks.STYLE_CD,
            tctks.STYLE_NM
        FROM
            TB_CM_TOUCH_KEY_STYLE tctks
        WHERE
            tctks.USE_YN = 'Y'
        ORDER BY
            tctks.STYLE_CD
    </select>

    <!-- 터치키 스타일 조회 -->
    <!--
        TABLE    : TB_CM_TOUCH_KEY_STYLE_DTL
        PARAM    :
        COMMENTS : 터치키에 적용할 스타일을 조회한다.
    -->
    <select id="getTouchKeyStyleList" parameterType="touchKeyStyleVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyStyleList */
        SELECT
            tctksd.STYLE_CD,
            tctksd.BUTTON_FG,
            tctksd.BUTTON_TAG_FG,
            tctksd.BUTTON_ON_COLOR,
            tctksd.BUTTON_OFF_COLOR,
            tctksd.FONT_ON_COLOR,
            tctksd.FONT_OFF_COLOR,
            tctksd.FONT_SIZE
        FROM
            TB_CM_TOUCH_KEY_STYLE_DTL tctksd
        <where>
            <if test='styleCd != "" and styleCd != null'>
            tctksd.STYLE_CD = #{styleCd}
            </if>
        </where>
        ORDER BY
            tctksd.STYLE_CD, tctksd.BUTTON_FG
    </select>

    <!-- 터치키 스타일 비교값 조회 -->
    <!--
        TABLE    : TB_CM_TOUCH_KEY_STYLE_DTL
        PARAM    :
        COMMENTS : 터치키 자료 입력시 비교할 스타일코드 값을 조회한다
    -->
    <select id="getTouchKeyStyleForCompare" parameterType="touchKeyStyleVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyStyleForCompare */
        SELECT
            FONT_SIZE,
            FONT_OFF_COLOR,
            BUTTON_OFF_COLOR
        FROM
            TB_CM_TOUCH_KEY_STYLE_DTL
        WHERE
            STYLE_CD = #{styleCd}
            AND BUTTON_FG = #{buttonFg}
            AND BUTTON_TAG_FG = #{buttonTagFg}

    </select>

    <!-- 판매터치키 XML 조회 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 조회한다.
    -->
    <select id="getTouchKeyXml" parameterType="DefaultMap" resultType="String">
        /* USE : TouchkeyMapper.getTouchKeyXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    XML
                FROM
                    TB_WB_HQ_CONFG_XML twhcx
                WHERE
                    twhcx.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND twhcx.CONFG_FG = #{confgFg}
                    AND twhcx.GRP_CD = #{tukeyGrpCd}
                    AND twhcx.USE_YN = 'Y'
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    XML
                FROM
                    TB_WB_STORE_CONFG_XML twscx
                WHERE
                    twscx.STORE_CD = #{storeCd}
                    AND twscx.CONFG_FG = #{confgFg}
                    AND twscx.GRP_CD = #{tukeyGrpCd}
                    AND twscx.USE_YN = 'Y'
            </when>
        </choose>
    </select>

    <!-- 판매터치키 저장 상품정보 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SALE_PRICE, TB_MS_PRODUCT_SALE_PRICE
        PARAM    : touchKeyVO
        COMMENTS : 판매터치키 구성에 존재하는 상품정보를 조회한다.
    -->
    <select id="getTouchKeyProdInfoList" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchKeyMapper.getTouchKeyProdInfoList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thtk.PROD_CD,
                    thp.PROD_NM,
                    TO_CHAR(NVL(thpsp.SALE_UPRC, 0), 'FM9,999,999') AS SALE_UPRC
                FROM
                    TB_HQ_TOUCH_KEY thtk
                LEFT OUTER JOIN TB_HQ_PRODUCT thp ON
                    thtk.HQ_OFFICE_CD = thp.HQ_OFFICE_CD
                    AND thtk.PROD_CD = thp.PROD_CD
                LEFT OUTER JOIN (
                    SELECT
                        HQ_OFFICE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                            ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_HQ_PRODUCT_SALE_PRICE
                    WHERE
                        HQ_OFFICE_CD = #{hqOfficeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                    GROUP BY
                    HQ_OFFICE_CD, PROD_CD ) thpsp ON
                    thtk.HQ_OFFICE_CD = thpsp.HQ_OFFICE_CD
                    AND thtk.PROD_CD = thpsp.PROD_CD
                WHERE
                    thtk.HQ_OFFICE_CD = #{hqOfficeCd}
                AND thtk.TUKEY_GRP_CD = #{tukeyGrpCd}
                GROUP BY
                    thtk.PROD_CD, thp.PROD_NM, thpsp.SALE_UPRC
                ORDER BY
                    thtk.PROD_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmtk.PROD_CD,
                    tmp.PROD_NM,
                    NVL(tmpsp.SALE_UPRC, 0) AS SALE_UPRC
                FROM
                    TB_MS_TOUCH_KEY tmtk
                LEFT OUTER JOIN TB_MS_PRODUCT tmp ON
                    tmtk.STORE_CD = tmp.STORE_CD
                    AND tmtk.PROD_CD = tmp.PROD_CD
                LEFT OUTER JOIN (
                    SELECT
                        STORE_CD,
                        PROD_CD,
                        MIN(SALE_UPRC) KEEP( DENSE_RANK FIRST
                            ORDER BY
                        START_DATE DESC ) AS SALE_UPRC
                    FROM
                        TB_MS_PRODUCT_SALE_PRICE
                    WHERE
                        STORE_CD = #{storeCd}
                        <![CDATA[
                        AND START_DATE <= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        AND END_DATE >= TO_CHAR(SYSDATE, 'yyyyMMdd')
                        ]]>
                    GROUP BY
                        STORE_CD, PROD_CD ) tmpsp ON
                    tmtk.STORE_CD = tmpsp.STORE_CD
                    AND tmtk.PROD_CD = tmpsp.PROD_CD
                WHERE
                    tmtk.STORE_CD = #{storeCd}
                AND tmtk.TUKEY_GRP_CD = #{tukeyGrpCd}
                GROUP BY
                    tmtk.PROD_CD, tmp.PROD_NM, tmpsp.SALE_UPRC
                ORDER BY
                    tmtk.PROD_CD
            </when>
        </choose>
    </select>

    <!-- 판매터치키 XML 생성 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 생성한다.
    -->
    <insert id="insertTouchKeyConfgXml" parameterType="DefaultMap">
        /* USE : TouchkeyMapper.insertTouchKeyConfgXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_WB_HQ_CONFG_XML twhcx
                (
                    twhcx.HQ_OFFICE_CD,
                    twhcx.CONFG_FG,
                    twhcx.XML,
                    twhcx.USE_YN,
                    twhcx.REG_DT,
                    twhcx.REG_ID,
                    twhcx.GRP_CD
                ) VALUES (
                    #{hqOfficeCd},
                    #{confgFg},
                    #{xml:CLOB},
                    #{useYn},
                    #{regDt},
                    #{regId},
                    #{tukeyGrpCd}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_WB_STORE_CONFG_XML twscx
                (
                    twscx.STORE_CD,
                    twscx.CONFG_FG,
                    twscx.XML,
                    twscx.USE_YN,
                    twscx.REG_DT,
                    twscx.REG_ID,
                    twscx.GRP_CD
                ) VALUES (
                    #{storeCd},
                    #{confgFg},
                    #{xml:CLOB},
                    #{useYn},
                    #{regDt},
                    #{regId},
                    #{tukeyGrpCd}
                )
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 XML 수정 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 구성 XML 정보를 수정한다.
    -->
    <update id="updateTouchKeyConfgXml" parameterType="DefaultMap">
        /* USE : TouchkeyMapper.updateTouchKeyConfgXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE
                    TB_WB_HQ_CONFG_XML twhcx
                SET
                    twhcx.XML = #{xml:CLOB},
                    twhcx.USE_YN = #{useYn},
                    twhcx.MOD_DT = #{regDt},
                    twhcx.MOD_ID = #{regId}
                WHERE
                    twhcx.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND twhcx.CONFG_FG = #{confgFg}
                    AND twhcx.GRP_CD = #{tukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE
                    TB_WB_STORE_CONFG_XML twscx
                SET
                    twscx.XML = #{xml:CLOB},
                    twscx.USE_YN = #{useYn},
                    twscx.MOD_DT = #{regDt},
                    twscx.MOD_ID = #{regId}
                WHERE
                    twscx.STORE_CD = #{storeCd}
                    AND twscx.CONFG_FG = #{confgFg}
                    AND twscx.GRP_CD = #{tukeyGrpCd}
            </when>
        </choose>
    </update>

    <!-- 판매터치키 그룹 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_CLASS, TB_MS_TOUCH_CLASS
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 그룹 정보를 생성한다.
    -->
    <insert id="insertTouchKeyClass" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.insertTouchKeyClass */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY_CLASS thtkc (
                    thtkc.HQ_OFFICE_CD,
                    thtkc.TUKEY_GRP_CD,
                    thtkc.TUKEY_CLASS_CD,
                    thtkc.TUKEY_CLASS_NM,
                    thtkc.PAGE_NO,
                    thtkc.PAGE_ROWS,
                    thtkc.X,
                    thtkc.Y,
                    thtkc.WIDTH,
                    thtkc.HEIGHT,
                    thtkc.STYLE_CD,
                    thtkc.FONT_SIZE,
                    thtkc.FONT_COLOR,
                    thtkc.FILL_COLOR,
                    thtkc.IMG_NM,
                    thtkc.REG_DT,
                    thtkc.REG_ID,
                    thtkc.MOD_DT,
                    thtkc.MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{tukeyGrpCd},
                    #{tukeyClassCd},
                    #{tukeyClassNm},
                    #{pageNo},
                    #{pageRows},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY_CLASS tmtkc (
                    tmtkc.STORE_CD,
                    tmtkc.TUKEY_GRP_CD,
                    tmtkc.TUKEY_CLASS_CD,
                    tmtkc.TUKEY_CLASS_NM,
                    tmtkc.PAGE_NO,
                    tmtkc.PAGE_ROWS,
                    tmtkc.X,
                    tmtkc.Y,
                    tmtkc.WIDTH,
                    tmtkc.HEIGHT,
                    tmtkc.STYLE_CD,
                    tmtkc.FONT_SIZE,
                    tmtkc.FONT_COLOR,
                    tmtkc.FILL_COLOR,
                    tmtkc.IMG_NM,
                    tmtkc.IN_FG,
                    tmtkc.REG_DT,
                    tmtkc.REG_ID,
                    tmtkc.MOD_DT,
                    tmtkc.MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{tukeyGrpCd},
                    #{tukeyClassCd},
                    #{tukeyClassNm},
                    #{pageNo},
                    #{pageRows},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{inFg},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 그룹 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 그룹 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyClass" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.deleteTouchKeyClass */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                DELETE
                FROM
                    TB_HQ_TOUCH_KEY_CLASS
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND TUKEY_GRP_CD = #{tukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                    TB_MS_TOUCH_KEY_CLASS
                WHERE
                    STORE_CD = #{storeCd}
                    AND TUKEY_GRP_CD  = #{tukeyGrpCd}
            </when>
        </choose>
    </delete>

    <!-- 판매터치키 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 정보를 생성한다.
    -->
    <insert id="insertTouchKey" parameterType="java.util.Map">
        /* USE : TouchkeyMapper.insertTouchKey */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY thtk (
                    thtk.HQ_OFFICE_CD,
                    thtk.TUKEY_CLASS_CD,
                    thtk.TUKEY_GRP_CD,
                    thtk.TUKEY_CD,
                    thtk.TUKEY_FG,
                    thtk.PROD_CD,
                    thtk.PAGE_NO,
                    thtk.X,
                    thtk.Y,
                    thtk.WIDTH,
                    thtk.HEIGHT,
                    thtk.STYLE_CD,
                    thtk.FONT_SIZE,
                    thtk.FONT_COLOR,
                    thtk.FILL_COLOR,
                    thtk.IMG_NM,
                    thtk.REG_DT,
                    thtk.REG_ID,
                    thtk.MOD_DT,
                    thtk.MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{tukeyClassCd},
                    #{tukeyGrpCd},
                    #{tukeyCd},
                    #{tukeyFg},
                    #{prodCd},
                    #{pageNo},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY tmtk (
                    tmtk.STORE_CD,
                    tmtk.TUKEY_CLASS_CD,
                    tmtk.TUKEY_GRP_CD,
                    tmtk.TUKEY_CD,
                    tmtk.TUKEY_FG,
                    tmtk.PROD_CD,
                    tmtk.PAGE_NO,
                    tmtk.X,
                    tmtk.Y,
                    tmtk.WIDTH,
                    tmtk.HEIGHT,
                    tmtk.STYLE_CD,
                    tmtk.FONT_SIZE,
                    tmtk.FONT_COLOR,
                    tmtk.FILL_COLOR,
                    tmtk.IMG_NM,
                    tmtk.IN_FG,
                    tmtk.REG_DT,
                    tmtk.REG_ID,
                    tmtk.MOD_DT,
                    tmtk.MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{tukeyClassCd},
                    #{tukeyGrpCd},
                    #{tukeyCd},
                    #{tukeyFg},
                    #{prodCd},
                    #{pageNo},
                    #{x},
                    #{y},
                    #{width},
                    #{height},
                    #{styleCd},
                    #{fontSize, jdbcType=NUMERIC},
                    #{fontColor, jdbcType=VARCHAR},
                    #{fillColor, jdbcType=VARCHAR},
                    #{imgNm, jdbcType=VARCHAR},
                    #{inFg},
                    #{regDt},
                    #{regId},
                    #{regDt},
                    #{regId}
                )
            </when>
        </choose>
    </insert>

    <!-- 판매터치키 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : touchKeyClassVO
        COMMENTS : 판매터치키 정보를 삭제한다.
    -->
    <delete id="deleteTouchKey" parameterType="touchKeyClassVO">
        /* USE : TouchkeyMapper.deleteTouchKey */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                DELETE
                FROM
                    TB_HQ_TOUCH_KEY
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                AND TUKEY_GRP_CD = #{tukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                DELETE
                FROM
                    TB_MS_TOUCH_KEY
                WHERE
                    STORE_CD = #{storeCd}
                AND TUKEY_GRP_CD = #{tukeyGrpCd}
            </when>
        </choose>

    </delete>

    <!-- 매장목록 조회 -->
    <!--
        TABLE    : TB_MS_STORE
        PARAM    : touchKeyVO
        COMMENTS : 매장목록을 조회한다.
    -->
    <select id="getStoreList" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getStoreList */
        SELECT
            tms.STORE_CD,
            tms.STORE_NM,
            tcm_sys_stat_fg.NMCODE_NM AS sys_stat_fg_nm,
            tcm_cls_stat_fg.NMCODE_NM AS cls_fg_nm
        FROM
            TB_MS_STORE tms
        LEFT OUTER JOIN TB_CM_NMCODE tcm_sys_stat_fg ON
            tms.SYS_STAT_FG = tcm_sys_stat_fg.NMCODE_CD
            AND tcm_sys_stat_fg.NMCODE_GRP_CD = '005'
        LEFT OUTER JOIN TB_CM_NMCODE tcm_cls_stat_fg ON
            tms.CLS_FG = tcm_cls_stat_fg.NMCODE_CD
            AND tcm_cls_stat_fg.NMCODE_GRP_CD = '001'
        WHERE
            tms.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='storeNm != null and storeNm != ""'>
            AND tms.STORE_NM LIKE '%'||#{storeNm}||'%'
        </if>
        <if test='sysStatFg != null and sysStatFg.toString() != ""'>
            AND tms.SYS_STAT_FG = #{sysStatFg}
        </if>
        <if test='clsFg != null and clsFg != ""'>
            AND tms.CLS_FG = #{clsFg}
        </if>
    </select>

    <!-- 판매터치키 분류 매장삭제 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 매장에 적용되어 있는 판매터치키 분류 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyClassToStore" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.deleteTouchKeyClassToStore */
        DELETE
        FROM
            TB_MS_TOUCH_KEY_CLASS
        WHERE
            STORE_CD = #{storeCd}
            AND TUKEY_GRP_CD  = #{tukeyGrpCd}
    </delete>

    <!-- 판매터치키 매장삭제 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 매장에 적용되어 있는 판매터치키 정보를 삭제한다.
    -->
    <delete id="deleteTouchKeyToStore" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.deleteTouchKeyToStore */
        DELETE
        FROM
            TB_MS_TOUCH_KEY
        WHERE
            STORE_CD = #{storeCd}
            AND TUKEY_GRP_CD  = #{tukeyGrpCd}
    </delete>

    <!-- 판매터치키 분류 생성 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 분류 정보를 생성한다.
    -->
    <insert id="insertTouchKeyClassToStore" parameterType="touchKeyVO">

        /* USE : TouchkeyMapper.insertTouchKey */
        INSERT INTO TB_MS_TOUCH_KEY_CLASS
        SELECT
            #{storeCd} AS STORE_CD,
            TUKEY_GRP_CD,
            TUKEY_CLASS_CD,
            TUKEY_CLASS_NM,
            PAGE_NO,
            PAGE_ROWS,
            X,
            Y,
            WIDTH,
            HEIGHT,
            STYLE_CD,
            FONT_SIZE,
            FONT_COLOR,
            FILL_COLOR,
            IMG_NM,
            'H',
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        FROM
            TB_HQ_TOUCH_KEY_CLASS
        WHERE
            HQ_OFFICE_CD = #{hqOfficeCd}
            AND TUKEY_GRP_CD = #{tukeyGrpCd}

    </insert>

    <!-- 판매터치키 생성 -->
    <!--
        TABLE    : TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 정보를 생성한다.
    -->
    <insert id="insertTouchKeyToStore" parameterType="touchKeyVO">

        /* USE : TouchkeyMapper.insertTouchKeyToStore */
        INSERT INTO TB_MS_TOUCH_KEY
        SELECT
            #{storeCd} AS STORE_CD,
            TUKEY_CLASS_CD,
            TUKEY_CD,
            TUKEY_FG,
            PROD_CD,
            PAGE_NO,
            X,
            Y,
            WIDTH,
            HEIGHT,
            STYLE_CD,
            FONT_SIZE,
            FONT_COLOR,
            FILL_COLOR,
            IMG_NM,
            'H',
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID,
            TUKEY_GRP_CD
        FROM
            TB_HQ_TOUCH_KEY
        WHERE
            HQ_OFFICE_CD = #{hqOfficeCd}
            AND TUKEY_GRP_CD = #{tukeyGrpCd}

    </insert>

    <!-- 판매터치키 XML 정보생성 -->
    <!--
        TABLE    : TB_WB_STORE_CONFG_XML
        PARAM    : touchKeyVO
        COMMENTS : 매장에 판매터치키 XML 정보를 생성한다.
    -->
    <update id="saveStoreConfgXml" parameterType="touchKeyVO">
        /* TouchkeyMapper.saveStoreConfgXml */
        MERGE INTO TB_WB_STORE_CONFG_XML twscx
        USING
        (
            SELECT
                #{storeCd} AS STORE_CD,
                CONFG_FG,
                XML,
                USE_YN,
                GRP_CD
            FROM
                TB_WB_HQ_CONFG_XML
            WHERE
                HQ_OFFICE_CD = #{hqOfficeCd}
                AND CONFG_FG = '10'
                AND GRP_CD = #{tukeyGrpCd}
        ) ORG
        ON
        (
            twscx.STORE_CD = ORG.STORE_CD
            AND twscx.CONFG_FG = ORG.CONFG_FG
            AND twscx.GRP_CD = ORG.GRP_CD
        )
        WHEN MATCHED THEN
            UPDATE
            SET
                twscx.XML = ORG.XML,
                twscx.USE_YN = 'Y',
                twscx.MOD_DT = #{regDt},
                twscx.MOD_ID = #{regId}
        WHEN NOT MATCHED THEN
            INSERT
            (
                twscx.STORE_CD,
                twscx.CONFG_FG,
                twscx.XML,
                twscx.USE_YN,
                twscx.REG_DT,
                twscx.REG_ID,
                twscx.GRP_CD
            )
            VALUES
            (
                #{storeCd},
                ORG.CONFG_FG,
                ORG.XML,
                'Y',
                #{regDt},
                #{regId},
                #{tukeyGrpCd}
            )
  </update>

    <!-- 판매터치키 그룹 조회 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : DefaultMap
        COMMENTS : 판매터치키 그룹(템플릿)을 조회한다.
    -->
    <select id="getTouchKeyGrp" parameterType="touchKeyVO" resultType="DefaultMap">
        /* USE : TouchkeyMapper.getTouchKeyGrp */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                      TUKEY_GRP_CD AS NAME,
                      TUKEY_GRP_CD AS VALUE
                FROM
                      TB_HQ_TOUCH_KEY_CLASS
                WHERE
                      HQ_OFFICE_CD = #{hqOfficeCd}
                GROUP BY TUKEY_GRP_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                      TUKEY_GRP_CD AS NAME,
                      TUKEY_GRP_CD AS VALUE
                FROM
                      TB_MS_TOUCH_KEY_CLASS
                WHERE
                      STORE_CD = #{storeCd}
                GROUP BY TUKEY_GRP_CD
            </when>
        </choose>
    </select>

    <!-- 터치키 그룹코드 생성 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : DefaultMap
        COMMENTS : 터치키 그룹코드를 생성한다. ( 본사/매장 )
    -->
    <select id="getTouchKeyGrpCd" parameterType="DefaultMap" resultType="String">
        /* USE : TouchkeyMapper.getTouchKeyGrpCd */
        <choose>
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT LPAD( NVL(MAX(TUKEY_GRP_CD), 0) + 1, 2, '0') AS TUKEY_GRP_CD
                FROM TB_HQ_TOUCH_KEY_CLASS
                WHERE HQ_OFFICE_CD = #{hqOfficeCd}
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT LPAD( NVL(MAX(TUKEY_GRP_CD), 0) + 1, 2, '0') AS TUKEY_GRP_CD
                FROM TB_MS_TOUCH_KEY_CLASS
                WHERE STORE_CD  = #{storeCd}
            </when>
        </choose>
    </select>

    <!-- 터치키 XML 데이터 복사 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_WB_STORE_CONFG_XML
        PARAM    : touchKeyVO
        COMMENTS : 터치키 XML 데이터 복사
    -->
    <insert id="copyTouchKeyGrpXml" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.copyTouchKeyGrpXml */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_WB_HQ_CONFG_XML
                (
                HQ_OFFICE_CD,
                CONFG_FG,
                XML,
                USE_YN,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                GRP_CD
                )
                SELECT HQ_OFFICE_CD,
                        CONFG_FG,
                        XML,
                        USE_YN,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId},
                        #{tukeyGrpCd}
                  FROM TB_WB_HQ_CONFG_XML
                 WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                    AND CONFG_FG = '10'
                    AND GRP_CD = #{copyTukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_WB_STORE_CONFG_XML
                (
                STORE_CD,
                CONFG_FG,
                XML,
                USE_YN,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                GRP_CD
                )
                SELECT STORE_CD,
                        CONFG_FG,
                        XML,
                        USE_YN,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId},
                        #{tukeyGrpCd}
                  FROM TB_WB_STORE_CONFG_XML
                 WHERE STORE_CD = #{storeCd}
                   AND CONFG_FG = '10'
                   AND GRP_CD = #{copyTukeyGrpCd}
            </when>
        </choose>
    </insert>

    <!-- 터치키 CLASS 데이터 복사 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS, TB_MS_TOUCH_KEY_CLASS
        PARAM    : touchKeyVO
        COMMENTS : 터치키 CLASS 데이터 복사
    -->
    <insert id="copyTouchKeyGrpClass" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.copyTouchKeyGrpClass */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY_CLASS
                (
                HQ_OFFICE_CD,
                TUKEY_GRP_CD,
                TUKEY_CLASS_CD,
                TUKEY_CLASS_NM,
                PAGE_NO,
                PAGE_ROWS,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID
                )
                SELECT HQ_OFFICE_CD,
                        #{tukeyGrpCd},
                        TUKEY_CLASS_CD,
                        TUKEY_CLASS_NM,
                        PAGE_NO,
                        PAGE_ROWS,
                        X,
                        Y,
                        WIDTH,
                        HEIGHT,
                        STYLE_CD,
                        FONT_SIZE,
                        FONT_COLOR,
                        FILL_COLOR,
                        IMG_NM,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId}
                  FROM TB_HQ_TOUCH_KEY_CLASS
                 WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                   AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY_CLASS
                (
                STORE_CD,
                TUKEY_GRP_CD,
                TUKEY_CLASS_CD,
                TUKEY_CLASS_NM,
                PAGE_NO,
                PAGE_ROWS,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                IN_FG,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID
                )
                SELECT STORE_CD,
                        #{tukeyGrpCd},
                        TUKEY_CLASS_CD,
                        TUKEY_CLASS_NM,
                        PAGE_NO,
                        PAGE_ROWS,
                        X,
                        Y,
                        WIDTH,
                        HEIGHT,
                        STYLE_CD,
                        FONT_SIZE,
                        FONT_COLOR,
                        FILL_COLOR,
                        IMG_NM,
                        IN_FG,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId}
                  FROM TB_MS_TOUCH_KEY_CLASS
                 WHERE STORE_CD = #{storeCd}
                   AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
        </choose>
    </insert>

    <!-- 터치키 데이터 복사 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY, TB_MS_TOUCH_KEY
        PARAM    : touchKeyVO
        COMMENTS : 터치키 데이터 복사
    -->
    <insert id="copyTouchKeyGrp" parameterType="touchKeyVO">
        /* USE : TouchkeyMapper.copyTouchKeyGrp */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_TOUCH_KEY
                (
                HQ_OFFICE_CD,
                TUKEY_CLASS_CD,
                TUKEY_CD,
                TUKEY_FG,
                PROD_CD,
                PAGE_NO,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                TUKEY_GRP_CD
                )
                SELECT HQ_OFFICE_CD,
                        TUKEY_CLASS_CD,
                        TUKEY_CD,
                        TUKEY_FG,
                        PROD_CD,
                        PAGE_NO,
                        X,
                        Y,
                        WIDTH,
                        HEIGHT,
                        STYLE_CD,
                        FONT_SIZE,
                        FONT_COLOR,
                        FILL_COLOR,
                        IMG_NM,
                        #{regDt},
                        #{regId},
                        #{modDt},
                        #{modId},
                        #{tukeyGrpCd}
                  FROM TB_HQ_TOUCH_KEY
                 WHERE HQ_OFFICE_CD = #{hqOfficeCd}
                   AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_TOUCH_KEY
                (
                STORE_CD,
                TUKEY_CLASS_CD,
                TUKEY_CD,
                TUKEY_FG,
                PROD_CD,
                PAGE_NO,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                IN_FG,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID,
                TUKEY_GRP_CD
                )
                SELECT STORE_CD,
                TUKEY_CLASS_CD,
                TUKEY_CD,
                TUKEY_FG,
                PROD_CD,
                PAGE_NO,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                IN_FG,
                #{regDt},
                #{regId},
                #{modDt},
                #{modId},
                #{tukeyGrpCd}
                FROM TB_MS_TOUCH_KEY
                WHERE STORE_CD = #{storeCd}
                AND TUKEY_GRP_CD = #{copyTukeyGrpCd}
            </when>
        </choose>
    </insert>

</mapper>
