<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    Pupup.xml
    공통 팝업 관련
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김지은     2018.06.08     최초작성
-->

<mapper namespace="kr.co.common.service.popup.impl.PopupMapper">

    <!-- 벤사목록조회 -->
    <!--
        TABLE    : TB_CM_VAN_CMPNY
        PARAM    : vanVO
        COMMENTS : 벤사 목록을 조회한다.
    -->
    <select id="getVanList" parameterType="vanVO" resultType="DefaultMap">
        /* USE : PopupMapper.getStoreList */
        SELECT VAN_FG,
               VAN_CD,
               VAN_NM
         FROM TB_CM_VAN_CMPNY
      <where>
        <if test='vanFg != null and vanFg != ""'>
              VAN_FG = #{vanFg}
        </if>
        <if test='vanCd != null and vanCd != ""'>
          AND VAN_CD = #{vanCd}
        </if>
        <if test='vanNm != null and vanNm != ""'>
          AND VAN_NM LIKE '%'||#{vanNm}||'%'
        </if>
      </where>
        ORDER BY VAN_FG, VAN_CD ASC
    </select>

    <!-- 대리점목록조회 -->
    <!--
        TABLE    : TB_CM_AGENCY
        PARAM    : agencyVO
        COMMENTS : 대리점 목록을 조회한다.
    -->
    <select id="getAgencyList" parameterType="agencyVO" resultType="DefaultMap">
      /* USE : PopupMapper.getAgencyList */
      SELECT AGENCY_CD,
             AGENCY_NM
        FROM TB_CM_AGENCY
       WHERE P_AGENCY_CD IS NOT NULL
        <if test='agencyCd != null and agencyCd != ""'>
         AND AGENCY_CD = #{agencyCd}
        </if>
        <if test='agencyNm != null and agencyNm != ""'>
         AND AGENCY_NM LIKE '%'||#{agencyNm}||'%'
        </if>
       ORDER BY AGENCY_CD ASC
    </select>

    <!-- 본사 목록조회 -->
    <!--
        TABLE    : TB_HQ_OFFICE
        PARAM    : hqOfficeVO
        COMMENTS : 본사 목록을 조회한다.
    -->
    <select id="getHqList" parameterType="hqOfficeVO" resultType="DefaultMap">
        /* USE : PopupMapper.getHqList */
      <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT HQ_OFFICE_CD,
               HQ_OFFICE_NM,
               OWNER_NM,
               SYS_STAT_FG,
               CLS_FG
      <include refid="CmmSQL.PagingTemplateCount"/>
          FROM TB_HQ_OFFICE
        <where>
            <if test='hqOfficeCd != null and hqOfficeCd != ""'>
               HQ_OFFICE_CD = #{hqOfficeCd}
            </if>
            <if test='hqOfficeNm != null and hqOfficeNm != ""'>
           AND HQ_OFFICE_NM LIKE '%'||#{hqOfficeNm}||'%'
            </if>
        </where>
         ORDER BY HQ_OFFICE_CD ASC
      <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 매장선택 조회 -->
    <!--
        TABLE    : TB_MS_STORE
        PARAM    : storeManageVO
        COMMENTS : 매장선택 리스트를 조회한다.
    -->
    <select id="getStoreList" parameterType="storeManageVO" resultType="DefaultMap">
      /* USE : PopupMapper.selectStoreList */
      <include refid="CmmSQL.PagingTemplateHeader"/>
      <![CDATA[
          SELECT  tms.STORE_CD, tms.STORE_NM
          ]]>
      <include refid="CmmSQL.PagingTemplateCount"/>
      <![CDATA[
          FROM    TB_MS_STORE tms
          WHERE   tms.HQ_OFFICE_CD =   #{hqOfficeCd}
          ]]>
      <if test='storeCd != null and storeCd != ""'>
        AND tms.STORE_CD = #{storeCd}
      </if>
      <if test='storeNm != null and storeNm != ""'>
        AND tms.STORE_NM LIKE '%'||#{storeNm}||'%'
      </if>
      ORDER BY tms.STORE_CD
      <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 상품분류 트리 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_CLASS, TB_MS_PRODUCT_CLASS,
        PARAM    : prodVO
        COMMENTS : 상품 분류를 트리뷰 목록으로 조회한다.
    -->
    <select id="getProdClassTree" parameterType="prodVO" resultType="productClassVO">
        /* USE : PopupMapper.getProdClassTree */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thpc.P_PROD_CLASS_CD,
                    thpc.PROD_CLASS_CD,
                    thpc.PROD_CLASS_NM
                FROM
                    TB_HQ_PRODUCT_CLASS thpc
                WHERE
                    thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                START WITH
                    thpc.P_PROD_CLASS_CD = '00000'
                    AND thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                CONNECT BY
                    thpc.P_PROD_CLASS_CD = PRIOR thpc.PROD_CLASS_CD
                    AND thpc.HQ_OFFICE_CD = #{hqOfficeCd}
            </when>
            <!-- 가맹점 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmpc.P_PROD_CLASS_CD,
                    tmpc.PROD_CLASS_CD,
                    tmpc.PROD_CLASS_NM
                FROM
                    TB_MS_PRODUCT_CLASS tmpc
                WHERE
                    tmpc.STORE_CD = #{storeCd}
                START WITH
                    tmpc.P_PROD_CLASS_CD = '00000'
                    AND tmpc.STORE_CD = #{storeCd}
                CONNECT BY
                    tmpc.P_PROD_CLASS_CD = PRIOR tmpc.PROD_CLASS_CD
                    AND tmpc.STORE_CD = #{storeCd}
            </when>
        </choose>
    </select>

    <!-- 상품분류 플랫 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_CLASS, TB_MS_PRODUCT_CLASS,
        PARAM    : prodVO
        COMMENTS : 상품 분류명을 플랫 형태로 조회한다.
    -->
    <select id="getProdClassCdNm" parameterType="prodVO" resultType="java.lang.String">
        /* USE : PopupMapper.getProdClassCdNm */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    SF_GET_PROD_CLASSES('H', #{hqOfficeCd}, #{prodClassCd}) AS PROD_CLASS_CD_NM
                FROM
                    DUAL
            </when>
            <!-- 가맹점 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    SF_GET_PROD_CLASSES('S', #{storeCd}, #{prodClassCd}) AS PROD_CLASS_CD_NM
                FROM
                    DUAL
            </when>
        </choose>

    </select>

</mapper>
