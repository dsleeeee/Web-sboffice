<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    DaySaleReport.xml
    일별매출내역 다운로드(제너시스올떡 분식대장)
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김설아     2021.12.08     최초작성
-->
<mapper namespace="kr.co.solbipos.sale.status.daySaleReport.service.impl.DaySaleReportMapper">

    <!-- 일별매출내역 다운로드 - 조회 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <select id="getDaySaleReportList"  parameterType="DaySaleReportVO" resultType="DefaultMap">
        /* DaySaleReportMapper.getDaySaleReportList */
        SELECT
        SUBSTR(thsr.FROM_SALE_DATE, 0, 6) AS SALE_MONTH,
        '전체매장통합파일' AS PROC_GUBUN,
        thsr.PROC_DT,
        (SELECT USER_NM FROM TB_WB_USER_INFO_DTL_V01 WHERE USER_ID = thsr.REG_ID) AS USER_NM,
        thsr.PROC_FG,
        '다운로드' AS DOWNLOAD,
        thsr.FROM_SALE_DATE,
        thsr.TO_SALE_DATE,
        thsr.FILE_NAME
        FROM TB_HQ_SALE_REPORT thsr
        WHERE 1=1
        AND thsr.HQ_OFFICE_CD = #{hqOfficeCd}
        <![CDATA[
            AND thsr.FROM_SALE_DATE >= #{startMonth}||'01'
            AND thsr.TO_SALE_DATE <= #{endMonth}||'31'
        ]]>
        AND thsr.REPORT_TYPE = '02'
        ORDER BY thsr.FROM_SALE_DATE DESC
    </select>

    <!-- 일별매출내역 다운로드 - 자료생성 저장 insert -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <insert id="getDaySaleReportSaveInsert" parameterType="DaySaleReportVO">
        /* DaySaleReportMapper.getDaySaleReportSaveInsert */
        INSERT INTO TB_HQ_SALE_REPORT
        (
            HQ_OFFICE_CD,
            HQ_BRAND_CD,
            REQ_DATE,
            REQ_TIME,
            REPORT_TYPE,
            FROM_SALE_DATE,
            TO_SALE_DATE,
            PROC_FG,
            PROC_MSG,
            PROC_DT,
            FILE_NAME,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        ) VALUES (
            #{hqOfficeCd},
            '0000000',
            #{reqDate},
            #{reqTime},
            '02',
            #{dataCreateMonth}||'01',
            #{dataCreateMonth}||'31',
            '0',
            '',
            '',
            '',
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
    </insert>

    <!-- 일별매출내역 다운로드 - 삭제 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <delete id="getDaySaleReportDel" parameterType="DaySaleReportVO">
        /* DaySaleReportMapper.getDaySaleReportDel */
        DELETE TB_HQ_SALE_REPORT
        WHERE 1=1
        AND HQ_OFFICE_CD = #{hqOfficeCd}
        AND FROM_SALE_DATE = #{fromSaleDate}
        AND TO_SALE_DATE = #{toSaleDate}
        AND REPORT_TYPE = '02'
    </delete>

    <!-- 일별매출내역 다운로드 - 자료생성 요청건 존재여부 확인 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <select id="getDaySaleReportChk" parameterType="DaySaleReportVO" resultType="DefaultMap">
        /* DaySaleReportMapper.getDaySaleReportChk */
        SELECT
        COUNT(thsr.REPORT_TYPE) AS CNT
        FROM TB_HQ_SALE_REPORT thsr
        WHERE 1=1
        AND thsr.HQ_OFFICE_CD = #{hqOfficeCd}
        AND thsr.FROM_SALE_DATE = #{dataCreateMonth}||'01'
        AND thsr.TO_SALE_DATE = #{dataCreateMonth}||'31'
        AND thsr.REPORT_TYPE = '02'
    </select>

</mapper>