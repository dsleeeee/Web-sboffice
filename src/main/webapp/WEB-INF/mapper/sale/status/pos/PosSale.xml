<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    PosSaleMapper.xml
    포스별
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김진       2020.02.06     최초작성
    2       김설아     2021.01.04
-->
<mapper namespace="kr.co.solbipos.sale.status.pos.service.impl.PosSaleMapper">

    <!-- 포스별매출일자별 - 리스트 조회 -->
    <!--
        TABLE    : TB_SL_DAILY_POS_PROD, TB_SL_DAILY_POS, TB_MS_POS
        PARAM    : posDayVO
        COMMENTS : 포스별매출일자별 - 리스트를 조회한다.
    -->
    <select id="getPosDayList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosDayList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT	TO_CHAR(TO_DATE(A.SALE_DATE, 'yyyymmdd'), 'yyyy-mm-dd') AS SALE_DATE
                , TO_CHAR(TO_DATE(A.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean') AS DAY_NAME
                , A.SALE_STORE_CNT
                , A.TOT_SALE_AMT
                , A.TOT_DC_AMT
                , A.TOT_REAL_SALE_AMT
                , A.TOT_SALE_CNT
                , B.*
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM	(
            SELECT	TSDP.SALE_DATE
                    , COUNT(DISTINCT TSDP.STORE_CD) AS SALE_STORE_CNT
                    , SUM(TSDP.TOT_SALE_AMT) AS TOT_SALE_AMT
                    , SUM(TSDP.TOT_DC_AMT) AS TOT_DC_AMT
                    , SUM(TSDP.REAL_SALE_AMT) AS TOT_REAL_SALE_AMT
                    , SUM(TSDP.SALE_CNT) AS TOT_SALE_CNT
            FROM	TB_SL_DAILY_POS TSDP
            WHERE	1 = 1
            AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
            <if test='arrStorePos != null and arrStorePos.length >= 0'>
                AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test='startDate != null and startDate != ""'>
                AND TSDP.SALE_DATE >= #{startDate}
            </if>
            <if test='endDate != null and endDate != ""'>
                AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
            </if>
            GROUP BY TSDP.SALE_DATE
        ) A,
        (
            WITH T AS
            (
                SELECT	DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
                    , TSDP.SALE_DATE AS SALE_DATE_TEMP
                    , TSDP.TOT_SALE_AMT AS SALE_AMT
                    , TSDP.TOT_DC_AMT AS DC_AMT
                    , TSDP.REAL_SALE_AMT AS REAL_SALE_AMT
                    , TSDP.SALE_CNT AS SALE_CNT
                FROM    TB_SL_DAILY_POS TSDP
                WHERE   1 = 1
                AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
                <if test='arrStorePos != null and arrStorePos.length >= 0'>
                    AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                    <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
                <if test='startDate != null and startDate != ""'>
                    AND TSDP.SALE_DATE >= #{startDate}
                </if>
                <if test='endDate != null and endDate != ""'>
                    AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
                </if>
            )
            SELECT  *
            FROM    T
            PIVOT	(
                        MAX(SALE_AMT) AS SALE_AMT, MAX(DC_AMT) AS DC_AMT, MAX(REAL_SALE_AMT) AS REAL_SALE_AMT, MAX(SALE_CNT) AS SALE_CNT
                        FOR STORE_CD IN (
                                            <foreach collection="arrStorePos" item="item" separator=",">
                                                '${item}'
                                            </foreach>
                                            )
                    )
        ) B
        WHERE   A.SALE_DATE = B.SALE_DATE_TEMP
        ORDER BY A.SALE_DATE
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <select id="getPosDayExcelList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosDayExcelList */
        SELECT	TO_CHAR(TO_DATE(A.SALE_DATE, 'yyyymmdd'), 'yyyy-mm-dd') AS SALE_DATE
                , TO_CHAR(TO_DATE(A.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean') AS DAY_NAME
                , A.SALE_STORE_CNT
                , A.TOT_SALE_AMT
                , A.TOT_DC_AMT
                , A.TOT_REAL_SALE_AMT
                , A.TOT_SALE_CNT
                , B.*
        FROM	(
                SELECT	TSDP.SALE_DATE
                        , COUNT(DISTINCT TSDP.STORE_CD) AS SALE_STORE_CNT
                        , SUM(TSDP.TOT_SALE_AMT) AS TOT_SALE_AMT
                        , SUM(TSDP.TOT_DC_AMT) AS TOT_DC_AMT
                        , SUM(TSDP.REAL_SALE_AMT) AS TOT_REAL_SALE_AMT
                        , SUM(TSDP.SALE_CNT) AS TOT_SALE_CNT
                FROM	TB_SL_DAILY_POS TSDP
                WHERE	1 = 1
                AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
                <if test='arrStorePos != null and arrStorePos.length >= 0'>
                    AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                    <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
                <if test='startDate != null and startDate != ""'>
                    AND TSDP.SALE_DATE >= #{startDate}
                </if>
                <if test='endDate != null and endDate != ""'>
                    AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
                </if>
                GROUP BY TSDP.SALE_DATE
        ) A,
        (
            WITH T AS
            (
                SELECT	DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
                        , TSDP.SALE_DATE AS SALE_DATE_TEMP
                        , TSDP.TOT_SALE_AMT AS SALE_AMT
                        , TSDP.TOT_DC_AMT AS DC_AMT
                        , TSDP.REAL_SALE_AMT AS REAL_SALE_AMT
                        , TSDP.SALE_CNT AS SALE_CNT
                FROM    TB_SL_DAILY_POS TSDP
                WHERE   1 = 1
                AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
                <if test='arrStorePos != null and arrStorePos.length >= 0'>
                    AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                    <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
                <if test='startDate != null and startDate != ""'>
                    AND TSDP.SALE_DATE >= #{startDate}
                </if>
                <if test='endDate != null and endDate != ""'>
                    AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
                </if>
            )
            SELECT  *
            FROM    T
            PIVOT	(
                        MAX(SALE_AMT) AS SALE_AMT, MAX(DC_AMT) AS DC_AMT, MAX(REAL_SALE_AMT) AS REAL_SALE_AMT, MAX(SALE_CNT) AS SALE_CNT
                        FOR STORE_CD IN (
                                        <foreach collection="arrStorePos" item="item" separator=",">
                                            '${item}'
                                        </foreach>
                                        )
                    )
        ) B
        WHERE   A.SALE_DATE = B.SALE_DATE_TEMP
        ORDER BY A.SALE_DATE
    </select>

    <select id="getStorePosList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getStorePosList */
        SELECT	DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
        FROM	TB_SL_DAILY_POS TSDP
                , TB_SL_DAILY_POS_PROD TSDPP
        WHERE	TSDP.HQ_OFFICE_CD = TSDPP.HQ_OFFICE_CD
        AND TSDP.HQ_BRAND_CD = TSDPP.HQ_BRAND_CD
        AND TSDP.STORE_CD = TSDPP.STORE_CD
        AND TSDP.SALE_DATE = TSDPP.SALE_DATE
        AND TSDP.POS_NO = TSDPP.POS_NO
        AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND TSDP.STORE_CD IN (${storeCdQuery})
        </if>
        <if test='arrPosNo != null and arrPosNo != ""'>
            AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
            <foreach collection="arrPosNo" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test='startDate != null and startDate != ""'>
            AND TSDP.SALE_DATE >= #{startDate}
        </if>
        <if test='endDate != null and endDate != ""'>
            AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
        </if>
        ORDER BY TSDP.STORE_CD||'||'||TSDP.POS_NO
    </select>

    <select id="getPosNmList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosNmList */
        SELECT	TMP.STORE_CD||'||'||TMP.POS_NO AS POS_CD
                , TMP.POS_NM AS POS_NM
                , (SELECT STORE_NM FROM TB_MS_STORE WHERE STORE_CD = TMP.STORE_CD) AS STORE_NM
        FROM    TB_MS_POS TMP
                , TB_MS_STORE TMS
        WHERE	TMP.STORE_CD = TMS.STORE_CD
        <if test='hqOfficeCd != null and hqOfficeCd != ""'>
            AND TMS.HQ_OFFICE_CD = #{hqOfficeCd}
        </if>
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND TMP.STORE_CD IN (${storeCdQuery})
        </if>
        <if test='arrPosNo != null and arrPosNo.length >= 0'>
            AND TMP.STORE_CD||'||'||TMP.POS_NO IN
            <foreach collection="arrPosNo" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        ORDER BY TMP.STORE_CD||'||'||TMP.POS_NO
    </select>

    <!-- 포스별매출요일별 - 리스트 조회 -->
    <!--
        TABLE    : TB_SL_DAILY_POS_PROD, TB_SL_DAILY_POS, TB_MS_POS
        PARAM    : posDayOfWeekVO
        COMMENTS : 포스별매출요일별 - 리스트를 조회한다.
    -->
    <select id="getPosDayOfWeekList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosDayOfWeekList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT	A.DAY_NAME
                , A.DAY_ORDER
                , A.SALE_STORE_CNT
                , A.TOT_SALE_AMT
                , A.TOT_DC_AMT
                , A.TOT_REAL_SALE_AMT
                , A.TOT_SALE_CNT
                , B.*
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM	(
            SELECT	TO_CHAR(TO_DATE(TSDP.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean') AS DAY_NAME
                    , CASE TO_CHAR(TO_DATE(TSDP.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean')
                    WHEN '월' THEN 1
                    WHEN '화' THEN 2
                    WHEN '수' THEN 3
                    WHEN '목' THEN 4
                    WHEN '금' THEN 5
                    WHEN '토' THEN 6
                    ELSE 0
                    END AS DAY_ORDER
                    , COUNT(DISTINCT TSDP.STORE_CD) AS SALE_STORE_CNT
                    , SUM(TSDP.TOT_SALE_AMT) AS TOT_SALE_AMT
                    , SUM(TSDP.TOT_DC_AMT) AS TOT_DC_AMT
                    , SUM(TSDP.REAL_SALE_AMT) AS TOT_REAL_SALE_AMT
                    , SUM(TSDP.SALE_CNT) AS TOT_SALE_CNT
            FROM	TB_SL_DAILY_POS TSDP
            WHERE	1 = 1
            AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
            <if test='arrStorePos != null and arrStorePos.length >= 0'>
                AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test='startDate != null and startDate != ""'>
                AND TSDP.SALE_DATE >= #{startDate}
            </if>
            <if test='endDate != null and endDate != ""'>
                AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
            </if>
            GROUP BY TO_CHAR(TO_DATE(TSDP.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean')
        ) A,
        (
            WITH T AS
            (
                SELECT	DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
                , TO_CHAR(TO_DATE(TSDP.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean') AS DAY_NAME_TEMP
                , TSDP.TOT_SALE_AMT AS SALE_AMT
                , TSDP.TOT_DC_AMT AS DC_AMT
                , TSDP.REAL_SALE_AMT AS REAL_SALE_AMT
                , TSDP.SALE_CNT AS SALE_CNT
                FROM    TB_SL_DAILY_POS TSDP
                , TB_SL_DAILY_POS_PROD TSDPP
                WHERE   TSDP.HQ_OFFICE_CD = TSDPP.HQ_OFFICE_CD
                AND TSDP.HQ_BRAND_CD = TSDPP.HQ_BRAND_CD
                AND TSDP.STORE_CD = TSDPP.STORE_CD
                AND TSDP.SALE_DATE = TSDPP.SALE_DATE
                AND TSDP.POS_NO = TSDPP.POS_NO
                AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
                <if test='arrStorePos != null and arrStorePos.length >= 0'>
                    AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                    <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
                <if test='startDate != null and startDate != ""'>
                    AND TSDP.SALE_DATE >= #{startDate}
                </if>
                <if test='endDate != null and endDate != ""'>
                    AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
                </if>
            )
            SELECT  *
            FROM    T
            PIVOT	(
                        MAX(SALE_AMT) AS SALE_AMT, MAX(DC_AMT) AS DC_AMT, MAX(REAL_SALE_AMT) AS REAL_SALE_AMT, MAX(SALE_CNT) AS SALE_CNT
                        FOR STORE_CD IN (
                                            <foreach collection="arrStorePos" item="item" separator=",">
                                                '${item}'
                                            </foreach>
                                            )
                    )
        ) B
        WHERE   A.DAY_NAME = B.DAY_NAME_TEMP
        ORDER BY A.DAY_ORDER
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <select id="getPosDayOfWeekChartList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosDayOfWeekChartList */
        SELECT	A.STORE_CD
                , A.POS_NO
                , A.STORE_NM
                , SUM(DECODE(A.DAY_ORDER,'1',A.SALE_CNT,0)) AS SALE_CNT_MON
                , SUM(DECODE(A.DAY_ORDER,'2',A.SALE_CNT,0)) AS SALE_CNT_TUE
                , SUM(DECODE(A.DAY_ORDER,'3',A.SALE_CNT,0)) AS SALE_CNT_WED
                , SUM(DECODE(A.DAY_ORDER,'4',A.SALE_CNT,0)) AS SALE_CNT_THU
                , SUM(DECODE(A.DAY_ORDER,'5',A.SALE_CNT,0)) AS SALE_CNT_FRI
                , SUM(DECODE(A.DAY_ORDER,'6',A.SALE_CNT,0)) AS SALE_CNT_SAT
                , SUM(DECODE(A.DAY_ORDER,'7',A.SALE_CNT,0)) AS SALE_CNT_SUN
                , SUM(DECODE(A.DAY_ORDER,'1',A.REAL_SALE_AMT,0)) AS REAL_SALE_AMT_MON
                , SUM(DECODE(A.DAY_ORDER,'2',A.REAL_SALE_AMT,0)) AS REAL_SALE_AMT_TUE
                , SUM(DECODE(A.DAY_ORDER,'3',A.REAL_SALE_AMT,0)) AS REAL_SALE_AMT_WED
                , SUM(DECODE(A.DAY_ORDER,'4',A.REAL_SALE_AMT,0)) AS REAL_SALE_AMT_THU
                , SUM(DECODE(A.DAY_ORDER,'5',A.REAL_SALE_AMT,0)) AS REAL_SALE_AMT_FRI
                , SUM(DECODE(A.DAY_ORDER,'6',A.REAL_SALE_AMT,0)) AS REAL_SALE_AMT_SAT
                , SUM(DECODE(A.DAY_ORDER,'7',A.REAL_SALE_AMT,0)) AS REAL_SALE_AMT_SUN
        FROM	(
            SELECT	DISTINCT TSDP.STORE_CD AS STORE_CD
                    , (SELECT STORE_NM FROM TB_MS_STORE WHERE HQ_OFFICE_CD = TSDP.HQ_OFFICE_CD AND STORE_CD = TSDP.STORE_CD)||' - '||TSDP.POS_NO AS STORE_NM
                    , TSDP.POS_NO AS POS_NO
                    , TO_CHAR(TO_DATE(TSDP.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean') AS DAY_NAME
                    , CASE TO_CHAR(TO_DATE(TSDP.SALE_DATE, 'YYYY-MM-DD'),'DY','NLS_DATE_LANGUAGE=korean')
                    WHEN '월' THEN 1
                    WHEN '화' THEN 2
                    WHEN '수' THEN 3
                    WHEN '목' THEN 4
                    WHEN '금' THEN 5
                    WHEN '토' THEN 6
                    ELSE 0
                    END AS DAY_ORDER
                    , TSDP.TOT_SALE_AMT AS SALE_AMT
                    , TSDP.TOT_DC_AMT AS DC_AMT
                    , TSDP.REAL_SALE_AMT AS REAL_SALE_AMT
                    , TSDP.SALE_CNT AS SALE_CNT
            FROM	TB_SL_DAILY_POS TSDP
                  , TB_SL_DAILY_POS_PROD TSDPP
            WHERE   TSDP.HQ_OFFICE_CD = TSDPP.HQ_OFFICE_CD
            AND TSDP.HQ_BRAND_CD = TSDPP.HQ_BRAND_CD
            AND TSDP.STORE_CD = TSDPP.STORE_CD
            AND TSDP.SALE_DATE = TSDPP.SALE_DATE
            AND TSDP.POS_NO = TSDPP.POS_NO
            AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
            <if test='arrStorePos != null and arrStorePos.length >= 0'>
                AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test='startDate != null and startDate != ""'>
                AND TSDP.SALE_DATE >= #{startDate}
            </if>
            <if test='endDate != null and endDate != ""'>
                AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
            </if>
        ) A
        GROUP BY A.STORE_CD, A.POS_NO, A.STORE_NM
        ORDER BY A.STORE_CD, A.POS_NO
    </select>

    <!-- 포스별매출월별 - 리스트 조회 -->
    <!--
        TABLE    : TB_SL_DAILY_POS_PROD, TB_SL_DAILY_POS, TB_MS_POS
        PARAM    : posMonthVO
        COMMENTS : 포스별매출월별 - 리스트를 조회한다.
    -->
    <select id="getPosMonthList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosMonthList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT	A.YEAR_MONTH
        , A.SALE_STORE_CNT
        , A.TOT_SALE_AMT
        , A.TOT_DC_AMT
        , A.TOT_REAL_SALE_AMT
        , A.TOT_SALE_CNT
        , B.*
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM	(
        SELECT	TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM') AS YEAR_MONTH
        , COUNT(DISTINCT TSDP.STORE_CD) AS SALE_STORE_CNT
        , SUM(TSDP.TOT_SALE_AMT) AS TOT_SALE_AMT
        , SUM(TSDP.TOT_DC_AMT) AS TOT_DC_AMT
        , SUM(TSDP.REAL_SALE_AMT) AS TOT_REAL_SALE_AMT
        , SUM(TSDP.SALE_CNT) AS TOT_SALE_CNT
        FROM	TB_SL_MONTHLY_POS TSDP
        WHERE	1 = 1
        AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test='startDate != null and startDate != ""'>
            AND TSDP.SALE_YM <![CDATA[>= ]]>#{startDate}
        </if>
        <if test='endDate != null and endDate != ""'>
            AND TSDP.SALE_YM <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM')
        ) A,
        (
        WITH T AS
        (
        SELECT	DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
        , TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM') AS YEAR_MONTH_TEMP
        , SUM(TSDP.TOT_SALE_AMT) AS SALE_AMT
        , SUM(TSDP.TOT_DC_AMT) AS DC_AMT
        , SUM(TSDP.REAL_SALE_AMT) AS REAL_SALE_AMT
        , SUM(TSDP.SALE_CNT) AS SALE_CNT
        FROM    TB_SL_MONTHLY_POS TSDP
        WHERE   1 = 1
        AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test='startDate != null and startDate != ""'>
            AND TSDP.SALE_YM <![CDATA[>=]]> #{startDate}
        </if>
        <if test='endDate != null and endDate != ""'>
            AND TSDP.SALE_YM <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY TSDP.STORE_CD || '||' || TSDP.POS_NO, TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM')
        )
        SELECT  *
        FROM    T
        PIVOT	(
        MAX(SALE_AMT) AS SALE_AMT, MAX(DC_AMT) AS DC_AMT, MAX(REAL_SALE_AMT) AS REAL_SALE_AMT, MAX(SALE_CNT) AS SALE_CNT
        FOR STORE_CD IN (
        <foreach collection="arrStorePos" item="item" separator=",">
            '${item}'
        </foreach>
        )
        )
        ) B
        WHERE   A.YEAR_MONTH = B.YEAR_MONTH_TEMP
        ORDER BY A.YEAR_MONTH
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 포스별매출월별 - 엑셀리스트 조회 -->
    <!--
        TABLE    : TB_SL_DAILY_POS_PROD, TB_SL_DAILY_POS, TB_MS_POS
        PARAM    : posMonthVO
        COMMENTS : 포스별매출월별 - 엑셀리스트를 조회한다.
    -->
    <select id="getPosMonthExcelList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosMonthExcelList */
        SELECT  A.YEAR_MONTH
        , A.SALE_STORE_CNT
        , A.TOT_SALE_AMT
        , A.TOT_DC_AMT
        , A.TOT_REAL_SALE_AMT
        , A.TOT_SALE_CNT
        , B.*
        FROM    (
        SELECT  TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM') AS YEAR_MONTH
        , COUNT(DISTINCT TSDP.STORE_CD) AS SALE_STORE_CNT
        , SUM(TSDP.TOT_SALE_AMT) AS TOT_SALE_AMT
        , SUM(TSDP.TOT_DC_AMT) AS TOT_DC_AMT
        , SUM(TSDP.REAL_SALE_AMT) AS TOT_REAL_SALE_AMT
        , SUM(TSDP.SALE_CNT) AS TOT_SALE_CNT
        FROM    TB_SL_MONTHLY_POS TSDP
        WHERE   1 = 1
        AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test='startDate != null and startDate != ""'>
            AND TSDP.SALE_YM <![CDATA[>= ]]>#{startDate}
        </if>
        <if test='endDate != null and endDate != ""'>
            AND TSDP.SALE_YM <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM')
        ) A,
        (
        WITH T AS
        (
        SELECT  DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
        , TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM') AS YEAR_MONTH_TEMP
        , SUM(TSDP.TOT_SALE_AMT) AS SALE_AMT
        , SUM(TSDP.TOT_DC_AMT) AS DC_AMT
        , SUM(TSDP.REAL_SALE_AMT) AS REAL_SALE_AMT
        , SUM(TSDP.SALE_CNT) AS SALE_CNT
        FROM    TB_SL_MONTHLY_POS TSDP
        WHERE   1 = 1
        AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test='startDate != null and startDate != ""'>
            AND TSDP.SALE_YM <![CDATA[>=]]> #{startDate}
        </if>
        <if test='endDate != null and endDate != ""'>
            AND TSDP.SALE_YM <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY TSDP.STORE_CD || '||' || TSDP.POS_NO, TO_CHAR(TO_DATE(TSDP.SALE_YM, 'YYYY-MM'),'YYYY-MM')
        )
        SELECT  *
        FROM    T
        PIVOT   (
        MAX(SALE_AMT) AS SALE_AMT, MAX(DC_AMT) AS DC_AMT, MAX(REAL_SALE_AMT) AS REAL_SALE_AMT, MAX(SALE_CNT) AS SALE_CNT
        FOR STORE_CD IN (
        <foreach collection="arrStorePos" item="item" separator=",">
            '${item}'
        </foreach>
        )
        )
        ) B
        WHERE   A.YEAR_MONTH = B.YEAR_MONTH_TEMP
        ORDER BY A.YEAR_MONTH
    </select>

    <!-- 상품별탭 - 조회 -->
    <!--
        TABLE    :
        PARAM    : posProdVO
        COMMENTS :
    -->
    <select id="getPosProdList" parameterType="posSaleVO" resultType="DefaultMap">
        /* USE : PosProdMapper.getPosProdList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT
        A.PATH_NM,
        A.PROD_CD,
        A.PROD_NM,
        A.SALE_STORE_CNT,
        A.TOT_SALE_AMT,
        A.TOT_DC_AMT,
        A.TOT_REAL_SALE_AMT,
        A.TOT_SALE_CNT,
        B.*
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM
        (
        SELECT
        PATH_NM,
        PROD_CD,
        PROD_NM,
        SUM(SALE_STORE_CNT) AS SALE_STORE_CNT,
        SUM(TOT_SALE_AMT) AS TOT_SALE_AMT,
        SUM(TOT_DC_AMT) AS TOT_DC_AMT,
        SUM(REAL_SALE_AMT) AS TOT_REAL_SALE_AMT,
        SUM(TOT_SALE_CNT) AS TOT_SALE_CNT
        FROM
        (
        SELECT
        FN_GET_PROD_CLASS_CD_NM_STR(tmp.STORE_CD, tmp.PROD_CLASS_CD, 'NM_STR') AS PATH_NM, --NM_STR
        tsdpp.PROD_CD,
        tmp.PROD_NM,
        COUNT(DISTINCT tsdpp.STORE_CD) AS SALE_STORE_CNT,
        SUM(tsdpp.TOT_SALE_AMT) AS TOT_SALE_AMT,
        SUM(tsdpp.TOT_DC_AMT) AS TOT_DC_AMT,
        SUM(tsdpp.REAL_SALE_AMT) AS REAL_SALE_AMT,
        SUM(tsdpp.TOT_SALE_QTY) AS TOT_SALE_CNT
        FROM TB_SL_DAILY_POS_PROD tsdpp,
        TB_MS_PRODUCT tmp
        WHERE 1=1
        AND tsdpp.HQ_OFFICE_CD = #{hqOfficeCd}
        AND tsdpp.STORE_CD = #{storeCd}
        AND tsdpp.SALE_DATE BETWEEN #{startDate} AND #{endDate}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND tsdpp.STORE_CD||'||'||tsdpp.POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        AND tmp.STORE_CD = tsdpp.STORE_CD
        AND tmp.PROD_CD = tsdpp.PROD_CD
        GROUP BY tsdpp.PROD_CD, tmp.PROD_NM, tmp.STORE_CD, tmp.PROD_CLASS_CD
        )
        GROUP BY PROD_CD, PROD_NM, PATH_NM
        ) A,
        (
        SELECT
        PROD_CD AS PROD_CD_TEMP,
        (STORE_CD || '||' || POS_NO) AS STORE_POS,
        TOT_SALE_AMT,
        TOT_DC_AMT,
        REAL_SALE_AMT,
        TOT_SALE_QTY
        FROM TB_SL_DAILY_POS_PROD
        WHERE 1=1
        AND HQ_OFFICE_CD = #{hqOfficeCd}
        AND STORE_CD = #{storeCd}
        AND SALE_DATE BETWEEN #{startDate} AND #{endDate}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND STORE_CD||'||'||POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        )
        PIVOT
        (
        SUM(TOT_SALE_AMT) AS SALE_AMT,
        SUM(TOT_DC_AMT) AS DC_AMT,
        SUM(REAL_SALE_AMT) AS REAL_SALE_AMT,
        SUM(TOT_SALE_QTY) AS SALE_CNT
        FOR STORE_POS IN (
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            <foreach collection="arrStorePos" item="item" separator=",">
                '${item}'
            </foreach>
        </if>
        )
        ) B
        WHERE 1=1
        AND B.PROD_CD_TEMP = A.PROD_CD
        ORDER BY A.PROD_CD
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 상품별탭 - 엑셀 조회 -->
    <!--
        TABLE    :
        PARAM    : posProdVO
        COMMENTS :
    -->
    <select id="getPosProdExcelList" parameterType="posSaleVO" resultType="DefaultMap">
        /* USE : PosProdMapper.getPosProdExcelList */
        SELECT
        A.PATH_NM,
        A.PROD_CD,
        A.PROD_NM,
        A.SALE_STORE_CNT,
        A.TOT_SALE_AMT,
        A.TOT_DC_AMT,
        A.TOT_REAL_SALE_AMT,
        A.TOT_SALE_CNT,
        B.*
        FROM
        (
        SELECT
        PATH_NM,
        PROD_CD,
        PROD_NM,
        SUM(SALE_STORE_CNT) AS SALE_STORE_CNT,
        SUM(TOT_SALE_AMT) AS TOT_SALE_AMT,
        SUM(TOT_DC_AMT) AS TOT_DC_AMT,
        SUM(REAL_SALE_AMT) AS TOT_REAL_SALE_AMT,
        SUM(TOT_SALE_CNT) AS TOT_SALE_CNT
        FROM
        (
        SELECT
        FN_GET_PROD_CLASS_CD_NM_STR(tmp.STORE_CD, tmp.PROD_CLASS_CD, 'NM_STR') AS PATH_NM, --NM_STR
        tsdpp.PROD_CD,
        tmp.PROD_NM,
        COUNT(DISTINCT tsdpp.STORE_CD) AS SALE_STORE_CNT,
        SUM(tsdpp.TOT_SALE_AMT) AS TOT_SALE_AMT,
        SUM(tsdpp.TOT_DC_AMT) AS TOT_DC_AMT,
        SUM(tsdpp.REAL_SALE_AMT) AS REAL_SALE_AMT,
        SUM(tsdpp.TOT_SALE_QTY) AS TOT_SALE_CNT
        FROM TB_SL_DAILY_POS_PROD tsdpp,
        TB_MS_PRODUCT tmp
        WHERE 1=1
        AND tsdpp.HQ_OFFICE_CD = #{hqOfficeCd}
        AND tsdpp.STORE_CD = #{storeCd}
        AND tsdpp.SALE_DATE BETWEEN #{startDate} AND #{endDate}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND tsdpp.STORE_CD||'||'||tsdpp.POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        AND tmp.STORE_CD = tsdpp.STORE_CD
        AND tmp.PROD_CD = tsdpp.PROD_CD
        GROUP BY tsdpp.PROD_CD, tmp.PROD_NM, tmp.STORE_CD, tmp.PROD_CLASS_CD
        )
        GROUP BY PROD_CD, PROD_NM, PATH_NM
        ) A,
        (
        SELECT
        PROD_CD AS PROD_CD_TEMP,
        (STORE_CD || '||' || POS_NO) AS STORE_POS,
        TOT_SALE_AMT,
        TOT_DC_AMT,
        REAL_SALE_AMT,
        TOT_SALE_QTY
        FROM TB_SL_DAILY_POS_PROD
        WHERE 1=1
        AND HQ_OFFICE_CD = #{hqOfficeCd}
        AND STORE_CD = #{storeCd}
        AND SALE_DATE BETWEEN #{startDate} AND #{endDate}
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            AND STORE_CD||'||'||POS_NO IN
            <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        )
        PIVOT
        (
        SUM(TOT_SALE_AMT) AS SALE_AMT,
        SUM(TOT_DC_AMT) AS DC_AMT,
        SUM(REAL_SALE_AMT) AS REAL_SALE_AMT,
        SUM(TOT_SALE_QTY) AS SALE_CNT
        FOR STORE_POS IN (
        <if test='arrStorePos != null and arrStorePos.length >= 0'>
            <foreach collection="arrStorePos" item="item" separator=",">
                '${item}'
            </foreach>
        </if>
        )
        ) B
        WHERE 1=1
        AND B.PROD_CD_TEMP = A.PROD_CD
        ORDER BY A.PROD_CD
    </select>

    <!-- 설정기간별탭 - 조회 -->
    <!--
        TABLE    :
        PARAM    : posDayPeriodVO
        COMMENTS :
    -->
    <select id="getPosDayPeriodList" parameterType="posSaleVO" resultType="DefaultMap">
        /* USE : PosSaleMapper.getPosDayPeriodList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT CONCAT(CONCAT(TMS.STORE_NM,' - POS '), TSDP.POS_NO) STORE_NM_POS_NO
        , TSDP.POS_NO
        , TSDP.STORE_CD
        , SUM(TSDP.SALE_CNT) AS SALE_CNT
        , SUM(TSDP.REAL_SALE_AMT) AS REAL_SALE_AMT
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM TB_SL_DAILY_POS TSDP
        , TB_MS_STORE TMS
        WHERE  1=1
        AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND TSDP.STORE_CD IN (${storeCdQuery})
        </if>
        <if test='orgnFg != null and orgnFg == "H"'>
            AND (
            'N' = (SELECT NVL(MAX(ENVST_VAL), 'N') FROM TB_HQ_ENVST WHERE HQ_OFFICE_CD = #{hqOfficeCd} AND ENVST_CD = '0001')
            OR	TSDP.STORE_CD IN (SELECT STORE_CD  FROM TB_HQ_EMPLOYEE_STORE_V08 WHERE HQ_OFFICE_CD = #{hqOfficeCd} AND EMP_NO = #{empNo})
            )
        </if>
        <if test='startDate != null and startDate != ""'>
            AND TSDP.SALE_DATE >= #{startDate}
        </if>
        <if test='endDate != null and endDate != ""'>
            AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
        </if>
        AND TSDP.STORE_CD = TMS.STORE_CD
        GROUP BY CONCAT(CONCAT(TMS.STORE_NM,' - POS '), TSDP.POS_NO), TSDP.POS_NO, TSDP.STORE_CD
        ORDER BY STORE_NM_POS_NO
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 설정기간별탭 - 엑셀 조회 -->
    <!--
        TABLE    :
        PARAM    : posDayPeriodVO
        COMMENTS :
    -->
    <select id="getPosDayPeriodExcelList" parameterType="posSaleVO" resultType="DefaultMap">
        /* USE : PosSaleMapper.getPosDayPeriodExcelList */
        SELECT CONCAT(CONCAT(TMS.STORE_NM,' - POS '), TSDP.POS_NO) STORE_NM_POS_NO
        , TSDP.POS_NO
        , TSDP.STORE_CD
        , SUM(TSDP.SALE_CNT) AS SALE_CNT
        , SUM(TSDP.REAL_SALE_AMT) AS REAL_SALE_AMT
        FROM TB_SL_DAILY_POS TSDP
        , TB_MS_STORE TMS
        WHERE  1=1
        AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='storeCdQuery != null and storeCdQuery != ""'>
            AND TSDP.STORE_CD IN (${storeCdQuery})
        </if>
        <if test='orgnFg != null and orgnFg == "H"'>
            AND (
            'N' = (SELECT NVL(MAX(ENVST_VAL), 'N') FROM TB_HQ_ENVST WHERE HQ_OFFICE_CD = #{hqOfficeCd} AND ENVST_CD = '0001')
            OR	TSDP.STORE_CD IN (SELECT STORE_CD  FROM TB_HQ_EMPLOYEE_STORE_V08 WHERE HQ_OFFICE_CD = #{hqOfficeCd} AND EMP_NO = #{empNo})
            )
        </if>
        <if test='startDate != null and startDate != ""'>
            AND TSDP.SALE_DATE >= #{startDate}
        </if>
        <if test='endDate != null and endDate != ""'>
            AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
        </if>
        AND TSDP.STORE_CD = TMS.STORE_CD
        GROUP BY CONCAT(CONCAT(TMS.STORE_NM,' - POS '), TSDP.POS_NO), TSDP.POS_NO, TSDP.STORE_CD
        ORDER BY STORE_NM_POS_NO
    </select>

    <!-- 설정기간별탭 - 상세 조회 -->
    <!--
        TABLE    :
        PARAM    : posDayPeriodVO
        COMMENTS :
    -->
    <select id="getPosDayPeriodDtlList" parameterType="posSaleVO" resultType="DefaultMap">
        /* USE : PosSaleMapper.getPosDayPeriodDtlList */
        <!--<include refid="CmmSQL.PagingTemplateHeader"/>-->
        SELECT
        FN_GET_PROD_CLASS_CD_NM_STR(tmp.STORE_CD, tmp.PROD_CLASS_CD, 'NM_STR') AS PATH_NM,
        tsdpp.PROD_CD,
        tmp.PROD_NM,
        SUM(tsdpp.TOT_SALE_QTY) AS TOT_SALE_QTY,
        SUM(tsdpp.REAL_SALE_AMT) AS REAL_SALE_AMT
        <!--<include refid="CmmSQL.PagingTemplateCount"/>-->
        FROM TB_SL_DAILY_POS_PROD tsdpp,
        TB_MS_PRODUCT tmp
        WHERE 1=1
        AND tsdpp.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='storeCd != null and storeCd != ""'>
            AND tsdpp.STORE_CD = #{storeCd}
        </if>
        AND tsdpp.SALE_DATE BETWEEN #{startDate} AND #{endDate}
        <if test='posNo != null and posNo != ""'>
            AND tsdpp.POS_NO = #{posNo}
        </if>
        AND tmp.STORE_CD = tsdpp.STORE_CD
        AND tmp.PROD_CD = tsdpp.PROD_CD
        GROUP BY tmp.STORE_CD, tmp.PROD_CLASS_CD, tsdpp.PROD_CD, tmp.PROD_NM
        ORDER BY tmp.STORE_CD, tmp.PROD_CLASS_CD, tsdpp.PROD_CD
        <!--<include refid="CmmSQL.PagingTemplateBottom"/>-->
    </select>

    <!-- 설정기간별탭 - 상세 엑셀 조회 -->
    <!--
        TABLE    :
        PARAM    : posDayPeriodVO
        COMMENTS :
    -->
    <select id="getPosDayPeriodDtlExcelList" parameterType="posSaleVO" resultType="DefaultMap">
        /* USE : PosSaleMapper.getPosDayPeriodDtlExcelList */
        SELECT
        FN_GET_PROD_CLASS_CD_NM_STR(tmp.STORE_CD, tmp.PROD_CLASS_CD, 'NM_STR') AS PATH_NM,
        tsdpp.PROD_CD,
        tmp.PROD_NM,
        SUM(tsdpp.TOT_SALE_QTY) AS TOT_SALE_QTY,
        SUM(tsdpp.REAL_SALE_AMT) AS REAL_SALE_AMT
        FROM TB_SL_DAILY_POS_PROD tsdpp,
        TB_MS_PRODUCT tmp
        WHERE 1=1
        AND tsdpp.HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='storeCd != null and storeCd != ""'>
            AND tsdpp.STORE_CD = #{storeCd}
        </if>
        AND tsdpp.SALE_DATE BETWEEN #{startDate} AND #{endDate}
        <if test='posNo != null and posNo != ""'>
            AND tsdpp.POS_NO = #{posNo}
        </if>
        AND tmp.STORE_CD = tsdpp.STORE_CD
        AND tmp.PROD_CD = tsdpp.PROD_CD
        GROUP BY tmp.STORE_CD, tmp.PROD_CLASS_CD, tsdpp.PROD_CD, tmp.PROD_NM
        ORDER BY tmp.STORE_CD, tmp.PROD_CLASS_CD, tsdpp.PROD_CD
    </select>

    <!-- 시간대별별 - 리스트 조회 -->
    <!--
        TABLE    : TB_SL_DAILY_POS_PROD, TB_SL_DAILY_POS, TB_MS_POS
        PARAM    : posDayVO
        COMMENTS : 포스별매출일자별 - 리스트를 조회한다.
    -->
    <select id="getPosHourList" parameterType="posSaleVO" resultType="DefaultMap">
        /* PosSaleMapper.getPosHourList */
        <if test="optionFg != null and optionFg.toString() == 'time'">
            SELECT	NVL(B.SALE_HOUR,A.LV)	AS	SALE_HOUR
            ,		B.SALE_STORE_CNT
            , 		B.TOT_SALE_AMT
            , 		B.TOT_DC_AMT
            , 		B.TOT_REAL_SALE_AMT
            , 		B.TOT_SALE_CNT
            ,		B.*
            FROM (
            SELECT 	LPAD(LEVEL-1, 2, '0') LV
            FROM 	DUAL CONNECT BY LEVEL <![CDATA[<= ]]> 24
            )	A
            , (
            SELECT	TO_CHAR(TO_DATE(A.SALE_HOUR,'HH24'),'HH24') AS SALE_HOUR
            , A.SALE_STORE_CNT
            , A.TOT_SALE_AMT
            , A.TOT_DC_AMT
            , A.TOT_REAL_SALE_AMT
            , A.TOT_SALE_CNT
            , B.*
            FROM	(
            SELECT	TSDP.SALE_HOUR
            , COUNT(DISTINCT TSDP.STORE_CD) AS SALE_STORE_CNT
            , SUM(TSDP.TOT_SALE_AMT) AS TOT_SALE_AMT
            , SUM(TSDP.TOT_DC_AMT) AS TOT_DC_AMT
            , SUM(TSDP.REAL_SALE_AMT) AS TOT_REAL_SALE_AMT
            , SUM(TSDP.SALE_CNT) AS TOT_SALE_CNT
            FROM	TB_SL_DAILY_POS_TIME TSDP
            WHERE	1 = 1
            AND TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
            <if test='arrStorePos != null and arrStorePos.length >= 0'>
                AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test='startDate != null and startDate != ""'>
                AND TSDP.SALE_DATE >= #{startDate}
            </if>
            <if test='endDate != null and endDate != ""'>
                AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
            </if>
            GROUP BY TSDP.SALE_HOUR
            ) A,
            (
            WITH T AS
            (
            SELECT	DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
            , TSDP.SALE_HOUR AS SALE_HOUR_TEMP
            , SUM(TSDP.TOT_SALE_AMT) AS SALE_AMT
            , SUM(TSDP.TOT_DC_AMT) AS DC_AMT
            , SUM(TSDP.REAL_SALE_AMT) AS REAL_SALE_AMT
            , SUM(TSDP.SALE_CNT) AS SALE_CNT
            FROM    TB_SL_DAILY_POS_TIME TSDP
            WHERE   TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
            <if test='arrStorePos != null and arrStorePos.length >= 0'>
                AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test='startDate != null and startDate != ""'>
                AND TSDP.SALE_DATE >= #{startDate}
            </if>
            <if test='endDate != null and endDate != ""'>
                AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
            </if>
            GROUP BY TSDP.STORE_CD || '||' || TSDP.POS_NO, TSDP.SALE_HOUR
            )
            SELECT  *
            FROM    T
            PIVOT	(
            MAX(SALE_AMT) AS SALE_AMT, MAX(DC_AMT) AS DC_AMT, MAX(REAL_SALE_AMT) AS REAL_SALE_AMT, MAX(SALE_CNT) AS SALE_CNT
            FOR STORE_CD IN (
            <foreach collection="arrStorePos" item="item" separator=",">
                '${item}'
            </foreach>
            )
            )
            ) B
            WHERE   A.SALE_HOUR = B.SALE_HOUR_TEMP
            ORDER BY A.SALE_HOUR
            ) B
            WHERE 	A.LV = B.SALE_HOUR(+)
            <if test='startTime != "0" or endTime != "23"'>
                AND B.SALE_HOUR BETWEEN #{startTime} AND #{endTime}
            </if>
            ORDER
            BY 		A.LV
        </if>
        <if test="optionFg != null and optionFg.toString() == 'timeSlot'">
            SELECT NVL(B.SALE_HOUR,A.LV) AS SALE_HOUR
            , B.SALE_STORE_CNT
            , B.TOT_SALE_AMT
            , B.TOT_DC_AMT
            , B.TOT_REAL_SALE_AMT
            , B.TOT_SALE_CNT
            , B.*
            FROM 	(
            SELECT  MIN(NMCODE_CD) KEEP(DENSE_RANK FIRST ORDER BY NMCODE_ITEM_1) || '~' || LPAD(MAX(NMCODE_CD) KEEP(DENSE_RANK LAST ORDER BY NMCODE_ITEM_1) + 1, 2, '0') AS LV
            <!-- 프차 -->
            <if test='hqOfficeCd != null and hqOfficeCd != "00000"'>
                FROM    TB_HQ_NMCODE
                WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
            </if>
            <!-- 단독매장 -->
            <if test='hqOfficeCd != null and hqOfficeCd == "00000"'>
                FROM 	TB_MS_STORE_NMCODE
                WHERE 	STORE_CD = #{storeCd}
            </if>
            AND		NMCODE_GRP_CD ='001'
            GROUP BY NMCODE_NM
            ) A
            , (
            SELECT 	SALE_HOUR
            , 		A.SALE_STORE_CNT
            , 		A.TOT_SALE_AMT
            , 		A.TOT_DC_AMT
            , 		A.TOT_REAL_SALE_AMT
            , 		A.TOT_SALE_CNT
            , 		B.*
            FROM (
            SELECT TIME_SLOT AS SALE_HOUR
            , COUNT(DISTINCT TSDP.STORE_CD) AS SALE_STORE_CNT
            , SUM(TSDP.TOT_SALE_AMT) AS TOT_SALE_AMT
            , SUM(TSDP.TOT_DC_AMT) AS TOT_DC_AMT
            , SUM(TSDP.REAL_SALE_AMT) AS TOT_REAL_SALE_AMT
            , SUM(TSDP.SALE_CNT) AS TOT_SALE_CNT
            FROM TB_SL_DAILY_POS_TIME TSDP,
            (
            SELECT 	MIN(NMCODE_CD) KEEP(DENSE_RANK FIRST ORDER BY NMCODE_ITEM_1) || '~' || LPAD(MAX(NMCODE_CD)
            KEEP(DENSE_RANK LAST ORDER BY NMCODE_ITEM_1) + 1, 2, '0') AS TIME_SLOT,
            MIN(NMCODE_CD) KEEP(DENSE_RANK FIRST ORDER BY NMCODE_ITEM_1) AS START_TIME,
            MAX(NMCODE_CD) KEEP(DENSE_RANK LAST ORDER BY NMCODE_ITEM_1) AS END_TIME
            <!-- 프차 -->
            <if test='hqOfficeCd != null and hqOfficeCd != "00000"'>
                FROM    TB_HQ_NMCODE
                WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
            </if>
            <!-- 단독매장 -->
            <if test='hqOfficeCd != null and hqOfficeCd == "00000"'>
                FROM 	TB_MS_STORE_NMCODE
                WHERE 	STORE_CD = #{storeCd}
            </if>
            AND		NMCODE_GRP_CD ='001'
            GROUP BY NMCODE_NM
            ) thn
            WHERE	1 = 1
            AND 	TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
            AND     TSDP.SALE_HOUR BETWEEN thn.START_TIME AND thn.END_TIME
            <if test='arrStorePos != null and arrStorePos.length >= 0'>
                AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test='startDate != null and startDate != ""'>
                AND TSDP.SALE_DATE >= #{startDate}
            </if>
            <if test='endDate != null and endDate != ""'>
                AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
            </if>
            GROUP BY TIME_SLOT
            ) A,
            (
            WITH T AS
            (
            SELECT	DISTINCT TSDP.STORE_CD || '||' || TSDP.POS_NO AS STORE_CD
            , 		TIME_SLOT AS SALE_HOUR_TEMP
            , 		SUM(TSDP.TOT_SALE_AMT) AS SALE_AMT
            , 		SUM(TSDP.TOT_DC_AMT) AS DC_AMT
            , 		SUM(TSDP.REAL_SALE_AMT) AS REAL_SALE_AMT
            , 		SUM(TSDP.SALE_CNT) AS SALE_CNT
            FROM    TB_SL_DAILY_POS_TIME TSDP,
            (
            SELECT  MIN(NMCODE_CD) KEEP(DENSE_RANK FIRST ORDER BY NMCODE_ITEM_1) || '~' || LPAD(MAX(NMCODE_CD) KEEP(DENSE_RANK LAST ORDER BY NMCODE_ITEM_1) + 1, 2, '0') AS TIME_SLOT,
            MIN(NMCODE_CD) KEEP(DENSE_RANK FIRST ORDER BY NMCODE_ITEM_1) AS START_TIME,
            MAX(NMCODE_CD) KEEP(DENSE_RANK LAST ORDER BY NMCODE_ITEM_1) AS END_TIME
            <!-- 프차 -->
            <if test='hqOfficeCd != null and hqOfficeCd != "00000"'>
                FROM    TB_HQ_NMCODE
                WHERE 	HQ_OFFICE_CD = #{hqOfficeCd}
            </if>
            <!-- 단독매장 -->
            <if test='hqOfficeCd != null and hqOfficeCd == "00000"'>
                FROM 	TB_MS_STORE_NMCODE
                WHERE 	STORE_CD = #{storeCd}
            </if>
            AND		NMCODE_GRP_CD ='001'
            GROUP BY NMCODE_NM
            ) thn
            WHERE   TSDP.HQ_OFFICE_CD = #{hqOfficeCd}
            AND     TSDP.SALE_HOUR BETWEEN thn.START_TIME AND thn.END_TIME
            <if test='arrStorePos != null and arrStorePos.length >= 0'>
                AND TSDP.STORE_CD||'||'||TSDP.POS_NO IN
                <foreach collection="arrStorePos" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
            <if test='startDate != null and startDate != ""'>
                AND TSDP.SALE_DATE >= #{startDate}
            </if>
            <if test='endDate != null and endDate != ""'>
                AND TSDP.SALE_DATE <![CDATA[<= ]]> #{endDate}
            </if>
            GROUP BY TSDP.STORE_CD || '||' || TSDP.POS_NO, TIME_SLOT
            )
            SELECT  *
            FROM    T
            PIVOT	(
            MAX(SALE_AMT) AS SALE_AMT, MAX(DC_AMT) AS DC_AMT, MAX(REAL_SALE_AMT) AS REAL_SALE_AMT, MAX(SALE_CNT) AS SALE_CNT
            FOR STORE_CD IN (
            <foreach collection="arrStorePos" item="item" separator=",">
                '${item}'
            </foreach>
            )
            )
            ) B
            WHERE   A.SALE_HOUR = B.SALE_HOUR_TEMP
            ORDER BY A.SALE_HOUR
            ) B
            WHERE 	A.LV = B.SALE_HOUR(+)
            <if test='timeSlot != null and timeSlot != ""'>
                AND A.LV = #{timeSlot}
            </if>
            ORDER
            BY 		A.LV
        </if>
    </select>

</mapper>
