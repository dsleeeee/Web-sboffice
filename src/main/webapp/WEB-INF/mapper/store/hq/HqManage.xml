<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    HqManage.xml
    본사정보관리 sql
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김지은     2018.06.08      최초작성
-->
<mapper namespace="kr.co.solbipos.store.hq.hqmanage.service.impl.HqManageMapper">

    <!-- 본사 목록 조회 -->
    <!--
        TABLE    : TB_HQ_OFFICE, TB_MS_STORE, TB_HQ_ENVST, TB_CM_ENVST
        PARAM    : hqManageVO
        COMMENTS : 등록된 본사 목록을 조회한다.
    -->
    <select id="getHqOfficeList" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.getHqOfficeList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        <![CDATA[
        SELECT tho.HQ_OFFICE_CD,
               tho.HQ_OFFICE_NM,
               tho.OWNER_NM,
               tho.BIZ_NO,
               tho.BIZ_TYPE_CD,
               tho.BIZ_ITEM_CD,
               tho.BIZ_STORE_NM,
               tho.TEL_NO,
               tho.FAX_NO,
               tho.EMAIL_ADDR,
               tho.HMPG_ADDR,
               tho.POST_NO,
               tho.ADDR,
               tho.ADDR_DTL,
               tho.AREA_CD,
               tho.SYS_STAT_FG,
               tho.SYS_OPEN_DATE,
               tho.SYS_CLOSURE_DATE,
               tho.AGENCY_CD,
               tho.REMARK,
               tho.CLS_FG,
               tho.REG_DT,
               tho.REG_ID,
               tho.MOD_DT,
               tho.MOD_ID,
               NVL(tms.CNT, 0) AS CNT,
               the.POS_NM
        ]]>
        <include refid="CmmSQL.PagingTemplateCount"/>
        <![CDATA[
        FROM TB_HQ_OFFICE tho,
        (
            SELECT HQ_OFFICE_CD,
            COUNT(HQ_OFFICE_CD) AS CNT
            FROM TB_MS_STORE
            GROUP BY HQ_OFFICE_CD
        ) tms,
        (
            SELECT the.HQ_OFFICE_CD,
            tcm.ENVST_NM AS POS_NM
            FROM TB_HQ_ENVST the,
            TB_CM_ENVST tcm
            WHERE the.ENVST_CD = '140'
            AND tcm.ENVST_CD = the.ENVST_CD
        ) the,
        TB_CM_AGENCY tca
        WHERE tho.HQ_OFFICE_CD != '00000'
        AND tms.HQ_OFFICE_CD (+) = tho.HQ_OFFICE_CD
        AND the.HQ_OFFICE_CD (+) = tho.HQ_OFFICE_CD
        ]]>
        AND tca.AGENCY_CD = tho.AGENCY_CD
        <if test='orgnFg != null and orgnFg == "A"'>
            AND (tca.AGENCY_CD = #{agencyCd} OR tca.P_AGENCY_CD = #{agencyCd}) -- 본사 AGENCY_CD
        </if>
        <if test='hqOfficeCd != null and hqOfficeCd != ""'>
           AND tho.HQ_OFFICE_CD LIKE '%'|| #{hqOfficeCd} || '%'
        </if>
        <if test='hqOfficeNm != null and hqOfficeNm != ""'>
           AND tho.HQ_OFFICE_NM LIKE '%'|| #{hqOfficeNm} || '%'
        </if>
        <if test='bizNo != null and bizNo != ""'>
           AND tho.BIZ_NO LIKE '%'|| #{bizNo} || '%'
        </if>
        <if test='clsFg != null and clsFg != ""'>
           AND tho.CLS_FG = #{clsFg}
        </if>
        <if test='sysStatFg != null and sysStatFg.toString() != ""'>
           AND tho.SYS_STAT_FG = #{sysStatFg}
        </if>
         ORDER BY tho.HQ_OFFICE_CD ASC
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 본사 상세정보 조회  -->
    <!--
        TABLE    : TB_HQ_OFFICE, TB_CM_AGENCY, TB_CM_NMCODE
        PARAM    : hqManageVO
        COMMENTS : 등록된 본사 상세정보를 조회한다.
    -->
    <select id="dtlInfo" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.dtlInfo */
        <![CDATA[
        SELECT tho.HQ_OFFICE_CD,
               tho.HQ_OFFICE_NM,
               tho.OWNER_NM,
               tho.BIZ_NO,
               SUBSTR(tho.BIZ_NO,0,3) AS BIZ_NO1,
               SUBSTR(tho.BIZ_NO,4,2) AS BIZ_NO2,
               SUBSTR(tho.BIZ_NO,6,5) AS BIZ_NO3,
               tho.BIZ_TYPE_CD,
               tho.BIZ_ITEM_CD,
               tho.BIZ_STORE_NM,
               tho.TEL_NO,
               tho.FAX_NO,
               tho.EMAIL_ADDR,
               tho.HMPG_ADDR,
               tho.POST_NO,
               tho.ADDR,
               tho.ADDR_DTL,
               tho.AREA_CD,
               tcna.NMCODE_NM AS AREA_NM,
               tho.SYS_STAT_FG,
               tcnm.NMCODE_NM AS SYS_STAT_FG_NM,
               TO_CHAR(TO_DATE(tho.SYS_OPEN_DATE, 'YYYYMMDD'), 'YYYY.MM.DD') AS SYS_OPEN_DATE,
               TO_CHAR(TO_DATE(tho.SYS_CLOSURE_DATE, 'YYYYMMDD'), 'YYYY.MM.DD') AS SYS_CLOSURE_DATE,
               tho.AGENCY_CD,
               tca.AGENCY_NM,
               tho.REMARK,
               tho.CLS_FG,
               tcn.NMCODE_NM AS CLS_FG_NM,
               tho.REG_DT,
               tho.REG_ID,
               tho.MOD_DT,
               tho.MOD_ID
          FROM TB_HQ_OFFICE tho,
               TB_CM_AGENCY tca,
               TB_CM_NMCODE tcn,
               TB_CM_NMCODE tcnm,
               TB_CM_NMCODE tcna
         WHERE tho.HQ_OFFICE_CD = #{hqOfficeCd}
           AND tca.AGENCY_CD (+)= tho.AGENCY_CD
           AND tcn.NMCODE_GRP_CD = '001'
           AND tcn.NMCODE_CD = tho.CLS_FG
           AND tcnm.NMCODE_GRP_CD = '005'
           AND tcnm.NMCODE_CD = tho.SYS_STAT_FG
           AND tcna.NMCODE_GRP_CD = '061'
           AND tcna.NMCODE_CD = tho.AREA_CD
        ]]>
    </select>

    <!-- 사업자번호 중복체크  -->
    <!--
        TABLE    : TB_HQ_OFFICE, TB_MS_STORE
        PARAM    : hqManageVO
        COMMENTS : 사업자번호를 중복체크한다.
    -->
    <select id="chkBizNo" parameterType="hqManageVO" resultType="Integer">
        /* USE : HqManageMapper.chkBizNo */
        <![CDATA[
        SELECT COUNT(STORE_CD) AS CNT
          FROM (
          SELECT HQ_OFFICE_CD AS STORE_CD
            FROM TB_HQ_OFFICE
           WHERE BIZ_NO = #{bizNo}
           UNION ALL
          SELECT STORE_CD
            FROM TB_MS_STORE
           WHERE BIZ_NO = #{bizNo}
               )
        ]]>
    </select>

    <!-- 사업자번호 사용현황 목록  -->
    <!--
        TABLE    : TB_HQ_OFFICE, TB_MS_STORE, TB_CM_NMCODE
        PARAM    : hqManageVO
        COMMENTS : 해당 사업자번호가 등록된 현황을 조회한다.
    -->
    <select id="getBizUseList" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.getBizUseList */
        SELECT 'H' AS STORE_FG,
               tho.HQ_OFFICE_CD AS STORE_CD,
               tho.HQ_OFFICE_NM AS STORE_NM,
               tho.OWNER_NM,
               tho.BIZ_NO,
               (SELECT NMCODE_NM FROM TB_CM_NMCODE WHERE NMCODE_GRP_CD = '005' AND NMCODE_CD = tho.SYS_STAT_FG) AS SYS_STAT_FG_NM,
               (SELECT NMCODE_NM FROM TB_CM_NMCODE WHERE NMCODE_GRP_CD = '001' AND NMCODE_CD = tho.CLS_FG) AS CLS_FG_NM
          FROM TB_HQ_OFFICE tho
         WHERE tho.BIZ_NO = #{bizNo}
         UNION ALL
         SELECT 'S' AS STORE_FG,
                tms.STORE_CD,
                tms.STORE_NM,
                tms.OWNER_NM,
                tms.BIZ_NO,
                (SELECT NMCODE_NM FROM TB_CM_NMCODE WHERE NMCODE_GRP_CD = '005' AND NMCODE_CD = tms.SYS_STAT_FG) AS SYS_STAT_FG_NM,
                (SELECT NMCODE_NM FROM TB_CM_NMCODE WHERE NMCODE_GRP_CD = '001' AND NMCODE_CD = tms.CLS_FG) AS CLS_FG_NM
           FROM TB_MS_STORE tms
          WHERE tms.BIZ_NO = #{bizNo}
    </select>

    <!-- 사업자번호 사용현황 상세  -->
    <!--
        TABLE    : TB_HQ_OFFICE, TB_MS_STORE, TB_CM_NMCODE
        PARAM    : hqManageVO
        COMMENTS : 사업자번호 사용현황 상세내용을 조회한다.
    -->
    <select id="getBizInfoDtl" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.getBizInfoDtl */
        SELECT tho.OWNER_NM,
               tho.BIZ_NO,
               SUBSTR(tho.BIZ_NO,0,3) AS BIZ_NO1,
               SUBSTR(tho.BIZ_NO,4,2) AS BIZ_NO2,
               SUBSTR(tho.BIZ_NO,6,5) AS BIZ_NO3,
               tho.BIZ_STORE_NM,
               tho.TEL_NO,
               tho.FAX_NO,
               tho.POST_NO,
               tho.ADDR,
               tho.ADDR_DTL,
               tho.AREA_CD,
               (SELECT NMCODE_NM FROM TB_CM_NMCODE WHERE NMCODE_GRP_CD = '061' AND NMCODE_CD = tho.AREA_CD) AS AREA_NM,
               tho.SYS_STAT_FG,
               (SELECT NMCODE_NM FROM TB_CM_NMCODE WHERE NMCODE_GRP_CD = '005' AND NMCODE_CD = tho.SYS_STAT_FG) AS SYS_STAT_FG_NM,
               tho.SYS_OPEN_DATE,
               tho.AGENCY_CD,
               tca.AGENCY_NM,
               tho.CLS_FG,
               (SELECT NMCODE_NM FROM TB_CM_NMCODE WHERE NMCODE_GRP_CD = '001' AND NMCODE_CD = tho.CLS_FG) AS CLS_FG_NM,
        <if test='storeFg == "H"'>
               tho.HQ_OFFICE_CD AS STORE_CD,
               tho.HQ_OFFICE_NM AS STORE_NM
          FROM TB_HQ_OFFICE tho,
               TB_CM_AGENCY tca
         WHERE tho.HQ_OFFICE_CD = #{storeCd}
           AND tca.AGENCY_CD = tho.AGENCY_CD
        </if>
        <if test='storeFg != "H"'>
               tho.STORE_CD,
               tho.STORE_NM
          FROM TB_MS_STORE tho,
               TB_CM_AGENCY tca
         WHERE tho.STORE_CD = #{storeCd}
           AND tca.AGENCY_CD = tho.AGENCY_CD
        </if>
    </select>

    <!-- 본사 코드 조회  -->
    <!--
        TABLE    : TB_HQ_OFFICE
        PARAM    : hqManageVO
        COMMENTS : 본사 코드 조회를 조회한다.
    -->
    <select id="getHqOfficeCd" parameterType="DefaultMap" resultType="String">
        /* HqManageMapper.getHqOfficeCd */
        <if test='sysStatFg.toString() == "DEMO"'>
          SELECT 'DS'||LPAD(TO_CHAR(NVL(MAX(SUBSTR(HQ_OFFICE_CD, 3, 4)), 0) + 1), 3, '0') AS HQ_OFFICE_CD
            FROM TB_HQ_OFFICE
           WHERE HQ_OFFICE_CD LIKE 'DS%'
        </if>
        <if test='sysStatFg.toString() != "DEMO"'>
          SELECT 'H'||LPAD(TO_CHAR(NVL(MAX(SUBSTR(HQ_OFFICE_CD, 2, 4)), 0) + 1), 4, '0') AS HQ_OFFICE_CD
            FROM TB_HQ_OFFICE
           WHERE HQ_OFFICE_CD LIKE 'H%'
        </if>
    </select>

    <!-- 본사 신규등록  -->
    <!--
        TABLE    : TB_HQ_OFFICE
        PARAM    : hqManageVO
        COMMENTS : 본사를 등록한다.
    -->
    <insert id="regist" parameterType="DefaultMap">
        /* USE : HqManageMapper.regist */
        <![CDATA[
        INSERT INTO TB_HQ_OFFICE
        (
            HQ_OFFICE_CD,
            HQ_OFFICE_NM,
            OWNER_NM,
            BIZ_NO,
            BIZ_TYPE_CD,
            BIZ_ITEM_CD,
            BIZ_STORE_NM,
            TEL_NO,
            FAX_NO,
            EMAIL_ADDR,
            HMPG_ADDR,
            POST_NO,
            ADDR,
            ADDR_DTL,
            AREA_CD,
            SYS_STAT_FG,
            SYS_OPEN_DATE,
            SYS_CLOSURE_DATE,
            AGENCY_CD,
            REMARK,
            CLS_FG,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        VALUES (
            #{hqOfficeCd},
            #{hqOfficeNm},
            #{ownerNm},
            #{bizNo},
            #{bizTypeCd},
            #{bizItemCd},
            #{bizStoreNm},
            #{telNo},
            #{faxNo},
            #{emailAddr},
            #{hmpgAddr},
            #{postNo},
            #{addr},
            #{addrDtl},
            #{areaCd},
            #{sysStatFg},
            #{sysOpenDate},
            '99991231',
            #{agencyCd},
            #{remark},
            #{clsFg},
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
        ]]>
    </insert>

    <!-- 본사 사원등록  -->
    <!--
        TABLE    : TB_HQ_EMPLOYEE
        PARAM    : hqManageVO
        COMMENTS : 본사 사원을 등록한다.
    -->
    <insert id="registEmployee" parameterType="DefaultMap">
        /* USE : HqManageMapper.registEmployee */
        <![CDATA[
        INSERT INTO TB_HQ_EMPLOYEE
        (
            HQ_OFFICE_CD,
            EMP_NO,
            EMP_NM,
            EMP_PWD,
            WEB_USE_YN,
            USER_ID,
            MP_NO,
            SERVICE_FG,
            SMS_RECV_YN,
            USE_YN,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        VALUES
        (
            #{hqOfficeCd},
            #{posEmpNo},
            #{ownerNm},
            #{posUserPwd},
            'Y',
            #{userId},
            #{telNo},
            '1',
            'N',
            'Y',
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
        ]]>
    </insert>

    <!-- 웹 사용자 등록  -->
    <!--
        TABLE    : TB_WB_USER_INFO
        PARAM    : hqManageVO
        COMMENTS : 웹 사용자를 등록한다. 본사 000007 -> FN_TB_WB_AUTHOR_GRP_USE_CD
    -->
    <insert id="registWebUser" parameterType="DefaultMap">
        /* USE : HqManageMapper.registWebUser */
        INSERT INTO TB_WB_USER_INFO
        (
            USER_ID,
            USER_PWD,
            AUTH_GRP_CD,
            LOGIN_FAIL_CNT,
            LAST_PWD_CHG_DT,
            USER_STAT_FG,
            USE_YN,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        VALUES
        (
            #{userId},
            #{userPwd},
            (SELECT FN_TB_WB_AUTHOR_GRP_USE_CD(#{hqOfficeCd}, 'H') FROM DUAL),
            0,
            #{regDt},
            '99',
            'Y',
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
    </insert>

    <!-- 본사 공통코드 등록  -->
    <!--
        TABLE    : TB_HQ_NMCODE
        PARAM    : hqManageVO
        COMMENTS : 본사 공통코드를 등록한다.
    -->
    <insert id="cmmCodeReg" parameterType="DefaultMap">
        /* USE : HqManageMapper.cmmCodeReg */
        INSERT INTO TB_HQ_NMCODE
        (
            HQ_OFFICE_CD,
            NMCODE_GRP_CD,
            NMCODE_CD,
            PARENT_CD,
            NMCODE_NM,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        VALUES
        (
            #{hqOfficeCd},
            #{nmcodeGrpCd},
            #{nmcodeCd},
            #{nmcodeGrpCd},
            #{nmcodeNm},
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
    </insert>

    <!-- 시간대 분류 등록  -->
    <!--
        TABLE    : TB_HQ_NMCODE
        PARAM    : hqManageVO
        COMMENTS : 본사 공통코드를 등록한다.
    -->
    <insert id="registTimeSlot" parameterType="DefaultMap">
        /* USE : HqManageMapper.registTimeSlot */
        INSERT INTO TB_HQ_NMCODE
        (
            HQ_OFFICE_CD,
            NMCODE_GRP_CD,
            NMCODE_CD,
            PARENT_CD,
            NMCODE_NM,
            NMCODE_ITEM_1,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        SELECT  #{hqOfficeCd},
                NMCODE_GRP_CD,
                NMCODE_CD,
                PARENT_CD,
                NMCODE_NM,
                NMCODE_ITEM_1,
                #{regDt},
                #{regId},
                #{modDt},
                #{modId}
        FROM    TB_HQ_NMCODE
        WHERE   HQ_OFFICE_CD = '00000'
        AND     NMCODE_GRP_CD = '001'
    </insert>

    <!-- 공통코드 복사   -->
    <!--
        TABLE    : TB_HQ_NMCODE
        PARAM    : hqNmcodeVO
        COMMENTS : 시스템 공통코드 테이블에서 본사용 공통코드를 복사함
    -->

    <select id="copyCmmNameCode" statementType="CALLABLE" parameterType="hqNmcodeVO" resultType="String">
        /* USE : HqManageMapper.copyCmmNameCode */
        {
            CALL PKG_CM_NMCODE.SP_HQ_NMCODE_I
            (
                #{hqOfficeCd},
                #{result, mode=OUT, jdbcType=VARCHAR}
            )
        }
    </select>

    <!-- TID 복사  -->
    <!--
        TABLE    : TB_HQ_NMCODE
        PARAM    : hqNmcodeVO
        COMMENTS : 공통코드 테이블에서 TID 복사하여 본사 공통코드 테이블에 넣음
    -->
    <!--
    <select id="copyTid" statementType="CALLABLE" parameterType="hqNmcodeVO" resultType="String">
      /* USE : HqManageMapper.copyTid */
      {
        CALL PKG_CM_NMCODE_TID.SP_HQ_NMCODE_TID_I
        (
          #{hqOfficeCd},
          #{result, mode=OUT, jdbcType=VARCHAR}
        )
      }
    </select>
    -->

    <!-- 공통코드 복사  -->
    <!--
        TABLE    : TB_HQ_NMCODE
        PARAM    : hqManageVO
        COMMENTS : 공통코드 테이블에서 복사하여 본사 공통코드 테이블에 넣음
    -->
    <!--
    <insert id="copyCmmCode" parameterType="DefaultMap">
        /* USE : HqManageMapper.copyCmmCode */
        INSERT INTO TB_HQ_NMCODE
        SELECT #{hqOfficeCd},
               NMCODE_GRP_CD,
               NMCODE_CD,
               NMCODE_NM,
               NMCODE_ITEM_1,
               NMCODE_ITEM_2,
               'Y',
               #{regDt},
               #{regId},
               #{modDt},
               #{modId}
          FROM TB_CM_NMCODE
         WHERE NMCODE_GRP_CD = #{nmcodeGrpCd}
    </insert>
    -->

    <!-- 회원 기본등급 등록 -->
    <!--
        TABLE    : TB_MB_MEMBER_CLASS
        PARAM    : memberClassVO
        COMMENTS : 회원 기본등급을 저장한다.
    -->
    <insert id="insertMemberClass" parameterType="memberClassVO" >
        /* USE : HqManageMapper.insertMemberClass */
        INSERT INTO TB_MB_MEMBER_CLASS
        (
           MEMBR_ORGN_CD,
           MEMBR_CLASS_CD,
           MEMBR_CLASS_NM,
           DC_RATE,
           POINT_SAVE_FG,
           DEFLT_YN,
           NEW_JOIN_SAVE_POINT,
           FIRST_SALE_SAVE_POINT,
           MIN_USE_POINT,
           ANVSR_POINT_SAVE_FG,
           ANVSR_SAVE_POINT,
           USE_YN,
           REG_DT,
           REG_ID,
           MOD_DT,
           MOD_ID
        )
        SELECT #{membrOrgnCd},
               MEMBR_CLASS_CD,
               MEMBR_CLASS_NM,
               DC_RATE,
               POINT_SAVE_FG,
               DEFLT_YN,
               NEW_JOIN_SAVE_POINT,
               FIRST_SALE_SAVE_POINT,
               MIN_USE_POINT,
               ANVSR_POINT_SAVE_FG,
               ANVSR_SAVE_POINT,
               USE_YN,
               #{regDt},
               #{regId},
               #{modDt},
               #{modId}
          FROM TB_MB_MEMBER_CLASS
         WHERE MEMBR_ORGN_CD = '0000000'
           AND MEMBR_CLASS_CD = '000'
    </insert>

    <!-- 기본 창고 등록 -->
    <!--
        TABLE    : TB_HQ_STORAGE
        PARAM    : hqManageVO
        COMMENTS : 본사 기본창고를 등록한다. (001 기본창고)
    -->
    <insert id="insertStorage" parameterType="DefaultMap" >
        /* USE : HqManageMapper.insertStorage */
        MERGE INTO TB_HQ_STORAGE A
        USING   (
                    SELECT  #{hqOfficeCd}   AS HQ_OFFICE_CD
                    ,       '001'           AS STORAGE_CD
                    ,       '기본창고'      AS STORAGE_NM
                    ,       'Y'             AS USE_YN
                    ,       '0001'          AS AREA_FG
                    FROM    DUAL B
                ) B
        ON      (           A.HQ_OFFICE_CD  =   B.HQ_OFFICE_CD
                AND         A.STORAGE_CD    =   B.STORAGE_CD
                )
        WHEN MATCHED THEN
        UPDATE
        SET     A.STORAGE_NM    =   B.STORAGE_NM
        ,       A.USE_YN        =   B.USE_YN
        ,       A.AREA_FG       =   B.AREA_FG
        WHEN NOT MATCHED THEN
        INSERT
        (
                A.HQ_OFFICE_CD
        ,       A.STORAGE_CD
        ,       A.STORAGE_NM
        ,       A.USE_YN
        ,       A.AREA_FG
        ,       A.REG_DT
        ,       A.REG_ID
        ,       A.MOD_DT
        ,       A.MOD_ID
        )
        VALUES
        (
                B.HQ_OFFICE_CD
        ,       B.STORAGE_CD
        ,       B.STORAGE_NM
        ,       B.USE_YN
        ,       B.AREA_FG
        ,       #{regDt}
        ,       #{regId}
        ,       #{modDt}
        ,       #{modId}
        )
    </insert>

    <!-- 포스 출력물 템플릿 등록 (본사) -->
    <!--
        TABLE    : TB_HQ_PRINT_TEMPL
        PARAM    : hqManageVO
        COMMENTS : 포스출력물의 템플릿을 저장한다.
    -->
    <insert id="hqPrintTempReg" parameterType="hqManageVO" >
        /* USE : HqManageMapper.hqPrintTempReg */
        INSERT INTO TB_HQ_PRINT_TEMPL
        (
            HQ_OFFICE_CD,
            PRT_CLASS_CD,
            TEMPLT_REG_FG,
            TEMPLT_CD,
            TEMPLT_NM,
            PRT_FORM,
            PRT_EN_FORM,
            PRT_CN_FORM,
            PRT_JP_FORM,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        SELECT #{hqOfficeCd},
               PRT_CLASS_CD,
               'C' AS TEMPLT_REG_FG,
               TEMPLT_CD,
               TEMPLT_NM,
               PRT_FORM,
               PRT_EN_FORM,
               PRT_CN_FORM,
               PRT_JP_FORM,
               #{regDt},
               #{regId},
               #{modDt},
               #{modId}
          FROM TB_CM_PRINT_TEMPL
    </insert>


    <!-- 본사 수정 -->
    <!--
        TABLE    : TB_WB_USER_INFO
        PARAM    : hqManageVO
        COMMENTS : 본사 정보를 수정한다.
    -->
    <update id="modify" parameterType="hqManageVO">
        /* USE : HqManageMapper.modify */
        <![CDATA[
        UPDATE TB_HQ_OFFICE
           SET HQ_OFFICE_NM   = #{hqOfficeNm},
               OWNER_NM       = #{ownerNm},
               BIZ_NO         = #{bizNo},
               BIZ_TYPE_CD    = #{bizTypeCd},
               BIZ_ITEM_CD    = #{bizItemCd},
               BIZ_STORE_NM   = #{bizStoreNm},
               TEL_NO         = #{telNo},
               FAX_NO         = #{faxNo},
               EMAIL_ADDR     = #{emailAddr},
               HMPG_ADDR      = #{hmpgAddr},
               POST_NO        = #{postNo},
               ADDR           = #{addr},
               ADDR_DTL       = #{addrDtl},
               AREA_CD        = #{areaCd},
               SYS_STAT_FG    = #{sysStatFg.code},
               SYS_OPEN_DATE  = #{sysOpenDate},
               SYS_CLOSURE_DATE = #{sysClosureDate},
               AGENCY_CD      = #{agencyCd},
               REMARK         = #{remark},
               CLS_FG         = #{clsFg},
               MOD_DT         = #{modDt},
               MOD_ID         = #{modId}
         WHERE HQ_OFFICE_CD   = #{hqOfficeCd}
        ]]>
    </update>

    <!-- 권한그룹 목록조회 -->
    <!--
        TABLE    : TB_HQ_OFFICE
        PARAM    : hqManageVO
        COMMENTS : 권한그룹 목록을 조회한다.
    -->
    <select id="authHqList" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.authHqList */
        SELECT  A.HQ_OFFICE_CD AS VALUE,
                '[' || A.HQ_OFFICE_CD || '] ' || A.HQ_OFFICE_NM AS NAME
        FROM    TB_HQ_OFFICE A
        ,		TB_CM_AGENCY B
        WHERE   A.HQ_OFFICE_CD != 'DS001'
        AND     A.SYS_CLOSURE_DATE > SYSDATE
        AND     B.AGENCY_CD = A.AGENCY_CD
        AND     (A.AGENCY_CD = #{agencyCd} OR B.P_AGENCY_CD= #{agencyCd} OR A.HQ_OFFICE_CD = '00000')
        ORDER
        BY      A.HQ_OFFICE_CD
    </select>

    <!-- 사용 메뉴 조회 -->
    <!--
        TABLE    : TB_WB_RESRCE_INFO, TB_HQ_EMPLOYEE, TB_WB_USER_INFO, TB_WB_AUTHOR_EXCEPT_V01
        PARAM    : hqManageVO
        COMMENTS : 사용 메뉴를 조회한다.
    -->
    <select id="avlblMenu" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.avlblMenu */
        SELECT twr.*
          FROM (
          SELECT twr.RESRCE_CD AS RESRCE_CD_LARGE,
                 twr.RESRCE_NM AS RESRCE_NM_LARGE,
                 twri.RESRCE_CD AS RESRCE_CD_MID,
                 twri.RESRCE_NM AS RESRCE_NM_MID,
                 twrif.RESRCE_CD AS RESRCE_CD_SMALL,
                 twrif.RESRCE_NM AS RESRCE_NM_SMALL
            FROM TB_WB_RESRCE_INFO twr,
                 TB_WB_RESRCE_INFO twri,
                 TB_WB_RESRCE_INFO twrif
           WHERE 1=1
             AND twr.USE_YN = 'Y'
             AND twri.USE_YN = 'Y'
             AND twrif.USE_YN = 'Y'
             AND twri.P_RESRCE = twr.RESRCE_CD
             AND twrif.P_RESRCE = twri.RESRCE_CD
             AND (twr.SPCL_AUTHOR IS NULL OR twr.SPCL_AUTHOR NOT IN ('A01'))
             AND twrif.DISP_LEVEL = '3'
           ORDER BY twr.RESRCE_CD, twri.RESRCE_CD, twrif.RESRCE_CD
              ) twr,
              (
          SELECT twa.RESRCE_CD
            FROM TB_HQ_EMPLOYEE the,
                 TB_WB_USER_INFO twu,
                 TB_WB_AUTHOR_GRP_RESRCE twa
           WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
             AND the.EMP_NO = '0000'
             AND twu.USER_ID = the.USER_ID
             AND twa.AUTH_GRP_CD = twu.AUTH_GRP_CD
             AND twa.USE_YN = 'Y'
           MINUS
          SELECT twa.RESRCE_CD
          FROM TB_HQ_EMPLOYEE the,
               TB_WB_USER_INFO twu,
               TB_WB_AUTHOR_EXCEPT_V01 twa
         WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
           AND the.EMP_NO = '0000'
           AND twu.USER_ID = the.USER_ID
           AND twa.USER_ID = twu.USER_ID
           AND twa.INCLD_EXCLD_FG = 'E'
           AND twa.USE_YN = 'Y'
               ) the
       WHERE the.RESRCE_CD = twr.RESRCE_CD_SMALL
    </select>

    <!-- 미사용 메뉴 조회 -->
    <!--
        TABLE    : TB_WB_RESRCE_INFO, TB_HQ_EMPLOYEE, TB_WB_USER_INFO, TB_WB_AUTHOR_EXCEPT_V01
        PARAM    : hqManageVO
        COMMENTS : 미사용 메뉴를 조회한다.
    -->
    <select id="beUseMenu" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.beUseMenu */
        SELECT twr.*
          FROM (
          SELECT twr.RESRCE_CD AS RESRCE_CD_LARGE,
                 twr.RESRCE_NM AS RESRCE_NM_LARGE,
                 twri.RESRCE_CD AS RESRCE_CD_MID,
                 twri.RESRCE_NM AS RESRCE_NM_MID,
                 twrif.RESRCE_CD AS RESRCE_CD_SMALL,
                 twrif.RESRCE_NM AS RESRCE_NM_SMALL
            FROM TB_WB_RESRCE_INFO twr,
                 TB_WB_RESRCE_INFO twri,
                 TB_WB_RESRCE_INFO twrif
           WHERE 1=1
             AND twr.USE_YN = 'Y'
             AND twri.USE_YN = 'Y'
             AND twrif.USE_YN = 'Y'
             AND twri.P_RESRCE = twr.RESRCE_CD
             AND twrif.P_RESRCE = twri.RESRCE_CD
             AND (twr.SPCL_AUTHOR IS NULL OR twr.SPCL_AUTHOR NOT IN ('A01'))
             AND twrif.DISP_LEVEL = '3'
           ORDER BY twr.RESRCE_CD, twri.RESRCE_CD, twrif.RESRCE_CD
               ) twr,
               (
          SELECT twa.RESRCE_CD
            FROM TB_HQ_EMPLOYEE the,
                 TB_WB_USER_INFO twu,
                 TB_WB_AUTHOR_EXCEPT_V01 twa
           WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
             AND the.EMP_NO = '0000'
             AND twu.USER_ID = the.USER_ID
             AND twa.USER_ID = twu.USER_ID
             AND twa.INCLD_EXCLD_FG = 'E'
             AND twa.USE_YN = 'Y'
               ) the
         WHERE the.RESRCE_CD = twr.RESRCE_CD_SMALL
    </select>

    <!-- 메뉴권한복사-->
    <!--
        TABLE    : TB_WB_USER_INFO, TB_HQ_EMPLOYEE
        PARAM    : hqMenuVO
        COMMENTS : 메뉴권한을 복사한다.
    -->
    <update id="copyAuth" parameterType="hqMenuVO" >
        /* USE : HqManageMapper.copyAuth */
        UPDATE TB_WB_USER_INFO
           SET AUTH_GRP_CD = (SELECT twu.AUTH_GRP_CD
                                FROM TB_HQ_EMPLOYEE the,
                                     TB_WB_USER_INFO twu
                               WHERE the.HQ_OFFICE_CD = #{copyHqOfficeCd}
                                 AND the.EMP_NO = '0000'
                                 AND twu.USER_ID = the.USER_ID
                              )
         WHERE USER_ID = (SELECT the.USER_ID
                            FROM TB_HQ_EMPLOYEE the,
                                 TB_WB_USER_INFO twu
                           WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
                             AND the.EMP_NO = '0000'
                             AND twu.USER_ID = the.USER_ID
                          )
    </update>

    <!-- 권한예외 복사-->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT, TB_HQ_EMPLOYEE, TB_WB_USER_INFO
        PARAM    : hqMenuVO
        COMMENTS : 예외 권한을 복사한다.
    -->
    <insert id="copyAuthExcp" parameterType="hqMenuVO" >
        /* USE : HqManageMapper.copyAuthExcp */
        <![CDATA[
        MERGE INTO TB_WB_AUTHOR_EXCEPT twa
        USING DUAL
         ON (
              twa.USER_ID = ( SELECT the.USER_ID
                                FROM TB_HQ_EMPLOYEE the,
                                      TB_WB_USER_INFO twu
                               WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
                                 AND the.EMP_NO = '0000'
                                 AND twu.USER_ID = the.USER_ID)
              AND twa.RESRCE_CD = #{resrceCd}
             )
         WHEN MATCHED THEN
         UPDATE
            SET twa.INCLD_EXCLD_FG = #{incldExcldFg},
                twa.USE_YN = #{useYn},
                twa.MOD_DT = #{modDt},
                twa.MOD_ID = #{modId}
         WHEN NOT MATCHED THEN
         INSERT (USER_ID, RESRCE_CD, INCLD_EXCLD_FG, USE_YN, REG_DT, REG_ID)
         VALUES (
                  (SELECT the.USER_ID FROM TB_HQ_EMPLOYEE the, TB_WB_USER_INFO twu WHERE the.HQ_OFFICE_CD = #{hqOfficeCd} AND the.EMP_NO = '0000' AND twu.USER_ID = the.USER_ID),
                  #{resrceCd},
                  #{incldExcldFg},
                  #{useYn},
                  #{regDt},
                  #{regId}
                )
        ]]>
    </insert>

    <!-- 메뉴권한 추가-->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT
        PARAM    : hqManageVO
        COMMENTS : 예외 권한을 복사한다.
    -->
    <insert id="addAuth" parameterType="DefaultMap">
        /* USE : HqManageMapper.addAuth */
        INSERT INTO TB_WB_AUTHOR_EXCEPT
        (
            USER_ID,
            RESRCE_CD,
            INCLD_EXCLD_FG,
            USE_YN,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        VALUES
        (
            (SELECT twu.USER_ID FROM TB_HQ_EMPLOYEE the, TB_WB_USER_INFO twu WHERE the.HQ_OFFICE_CD = #{hqOfficeCd} AND the.EMP_NO = '0000' AND twu.USER_ID = the.USER_ID),
            #{resrceCd},
            #{incldExcldFg},
            'Y',
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
    </insert>

    <!-- 메뉴권한 확인-->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT_V01
        PARAM    : hqManageVO
        COMMENTS : 메뉴권한을 확인한다.
    -->
    <select id="isAuth" parameterType="DefaultMap" resultType="Integer">
        /* USE : HqManageMapper.isAuth */
        SELECT COUNT(RESRCE_CD) AS CNT
          FROM TB_WB_AUTHOR_EXCEPT_V01
         WHERE USER_ID = (SELECT twu.USER_ID
                            FROM TB_HQ_EMPLOYEE the,
                                 TB_WB_USER_INFO twu
                           WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
                             AND the.EMP_NO = '0000'
                             AND twu.USER_ID = the.USER_ID)
           AND RESRCE_CD = #{resrceCd}
           AND USE_YN = 'Y'
    </select>

    <!-- 메뉴권한 삭제-->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT
        PARAM    : hqManageVO
        COMMENTS : 메뉴권한을 삭제한다.
    -->
    <delete id="removeAuth" parameterType="DefaultMap">
        /* HqManageMapper.removeAuth */
        DELETE TB_WB_AUTHOR_EXCEPT
         WHERE USER_ID = (SELECT twu.USER_ID
                            FROM TB_HQ_EMPLOYEE the,
                                 TB_WB_USER_INFO twu
                           WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
                             AND the.EMP_NO = '0000'
                             AND twu.USER_ID = the.USER_ID)
           AND RESRCE_CD = #{resrceCd}
    </delete>

    <!-- 본사 환경정보 조회 -->
    <!--
        TABLE    : TB_CM_ENVST, TB_CM_ENVST_DTL, TB_HQ_ENVST, TB_CM_NMCODE, TB_HQ_OFFICE
        COMMENTS : 브랜드의 환경정보를 조회한다.
    -->
    <select id="getConfigList" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.getConfigList */
        SELECT tcd.ENVST_GRP_CD,
                tcn.NMCODE_NM,
                tcd.ENVST_CD,
                tcd.ENVST_NM,
                tcd.DIRCT_IN_YN,
                tcd.REMARK,
                tcd.ENVST_VAL_CD,
                tcd.ENVST_VAL_NM,
                tcd.DEFLT_YN,
                tcd.TARGT_FG,
                DECODE(the.ENVST_CD, NULL, 'N', 'Y') AS EXIST_FG,
                the.ENVST_VAL AS SEL_ENVST_VAL,
                tce.ENVST_CD_CNT
          FROM (
          	  		SELECT *
                      FROM (
                              SELECT tce.ENVST_GRP_CD,
                                      tce.ENVST_CD,
                                      tce.ENVST_NM,
                                      tce.ENVST_FG,
                                      tce.TARGT_FG,
                                      tce.DIRCT_IN_YN,
                                      tce.ENVST_REMARK AS REMARK,
                                      tcd.ENVST_VAL_CD,
                                      tcd.ENVST_VAL_NM,
                                      tcd.DEFLT_YN,
                                      DECODE(tce.DIRCT_IN_YN, 'Y', 'Y', tcd.USE_YN) DTL_USE_YN
                                FROM TB_CM_ENVST tce,
                                      TB_CM_ENVST_DTL tcd
                               WHERE tce.TARGT_FG IN ('H','X','C','Z')
                                 AND tce.USE_YN = 'Y'
                                 AND tcd.ENVST_CD (+)= tce.ENVST_CD
                                <if test='envst1266 != null and envst1266 == "1"'>
                                    AND tce.ENVST_CD IN (
                                                        SELECT ENVST_CD
                                                        FROM TB_CM_ENVST_HQ_MS_MNG
                                                        WHERE ORGN_FG = 'H'
                                                        AND ORGN_CD = #{hqOfficeCd}
                                                        )
                                </if>
                            ) tcd
           			 WHERE tcd.DTL_USE_YN = 'Y'
                    <if test='envst != null and envst != ""'>
                        AND (tcd.ENVST_CD LIKE '%'|| #{envst} ||'%'
                        OR 	tcd.ENVST_NM LIKE '%'|| #{envst} ||'%')
                    </if>
                ) tcd,
                (
                   SELECT tce.ENVST_GRP_CD,
                           COUNT(*) AS ENVST_CD_CNT
                     FROM TB_CM_ENVST tce
                    WHERE tce.TARGT_FG IN ('H','X','C','Z')
                      AND tce.USE_YN = 'Y'
                    GROUP
                       BY tce.ENVST_GRP_CD
                ) tce,
               TB_HQ_ENVST the,
               TB_CM_NMCODE tcn
         WHERE the.HQ_OFFICE_CD (+)= #{hqOfficeCd}
           AND the.ENVST_CD (+)= tcd.ENVST_CD
           AND tcn.NMCODE_GRP_CD = '004'
           AND tcn.NMCODE_CD = tcd.ENVST_GRP_CD
           AND tce.ENVST_GRP_CD = tcd.ENVST_GRP_CD
         ORDER BY tcd.ENVST_GRP_CD, tcd.ENVST_CD, tcd.ENVST_VAL_CD
    </select>

    <!-- 브랜드환경정보 등록 -->
    <!--
        TABLE    : TB_HQ_ENVST
        COMMENTS : 브랜드의 환경정보를 조회한다.
    -->
    <insert id="insertConfig" parameterType="DefaultMap">
        /* USE : HqManageMapper.insertConfig */
        INSERT INTO TB_HQ_ENVST
        (
            HQ_OFFICE_CD,
            ENVST_CD,
            ENVST_VAL,
            DIRCT_IN_YN,
            USE_YN,
            REG_DT,
            REG_ID,
            MOD_DT,
            MOD_ID
        )
        VALUES
        (
            #{hqOfficeCd},
            #{envstCd},
            #{envstVal},
            #{dirctInYn},
            #{useYn},
            #{regDt},
            #{regId},
            #{modDt},
            #{modId}
        )
    </insert>

    <!-- 환경설정 수정 -->
    <!--
        TABLE    : TB_HQ_ENVST
        COMMENTS : 환경설정정보를 수정한다.
    -->
    <update id="updateConfig" parameterType="DefaultMap">
        /* USE : HqManageMapper.updateConfig */
        UPDATE TB_HQ_ENVST
           SET ENVST_VAL = #{envstVal},
               MOD_DT = #{modDt},
               MOD_ID = #{modId}
         WHERE HQ_OFFICE_CD = #{hqOfficeCd}
           AND ENVST_CD = #{envstCd}
    </update>

    <!-- 터치키 재설정 프로시저 호출 -->
    <!--
        TABLE    : TB_WB_HQ_CONFG_XML, TB_HQ_TOUCH_KEY_CLASS, TB_HQ_TOUCH_KEY
        COMMENTS : 터치키 재설정 프로시저 호출
    -->
    <select id="updateTouchKeyMng" statementType="CALLABLE" parameterType="HqEnvstVO" resultType="DefaultMap">
        /* StoreManageMapper.updateTouchKeyMng */
        {
            CALL PKG_TOUCH_KEY_MNG.SP_TOUCH_KEY_MNG_U
            (
                #{hqOfficeCd},
                #{envstCd},
                #{regDt},
                #{regId},
                #{modDt},
                #{modId},
                #{result, mode=OUT, jdbcType=VARCHAR}
            )
        }
    </select>

    <!-- 매장 환경설정 수정 -->
    <!--
        TABLE    : TB_MS_STORE_ENVST
        COMMENTS : 매장의환경설정정보를 수정한다.
    -->
    <update id="updateConfigStore" parameterType="DefaultMap">
        /* USE : HqManageMapper.updateConfigStore */
        UPDATE TB_MS_STORE_ENVST
           SET ENVST_VAL = #{envstVal},
               MOD_DT = #{modDt},
               MOD_ID = #{modId}
         WHERE STORE_CD IN (SELECT STORE_CD FROM TB_MS_STORE WHERE HQ_OFFICE_CD = #{hqOfficeCd} )
           AND ENVST_CD = #{envstCd}
    </update>

    <!-- 권한예외 복사 시, 복사기준본사의 권한예외 값 조회 -->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT_V01
        PARAM    : hqManageVO
        COMMENTS : 권한예외 복사 시, 복사기준본사의 권한예외 값을 조회한다.
    -->
    <select id="exceptMenu" parameterType="hqMenuVO" resultType="DefaultMap">
       /* USE : HqManageMapper.exceptMenu */
        SELECT USER_ID,
   	            RESRCE_CD,
	            INCLD_EXCLD_FG,
	            USE_YN
          FROM TB_WB_AUTHOR_EXCEPT_V01
         WHERE USER_ID = (SELECT twu.USER_ID
                             FROM TB_HQ_EMPLOYEE the,
                                   TB_WB_USER_INFO twu
                            WHERE the.HQ_OFFICE_CD = #{copyHqOfficeCd}
                               AND the.EMP_NO = '0000'
                               AND twu.USER_ID = the.USER_ID)
           AND USE_YN = 'Y'
    </select>

    <!-- 메뉴권한 전체삭제-->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT
        PARAM    : hqManageVO
        COMMENTS : 해당 본사의 메뉴권한 전체를 삭제한다.
    -->
    <delete id="removeAuthAll" parameterType="DefaultMap">
        /* HqManageMapper.removeAuthAll */
        DELETE TB_WB_AUTHOR_EXCEPT
         WHERE USER_ID = (SELECT twu.USER_ID
                            FROM TB_HQ_EMPLOYEE the,
                                 TB_WB_USER_INFO twu
                           WHERE the.HQ_OFFICE_CD = #{hqOfficeCd}
                             AND the.EMP_NO = '0000'
                             AND twu.USER_ID = the.USER_ID)
    </delete>

    <!-- 업체 목록 조회 -->
    <!--
      TABLE    : TB_CM_AGENCY
      COMMENTS : 업체 목록을 조회한다.
    -->
    <select id="getAgencyCd" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.selectAgencyList */
          SELECT AGENCY_CD AS VALUE,
                  '[' || AGENCY_CD || '] ' || AGENCY_NM AS NAME
            FROM TB_CM_AGENCY
            WHERE 1=1
              AND AGENCY_CD != '00000'
        <if test='orgnFg != null and orgnFg == "A"'>
            AND (AGENCY_CD = #{agencyCd} OR P_AGENCY_CD = #{agencyCd})
        </if>
        ORDER BY AGENCY_CD ASC
    </select>

    <!-- 판매터치키 메뉴 임시테이블 삭제 -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY_CLASS
        PARAM    : hqEnvstVO
        COMMENTS : 판매터치키 메뉴 임시테이블 정보를 삭제한다.
    -->
    <delete id="deleteAllTmpTouchKeyClass" parameterType="hqEnvstVO">
        /* USE : HqManageMapper.deleteAllTmpTouchKeyClass */
        DELETE
          FROM TB_TMP_TOUCH_KEY_CLASS
         WHERE 1=1
           AND SESSION_ID = #{sessionId}
    </delete>

    <!-- 판매터치키 임시테이블 삭제 -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY
        PARAM    : hqEnvstVO
        COMMENTS : 판매터치키 임시테이블 정보를 삭제한다.
    -->
    <delete id="deleteAllTmpTouchKey" parameterType="hqEnvstVO">
        /* USE : HqManageMapper.deleteAllTmpTouchKey */
        DELETE
          FROM TB_TMP_TOUCH_KEY
         WHERE 1=1
           AND SESSION_ID = #{sessionId}
    </delete>

    <!-- 임시테이블에 본사 판매터치키 분류 입력-->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY_CLASS, TB_HQ_TOUCH_KEY_CLASS
        PARAM    : hqEnvstVO
        COMMENTS : 임시테이블에 본사 판매터치키 분류를 입력한다.
    -->
    <insert id="insertTmpHqTouchKeyClass" parameterType="hqEnvstVO" >
        /* USE : HqManageMapper.insertTmpHqTouchKeyClass */
        INSERT INTO TB_TMP_TOUCH_KEY_CLASS(
                    SESSION_ID,
                    SEQ,
                    HQ_OFFICE_CD,
                    TUKEY_GRP_CD,
                    TUKEY_CLASS_CD,
                    TUKEY_CLASS_NM,
                    PAGE_NO,
                    PAGE_ROWS,
                    X,
                    Y,
                    WIDTH,
                    HEIGHT,
                    STYLE_CD,
                    FONT_SIZE,
                    FONT_COLOR,
                    FILL_COLOR,
                    IMG_NM,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
        )
             SELECT #{sessionId},
                    ROWNUM,
                    HQ_OFFICE_CD,
                    TUKEY_GRP_CD,
                    TUKEY_CLASS_CD,
                    TUKEY_CLASS_NM,
                    PAGE_NO,
                    PAGE_ROWS,
                    X,
                    Y,
                    WIDTH,
                    HEIGHT,
                    STYLE_CD,
                    FONT_SIZE,
                    FONT_COLOR,
                    FILL_COLOR,
                    IMG_NM,
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
               FROM TB_HQ_TOUCH_KEY_CLASS
              WHERE HQ_OFFICE_CD = #{hqOfficeCd}
              ORDER
                 BY TUKEY_GRP_CD, TUKEY_CLASS_CD
    </insert>

    <!-- 임시테이블에 본사 판매터치키 입력-->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_HQ_TOUCH_KEY
        PARAM    : hqEnvstVO
        COMMENTS : 임시테이블에 본사 판매터치키를 입력한다.
    -->
    <insert id="insertTmpHqTouchKey" parameterType="hqEnvstVO" >
        /* USE : HqManageMapper.insertTmpHqTouchKey */
        INSERT INTO TB_TMP_TOUCH_KEY(
                    SESSION_ID,
                    SEQ,
                    HQ_OFFICE_CD,
                    TUKEY_CLASS_CD,
                    TUKEY_CD,
                    TUKEY_FG,
                    PROD_CD,
                    PAGE_NO,
                    X,
                    Y,
                    WIDTH,
                    HEIGHT,
                    STYLE_CD,
                    FONT_SIZE,
                    FONT_COLOR,
                    FILL_COLOR,
                    IMG_NM,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID,
                    TUKEY_GRP_CD
        )
             SELECT #{sessionId},
                    ROWNUM,
                    HQ_OFFICE_CD,
                    TUKEY_CLASS_CD,
                    TUKEY_CD,
                    TUKEY_FG,
                    PROD_CD,
                    PAGE_NO,
                    X,
                    Y,
                    WIDTH,
                    HEIGHT,
                    STYLE_CD,
                    FONT_SIZE,
                    FONT_COLOR,
                    FILL_COLOR,
                    IMG_NM,
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId},
                    TUKEY_GRP_CD
               FROM TB_HQ_TOUCH_KEY
              WHERE HQ_OFFICE_CD = #{hqOfficeCd}
              ORDER
                 BY TUKEY_GRP_CD, TUKEY_CLASS_CD, TUKEY_CD
    </insert>

    <!-- 본사 판매터치키 분류 기존정보 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY_CLASS
        PARAM    : hqEnvstVO
        COMMENTS : 본사 판매터치키 분류 기존정보를 삭제한다.
    -->
    <delete id="deleteOrgHqTouchKeyClass" parameterType="hqEnvstVO">
        /* USE : HqManageMapper.deleteOrgHqTouchKeyClass */
        DELETE
          FROM TB_HQ_TOUCH_KEY_CLASS
         WHERE HQ_OFFICE_CD = #{hqOfficeCd}
    </delete>

    <!-- 본사 판매터치키 기존정보 삭제 -->
    <!--
        TABLE    : TB_HQ_TOUCH_KEY
        PARAM    : hqEnvstVO
        COMMENTS : 본사 판매터치키 기존정보를 삭제한다.
    -->
    <delete id="deleteOrgHqTouchKey" parameterType="hqEnvstVO">
        /* USE : HqManageMapper.deleteOrgHqTouchKey */
         DELETE
           FROM TB_HQ_TOUCH_KEY
          WHERE HQ_OFFICE_CD = #{hqOfficeCd}
    </delete>

    <!-- 본사 판매터치키 분류 재정렬 -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY_CLASS, TB_HQ_TOUCH_KEY_CLASS
        PARAM    : hqEnvstVO
        COMMENTS : 터치분류 메뉴 라인수 변경에 따른 터치키분류 재정렬(바둑판형식)
    -->
    <update id="chgSortHqTouchKeyClass" parameterType="hqEnvstVO">
        /* HqManageMapper.chgSortHqTouchKeyClass */
        INSERT INTO TB_HQ_TOUCH_KEY_CLASS(
                HQ_OFFICE_CD,
                TUKEY_GRP_CD,
                TUKEY_CLASS_CD,
                TUKEY_CLASS_NM,
                PAGE_NO,
                PAGE_ROWS,
                X,
                Y,
                WIDTH,
                HEIGHT,
                STYLE_CD,
                FONT_SIZE,
                FONT_COLOR,
                FILL_COLOR,
                IMG_NM,
                REG_DT,
                REG_ID,
                MOD_DT,
                MOD_ID
            )
            SELECT thtkc.HQ_OFFICE_CD,
                   thtkc.TUKEY_GRP_CD,
                   thtkc.TUKEY_CLASS_CD,
                   thtkc.TUKEY_CLASS_NM,
                   thtkc.PAGE_NO,
                   thtkc.PAGE_ROWS,
                   thtkc.X,
                   thtkc.Y,
                   thtkc.WIDTH,
                   thtkc.HEIGHT,
                   thtkc.STYLE_CD,
                   thtkc.FONT_SIZE,
                   thtkc.FONT_COLOR,
                   thtkc.FILL_COLOR,
                   thtkc.IMG_NM,
                   #{regDt} AS REG_DT,
                   #{regId} AS REG_ID,
                   #{modDt} AS MOD_DT,
                   #{modId} AS MOD_ID
            FROM (
                    SELECT tttkc.GRP_ID,
                           tttkc.HQ_OFFICE_CD,
                           tttkc.TUKEY_GRP_CD,
                           tttkc.TUKEY_CLASS_CD,
                           tttkc.TUKEY_CLASS_NM,
                           FLOOR((tttkc.GRP_ID-1) / (5*(TO_NUMBER(#{envstVal}))-1))+1 AS PAGE_NO,
                           #{envstVal} AS PAGE_ROWS,
                           MOD(MOD(tttkc.GRP_ID-1,5*(TO_NUMBER(#{envstVal}))-1),5) * 100 AS X,
                           (FLOOR(MOD(tttkc.GRP_ID-1,5*(TO_NUMBER(#{envstVal}))-1)/5)) * 61 AS Y,
                           '99' AS WIDTH,
                           '60' AS HEIGHT,
                           tttkc.STYLE_CD,
                           tttkc.FONT_SIZE,
                           tttkc.FONT_COLOR,
                           tttkc.FILL_COLOR,
                           tttkc.IMG_NM
                      FROM (
                               SELECT RANK() OVER(PARTITION BY tttkc.TUKEY_GRP_CD ORDER BY tttkc.TUKEY_GRP_CD, tttkc.TUKEY_CLASS_CD) AS GRP_ID,
                                      tttkc.*
                                 FROM TB_TMP_TOUCH_KEY_CLASS tttkc
                                WHERE tttkc.SESSION_ID = #{sessionId}
                                  AND tttkc.HQ_OFFICE_CD = #{hqOfficeCd}
                                ORDER
                                   BY tttkc.TUKEY_GRP_CD, tttkc.TUKEY_CLASS_CD
                           ) tttkc
                ) thtkc
          WHERE 6 > thtkc.PAGE_NO
  </update>

    <!-- 본사 판매터치키 재정렬 (01: 셀 사이즈) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_HQ_TOUCH_KEY
        PARAM    : hqEnvstVO
        COMMENTS : 터치분류 메뉴 라인수 변경에 따른 터치키 재정렬(바둑판형식)
    -->
    <update id="chgSortHqTouchKey01" parameterType="hqEnvstVO">
        /* HqManageMapper.chgSortHqTouchKey01 */
        INSERT INTO TB_HQ_TOUCH_KEY(
                   HQ_OFFICE_CD,
                   TUKEY_CLASS_CD,
                   TUKEY_CD,
                   TUKEY_FG,
                   PROD_CD,
                   PAGE_NO,
                   X,
                   Y,
                   WIDTH,
                   HEIGHT,
                   STYLE_CD,
                   FONT_SIZE,
                   FONT_COLOR,
                   FILL_COLOR,
                   IMG_NM,
                   REG_DT,
                   REG_ID,
                   MOD_DT,
                   MOD_ID,
                   TUKEY_GRP_CD
             )
             SELECT thtk.HQ_OFFICE_CD,
                    thtk.TUKEY_CLASS_CD,
                    thtk.TUKEY_CD,
                    thtk.TUKEY_FG,
                    thtk.PROD_CD,
                    thtk.PAGE_NO,
                    thtk.X,
                    thtk.Y,
                    thtk.WIDTH,
                    thtk.HEIGHT,
                    thtk.STYLE_CD,
                    thtk.FONT_SIZE,
                    thtk.FONT_COLOR,
                    thtk.FILL_COLOR,
                    thtk.IMG_NM,
                    #{regDt} AS REG_DT,
                    #{regId} AS REG_ID,
                    #{modDt} AS MOD_DT,
                    #{modId} AS MOD_ID,
                    thtk.TUKEY_GRP_CD
             FROM (
                     SELECT tttk.GRP_ID,
                            tttk.HQ_OFFICE_CD,
                            tttk.TUKEY_CLASS_CD,
                            tttk.TUKEY_CD,
                            tttk.TUKEY_FG,
                            tttk.PROD_CD,
                            FLOOR((tttk.GRP_ID-1) / (5*(8-TO_NUMBER(#{envstVal}))-1))+1 AS PAGE_NO,
                            MOD(MOD(tttk.GRP_ID-1,5*(8-TO_NUMBER(#{envstVal}))-1),5) * 100 AS X,
                            (FLOOR(MOD(tttk.GRP_ID-1,5*(8-TO_NUMBER(#{envstVal}))-1)/5)) * 75 AS Y,
                            '99' AS WIDTH,
                            '74' AS HEIGHT,
                            tttk.STYLE_CD,
                            tttk.FONT_SIZE,
                            tttk.FONT_COLOR,
                            tttk.FILL_COLOR,
                            tttk.IMG_NM,
                            tttk.IN_FG,
                            tttk.TUKEY_GRP_CD
                    FROM (
                            SELECT RANK() OVER(PARTITION BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD ORDER BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD) AS GRP_ID,
                                   tttk.*
                              FROM TB_TMP_TOUCH_KEY tttk
                             WHERE tttk.SESSION_ID = #{sessionId}
                               AND tttk.HQ_OFFICE_CD = #{hqOfficeCd}
                               AND tttk.TUKEY_FG = '01'
                             ORDER
                                BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD
                         ) tttk
                  ) thtk
            WHERE 6 > thtk.PAGE_NO
    </update>

    <!-- 본사 판매터치키 재정렬 (02: 상품명) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_HQ_TOUCH_KEY
        PARAM    : hqEnvstVO
        COMMENTS : 터치분류 메뉴 라인수 변경에 따른 터치키 재정렬(바둑판형식)
    -->
    <update id="chgSortHqTouchKey02" parameterType="hqEnvstVO">
        /* HqManageMapper.chgSortHqTouchKey02 */
        INSERT INTO TB_HQ_TOUCH_KEY(
                   HQ_OFFICE_CD,
                   TUKEY_CLASS_CD,
                   TUKEY_CD,
                   TUKEY_FG,
                   PROD_CD,
                   PAGE_NO,
                   X,
                   Y,
                   WIDTH,
                   HEIGHT,
                   STYLE_CD,
                   FONT_SIZE,
                   FONT_COLOR,
                   FILL_COLOR,
                   IMG_NM,
                   REG_DT,
                   REG_ID,
                   MOD_DT,
                   MOD_ID,
                   TUKEY_GRP_CD
             )
             SELECT thtk.HQ_OFFICE_CD,
                    thtk.TUKEY_CLASS_CD,
                    thtk.TUKEY_CD,
                    thtk.TUKEY_FG,
                    thtk.PROD_CD,
                    thtk.PAGE_NO,
                    thtk.X,
                    thtk.Y,
                    thtk.WIDTH,
                    thtk.HEIGHT,
                    thtk.STYLE_CD,
                    thtk.FONT_SIZE,
                    thtk.FONT_COLOR,
                    thtk.FILL_COLOR,
                    thtk.IMG_NM,
                    #{regDt} AS REG_DT,
                    #{regId} AS REG_ID,
                    #{modDt} AS MOD_DT,
                    #{modId} AS MOD_ID,
                    thtk.TUKEY_GRP_CD
             FROM (
                     SELECT tttk.GRP_ID,
                            tttk.HQ_OFFICE_CD,
                            tttk.TUKEY_CLASS_CD,
                            tttk.TUKEY_CD,
                            tttk.TUKEY_FG,
                            tttk.PROD_CD,
                            FLOOR((tttk.GRP_ID-1) / (5*(8-TO_NUMBER(#{envstVal}))-1))+1 AS PAGE_NO,
                            '5' AS X,
                            '5' AS Y,
                            '89' AS WIDTH,
                            '64' AS HEIGHT,
                            tttk.STYLE_CD,
                            tttk.FONT_SIZE,
                            tttk.FONT_COLOR,
                            tttk.FILL_COLOR,
                            tttk.IMG_NM,
                            tttk.TUKEY_GRP_CD
                    FROM (
                            SELECT RANK() OVER(PARTITION BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD ORDER BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD) AS GRP_ID,
                                   tttk.*
                              FROM TB_TMP_TOUCH_KEY tttk
                             WHERE tttk.SESSION_ID = #{sessionId}
                               AND tttk.HQ_OFFICE_CD = #{hqOfficeCd}
                               AND tttk.TUKEY_FG = '02'
                             ORDER
                                BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD
                         ) tttk
                  ) thtk
            WHERE 6 > thtk.PAGE_NO
    </update>

    <!-- 본사 판매터치키 재정렬 (03: 가격) -->
    <!--
        TABLE    : TB_TMP_TOUCH_KEY, TB_HQ_TOUCH_KEY
        PARAM    : hqEnvstVO
        COMMENTS : 터치분류 메뉴 라인수 변경에 따른 터치키 재정렬(바둑판형식)
    -->
    <update id="chgSortHqTouchKey03" parameterType="hqEnvstVO">
        /* HqManageMapper.chgSortHqTouchKey03 */
        INSERT INTO TB_HQ_TOUCH_KEY(
                   HQ_OFFICE_CD,
                   TUKEY_CLASS_CD,
                   TUKEY_CD,
                   TUKEY_FG,
                   PROD_CD,
                   PAGE_NO,
                   X,
                   Y,
                   WIDTH,
                   HEIGHT,
                   STYLE_CD,
                   FONT_SIZE,
                   FONT_COLOR,
                   FILL_COLOR,
                   IMG_NM,
                   REG_DT,
                   REG_ID,
                   MOD_DT,
                   MOD_ID,
                   TUKEY_GRP_CD
             )
             SELECT thtk.HQ_OFFICE_CD,
                    thtk.TUKEY_CLASS_CD,
                    thtk.TUKEY_CD,
                    thtk.TUKEY_FG,
                    thtk.PROD_CD,
                    thtk.PAGE_NO,
                    thtk.X,
                    thtk.Y,
                    thtk.WIDTH,
                    thtk.HEIGHT,
                    thtk.STYLE_CD,
                    thtk.FONT_SIZE,
                    thtk.FONT_COLOR,
                    thtk.FILL_COLOR,
                    thtk.IMG_NM,
                    #{regDt} AS REG_DT,
                    #{regId} AS REG_ID,
                    #{modDt} AS MOD_DT,
                    #{modId} AS MOD_ID,
                    thtk.TUKEY_GRP_CD
             FROM (
                     SELECT tttk.GRP_ID,
                            tttk.HQ_OFFICE_CD,
                            tttk.TUKEY_CLASS_CD,
                            tttk.TUKEY_CD,
                            tttk.TUKEY_FG,
                            tttk.PROD_CD,
                            FLOOR((tttk.GRP_ID-1) / (5*(8-TO_NUMBER(#{envstVal}))-1))+1 AS PAGE_NO,
                            94 - (LENGTH(thpsp.SALE_UPRC) * 10) AS X,
                            '49' AS Y,
                            (LENGTH(thpsp.SALE_UPRC) * 10) AS WIDTH,
                            '20' AS HEIGHT,
                            tttk.STYLE_CD,
                            tttk.FONT_SIZE,
                            tttk.FONT_COLOR,
                            tttk.FILL_COLOR,
                            tttk.IMG_NM,
                            tttk.TUKEY_GRP_CD,
                            thpsp.SALE_UPRC
                    FROM (
                            SELECT RANK() OVER(PARTITION BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD ORDER BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD) AS GRP_ID,
                                   tttk.*
                              FROM TB_TMP_TOUCH_KEY tttk
                             WHERE tttk.SESSION_ID = #{sessionId}
                               AND tttk.HQ_OFFICE_CD = #{hqOfficeCd}
                               AND tttk.TUKEY_FG = '03'
                             ORDER
                                BY tttk.TUKEY_GRP_CD, tttk.TUKEY_CLASS_CD, tttk.TUKEY_CD
                         ) tttk, TB_HQ_PRODUCT_SALE_PRICE_V01 thpsp
                   WHERE tttk.HQ_OFFICE_CD = thpsp.HQ_OFFICE_CD
                     AND tttk.PROD_CD  = thpsp.PROD_CD
                     AND thpsp.SALE_DATE = TO_CHAR(SYSDATE, 'yyyyMMdd')
                  ) thtk
            WHERE 6 > thtk.PAGE_NO
    </update>

    <!-- 기준테이블바탕화면 이미지 등록 -->
    <!--
        TABLE    : TB_HQ_POS_ADVER_FILE, TB_MS_POS_ADVER_FILE
        PARAM    : hqManageVO
        COMMENTS : 기준테이블바탕화면 이미지를 등록한다.
    -->
    <insert id="insertHqBaseTblBgImg" parameterType="hqManageVO">
        /* USE : HqManageMapper.insertHqBaseTblBgImg */
        INSERT INTO TB_HQ_POS_ADVER_FILE
        (
               HQ_OFFICE_CD
        ,      ADVER_FILE_NO
        ,      FILE_USE_TYPE
        ,      ADVER_S_DATE
        ,      ADVER_E_DATE
        ,      FILE_DIR
        ,      FILE_NM
        ,      FILE_EXT
        ,      FILE_SIZE
        ,      FILE_MIME_TYPE
        ,      FILE_ORG_NM
        ,      FILE_DESC
        ,      FILE_CHG_DT
        ,      USE_YN
        ,      REG_DT
        ,      REG_ID
        ,      MOD_DT
        ,      MOD_ID
        ,      DISP_SEQ
        ,      DISP_TIME
        ,      TIME_YN
        ,      START_TIME
        ,      END_TIME
        ,      WEEK_YN
        ,      MON_YN
        ,      TUE_YN
        ,      WED_YN
        ,      THU_YN
        ,      FRI_YN
        ,      SAT_YN
        ,      SUN_YN
        ,      PROMOTION_CD
        )
        SELECT #{hqOfficeCd} AS HQ_OFFICE_CD
        ,      (SELECT LPAD(NVL(MAX(ADVER_FILE_NO), 0) +1, 4, '0') FROM TB_HQ_POS_ADVER_FILE WHERE HQ_OFFICE_CD = #{hqOfficeCd}) AS ADVER_FILE_NO
        ,      FILE_USE_TYPE
        ,      ADVER_S_DATE
        ,      ADVER_E_DATE
        ,      FILE_DIR
        ,      FILE_NM
        ,      FILE_EXT
        ,      FILE_SIZE
        ,      FILE_MIME_TYPE
        ,      FILE_ORG_NM
        ,      FILE_DESC
        ,      FILE_CHG_DT
        ,      USE_YN
        ,      #{regDt} AS REG_DT
        ,      #{regId} AS REG_ID
        ,      #{modDt} AS MOD_DT
        ,      #{modId} AS MOD_ID
        ,      DISP_SEQ
        ,      DISP_TIME
        ,      TIME_YN
        ,      START_TIME
        ,      END_TIME
        ,      WEEK_YN
        ,      MON_YN
        ,      TUE_YN
        ,      WED_YN
        ,      THU_YN
        ,      FRI_YN
        ,      SAT_YN
        ,      SUN_YN
        ,      PROMOTION_CD
        FROM   TB_MS_POS_ADVER_FILE
        WHERE  STORE_CD        =   '0000000'
        AND    ADVER_FILE_NO   =   '8000'
    </insert>


    <!-- 사용 메뉴 조회 -->
    <!--
        TABLE    : TB_WB_RESRCE_INFO, TB_HQ_EMPLOYEE, TB_WB_USER_INFO, TB_WB_AUTHOR_EXCEPT_V01
        PARAM    : hqManageVO
        COMMENTS : 사용 메뉴를 조회한다.
    -->
    <select id="avlblMobileMenu" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.avlblMobileMenu */
        SELECT twr.*
        FROM
            (
                SELECT  twr.RESRCE_CD   AS RESRCE_CD_LARGE
                ,       twr.RESRCE_NM   AS RESRCE_NM_LARGE
                ,       twri.RESRCE_CD  AS RESRCE_CD_MID
                ,       twri.RESRCE_NM  AS RESRCE_NM_MID
                FROM    TB_WB_RESRCE_INFO twr
                ,       TB_WB_RESRCE_INFO twri
                WHERE   1=1
                AND     twr.USE_YN      = 'Y'
                AND     twri.USE_YN     = 'Y'
                AND     twri.P_RESRCE   = twr.RESRCE_CD
                AND     twri.DISP_LEVEL = '2'
                AND     twri.RESRCE_CD NOT IN   (
                                                    SELECT 	P_RESRCE
                                                    FROM 	TB_WB_RESRCE_INFO
                                                    WHERE 	USE_YN = 'Y'
                                                    AND 	DISP_LEVEL = '3'
                                                )
                AND     (twr.SPCL_AUTHOR IS NULL OR twr.SPCL_AUTHOR NOT IN ('A01'))
                ORDER
                BY      twr.RESRCE_CD
                ,       twri.RESRCE_CD
            ) twr
        ,   (
                SELECT  twa.RESRCE_CD
                FROM    TB_HQ_EMPLOYEE the
                ,       TB_WB_USER_INFO twu
                ,       TB_WB_AUTHOR_GRP_RESRCE twa
                WHERE   the.HQ_OFFICE_CD    = #{hqOfficeCd}
                AND     the.EMP_NO          = '0000'
                AND     twu.USER_ID         = the.USER_ID
                AND 	twa.AUTH_GRP_CD IN (SELECT FN_TB_WB_AUTHOR_GRP_USE_CD(( SELECT USER_ID FROM TB_HQ_EMPLOYEE WHERE HQ_OFFICE_CD = #{hqOfficeCd} AND EMP_NO ='0000'), 'MOB') FROM DUAL)
                AND     twa.USE_YN          = 'Y'
                MINUS
                SELECT  twa.RESRCE_CD
                FROM    TB_HQ_EMPLOYEE the
                ,       TB_WB_USER_INFO twu
                ,       TB_WB_AUTHOR_EXCEPT_V01 twa
                WHERE   the.HQ_OFFICE_CD = #{hqOfficeCd}
                AND     the.EMP_NO          = '0000'
                AND     twu.USER_ID         = the.USER_ID
                AND     twa.USER_ID         = twu.USER_ID
                AND     twa.INCLD_EXCLD_FG  = 'E'
                AND     twa.USE_YN          = 'Y'
            ) the
        WHERE the.RESRCE_CD = twr.RESRCE_CD_MID
    </select>

    <!-- 미사용 메뉴 조회 -->
    <!--
        TABLE    : TB_WB_RESRCE_INFO, TB_HQ_EMPLOYEE, TB_WB_USER_INFO, TB_WB_AUTHOR_EXCEPT_V01
        PARAM    : hqManageVO
        COMMENTS : 미사용 메뉴를 조회한다.
    -->
    <select id="beUseMobileMenu" parameterType="hqManageVO" resultType="DefaultMap">
        /* USE : HqManageMapper.beUseMobileMenu */
        SELECT twr.*
        FROM
            (
                SELECT  twr.RESRCE_CD   AS RESRCE_CD_LARGE
                ,       twr.RESRCE_NM   AS RESRCE_NM_LARGE
                ,       twri.RESRCE_CD  AS RESRCE_CD_MID
                ,       twri.RESRCE_NM  AS RESRCE_NM_MID
                FROM    TB_WB_RESRCE_INFO twr
                ,       TB_WB_RESRCE_INFO twri
                WHERE   1=1
                AND     twr.USE_YN      = 'Y'
                AND     twri.USE_YN     = 'Y'
                AND     twri.P_RESRCE   = twr.RESRCE_CD
                AND     twri.DISP_LEVEL = '2'
                AND     twri.RESRCE_CD NOT IN   (
                                                    SELECT 	P_RESRCE
                                                    FROM 	TB_WB_RESRCE_INFO
                                                    WHERE 	USE_YN = 'Y'
                                                    AND 	DISP_LEVEL = '3'
                                                )
                AND     (twr.SPCL_AUTHOR IS NULL OR twr.SPCL_AUTHOR NOT IN ('A01'))
                ORDER
                BY      twr.RESRCE_CD
                ,       twri.RESRCE_CD
            ) twr
        ,   (
                SELECT  twa.RESRCE_CD
                FROM    TB_HQ_EMPLOYEE the
                ,       TB_WB_USER_INFO twu
                ,       TB_WB_AUTHOR_EXCEPT_V01 twa
                WHERE   the.HQ_OFFICE_CD    = #{hqOfficeCd}
                AND     the.EMP_NO          = '0000'
                AND     twu.USER_ID         = the.USER_ID
                AND     twa.USER_ID         = twu.USER_ID
                AND     twa.INCLD_EXCLD_FG  = 'E'
                AND     twa.USE_YN          = 'Y'
            ) the
        WHERE   the.RESRCE_CD = twr.RESRCE_CD_MID
    </select>

    <!-- 메뉴권한 전체삭제-->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT
        PARAM    : hqManageVO
        COMMENTS : 해당 본사의 메뉴권한 전체를 삭제한다.
    -->
    <delete id="removeMobileAuthAll" parameterType="DefaultMap">
        /* HqManageMapper.removeMobileAuthAll */
        DELETE  TB_WB_AUTHOR_EXCEPT
        WHERE   USER_ID =   (
                                SELECT  twu.USER_ID
                                FROM    TB_HQ_EMPLOYEE the
                                ,       TB_WB_USER_INFO twu
                                WHERE   the.HQ_OFFICE_CD    = #{hqOfficeCd}
                                AND     the.EMP_NO          = '0000'
                                AND     twu.USER_ID         = the.USER_ID
                            )
        AND     RESRCE_CD IN    (
                                    SELECT 	twri.RESRCE_CD AS RESRCE_CD
                                    FROM 	TB_WB_RESRCE_INFO twr
                                    , 	    TB_WB_RESRCE_INFO twri
                                    WHERE 	1=1
                                    AND 	twr.USE_YN      = 'Y'
                                    AND 	twri.USE_YN     = 'Y'
                                    AND 	twri.P_RESRCE   = twr.RESRCE_CD
                                    AND 	twri.DISP_LEVEL = '2'
                                    AND 	twri.RESRCE_CD NOT IN 	(
                                                                        SELECT 	P_RESRCE
                                                                        FROM 	TB_WB_RESRCE_INFO
                                                                        WHERE 	USE_YN = 'Y'
                                                                        AND 	DISP_LEVEL = '3'
                                                                    )
                                    AND (twr.SPCL_AUTHOR IS NULL OR twr.SPCL_AUTHOR NOT IN ('A01'))
                                )
    </delete>

    <!-- 모바일 권한예외 복사 시, 복사기준본사의 모바일 권한예외 값 조회 -->
    <!--
        TABLE    : TB_WB_AUTHOR_EXCEPT_V01
        PARAM    : hqManageVO
        COMMENTS : 모바일 권한예외 복사 시, 복사기준본사의 모바일 권한예외 값 조회한다.
    -->
    <select id="exceptMobileMenu" parameterType="hqMenuVO" resultType="DefaultMap">
        /* USE : HqManageMapper.exceptMobileMenu */
        SELECT  USER_ID
        ,       RESRCE_CD
        ,       INCLD_EXCLD_FG
        ,       USE_YN
        FROM    TB_WB_AUTHOR_EXCEPT_V01
        WHERE   USER_ID =   (
                                SELECT  twu.USER_ID
                                FROM    TB_HQ_EMPLOYEE the
                                ,       TB_WB_USER_INFO twu
                                WHERE   the.HQ_OFFICE_CD    = #{copyHqOfficeCd}
                                AND     the.EMP_NO          = '0000'
                                AND     twu.USER_ID         = the.USER_ID
                            )
        AND     RESRCE_CD IN    (
                                    SELECT 	twri.RESRCE_CD AS RESRCE_CD
                                    FROM 	TB_WB_RESRCE_INFO twr
                                    , 	    TB_WB_RESRCE_INFO twri
                                    WHERE 	1=1
                                    AND 	twr.USE_YN      = 'Y'
                                    AND 	twri.USE_YN     = 'Y'
                                    AND 	twri.P_RESRCE   = twr.RESRCE_CD
                                    AND 	twri.DISP_LEVEL = '2'
                                    AND 	twri.RESRCE_CD NOT IN 	(
                                                                        SELECT 	P_RESRCE
                                                                        FROM 	TB_WB_RESRCE_INFO
                                                                        WHERE 	USE_YN      = 'Y'
                                                                        AND 	DISP_LEVEL  = '3'
                                                                    )
                                    AND (twr.SPCL_AUTHOR IS NULL OR twr.SPCL_AUTHOR NOT IN ('A01'))
                                )
          AND USE_YN = 'Y'
    </select>
</mapper>
