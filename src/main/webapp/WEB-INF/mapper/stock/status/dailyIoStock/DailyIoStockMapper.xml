<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.stock.status.dailyIoStock.service.impl.DailyIoStockMapper">

    <!-- 일자별수불현황 - 일자별수불현황 리스트 조회  -->
    <select id="getDailyIoStockList" parameterType="dailyIoStockVO" resultType="DefaultMap">
        <choose>
             <when test='orgnFg != null and orgnFg == "H"'>    <!-- 본사 -->
                SELECT SUBSTR(TPHS.IO_OCCR_DT,1,8) AS IO_OCCR_DT
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '01', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_01 /* 본사입고 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '01', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_01 /* 본사입고 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '16', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_16 /* 업체반출 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '16', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_16 /* 업체반출 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '13', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_13 /* 본사출고 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '13', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_13 /* 본사출고 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '02', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_02 /* 본사반입 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '02', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_02 /* 본사반입 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '04', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_04 /* 매장이입 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '04', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_04 /* 매장이입 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '14', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_14 /* 매장이출 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '14', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_14 /* 매장이출 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '17', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_17 /* 재고폐기 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '17', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_17 /* 재고폐기 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '21', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_21 /* 재고조정 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '21', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_21 /* 재고조정 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '22', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_22 /* 세트생성 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '22', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_22 /* 세트생성 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '19', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_19 /* 거래처출고 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '19', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_19 /* 거래처출고 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '33', TPHS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_33 /* 거래처반품 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPHS.IO_OCCR_FG, '33', TPHS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_33 /* 거래처반품 금액*/
				  FROM TB_PO_HQ_STOCK TPHS
				 WHERE TPHS.HQ_OFFICE_CD = #{hqOfficeCd}
						<if test="startDate != '' and startDate != null and endDate != '' and endDate != null">
						   AND SUBSTR(TPHS.IO_OCCR_DT,1,8) BETWEEN #{startDate} AND #{endDate}
						</if>
				 GROUP BY SUBSTR(TPHS.IO_OCCR_DT,1,8)
				 ORDER BY SUBSTR(TPHS.IO_OCCR_DT,1,8) DESC
             </when>
             <when test='orgnFg != null and orgnFg == "S"'>    <!-- 가맹점 -->
                SELECT SUBSTR(TPSS.IO_OCCR_DT,1,8) AS IO_OCCR_DT
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '03', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_03 /* 매장입고 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '03', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_03 /* 매장입고 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '12', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_12 /* 매장반품 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '12', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_12 /* 매장반품 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '06', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_06 /* 사입입고 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '06', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_06 /* 사입입고 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '18', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_18 /* 사입반품 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '18', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_18 /* 사입반품 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '11', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_11 /* 매장판매 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '11', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_11 /* 매장판매 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '04', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_04 /* 매장이입 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '04', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_04 /* 매장이입 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '14', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_14 /* 매장이출 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '14', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_14 /* 매장이출 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '17', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_01 /* 재고폐기 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '17', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_01 /* 재고폐기 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '21', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_02 /* 재고조정 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '21', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_02 /* 재고조정 금액*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '22', TPSS.IO_OCCR_QTY, 0))) AS IO_OCCR_QTY_05 /* 세트생성 수량*/
				     , SF_ZERO_TO_NULL(SUM(DECODE(TPSS.IO_OCCR_FG, '22', TPSS.IO_OCCR_TOT, 0))) AS IO_OCCR_TOT_05 /* 세트생성 금액*/
				  FROM TB_PO_STORE_STOCK TPSS
				 WHERE TPSS.STORE_CD = #{storeCd}
					   <if test="startDate != '' and startDate != null and endDate != '' and endDate != null">
	    				    AND SUBSTR(TPSS.IO_OCCR_DT,1,8) BETWEEN #{startDate} AND #{endDate}
					   </if>
				 GROUP BY SUBSTR(TPSS.IO_OCCR_DT,1,8)
				 ORDER BY SUBSTR(TPSS.IO_OCCR_DT,1,8) DESC
             </when>
        </choose>

    </select>

</mapper>
