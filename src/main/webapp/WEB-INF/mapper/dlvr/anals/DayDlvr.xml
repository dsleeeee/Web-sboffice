<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.dlvr.anals.dayDlvr.service.impl.DayDlvrMapper">

  <!-- 일자별 배달현황  -->
  <!--
      TABLE    : TB_SL_SALE_HDR_DLVR & TB_SL_SALE_HDR
      COMMENTS :
  -->
  <!--  <select id="getDayDlvrSaleList" parameterType="dayDlvrVO" resultType="DefaultMap">-->
  <!--    /*배달매출 조회*/-->
  <!--    /*DlvrMapper.getDlvrList*/-->
  <!--    <include refid="CmmSQL.PagingTemplateHeader"/>-->
  <!--    SELECT tssh.SALE_DATE, SUM(tssh.REAL_SALE_AMT) AS SUM_DLVR_REAL_SALE_AMT, count(tssh.BILL_NO) AS CNT_DLVR_BILL_NO-->
  <!--    <include refid="CmmSQL.PagingTemplateCount"/>-->
  <!--    FROM TB_SL_SALE_HDR_DLVR tsshd-->
  <!--    INNER JOIN TB_SL_SALE_HDR tssh ON tsshd.BILL_NO = tssh.BILL_NO AND tsshd.POS_NO = tssh.POS_NO AND tsshd.STORE_CD = tssh.STORE_CD AND tsshd.HQ_OFFICE_CD = tssh.HQ_OFFICE_CD AND tsshd.SALE_DATE = tssh.SALE_DATE AND tsshd.HQ_BRAND_CD = tssh.HQ_BRAND_CD-->
  <!--    WHERE tssh.SALE_DATE BETWEEN #{startDate} AND #{endDate}-->
  <!--    GROUP BY tssh.SALE_DATE-->
  <!--    <include refid="CmmSQL.PagingTemplateBottom"/>-->
  <!--  </select>-->

  <!--  <select id="getDayNonDlvrSaleList" parameterType="dayDlvrVO" resultType="DefaultMap">-->
  <!--    /*배달외매출 조회*/-->
  <!--    /*DlvrMapper.getDlvrList*/-->
  <!--    <include refid="CmmSQL.PagingTemplateHeader"/>-->
  <!--    SELECT tssh.SALE_DATE, SUM(tssh.REAL_SALE_AMT) AS SUM_REAL_SALE_AMT, count(tssh.BILL_NO) AS CNT_BILL_NO-->
  <!--    <include refid="CmmSQL.PagingTemplateCount"/>-->
  <!--    FROM TB_SL_SALE_HDR_DLVR tsshd-->
  <!--    FULL OUTER JOIN TB_SL_SALE_HDR tssh ON tsshd.BILL_NO = tssh.BILL_NO AND tsshd.POS_NO = tssh.POS_NO AND tsshd.STORE_CD = tssh.STORE_CD AND tsshd.HQ_OFFICE_CD = tssh.HQ_OFFICE_CD AND tsshd.SALE_DATE = tssh.SALE_DATE AND tsshd.HQ_BRAND_CD = tssh.HQ_BRAND_CD-->
  <!--    WHERE tssh.SALE_DATE BETWEEN #{startDate} AND #{endDate}-->
  <!--    AND tsshd.BILL_NO IS NULL OR tssh.BILL_NO IS NULL-->
  <!--    AND tsshd.POS_NO IS NULL OR tssh.POS_NO IS NULL-->
  <!--    AND tsshd.STORE_CD IS NULL OR tssh.STORE_CD IS NULL-->
  <!--    AND tsshd.HQ_OFFICE_CD IS NULL OR tssh.HQ_OFFICE_CD IS NULL-->
  <!--    AND tsshd.SALE_DATE IS NULL OR tssh.SALE_DATE IS NULL-->
  <!--    AND tsshd.HQ_BRAND_CD IS NULL OR tssh.HQ_BRAND_CD IS NULL-->
  <!--    GROUP BY tssh.SALE_DATE-->
  <!--    <include refid="CmmSQL.PagingTemplateBottom"/>-->
  <!--  </select>-->

  <select id="getDayDlvrSaleList" parameterType="dayDlvrVO" resultType="DefaultMap">
    /*배달매출 조회*/
    /*DlvrMapper.getDlvrList*/
    <include refid="CmmSQL.PagingTemplateHeader"/>
    SELECT
    A.SALE_DATE AS DLVR_SALE_DATE,
    B.SALE_DATE AS NON_DLVR_SALE_DATE,
    CASE WHEN A.SALE_DATE != B.SALE_DATE THEN
    0 ELSE A.SUM_DLVR_REAL_SALE_AMT
    END AS SUM_DLVR_REAL_SALE_AMT,
    CASE WHEN A.SALE_DATE != B.SALE_DATE THEN
    0 ELSE A.CNT_DLVR_BILL_NO
    END AS CNT_DLVR_BILL_NO,
    B.SUM_REAL_SALE_AMT,
    B.CNT_BILL_NO
    <include refid="CmmSQL.PagingTemplateCount"/>
    FROM
    (
    SELECT
    tssh.SALE_DATE,
    SUM( tssh.REAL_SALE_AMT ) AS SUM_DLVR_REAL_SALE_AMT,
    count( tssh.BILL_NO ) AS CNT_DLVR_BILL_NO
    FROM
    TB_SL_SALE_HDR_DLVR tsshd
    INNER JOIN TB_SL_SALE_HDR tssh ON tsshd.BILL_NO = tssh.BILL_NO
    AND tsshd.POS_NO = tssh.POS_NO
    AND tsshd.STORE_CD = tssh.STORE_CD
    AND tsshd.HQ_OFFICE_CD = tssh.HQ_OFFICE_CD
    AND tsshd.SALE_DATE = tssh.SALE_DATE
    AND tsshd.HQ_BRAND_CD = tssh.HQ_BRAND_CD
    WHERE
    tssh.SALE_DATE BETWEEN #{startDate}
    AND #{endDate}
    GROUP BY
    tssh.SALE_DATE
    ) A,
    (
    SELECT
    tssh.SALE_DATE,
    SUM( tssh.REAL_SALE_AMT ) AS SUM_REAL_SALE_AMT,
    count( tssh.BILL_NO ) AS CNT_BILL_NO
    FROM
    TB_SL_SALE_HDR_DLVR tsshd FULL OUTER
    JOIN TB_SL_SALE_HDR tssh ON tsshd.BILL_NO = tssh.BILL_NO
    AND tsshd.POS_NO = tssh.POS_NO
    AND tsshd.STORE_CD = tssh.STORE_CD
    AND tsshd.HQ_OFFICE_CD = tssh.HQ_OFFICE_CD
    AND tsshd.SALE_DATE = tssh.SALE_DATE
    AND tsshd.HQ_BRAND_CD = tssh.HQ_BRAND_CD
    WHERE
    tssh.SALE_DATE BETWEEN #{startDate}
    AND #{endDate}
    AND tsshd.BILL_NO IS NULL
    OR tssh.BILL_NO IS NULL
    AND tsshd.POS_NO IS NULL
    OR tssh.POS_NO IS NULL
    AND tsshd.STORE_CD IS NULL
    OR tssh.STORE_CD IS NULL
    AND tsshd.HQ_OFFICE_CD IS NULL
    OR tssh.HQ_OFFICE_CD IS NULL
    AND tsshd.SALE_DATE IS NULL
    OR tssh.SALE_DATE IS NULL
    AND tsshd.HQ_BRAND_CD IS NULL
    OR tssh.HQ_BRAND_CD IS NULL
    GROUP BY
    tssh.SALE_DATE
    ) B
    GROUP BY
    A.SALE_DATE,
    A.SUM_DLVR_REAL_SALE_AMT,
    A.CNT_DLVR_BILL_NO,
    B.SUM_REAL_SALE_AMT,
    B.CNT_BILL_NO,
    B.SALE_DATE
    <include refid="CmmSQL.PagingTemplateBottom"/>
  </select>

</mapper>