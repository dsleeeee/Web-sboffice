<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.application.persistance.login.LoginMapper">
  
  <select id="selectWebUser" parameterType="sessionInfo" resultType="sessionInfo" >
  <![CDATA[
  /* LoginMapper.selectWebUser */
    SELECT A.USER_ID,
    	   A.USER_PWD,
           ( SELECT EMP_NM 
               FROM TB_MS_EMPLOYEE 
              WHERE USER_ID = A.USER_ID
           ) AS USER_NAME,
    	   A.GRP_CD,
    	   A.LAST_LOGIN_DATE,
    	   A.LAST_PWD_CHG_DATE,
    	   A.LOGIN_FAIL_CNT,
    	   A.LOCK_CD
      FROM TB_WB_USER_INFO A
     WHERE A.USER_ID = #{userId}
       AND A.LOCK_CD = 'N'
  ]]>
  </select>
  
  <select id="selectLoginHist" resultType="DefaultMap" parameterType="loginHist">
  <![CDATA[
  /* LoginMapper.selectLoginHist */
    SELECT SEQ,
    	   USER_ID,
    	   STAT_CD,
    	   LOGIN_ORGN,
    	   LOGIN_IP,
    	   BRWSR_INFO,
           LOGIN_DATE,
    	   LOGIN_DT
      FROM TB_WB_LOGIN_HIST
     WHERE WEB_USER_ID = #{webUserId}
  ]]>
  </select>
  
  <insert id="insertLoginHist" parameterType="loginHist">
  <![CDATA[
  /* LoginMapper.insertLoginHist */
    INSERT INTO TB_WB_LOGIN_HIST
    (
      SEQ,
      USER_ID,
      STAT_CD,
      LOGIN_ORGN,
      LOGIN_IP,
      BRWSR_INFO,
      LOGIN_DATE,
      LOGIN_DT
    )
    VALUES
    (
      SQ_WB_LOGIN_HIST.NEXTVAL,
      #{userId},
      #{statCd.value},
      #{loginOrgn.value},
      #{loginIp},
      #{brwsrInfo},
      #{loginDate},
      #{loginDt}
    )
  ]]>
  </insert>
  
<!--    권한 있는 리소스 가져오기 -->
  <select id="selectAuthMenu" parameterType="sessionInfo" resultType="resrceInfo">
  <![CDATA[
  /* LoginMapper.selectAuthMenu */
    SELECT DISTINCT RESRCE_CD,
  		   P_RESRCE,
  		   RESRCE_FG,
           FUNC_FG,
  		   RESRCE_NM,
  		   URL,
  		   SPCL_AUTHOR,
  		   DISP_LEVEL,
           DISP_IDX,
  		   USE_YN,
  		   REG_DT,
  		   REG_ID,
  		   MOD_DT,
  		   MOD_ID
      FROM TB_WB_RESRCE_INFO
     START WITH RESRCE_CD IN (
            SELECT RESRCE_CD  		   
              FROM TB_WB_RESRCE_INFO
             WHERE RESRCE_CD IN (
              SELECT RESRCE_CD 
                FROM TB_WB_AUTHOR_GRP_RESRCE 
               WHERE GRP_CD = (
                SELECT GRP_CD 
                  FROM TB_WB_USER_INFO 
                 WHERE USER_ID = #{userId}
                ) AND USE_YN = 'Y'
             UNION ALL
            SELECT RESRCE_CD 
              FROM TB_WB_AUTHOR_EXCEPT
             WHERE USER_ID = #{userId}
               AND INCLD_EXCLD_FG = 'I'
               AND USE_YN = 'Y'
              )
      AND RESRCE_CD NOT IN (
            SELECT RESRCE_CD 
              FROM TB_WB_AUTHOR_EXCEPT
             WHERE USER_ID = #{userId}
               AND INCLD_EXCLD_FG = 'E'
               AND USE_YN = 'Y')
      AND RESRCE_FG = 'W002')
  CONNECT BY PRIOR P_RESRCE = RESRCE_CD
      AND LEVEL < 3
    ORDER BY RESRCE_CD ASC
  ]]>
  </select>
  
    

</mapper>



















