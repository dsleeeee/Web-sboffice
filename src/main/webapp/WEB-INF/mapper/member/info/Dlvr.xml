<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.membr.info.dlvr.service.impl.DlvrMapper">

  <!-- 배달지 조회 및 변경 -->
  <!--
      TABLE    : TB_MB_MEMBER_DLVR_ADDR & TB_MB_MEMBER_DLVR_TEL
      COMMENTS : 배달지 조회 및 변경@param map 조회한 결과의 컬럼이 key=value 타입의 {@code DefaultMap}. key 가 다국어 처리됨@param map 조회한 결과의 컬럼이 key=value 타입의 {@code DefaultMap}. key 가 다국어 처리됨@param map 조회한 결과의 컬럼이 key=value 타입의 {@code DefaultMap}. key 가 다국어 처리됨@param map 조회한 결과의 컬럼이 key=value 타입의 {@code DefaultMap}. key 가 다국어 처리됨@param map 조회한 결과의 컬럼이 key=value 타입의 {@code DefaultMap}. key 가 다국어 처리됨
  -->
  <select id="getDlvrList" parameterType="dlvrVO" resultType="DefaultMap">
    /*DlvrMapper.getDlvrList*/
    <include refid="CmmSQL.PagingTemplateHeader"/>
    /*달주소지 조회*/
    SELECT SBPENC.D(tmm.MEMBR_NM)AS MEMBR_NM, tmmda.ADDR, tmmda.ADDR_DTL, tmmda.USE_YN AS DLVR_USE_YN, tmmda.LAST_DLVR_DATE, tmm.MEMBR_NO
    <include refid="CmmSQL.PagingTemplateCount"/>
    FROM TB_MB_MEMBER_DLVR_ADDR tmmda
    LEFT JOIN TB_MB_MEMBER tmm ON tmm.MEMBR_NO = tmmda.MEMBR_NO
    <include refid="CmmSQL.PagingTemplateBottom"/>
  </select>

  <delete id="deleteDlvr" parameterType="dlvrVO">
      /*배달주소지 삭제*/
      DELETE FROM TB_MB_MEMBER_DLVR_ADDR tmmda
      WHERE MEMBR_NO = ''
  </delete>

  <update id="updateDlvr" parameterType="dlvrVO">
      /*배달지주소 저장*/
      UPDATE TB_MB_MEMBER_DLVR_ADDR
      SET ADDR = #{addr}, ADDR_DTL = #{addrDtl}, USE_YN = #{userYn}, LAST_DLVR_DATE = #{lastDlvrDate}
      WHERE MEMBR_NO = ''
  </update>

  <select id="getDlvrTelList" parameterType="dlvrVO" resultType="DefaultMap">
      /*배달전화번호 조회*/
      SELECT SBPENC.D(tmm.MEMBR_NM)AS MEMBR_NM, tmmdt.TEL_NO, tmmdt.USE_YN, tmmdt.REG_DT, tmmdt.MOD_DT, tmm.MEMBR_NO
      FROM TB_MB_MEMBER_DLVR_TEL tmmdt
      LEFT JOIN TB_MB_MEMBER tmm ON tmm.MEMBR_NO = tmmdt.MEMBR_NO
  </select>

  <delete id="deleteDlvrTel" parameterType="dlvrVO">
      /*배달전화 삭제*/
      DELETE FROM TB_MB_MEMBER_DLVR_TEL tmmdt
      WHERE MEMBR_NO = ''
  </delete>

  <update id="updateDlvrTel" parameterType="dlvrVO">
      /*배달전화 저장*/
      UPDATE TB_MB_MEMBER_DLVR_TEL
      SET TEL_NO = #{telNo}, USE_YN = #{userYn}
      WHERE MEMBR_NO = ''
  </update>

</mapper>