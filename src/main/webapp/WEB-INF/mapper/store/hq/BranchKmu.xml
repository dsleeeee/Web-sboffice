<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    BranchKmu.xml
    그룹관리
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       김설아     2025.10.27      최초작성
-->
<mapper namespace="kr.co.solbipos.store.hq.branchKmu.service.impl.BranchKmuMapper">

    <!-- 목록 조회 -->
    <!--
        TABLE    :
        PARAM    :
        COMMENTS :
    -->
    <select id="getBranchKmuList" parameterType="branchKmuVO" resultType="DefaultMap">
        /* USE : BranchKmuMapper.getBranchKmuList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT  BRANCH_CD
        ,       BRANCH_NM
        ,       BRANCH_OWNER_NM
        ,       TEL_NO
        ,       PHONE_NO
        ,       EMAIL
        ,       POST_NO
        ,       ADDR
        ,       ADDR_DTL
        ,       USE_YN
        ,       ORGPLCE_INFO
        ,       TO_CHAR(TO_DATE(REG_DT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') AS REG_DT
        ,       REG_ID
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM    TB_HQ_BRANCH_MOMS
        WHERE   HQ_OFFICE_CD = #{hqOfficeCd}
        <if test='branchCd != null and branchCd != ""'>
            AND BRANCH_CD LIKE '%'|| #{branchCd} || '%'
        </if>
        <if test='branchNm != null and branchNm != ""'>
            AND BRANCH_NM LIKE '%'|| #{branchNm} || '%'
        </if>
        <if test='branchOwnerNm != null and branchOwnerNm != ""'>
            AND BRANCH_OWNER_NM LIKE '%'|| #{branchOwnerNm} || '%'
        </if>
        <if test='phoneNo != null and phoneNo != ""'>
            AND PHONE_NO LIKE '%'|| #{phoneNo} || '%'
        </if>
        <if test='useYn != null and useYn != ""'>
            AND USE_YN = #{useYn}
        </if>
        ORDER BY BRANCH_CD
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <!-- 코드 채번 -->
    <!--
        TABLE    :
        PARAM    :
        COMMENTS :
    -->
    <select id="setBranchCd" parameterType="branchKmuVO" resultType="String">
        /* USE : saveBranchKmu.setBranchCd */
        SELECT LPAD(NVL(MAX(BRANCH_CD), '0') + 1, 3, '0')
        FROM TB_HQ_BRANCH_MOMS
        WHERE HQ_OFFICE_CD = #{hqOfficeCd}
    </select>

    <!-- 등록  -->
    <!--
        TABLE    :
        PARAM    :
        COMMENTS :
    -->
    <insert id="saveBranchKmu" parameterType="DefaultMap">
        /* USE : BranchKmuMapper.saveBranchKmu */
        MERGE INTO TB_HQ_BRANCH_MOMS thbm
        USING DUAL
        ON (
            HQ_OFFICE_CD = #{hqOfficeCd}
            AND BRANCH_CD = #{branchCd}
        )
        WHEN MATCHED THEN
            UPDATE
            SET
                BRANCH_NM       = #{branchNm}
            ,   BRANCH_OWNER_NM = #{branchOwnerNm}
            ,   TEL_NO          = #{telNo}
            ,   PHONE_NO        = #{phoneNo}
            ,   EMAIL           = #{email}
            ,   POST_NO         = #{postNo}
            ,   ADDR            = #{addr}
            ,   ADDR_DTL        = #{addrDtl}
            ,   USE_YN          = #{useYn}
            ,   ORGPLCE_INFO    = #{orgplceInfo}
        WHEN NOT MATCHED THEN
            INSERT
            (
                HQ_OFFICE_CD
            ,   BRANCH_CD
            ,   BRANCH_NM
            ,   BRANCH_OWNER_NM
            ,   TEL_NO
            ,   PHONE_NO
            ,   EMAIL
            ,   POST_NO
            ,   ADDR
            ,   ADDR_DTL
            ,   USE_YN
            ,   ORGPLCE_INFO
            ,   REG_DT
            ,   REG_ID
            ,   MOD_DT
            ,   MOD_ID
            )
            VALUES
            (
                #{hqOfficeCd}
            ,   #{branchCd}
            ,   #{branchNm}
            ,   #{branchOwnerNm}
            ,   #{telNo}
            ,   #{phoneNo}
            ,   #{email}
            ,   #{postNo}
            ,   #{addr}
            ,   #{addrDtl}
            ,   #{useYn}
            ,   #{orgplceInfo}
            ,   #{regDt}
            ,   #{regId}
            ,   #{modDt}
            ,   #{modId}
            )
    </insert>

</mapper>
