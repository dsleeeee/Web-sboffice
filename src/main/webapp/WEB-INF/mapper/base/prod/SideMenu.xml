<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SideMenu.xml
    사이드메뉴 sql
    ======================================================
    No  ||  수정자 ||  수정일자    ||  수정내역
    ======================================================
    1       노현수     2018.11.14     최초작성
-->
<mapper namespace="kr.co.solbipos.base.prod.sidemenu.service.impl.SideMenuMapper">

    <!-- 속성분류 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR_CLASS, TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 사이드메뉴 속성의 분류목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getAttrClassList" parameterType="sideMenuAttrClassVO" resultType="DefaultMap">
        /* USE : SideMenuMapper.getAttrClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thpsc.HQ_BRAND_CD,
                    thpsc.SDATTR_CLASS_CD,
                    thpsc.SDATTR_CLASS_NM,
                    (SELECT COUNT(*) FROM TB_HQ_PRODUCT_SDATTR WHERE HQ_OFFICE_CD = thpsc.HQ_OFFICE_CD AND SDATTR_CLASS_CD = thpsc.SDATTR_CLASS_CD AND USE_YN = 'Y' ) AS CNT
                FROM
                    TB_HQ_PRODUCT_SDATTR_CLASS thpsc
                WHERE
                    thpsc.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thpsc.USE_YN = 'Y'
                ORDER BY
                    thpsc.SDATTR_CLASS_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmpsc.MS_BRAND_CD,
                    tmpsc.SDATTR_CLASS_CD,
                    tmpsc.SDATTR_CLASS_NM,
                    (SELECT COUNT(*) FROM TB_MS_PRODUCT_SDATTR WHERE STORE_CD = tmpsc.STORE_CD AND SDATTR_CLASS_CD = tmpsc.SDATTR_CLASS_CD AND USE_YN = 'Y') AS CNT
                FROM
                    TB_MS_PRODUCT_SDATTR_CLASS tmpsc
                WHERE
                    tmpsc.STORE_CD = #{storeCd}
                    AND tmpsc.USE_YN = 'Y'
                ORDER BY
                    tmpsc.SDATTR_CLASS_CD
            </when>
        </choose>
    </select>

    <!-- 속성분류 생성시 분류코드 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR_CLASS, TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 속성분류 생성시 분류코드 생성한다. ( 본사/매장 )
    -->
    <select id="getAttrClassCode" parameterType="sideMenuAttrClassVO" resultType="String">
        <choose>
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT LPAD(NVL(MAX(SDATTR_CLASS_CD), '0') + 1, 5, '0')
                FROM TB_HQ_PRODUCT_SDATTR_CLASS
                WHERE HQ_OFFICE_CD = #{hqOfficeCd}
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT LPAD(NVL(MAX(SDATTR_CLASS_CD), '79999') + 1, 5, '0')
                FROM TB_MS_PRODUCT_SDATTR_CLASS
                WHERE STORE_CD = #{storeCd}
                  AND SDATTR_CLASS_CD > 79999
            </when>
        </choose>
    </select>

    <!-- 속성분류 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR_CLASS, TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 속성분류를 생성한다.
    -->
    <insert id="insertAttrClassList" parameterType="sideMenuAttrClassVO">
        /* USE : SideMenuMapper.insertAttrClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_PRODUCT_SDATTR_CLASS
                (
                    HQ_OFFICE_CD,
                    HQ_BRAND_CD,
                    SDATTR_CLASS_CD,
                    SDATTR_CLASS_NM,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{hqBrandCd, jdbcType=VARCHAR},
                    #{sdattrClassCd},
                    #{sdattrClassNm},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_PRODUCT_SDATTR_CLASS
                (
                    STORE_CD,
                    MS_BRAND_CD,
                    SDATTR_CLASS_CD,
                    SDATTR_CLASS_NM,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{msBrandCd, jdbcType=VARCHAR},
                    #{sdattrClassCd},
                    #{sdattrClassNm},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
        </choose>
    </insert>

    <!-- 속성분류 수정 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR_CLASS, TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 속성분류를 수정한다.
    -->
    <update id="updateAttrClassList" parameterType="sideMenuAttrClassVO">
        /* USE : SideMenuMapper.updateAttrClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDATTR_CLASS
                SET
                    HQ_BRAND_CD = #{hqBrandCd, jdbcType=VARCHAR},
                    SDATTR_CLASS_NM = #{sdattrClassNm},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDATTR_CLASS_CD = #{sdattrClassCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDATTR_CLASS
                SET
                    MS_BRAND_CD = #{msBrandCd, jdbcType=VARCHAR},
                    SDATTR_CLASS_NM = #{sdattrClassNm},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDATTR_CLASS_CD = #{sdattrClassCd}
            </when>
        </choose>
    </update>

    <!-- 속성분류 삭제 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR_CLASS, TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 속성분류를 삭제한다.
    -->
    <update id="deleteAttrClassList" parameterType="sideMenuAttrClassVO">
        /* USE : SideMenuMapper.deleteAttrClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDATTR_CLASS
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDATTR_CLASS_CD = #{sdattrClassCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDATTR_CLASS
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDATTR_CLASS_CD = #{sdattrClassCd}
            </when>
        </choose>
    </update>

    <!--  사이드메뉴-속성탭-속성분류 생성시 매장적용  -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 본사 사이드메뉴 속성의 속성분류를 매장에 생성한다.
    -->
    <select id="insertHqAttrClassListToStore" statementType="CALLABLE"  parameterType="sideMenuAttrClassVO" resultType="String">
        /* USE : SideMenuMapper.insertHqAttrClassListToStore   */
        {
            CALL PKG_HQ_PRODUCT_SDATTR_CLASS.SP_HQ_PRODUCT_SDATTR_CLASS_I
          (
            #{hqOfficeCd},
            #{sdattrClassCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!--  사이드메뉴-속성탭-속성분류 수정시 매장적용  -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 본사 사이드메뉴  속성의 속성분류를 매장에 적용시킨다.
    -->
    <select id="updateHqAttrClassListToStore" statementType="CALLABLE"  parameterType="sideMenuAttrClassVO" resultType="String">
        /* USE : SideMenuMapper.updateHqAttrClassListToStore   */
        {
            CALL PKG_HQ_PRODUCT_SDATTR_CLASS.SP_HQ_PRODUCT_SDATTR_CLASS_U
          (
            #{hqOfficeCd},
            #{sdattrClassCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!--  사이드메뉴-속성탭-속성분류 삭제시 매장적용  -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDATTR_CLASS
        PARAM    : sideMenuAttrClassVO
        COMMENTS : 본사 사이드메뉴  속성의 속성분류를 매장에서 제외시킨다.
    -->
    <select id="deleteHqAttrClassListToStore" statementType="CALLABLE"  parameterType="sideMenuAttrClassVO" resultType="String">
        /* USE : SideMenuMapper.deleteHqAttrClassListToStore   */
        {
             CALL PKG_HQ_PRODUCT_SDATTR_CLASS.SP_HQ_PRODUCT_SDATTR_CLASS_D
          (
            #{hqOfficeCd},
            #{sdattrClassCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 속성 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR, TB_MS_PRODUCT_SDATTR
        PARAM    : sideMenuAttrCdVO
        COMMENTS : 사이드메뉴 속성목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getAttrCdList" parameterType="sideMenuAttrCdVO" resultType="DefaultMap">
        /* USE : SideMenuMapper.getAttrCdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thps.SDATTR_CD,
                    thps.SDATTR_NM,
                    thps.SDATTR_CLASS_CD,
                    thps.DISP_SEQ
                FROM
                    TB_HQ_PRODUCT_SDATTR thps
                WHERE
                    thps.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thps.SDATTR_CLASS_CD = #{sdattrClassCd}
                    AND thps.USE_YN = 'Y'
                ORDER BY
                    thps.DISP_SEQ
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmps.SDATTR_CD,
                    tmps.SDATTR_NM,
                    tmps.SDATTR_CLASS_CD,
                    tmps.DISP_SEQ
                FROM
                    TB_MS_PRODUCT_SDATTR tmps
                WHERE
                    tmps.STORE_CD = #{storeCd}
                    AND tmps.SDATTR_CLASS_CD = #{sdattrClassCd}
                    AND tmps.USE_YN = 'Y'
                ORDER BY
                    tmps.DISP_SEQ
            </when>
        </choose>
    </select>

    <!-- 속성생성 시 속성코드 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR, TB_MS_PRODUCT_SDATTR
        PARAM    : sideMenuAttrCdVO
        COMMENTS : 속성생성 시 속성코드를 생성한다. ( 본사/매장 )
    -->
    <select id="getAttrCode" parameterType="sideMenuAttrCdVO" resultType="String">
        <choose>
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT LPAD(NVL(MAX(SDATTR_CD), '0') + 1, 10, '0')
                FROM TB_HQ_PRODUCT_SDATTR
                WHERE HQ_OFFICE_CD = #{hqOfficeCd}
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT LPAD(NVL(MAX(SDATTR_CD), '7999999999') + 1, 10, '0')
                FROM TB_MS_PRODUCT_SDATTR
                WHERE STORE_CD = #{storeCd}
                  AND SDATTR_CD > 7999999999
            </when>
        </choose>
    </select>

    <!-- 속성 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR, TB_MS_PRODUCT_SDATTR
        PARAM    : sideMenuAttrCdVO
        COMMENTS : 속성을 생성한다.
    -->
    <insert id="insertAttrCdList" parameterType="sideMenuAttrCdVO">
        /* USE : SideMenuMapper.insertAttrCdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_PRODUCT_SDATTR
                (
                    HQ_OFFICE_CD,
                    SDATTR_CD,
                    SDATTR_NM,
                    SDATTR_CLASS_CD,
                    DISP_SEQ,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{sdattrCd} ,
                    #{sdattrNm},
                    #{sdattrClassCd},
                    #{dispSeq},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_PRODUCT_SDATTR
                (
                    STORE_CD,
                    SDATTR_CD,
                    SDATTR_NM,
                    SDATTR_CLASS_CD,
                    DISP_SEQ,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{sdattrCd} ,
                    #{sdattrNm},
                    #{sdattrClassCd},
                    #{dispSeq},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
        </choose>
    </insert>

    <!-- 속성 수정 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR, TB_MS_PRODUCT_SDATTR
        PARAM    : sideMenuAttrCdVO
        COMMENTS : 속성을 수정한다.
    -->
    <update id="updateAttrCdList" parameterType="sideMenuAttrCdVO">
        /* USE : SideMenuMapper.updateAttrCdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDATTR
                SET
                    SDATTR_NM = #{sdattrNm},
                    DISP_SEQ = #{dispSeq},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDATTR_CD = #{sdattrCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDATTR
                SET
                    SDATTR_NM = #{sdattrNm},
                    DISP_SEQ = #{dispSeq},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDATTR_CD = #{sdattrCd}
            </when>
        </choose>
    </update>

    <!-- 속성분류 삭제 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDATTR, TB_MS_PRODUCT_SDATTR
        PARAM    : sideMenuAttrCdVO
        COMMENTS : 속성분류를 삭제한다.
    -->
    <update id="deleteAttrCdList" parameterType="sideMenuAttrCdVO">
        /* USE : SideMenuMapper.deleteAttrCdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDATTR
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDATTR_CD = #{sdattrCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDATTR
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDATTR_CD = #{sdattrCd}
            </when>
        </choose>
    </update>

    <!--  사이드메뉴-속성탭-속성 생성시 매장적용  -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDATTR
        PARAM    : SideMenuAttrCdVO
        COMMENTS : 본사 사이드메뉴 속성분류의 속성을 매장에 생성한다.
    -->
    <select id="insertHqAttrCdListToStore" statementType="CALLABLE"  parameterType="SideMenuAttrCdVO" resultType="String">
        /* USE : SideMenuMapper.insertHqAttrCdListToStore   */
        {
            CALL PKG_HQ_PRODUCT_SDATTR.SP_HQ_PRODUCT_SDATTR_I
          (
            #{hqOfficeCd},
            #{sdattrCd},
            #{sdattrClassCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!--  사이드메뉴-속성탭-속성 수정시 매장적용  -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDATTR
        PARAM    : SideMenuAttrCdVO
        COMMENTS : 본사 사이드메뉴 속성분류의 속성을 매장에 적용시킨다.
    -->
    <select id="updateHqAttrCdListToStore" statementType="CALLABLE"  parameterType="SideMenuAttrCdVO" resultType="String">
        /* USE : SideMenuMapper.updateHqAttrCdListToStore   */
        {
            CALL PKG_HQ_PRODUCT_SDATTR.SP_HQ_PRODUCT_SDATTR_U
          (
            #{hqOfficeCd},
            #{sdattrCd},
            #{sdattrClassCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!--  사이드메뉴-속성탭-속성 삭제시 매장적용  -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDATTR
        PARAM    : SideMenuAttrCdVO
        COMMENTS : 본사 사이드메뉴 속성분류의 속성을 매장에서 제외시킨다.
    -->
    <select id="deleteHqAttrCdListToStore" statementType="CALLABLE"  parameterType="SideMenuAttrCdVO" resultType="String">
        /* USE : SideMenuMapper.deleteHqAttrCdListToStore   */
        {
            CALL PKG_HQ_PRODUCT_SDATTR.SP_HQ_PRODUCT_SDATTR_D
          (
            #{hqOfficeCd},
            #{sdattrCd},
            #{sdattrClassCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 선택그룹 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_GROUP, TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 사이드메뉴 선택그룹 목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getMenuGrpList" parameterType="sideMenuSelGroupVO" resultType="DefaultMap">
        /* USE : SideMenuMapper.getMenuGrpList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thpsg.HQ_BRAND_CD,
                    thpsg.SDSEL_GRP_CD,
                    thpsg.SDSEL_GRP_NM,
                    thpsg.PROD_CD,
                    (SELECT COUNT(*) FROM TB_HQ_PRODUCT_SDSEL_CLASS WHERE HQ_OFFICE_CD = thpsg.HQ_OFFICE_CD  AND SDSEL_GRP_CD = thpsg.SDSEL_GRP_CD AND USE_YN  = 'Y') AS CNT
                FROM
                    TB_HQ_PRODUCT_SDSEL_GROUP thpsg
                WHERE
                    thpsg.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thpsg.USE_YN = 'Y'
                ORDER BY
                    thpsg.SDSEL_GRP_CD
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmpsg.MS_BRAND_CD,
                    tmpsg.SDSEL_GRP_CD,
                    tmpsg.SDSEL_GRP_NM,
                    (SELECT COUNT(*) FROM TB_MS_PRODUCT_SDSEL_CLASS WHERE STORE_CD = tmpsg.STORE_CD  AND SDSEL_GRP_CD = tmpsg.SDSEL_GRP_CD AND USE_YN  = 'Y') AS CNT
                FROM
                    TB_MS_PRODUCT_SDSEL_GROUP tmpsg
                WHERE
                    tmpsg.STORE_CD = #{storeCd}
                    AND tmpsg.USE_YN = 'Y'
                ORDER BY
                    tmpsg.SDSEL_GRP_CD
            </when>
        </choose>
    </select>

    <!-- 선택그룹 생성 시 그룹코드 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_GROUP, TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 선택그룹 생성 시 그룹코드를 생성한다. ( 본사/매장 )
    -->
    <select id="getMenuGrpCode" parameterType="sideMenuSelGroupVO" resultType="String">
        <choose>
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT LPAD(NVL(MAX(SDSEL_GRP_CD), '0') + 1, 6, '0')
                FROM TB_HQ_PRODUCT_SDSEL_GROUP
                WHERE HQ_OFFICE_CD = #{hqOfficeCd}
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT LPAD(NVL(MAX(SDSEL_GRP_CD), '799999') + 1, 6, '0')
                FROM TB_MS_PRODUCT_SDSEL_GROUP
                WHERE STORE_CD = #{storeCd}
                  AND SDSEL_GRP_CD > 799999
            </when>
        </choose>
    </select>

    <!-- 선택그룹 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_GROUP, TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 선택그룹을 생성한다.
    -->
    <insert id="insertMenuGrpList" parameterType="sideMenuSelGroupVO">
        /* USE : SideMenuMapper.insertMenuGrpList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_PRODUCT_SDSEL_GROUP
                (
                    HQ_OFFICE_CD,
                    HQ_BRAND_CD,
                    SDSEL_GRP_CD,
                    SDSEL_GRP_NM,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{hqBrandCd},
                    #{sdselGrpCd},
                    #{sdselGrpNm},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_PRODUCT_SDSEL_GROUP
                (
                    STORE_CD,
                    MS_BRAND_CD,
                    SDSEL_GRP_CD,
                    SDSEL_GRP_NM,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{msBrandCd},
                    #{sdselGrpCd},
                    #{sdselGrpNm},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
        </choose>
    </insert>

    <!-- 선택그룹 수정 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_GROUP, TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 선택그룹을 수정한다.
    -->
    <update id="updateMenuGrpList" parameterType="sideMenuSelGroupVO">
        /* USE : SideMenuMapper.updateMenuGrpList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDSEL_GROUP
                SET
                    SDSEL_GRP_NM = #{sdselGrpNm},
                    HQ_BRAND_CD = #{hqBrandCd},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDSEL_GROUP
                SET
                    SDSEL_GRP_NM = #{sdselGrpNm},
                    MS_BRAND_CD = #{msBrandCd},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
        </choose>
    </update>

    <!-- 선택그룹 삭제 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_GROUP, TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 선택그룹을 삭제한다.
    -->
    <update id="deleteMenuGrpList" parameterType="sideMenuSelGroupVO">
        /* USE : SideMenuMapper.deleteMenuGrpList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDSEL_GROUP
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDSEL_GROUP
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
        </choose>
    </update>

    <!-- 사이드메뉴-선택메뉴탭-선택그룹 생성시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 본사 사이드메뉴 선택그룹을 매장에 적용시킨다.
    -->
    <select id="insertHqMenuGrpListToStore" statementType="CALLABLE"  parameterType="sideMenuSelGroupVO" resultType="String">
        /* USE : SideMenuMapper.insertHqMenuGrpListToStore */
        {
          CALL PKG_HQ_PRODUCT_SDSEL_GROUP.SP_HQ_PRODUCT_SDSEL_GROUP_I
          (
            #{hqOfficeCd},
            #{sdselGrpCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 사이드메뉴-선택메뉴탭-선택그룹 수정시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 본사 사이드메뉴 선택그룹을 매장에 적용시킨다.
    -->
    <select id="updateHqMenuGrpListToStore" statementType="CALLABLE"  parameterType="sideMenuSelGroupVO" resultType="String">
        /* USE : SideMenuMapper.updateHqMenuGrpListToStore */
        {
          CALL PKG_HQ_PRODUCT_SDSEL_GROUP.SP_HQ_PRODUCT_SDSEL_GROUP_U
          (
            #{hqOfficeCd},
            #{sdselGrpCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 사이드메뉴-선택메뉴탭-선택그룹 삭제시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_GROUP
        PARAM    : sideMenuSelGroupVO
        COMMENTS : 본사 사이드메뉴 선택상품을 매장에서 제외시킨다.
    -->
    <select id="deleteHqMenuGrpListToStore" statementType="CALLABLE"  parameterType="sideMenuSelGroupVO" resultType="String">
        /* USE : SideMenuMapper.deleteHqMenuGrpListToStore */
        {
          CALL PKG_HQ_PRODUCT_SDSEL_GROUP.SP_HQ_PRODUCT_SDSEL_GROUP_D
          (
            #{hqOfficeCd},
            #{sdselGrpCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 선택분류 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_CLASS, TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 사이드메뉴 선택분류 목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getMenuClassList" parameterType="sideMenuSelClassVO" resultType="DefaultMap">
        /* USE : SideMenuMapper.getMenuClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thpsc.SDSEL_CLASS_CD,
                    thpsc.SDSEL_CLASS_NM,
                    thpsc.SDSEL_GRP_CD,
                    thpsc.DISP_SEQ,
                    thpsc.SDSEL_QTY,
                    (SELECT COUNT(*) FROM TB_HQ_PRODUCT_SDSEL_PROD WHERE HQ_OFFICE_CD = thpsc.HQ_OFFICE_CD AND SDSEL_CLASS_CD = thpsc.SDSEL_CLASS_CD AND USE_YN = 'Y') AS CNT,
                    (SELECT SUM(ADD_PROD_QTY) FROM TB_HQ_PRODUCT_SDSEL_PROD WHERE HQ_OFFICE_CD = thpsc.HQ_OFFICE_CD AND SDSEL_CLASS_CD = thpsc.SDSEL_CLASS_CD AND USE_YN = 'Y' AND FIX_PROD_FG = '1') AS FIX_PROD_CNT
                FROM
                    TB_HQ_PRODUCT_SDSEL_CLASS thpsc
                WHERE
                    thpsc.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thpsc.SDSEL_GRP_CD = #{sdselGrpCd}
                    AND thpsc.USE_YN = 'Y'
                ORDER BY
                    thpsc.DISP_SEQ
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmpsc.SDSEL_CLASS_CD,
                    tmpsc.SDSEL_CLASS_NM,
                    tmpsc.SDSEL_GRP_CD,
                    tmpsc.DISP_SEQ,
                    tmpsc.SDSEL_QTY,
                    (SELECT COUNT(*) FROM TB_MS_PRODUCT_SDSEL_PROD WHERE STORE_CD = tmpsc.STORE_CD AND SDSEL_CLASS_CD = tmpsc.SDSEL_CLASS_CD AND USE_YN = 'Y') AS CNT,
                    (SELECT SUM(ADD_PROD_QTY) FROM TB_MS_PRODUCT_SDSEL_PROD WHERE STORE_CD = tmpsc.STORE_CD AND SDSEL_CLASS_CD = tmpsc.SDSEL_CLASS_CD AND USE_YN = 'Y' AND FIX_PROD_FG = '1') AS FIX_PROD_CNT
                FROM
                    TB_MS_PRODUCT_SDSEL_CLASS tmpsc
                WHERE
                    tmpsc.STORE_CD = #{storeCd}
                    AND tmpsc.SDSEL_GRP_CD = #{sdselGrpCd}
                    AND tmpsc.USE_YN = 'Y'
                ORDER BY
                    tmpsc.DISP_SEQ
            </when>
        </choose>
    </select>

    <!-- 선택분류 생성 시 분류코드 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_CLASS, TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 선택분류 생성 시 분류코드를 생성한다. ( 본사/매장 )
    -->
    <select id="getMenuClassCode" parameterType="sideMenuSelClassVO" resultType="String">
        <choose>
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT LPAD(NVL(MAX(SDSEL_CLASS_CD), '0') + 1, 6, '0')
                FROM TB_HQ_PRODUCT_SDSEL_CLASS
                WHERE HQ_OFFICE_CD = #{hqOfficeCd}
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT LPAD(NVL(MAX(SDSEL_CLASS_CD), '799999') + 1, 6, '0')
                FROM TB_MS_PRODUCT_SDSEL_CLASS
                WHERE STORE_CD = #{storeCd}
                  AND SDSEL_CLASS_CD > 799999
            </when>
        </choose>
    </select>

    <!-- 선택분류 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_CLASS, TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 선택분류를 생성한다.
    -->
    <insert id="insertMenuClassList" parameterType="sideMenuSelClassVO">
        /* USE : SideMenuMapper.insertMenuClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                INSERT INTO TB_HQ_PRODUCT_SDSEL_CLASS
                (
                    HQ_OFFICE_CD,
                    SDSEL_CLASS_CD,
                    SDSEL_CLASS_NM,
                    SDSEL_GRP_CD,
                    DISP_SEQ,
                    SDSEL_QTY,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{hqOfficeCd},
                    #{sdselClassCd},
                    #{sdselClassNm},
                    #{sdselGrpCd},
                    #{dispSeq},
                    #{sdselQty},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                INSERT INTO TB_MS_PRODUCT_SDSEL_CLASS
                (
                    STORE_CD,
                    SDSEL_CLASS_CD,
                    SDSEL_CLASS_NM,
                    SDSEL_GRP_CD,
                    DISP_SEQ,
                    SDSEL_QTY,
                    USE_YN,
                    REG_DT,
                    REG_ID,
                    MOD_DT,
                    MOD_ID
                ) VALUES (
                    #{storeCd},
                    #{sdselClassCd},
                    #{sdselClassNm},
                    #{sdselGrpCd},
                    #{dispSeq},
                    #{sdselQty},
                    'Y',
                    #{regDt},
                    #{regId},
                    #{modDt},
                    #{modId}
                )
            </when>
        </choose>
    </insert>

    <!-- 선택분류 수정 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_CLASS, TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 선택분류를 수정한다.
    -->
    <update id="updateMenuClassList" parameterType="sideMenuSelClassVO">
        /* USE : SideMenuMapper.updateMenuClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDSEL_CLASS
                SET
                    SDSEL_CLASS_NM = #{sdselClassNm},
                    DISP_SEQ = #{dispSeq},
                    SDSEL_QTY = #{sdselQty},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDSEL_CLASS
                SET
                    SDSEL_CLASS_NM = #{sdselClassNm},
                    DISP_SEQ = #{dispSeq},
                    SDSEL_QTY = #{sdselQty},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
        </choose>
    </update>

    <!-- 선택분류 삭제 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_CLASS, TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 선택분류를 삭제한다.
    -->
    <update id="deleteMenuClassList" parameterType="sideMenuSelClassVO">
        /* USE : SideMenuMapper.deleteMenuClassList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDSEL_CLASS
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDSEL_CLASS
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND SDSEL_GRP_CD = #{sdselGrpCd}
            </when>
        </choose>
    </update>

    <!-- 사이드메뉴-선택메뉴탭-선택분류 생성시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 본사 사이드메뉴 속성분류를 매장에 생성한다.
    -->
    <select id="insertHqMenuClassListToStore" statementType="CALLABLE"  parameterType="sideMenuSelClassVO" resultType="String">
        /* USE : SideMenuMapper.insertHqMenuClassListToStore   */
        {
            CALL PKG_HQ_PRODUCT_SDSEL_CLASS.SP_HQ_PRODUCT_SDSEL_CLASS_I
          (
            #{hqOfficeCd},
            #{sdselClassCd},
            #{sdselGrpCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 사이드메뉴-선택메뉴탭-선택분류 수정시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 본사 사이드메뉴 속성분류를 매장에 적용시킨다.
    -->
    <select id="saveHqMenuClassListToStore" statementType="CALLABLE"  parameterType="sideMenuSelClassVO" resultType="String">
        /* USE : SideMenuMapper.saveHqMenuClassListToStore   */
        {
            CALL PKG_HQ_PRODUCT_SDSEL_CLASS.SP_HQ_PRODUCT_SDSEL_CLASS_U
          (
            #{hqOfficeCd},
            #{sdselClassCd},
            #{sdselGrpCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 사이드메뉴-선택메뉴탭-선택분류 삭제시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 본사 사이드메뉴 속성분류를 매장에서 제외시킨다.
    -->
    <select id="deleteHqMenuClassListToStore" statementType="CALLABLE"  parameterType="sideMenuSelClassVO" resultType="String">
        /* USE : SideMenuMapper.deleteHqMenuClassListToStore */
        {
          CALL PKG_HQ_PRODUCT_SDSEL_CLASS.SP_HQ_PRODUCT_SDSEL_CLASS_D
          (
            #{hqOfficeCd},
            #{sdselClassCd},
            #{sdselGrpCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 선택할 상품 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_PROD, TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 사이드메뉴 선택상품 목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getProdList" parameterType="sideMenuSelProdVO" resultType="DefaultMap">
        /* USE : SideMenuMapper.getProdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                <include refid="CmmSQL.PagingTemplateHeader"/>
                SELECT
                    thp.HQ_OFFICE_CD,
                    thp.PROD_CD,
                    thp.PROD_NM,
                    thp.PROD_CLASS_CD,
                    ( SELECT SF_GET_PROD_CLASSES('H', thp.HQ_OFFICE_CD, thp.PROD_CLASS_CD) FROM DUAL ) AS PROD_CLASS_NM,
                    thp.ORGPLCE_CD, -- TODO 원산지명 조회 필요
                    thp.PO_UNIT_FG
                    <include refid="CmmSQL.PagingTemplateCount"/>
                FROM
                    TB_HQ_PRODUCT thp
                WHERE
                    thp.HQ_OFFICE_CD = #{hqOfficeCd}
                    <if test="prodCd != null and prodCd != ''">
                    AND thp.PROD_CD = #{prodCd} --상품코드
                    </if>
                    <if test="prodNm != null and prodNm != ''">
                    AND thp.PROD_NM LIKE '%'||#{prodNm}||'%' --상품명
                    </if>
                    AND thp.USE_YN = 'Y'
                    AND thp.SIDE_PROD_YN = 'N'
                    AND thp.PROD_CD NOT IN (
                                            SELECT prod_cd
                                              FROM TB_HQ_PRODUCT_SDSEL_PROD thpsp
                                             WHERE thpsp.HQ_OFFICE_CD = #{hqOfficeCd}
                                               AND thpsp.SDSEL_CLASS_CD = #{sdselClassCd}
                                               AND thpsp.USE_YN = 'Y'
                                            )
                ORDER BY
                    thp.PROD_CD
                <include refid="CmmSQL.PagingTemplateBottom"/>
            </when>
            <!-- 가맹점 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                <include refid="CmmSQL.PagingTemplateHeader"/>
                SELECT
                    tmp.STORE_CD,
                    tmp.PROD_CD,
                    tmp.PROD_NM,
                    tmp.PROD_CLASS_CD,
                    ( SELECT SF_GET_PROD_CLASSES('S', tmp.STORE_CD, tmp.PROD_CLASS_CD) FROM DUAL ) AS PROD_CLASS_NM,
                    tmp.ORGPLCE_CD, -- TODO 원산지명 조회 필요
                    tmp.PO_UNIT_FG,
                    tmp.REG_DT
                    <include refid="CmmSQL.PagingTemplateCount"/>
                FROM
                    TB_MS_PRODUCT tmp
                WHERE
                    tmp.STORE_CD = #{storeCd}
                    <if test="prodCd != null and prodCd != ''">
                    AND tmp.PROD_CD = #{prodCd} --상품코드
                    </if>
                    <if test="prodNm != null and prodNm != ''">
                    AND tmp.PROD_NM LIKE '%'||#{prodNm}||'%' --상품명
                    </if>
                    <if test="sideEnvstVal != null and sideEnvstVal != ''">
                        AND tmp.REG_FG = 'H' --사이드메뉴생성구분이 세트상품만생성(BBQ)이면 본사에서 등록한 상품만 조회
                    </if>
                    AND tmp.USE_YN = 'Y'
                    AND tmp.SIDE_PROD_YN = 'N'
                    AND tmp.PROD_CD NOT IN (
                                            SELECT prod_cd
                                            FROM TB_MS_PRODUCT_SDSEL_PROD tmpsp
                                            WHERE tmpsp.STORE_CD = #{storeCd}
                                            AND tmpsp.SDSEL_CLASS_CD = #{sdselClassCd}
                                            AND tmpsp.USE_YN = 'Y'
                                            )
                ORDER BY
                    tmp.PROD_CD
                <include refid="CmmSQL.PagingTemplateBottom"/>
            </when>
        </choose>
    </select>

    <!-- 선택상품 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_PROD, TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 사이드메뉴 선택상품 목록을 조회한다. ( 본사/매장 )
    -->
    <select id="getMenuProdList" parameterType="sideMenuSelProdVO" resultType="DefaultMap">
        /* USE : SideMenuMapper.getMenuProdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT
                    thpsc.SDSEL_GRP_CD,
                    thpsp.SDSEL_CLASS_CD,
                    thpsp.PROD_CD,
                    thp.PROD_NM,
                    thpsp.ADD_PROD_UPRC,
                    thpsp.ADD_PROD_QTY,
                    thpsp.DISP_SEQ,
                    NVL(thpsp.FIX_PROD_FG, '0') AS FIX_PROD_FG
                FROM
                    TB_HQ_PRODUCT_SDSEL_PROD thpsp
                LEFT OUTER JOIN TB_HQ_PRODUCT thp ON
                    thpsp.HQ_OFFICE_CD = thp.HQ_OFFICE_CD
                    AND thpsp.PROD_CD = thp.PROD_CD
                INNER JOIN TB_HQ_PRODUCT_SDSEL_CLASS thpsc ON
                    thpsc.HQ_OFFICE_CD = thpsp.HQ_OFFICE_CD
                    AND thpsc.SDSEL_CLASS_CD = thpsp.SDSEL_CLASS_CD
              WHERE
                    thpsp.HQ_OFFICE_CD = #{hqOfficeCd}
                    AND thpsp.SDSEL_CLASS_CD = #{sdselClassCd}
                    AND thpsp.USE_YN = 'Y'
                ORDER BY
                    thpsp.DISP_SEQ
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT
                    tmpsc.SDSEL_GRP_CD,
                    tmpsp.SDSEL_CLASS_CD,
                    tmpsp.PROD_CD,
                    tmp.PROD_NM,
                    tmpsp.ADD_PROD_UPRC,
                    tmpsp.ADD_PROD_QTY,
                    tmpsp.DISP_SEQ,
                    NVL(tmpsp.FIX_PROD_FG, '0') AS FIX_PROD_FG
                FROM
                    TB_MS_PRODUCT_SDSEL_PROD tmpsp
                LEFT OUTER JOIN TB_MS_PRODUCT tmp ON
                    tmpsp.STORE_CD = tmp.STORE_CD
                    AND tmpsp.PROD_CD = tmp.PROD_CD
                INNER JOIN TB_MS_PRODUCT_SDSEL_CLASS tmpsc ON
                    tmpsc.STORE_CD = tmpsp.STORE_CD
                    AND tmpsc.SDSEL_CLASS_CD = tmpsp.SDSEL_CLASS_CD
                WHERE
                    tmpsp.STORE_CD = #{storeCd}
                    AND tmpsp.SDSEL_CLASS_CD = #{sdselClassCd}
                    AND tmpsp.USE_YN = 'Y'
                ORDER BY
                    tmpsp.DISP_SEQ
            </when>
        </choose>
    </select>

    <!-- 선택상품 생성 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_PROD, TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 선택상품을 생성한다.
    -->
    <insert id="insertMenuProdList" parameterType="sideMenuSelProdVO">
        /* USE : SideMenuMapper.insertMenuProdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                MERGE INTO TB_HQ_PRODUCT_SDSEL_PROD thpsp
                USING DUAL
                   ON (
                thpsp.HQ_OFFICE_CD = #{hqOfficeCd}
                AND thpsp.SDSEL_CLASS_CD = #{sdselClassCd}
                AND thpsp.PROD_CD = #{prodCd}
                      )
                WHEN MATCHED THEN
                     UPDATE
                        SET thpsp.USE_YN = 'Y',
                            thpsp.MOD_DT = #{modDt},
                            thpsp.MOD_ID = #{modId}
                WHEN NOT MATCHED THEN
                     INSERT
                     (
                         HQ_OFFICE_CD,
                         SDSEL_CLASS_CD,
                         PROD_CD,
                         ADD_PROD_UPRC,
                         ADD_PROD_QTY,
                         DISP_SEQ,
                         USE_YN,
                         REG_DT,
                         REG_ID,
                         MOD_DT,
                         MOD_ID,
                         FIX_PROD_FG
                     ) VALUES (
                         #{hqOfficeCd},
                         #{sdselClassCd},
                         #{prodCd},
                         #{addProdUprc},
                         #{addProdQty},
                         (SELECT NVL(MAX(DISP_SEQ), 0) +1 FROM TB_HQ_PRODUCT_SDSEL_PROD WHERE HQ_OFFICE_CD =  #{hqOfficeCd} AND SDSEL_CLASS_CD = #{sdselClassCd} AND USE_YN='Y'), -- 임시수정
                         'Y',
                         #{regDt},
                         #{regId},
                         #{modDt},
                         #{modId},
                         #{fixProdFg}
                     )
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                MERGE INTO TB_MS_PRODUCT_SDSEL_PROD tmpsp
                USING DUAL
                  ON (
                      tmpsp.STORE_CD = #{storeCd}
                      AND tmpsp.SDSEL_CLASS_CD = #{sdselClassCd}
                      AND tmpsp.PROD_CD = #{prodCd}
                  )
                WHEN MATCHED THEN
                     UPDATE
                     SET tmpsp.USE_YN = 'Y',
                         tmpsp.MOD_DT = #{modDt},
                         tmpsp.MOD_ID = #{modId}
                WHEN NOT MATCHED THEN
                     INSERT
                     (
                         STORE_CD,
                         SDSEL_CLASS_CD,
                         PROD_CD,
                         ADD_PROD_UPRC,
                         ADD_PROD_QTY,
                         DISP_SEQ,
                         USE_YN,
                         REG_DT,
                         REG_ID,
                         MOD_DT,
                         MOD_ID,
                         FIX_PROD_FG
                     ) VALUES (
                         #{storeCd},
                         #{sdselClassCd},
                         #{prodCd},
                         #{addProdUprc},
                         #{addProdQty},
                         (SELECT NVL(MAX(DISP_SEQ), 0) +1 FROM TB_MS_PRODUCT_SDSEL_PROD WHERE STORE_CD =  #{storeCd} AND SDSEL_CLASS_CD = #{sdselClassCd} AND USE_YN='Y'), -- 임시수정
                         'Y',
                         #{regDt},
                         #{regId},
                         #{modDt},
                         #{modId},
                         #{fixProdFg}
                     )
            </when>
        </choose>
    </insert>

    <!-- 선택상품 수정 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_PROD, TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 선택상품을 수정한다.
    -->
    <update id="updateMenuProdList" parameterType="sideMenuSelProdVO">
        /* USE : SideMenuMapper.updateMenuProdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDSEL_PROD
                SET
                    ADD_PROD_UPRC = #{addProdUprc},
                    ADD_PROD_QTY = #{addProdQty},
                    DISP_SEQ = #{dispSeq},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId},
                    FIX_PROD_FG = #{fixProdFg}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND PROD_CD = #{prodCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDSEL_PROD
                SET
                    ADD_PROD_UPRC = #{addProdUprc},
                    ADD_PROD_QTY = #{addProdQty},
                    DISP_SEQ = #{dispSeq},
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId},
                    FIX_PROD_FG = #{fixProdFg}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND PROD_CD = #{prodCd}
            </when>
        </choose>
    </update>

    <!-- 선택상품 삭제 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_PROD, TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 선택상품을 삭제한다.
    -->
    <update id="deleteMenuProdList" parameterType="sideMenuSelProdVO">
        /* USE : SideMenuMapper.deleteMenuProdList */
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                UPDATE TB_HQ_PRODUCT_SDSEL_PROD
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    HQ_OFFICE_CD = #{hqOfficeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND PROD_CD = #{prodCd}
            </when>
            <!-- 매장 -->
            <when test='orgnFg != null and orgnFg == "S"'>
                UPDATE TB_MS_PRODUCT_SDSEL_PROD
                SET
                    USE_YN = 'N',
                    MOD_DT = #{modDt},
                    MOD_ID = #{modId}
                WHERE
                    STORE_CD = #{storeCd}
                    AND SDSEL_CLASS_CD = #{sdselClassCd}
                    AND PROD_CD = #{prodCd}
            </when>
        </choose>
    </update>

    <!-- 사이드메뉴-선택메뉴탭-선택상품 생성시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 본사 사이드메뉴 선택상품을 매장에 생성한다.
    -->
    <select id="insertHqMenuProdListToStore" statementType="CALLABLE"  parameterType="sideMenuSelProdVO" resultType="String">
        /* USE : SideMenuMapper.insertHqMenuProdListToStore */
        {
          CALL PKG_HQ_PRODUCT_SDSEL_PROD.SP_HQ_PRODUCT_SDSEL_PROD_I
          (
            #{hqOfficeCd},
            #{sdselClassCd},
            #{prodCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 사이드메뉴-선택메뉴탭-선택상품 수정시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 본사 사이드메뉴 선택상품을 매장에 적용시킨다.
    -->
    <select id="saveHqMenuProdListToStore" statementType="CALLABLE"  parameterType="sideMenuSelProdVO" resultType="String">
        /* USE : SideMenuMapper.saveHqMenuProdListToStore */
        {
          CALL PKG_HQ_PRODUCT_SDSEL_PROD.SP_HQ_PRODUCT_SDSEL_PROD_U
          (
            #{hqOfficeCd},
            #{sdselClassCd},
            #{prodCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>

    <!-- 사이드메뉴-선택메뉴탭-선택상품 삭제시 매장적용 -->
    <!--
        TABLE    : TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelProdVO
        COMMENTS : 본사 사이드메뉴 선택상품을 매장에서 제외시킨다.
    -->
    <select id="deleteHqMenuProdListToStore" statementType="CALLABLE"  parameterType="sideMenuSelProdVO" resultType="String">
        /* USE : SideMenuMapper.deleteHqMenuProdListToStore */
        {
          CALL PKG_HQ_PRODUCT_SDSEL_PROD.SP_HQ_PRODUCT_SDSEL_PROD_D
          (
            #{hqOfficeCd},
            #{sdselClassCd},
            #{prodCd},
            #{regId},
            #{result, mode=OUT, jdbcType=VARCHAR}
          )
        }
    </select>


    <!-- 선택분류에 등록된 선택상품 개수 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_PROD, TB_MS_PRODUCT_SDSEL_PROD
        PARAM    : sideMenuSelClassVO
        COMMENTS : 선택분류에 등록된 선택상품 개수 조회한다. ( 본사/매장 )
    -->
    <select id="getSideMenuSelClassProdCnt" parameterType="sideMenuSelClassVO" resultType="Integer">
      /* USE : SideMenuMapper.getSideMenuSelClassProdCnt */
      <choose>
        <!-- 본사 -->
        <when test='orgnFg != null and orgnFg == "H"'>
          SELECT COUNT(PROD_CD) AS PROD_CNT
            FROM TB_HQ_PRODUCT_SDSEL_PROD thpsp
           WHERE thpsp.HQ_OFFICE_CD = #{hqOfficeCd}
             AND thpsp.SDSEL_CLASS_CD = #{sdselClassCd}
             AND thpsp.USE_YN = 'Y'
        </when>
        <!-- 매장 -->
        <when test='orgnFg != null and orgnFg == "S"'>
          SELECT COUNT(PROD_CD) AS PROD_CNT
            FROM TB_MS_PRODUCT_SDSEL_PROD tmpsp
           WHERE tmpsp.STORE_CD = #{storeCd}
           AND tmpsp.SDSEL_CLASS_CD = #{sdselClassCd}
           AND tmpsp.USE_YN = 'Y'
        </when>
      </choose>
    </select>

    <!-- 선택그룹에 등록된 선택분류 개수 조회 -->
    <!--
        TABLE    : TB_HQ_PRODUCT_SDSEL_CLASS, TB_MS_PRODUCT_SDSEL_CLASS
        PARAM    : sideMenuSelClassVO
        COMMENTS : 선택분류에 등록된 선택상품 개수 조회한다. ( 본사/매장 )
    -->
    <select id="getSideMenuSelGrpClassCnt" parameterType="sideMenuSelClassVO" resultType="Integer">
      /* USE : SideMenuMapper.getSideMenuSelGrpClassCnt */
      <choose>
        <!-- 본사 -->
        <when test='orgnFg != null and orgnFg == "H"'>
          SELECT COUNT(SDSEL_CLASS_CD) AS CLASS_CNT
            FROM TB_HQ_PRODUCT_SDSEL_CLASS thpsc
           WHERE thpsc.HQ_OFFICE_CD = #{hqOfficeCd}
             AND thpsc.SDSEL_GRP_CD = #{sdselGrpCd}
             AND thpsc.USE_YN = 'Y'
        </when>
        <!-- 매장 -->
        <when test='orgnFg != null and orgnFg == "S"'>
          SELECT COUNT(SDSEL_CLASS_CD) AS CLASS_CNT
            FROM TB_MS_PRODUCT_SDSEL_CLASS tmpsc
           WHERE tmpsc.STORE_CD = #{storeCd}
             AND tmpsc.SDSEL_GRP_CD = #{sdselClassCd}
            AND tmpsc.USE_YN = 'Y'
        </when>
      </choose>
    </select>

</mapper>



