var wijmo,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(t){var e,r;e=t.grid||(t.grid={}),r=function(r){function i(e,i){var n=r.call(this,e)||this,s=n.getTemplate();return n.applyTemplate("wj-control wj-columnpicker",s,{_dAll:"d-unUse",_dInUse:"d-inUse"}),n._lbAll=n._createColumnListBox(n._dAll),n._lbInUse=n._createColumnListBox(n._dInUse),n._dMarker=t.createElement('<div class="wj-marker" style="display:none">&nbsp;</div>'),n.hostElement.appendChild(n._dMarker),n.addEventListener(n.hostElement,"dblclick",function(e){if(t.contains(n._lbAll.hostElement,e.target)){var r=n._lbAll.selectedItem;(i=n._lbInUse.itemsSource).indexOf(r)<0&&i.push(r)}if(t.contains(n._lbInUse.hostElement,e.target)){var i;r=n._lbInUse.selectedItem;(i=n._lbInUse.itemsSource).remove(r)}}),n.initialize(i),n}return __extends(i,r),Object.defineProperty(i.prototype,"grid",{get:function(){return this._grid},set:function(r){this._grid=t.asType(r,e.FlexGrid),this.load()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orgColumns",{get:function(){return this._orgColumns},set:function(t){for(var e=new Array,r=0;r<t.length;r++)e[r]={binding:t[r].binding,name:t[r]._hdr,isVisible:t[r].isVisible};e.length=t.length,this._orgColumns=e}}),i.prototype.save=function(){var t=this._grid,e=this._lbInUse.itemsSource;t&&t.columns.deferUpdate(function(){t.columns.clear();for(var r=0;r<e.length;r++)t.columns.push(e[r])})},i.prototype.load=function(){for(var e=this._getAllColumns(),r=new t.collections.ObservableArray,i=0;i<e.length;i++){var n=e[i];n.grid&&r.push(n)}this._lbAll.itemsSource=e,this._lbInUse.itemsSource=r,this._resetMouseState()},i.prototype._getAllColumns=function(){var r=this._grid,i=new t.collections.ObservableArray;if(r){for(var n=0;n<r.columns.length;n++)r.columns[n].isVisible&&i.push(r.columns[n]);if(t.hasItems(r.collectionView)){var s=r.collectionView.items[0];for(var o in s)if(!r.columns.getColumn(o))for(var l=0;l<this._orgColumns.length;l++)this._orgColumns[l].binding===o&&this._orgColumns[l].isVisible&&i.push(new e.Column({binding:o,header:t.toHeaderCase(this._orgColumns[l].name)}))}}return i},i.prototype._createColumnListBox=function(r){var i=new t.input.ListBox(r);return i.displayMemberPath="header",i.formatItem.addHandler(function(r,i){i.item.setAttribute("draggable","true");i.data;t.assert(i.data instanceof e.Column,"expecting a Column here...")}),this.addEventListener(r,"dragstart",this._dragstart.bind(this)),this.addEventListener(r,"dragover",this._dragover.bind(this)),this.addEventListener(r,"dragleave",this._dragover.bind(this)),this.addEventListener(r,"drop",this._drop.bind(this)),this.addEventListener(r,"dragend",this._dragend.bind(this)),i},i.prototype._dragstart=function(e){var r=this._getListBoxTarget(e);if(r){this._dragSource=null;for(var i=r.hostElement,n=0;n<i.children.length;n++)if(t.contains(i.children[n],e.target)){r.selectedIndex=n,this._dragSource=i;break}this._dragSource&&e.dataTransfer?(e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text",""),e.stopPropagation()):e.preventDefault()}},i.prototype._dragover=function(e){var r=this._getListBoxTarget(e);if(r){var i=!1,n=t.Control.getControl(this._dragSource).selectedItem;this._dragSource==this._dAll&&r!=this._lbAll&&r.itemsSource.indexOf(n)<0&&"gChk"!==n.binding&&(i=!0),this._dragSource&&this._dragSource!=this._dAll&&"gChk"!==n.binding&&(i=!0),i?(e.dataTransfer.dropEffect=this._dragSource==this._dAll?"copy":"move",e.preventDefault(),this._showDragMarker(e)):this._showDragMarker(null)}},i.prototype._drop=function(e){var r=this._getListBoxTarget(e);if(r){var i=t.Control.getControl(this._dragSource),n=i?i.selectedItem:null,s=r.itemsSource;if(n&&"gChk"!==n.binding)if(r==this._lbAll)i.itemsSource.remove(n);else{var o=s.indexOf(n);if(o==this._dropIndex)return;o>-1&&(s.removeAt(o),o<this._dropIndex&&this._dropIndex--),s.insert(this._dropIndex,n),r.selectedIndex=this._dropIndex}}this._resetMouseState()},i.prototype._dragend=function(t){this._resetMouseState()},i.prototype._getListBoxTarget=function(e){for(var r=e.target;r;r=r.parentElement){var i=t.Control.getControl(r);if(i instanceof t.input.ListBox)return i}return null},i.prototype._resetMouseState=function(){this._dragSource=null,this._showDragMarker(null),this._lbAll.selectedIndex=this._lbInUse.selectedIndex=-1},i.prototype._showDragMarker=function(e){var r,i,n;if(e){for(n=i=document.elementFromPoint(e.clientX,e.clientY);n&&!t.hasClass(n,"wj-listbox-item");)n=n.parentElement;if(!n&&t.hasClass(i,"wj-listbox")){var s=i.lastElementChild;t.hasClass(s,"wj-listbox-item")&&(n=s)}r=n?n.getBoundingClientRect():t.hasClass(i,"wj-listbox")?i.getBoundingClientRect():null}if(r){var o=r.top;if(this._dropIndex=0,n)for(var l=n.parentElement.children,a=0;a<l.length;a++)if(l[a]==n){this._dropIndex=a,e.clientY>r.top+r.height/2&&(o=r.bottom,this._dropIndex++);break}var d=this.hostElement.getBoundingClientRect();t.setCss(this._dMarker,{left:Math.round(r.left-d.left),top:Math.round(o-d.top-2),width:Math.round(r.width),height:4,display:""})}else this._dMarker.style.display="none"},i.controlTemplate='<div class="wj-columnlists"><div class="wj-column-picker-wrap column-list"><div class="column-list-title">컬럼목록</div><div wj-part="d-unUse" class="wj-column-picker-list"></div></div><div class="wj-column-picker-wrap ml10 column-list"><div class="column-list-title">사용컬럼</div><div wj-part="d-inUse" class="wj-column-picker-list"></div></div>',i}(t.Control),e.ColumnPicker=r}(wijmo||(wijmo={}));
