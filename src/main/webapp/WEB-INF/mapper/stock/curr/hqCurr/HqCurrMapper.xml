<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.solbipos.stock.curr.hqCurr.service.impl.HqCurrMapper">

    <!-- 현재고현황 - 본사 현재고현황 리스트 조회 -->
    <!--
        TABLE    : TB_ST_HQ_STOCK_CUR, TB_HQ_PRODUCT, TB_HQ_PRODUCT_BARCD
        PARAM    : hqCurrVO
        COMMENTS : 현재고현황 - 현재고현황 리스트를 조회한다.
    -->
    <select id="getHqCurrList" parameterType="hqCurrVO" resultType="DefaultMap">
        /* USE : HqCurrMapper.getHqCurrList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT  FN_GET_PROD_CLASS_CD_NM_STR(#{hqOfficeCd}, thp.PROD_CLASS_CD, 'NM_STR') AS PROD_CLASS_NM
        ,       FN_GET_VENDOR_STR(#{hqOfficeCd}, tshsc.PROD_CD,'NM') AS VENDR_NM
        ,		tshsc.PROD_CD
        ,       thp.PROD_NM
        ,       tshsc.FIRST_VENDR_IN_DATE
        ,       tshsc.LAST_VENDR_IN_DATE
        ,       tshsc.FIRST_HQ_OUT_DATE
        ,       tshsc.LAST_HQ_OUT_DATE
        ,       tshsc.FIRST_SALE_DATE
        ,       tshsc.LAST_SALE_DATE
        ,       thp.COST_UPRC
        <!-- ,       thv.VENDR_NM -->
        ,       thpb.BARCD_CD
        ,       thp.PO_UNIT_QTY
        ,       ROUND(tshsc.CURR_QTY * thp.COST_UPRC / thp.PO_UNIT_QTY) AS CURR_AMT

        <if test='unitFg == "1"'>
            ,       thp.PO_UNIT_FG AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_HQ_NMCODE WHERE NMCODE_GRP_CD = '093' AND HQ_OFFICE_CD = #{hqOfficeCd} AND NMCODE_CD = thp.PO_UNIT_FG)  AS PO_UNIT_FG_NM      /* 본사 가상로그인시 */
            ,       (thp.SAFE_STOCK_QTY / thp.PO_UNIT_QTY) AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tshsc.CURR_QTY                               ) / thp.PO_UNIT_QTY) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_IN_QTY                       ) / thp.PO_UNIT_QTY) AS ACC_VENDR_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_OUT_QTY                      ) / thp.PO_UNIT_QTY) AS ACC_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_OUT_QTY                         ) / thp.PO_UNIT_QTY) AS ACC_HQ_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_IN_QTY                          ) / thp.PO_UNIT_QTY) AS ACC_HQ_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_IN_QTY                  ) / thp.PO_UNIT_QTY) AS ACC_STORE_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_OUT_QTY                 ) / thp.PO_UNIT_QTY) AS ACC_STORE_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_DISUSE_QTY                         ) / thp.PO_UNIT_QTY) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_ADJ_QTY                            ) / thp.PO_UNIT_QTY) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SET_IN_QTY + tshsc.ACC_SET_OUT_QTY ) / thp.PO_UNIT_QTY) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_OUT_QTY                 ) / thp.PO_UNIT_QTY) AS ACC_SALE_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_IN_QTY                  ) / thp.PO_UNIT_QTY) AS ACC_SALE_VENDR_IN_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_OUT_QTY                 	  ) / thp.PO_UNIT_QTY) AS ACC_HQ_MOVE_OUT_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_IN_QTY                 	  ) / thp.PO_UNIT_QTY) AS ACC_HQ_MOVE_IN_QTY
        </if>
        <if test='unitFg == "0"'>
            ,       (CASE WHEN thp.STOCK_UNIT_FG IS NOT NULL THEN thp.STOCK_UNIT_FG ELSE thp.PO_UNIT_FG END) AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_HQ_NMCODE WHERE NMCODE_GRP_CD = '093' AND HQ_OFFICE_CD = #{hqOfficeCd} AND NMCODE_CD = (CASE WHEN thp.STOCK_UNIT_FG IS NOT NULL THEN thp.STOCK_UNIT_FG ELSE thp.PO_UNIT_FG END))  AS PO_UNIT_FG_NM      /* 본사 가상로그인시 */
            ,       thp.SAFE_STOCK_QTY AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tshsc.CURR_QTY                               )) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_IN_QTY                       )) AS ACC_VENDR_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_OUT_QTY                      )) AS ACC_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_OUT_QTY                         )) AS ACC_HQ_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_IN_QTY                          )) AS ACC_HQ_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_IN_QTY                  )) AS ACC_STORE_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_OUT_QTY                 )) AS ACC_STORE_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_DISUSE_QTY                         )) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_ADJ_QTY                            )) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SET_IN_QTY + tshsc.ACC_SET_OUT_QTY )) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_OUT_QTY                 )) AS ACC_SALE_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_IN_QTY                  )) AS ACC_SALE_VENDR_IN_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_OUT_QTY                 	  )) AS ACC_HQ_MOVE_OUT_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_IN_QTY                 	  )) AS ACC_HQ_MOVE_IN_QTY
        </if>
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM    TB_ST_HQ_STOCK_CUR tshsc
        ,       TB_HQ_PRODUCT thp
        ,       TB_HQ_PRODUCT_BARCD thpb
        <!-- ,       (   SELECT   thvp.PROD_CD
                    ,      LISTAGG((SELECT 	thv.VENDR_NM
                                    FROM	TB_HQ_VENDOR thv
                                    WHERE 	thv.HQ_OFFICE_CD  = thvp.HQ_OFFICE_CD
                                    AND		thv.VENDR_CD  = thvp.VENDR_CD), ',') WITHIN GROUP (ORDER BY thvp.VENDR_CD) AS VENDR_NM
                    FROM    TB_HQ_VENDOR_PROD thvp
                    WHERE   thvp.HQ_OFFICE_CD    =   #{hqOfficeCd}
                    GROUP
                    BY      thvp.PROD_CD
                ) thv -->
        WHERE   tshsc.HQ_OFFICE_CD    	=   #{hqOfficeCd}
        AND     tshsc.STORAGE_CD      	=   '999'
        AND     thp.HQ_OFFICE_CD      	=   tshsc.HQ_OFFICE_CD
        AND     thp.PROD_CD           	=   tshsc.PROD_CD
        AND     thp.STOCK_PROD_YN     	=   'Y'
        AND     thp.USE_YN            	=   'Y'
        AND     thpb.HQ_OFFICE_CD (+) 	=   tshsc.HQ_OFFICE_CD
        AND     thpb.PROD_CD      (+) 	=   tshsc.PROD_CD
    <!-- AND     thv.PROD_CD       (+) 	=   tshsc.PROD_CD -->
        <if test='prodCd != null and prodCd != ""'>
            AND tshsc.PROD_CD = #{prodCd}
        </if>
        <if test='prodNm != null and prodNm != ""'>
            AND thp.PROD_NM LIKE '%'||#{prodNm}||'%'
        </if>
        <if test='barcdCd != null and barcdCd != ""'>
            AND thpb.BARCD_CD = #{barcdCd}
        </if>
        <if test='safeStockFg == "0"'>
            AND thp.SAFE_STOCK_QTY > 0 AND thp.SAFE_STOCK_QTY > tshsc.CURR_QTY
        </if>
        <if test='weightFg == "0"'>
            AND thp.PROD_TYPE_FG IN ('1')
        </if>
        <if test='weightFg == "1"'>
            AND thp.PROD_TYPE_FG IN ('2', '3')
        </if>
        <if test="prodClassCd != null and prodClassCd != ''">
            AND thp.PROD_CLASS_CD IN  ( SELECT  #{prodClassCd} AS PROD_CLASS_CD
                                        FROM    DUAL
                                        UNION
                                        SELECT  thpc.PROD_CLASS_CD
                                        FROM    TB_HQ_PRODUCT_CLASS thpc
                                        WHERE   thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                                        START WITH  thpc.P_PROD_CLASS_CD = #{prodClassCd} AND thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                                        CONNECT BY  thpc.P_PROD_CLASS_CD = PRIOR thpc.PROD_CLASS_CD AND thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                                      )
        </if>
        <if test='arrVendrCd != null and arrVendrCd != ""'>
            AND thp.PROD_CD IN    ( SELECT  PROD_CD
                                    FROM    TB_HQ_VENDOR_PROD
                                    WHERE   HQ_OFFICE_CD = #{hqOfficeCd}
                                    AND     VENDR_CD IN
                                    <foreach collection="arrVendrCd" item="item" open="(" close=")" separator=",">
                                        #{item}
                                    </foreach>
                                  )
        </if>
        ORDER BY tshsc.PROD_CD
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>


    <!-- 현재고현황 - 매장 현재고현황 리스트 조회 -->
    <!--
        TABLE    : TB_ST_STORE_STOCK_CUR, TB_MS_PRODUCT, TB_MS_PRODUCT_BARCD
        PARAM    : storeCurrVO
        COMMENTS : 현재고현황 - 현재고현황 리스트를 조회한다.
    -->
    <select id="getHqStoreCurrList" parameterType="hqCurrVO" resultType="DefaultMap">
        /* USE : HqCurrMapper.getHqStoreCurrList */
        <include refid="CmmSQL.PagingTemplateHeader"/>
        SELECT  FN_GET_PROD_CLASS_CD_NM_STR(#{storeCd}, tmp.PROD_CLASS_CD, 'NM_STR') AS PROD_CLASS_NM
        ,       FN_GET_VENDOR_STR(#{storeCd}, tsssc.PROD_CD,'NM') AS VENDR_NM
		,		tsssc.PROD_CD             ,   tmp.PROD_NM
        ,       tsssc.FIRST_IN_DATE       ,   tsssc.LAST_IN_DATE
        ,       tsssc.FIRST_SALE_DATE     ,   tsssc.LAST_SALE_DATE
        ,       tsssc.STORE_CD
        ,       (SELECT STORE_NM FROM TB_MS_STORE Z WHERE Z.STORE_CD = tsssc.STORE_CD) AS STORE_NM
        ,       tmp.COST_UPRC
        <!-- ,       tmv.VENDR_NM -->
        ,       tmpb.BARCD_CD
        ,       tmp.PO_UNIT_QTY
        ,       ROUND(tsssc.CURR_QTY * tmp.COST_UPRC / tmp.PO_UNIT_QTY) AS CURR_AMT
        <if test='unitFg == "1"'>
            ,       tmp.PO_UNIT_FG AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_MS_STORE_NMCODE WHERE NMCODE_GRP_CD = '093' AND STORE_CD = #{storeCd} AND NMCODE_CD = tmp.PO_UNIT_FG)  AS PO_UNIT_FG_NM        /* 매장 가상로그인시 */
            ,       (tmp.SAFE_STOCK_QTY / tmp.PO_UNIT_QTY) AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tsssc.CURR_QTY                               ) / tmp.PO_UNIT_QTY) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_IN_QTY                       ) / tmp.PO_UNIT_QTY) AS ACC_STORE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_OUT_QTY                      ) / tmp.PO_UNIT_QTY) AS ACC_STORE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_OUT_QTY                     ) / tmp.PO_UNIT_QTY) AS ACC_PURCHS_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_IN_QTY                      ) / tmp.PO_UNIT_QTY) AS ACC_PURCHS_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_IN_QTY                        ) / tmp.PO_UNIT_QTY) AS ACC_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_OUT_QTY                       ) / tmp.PO_UNIT_QTY) AS ACC_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_DISUSE_QTY                         ) / tmp.PO_UNIT_QTY) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_ADJ_QTY                            ) / tmp.PO_UNIT_QTY) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_SET_IN_QTY + tsssc.ACC_SET_OUT_QTY ) / tmp.PO_UNIT_QTY) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_SALE_QTY                     ) / tmp.PO_UNIT_QTY) AS ACC_STORE_SALE_QTY
        </if>
        <if test='unitFg == "0"'>
            ,       (CASE WHEN tmp.STOCK_UNIT_FG IS NOT NULL THEN tmp.STOCK_UNIT_FG ELSE tmp.PO_UNIT_FG END) AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_MS_STORE_NMCODE WHERE NMCODE_GRP_CD = '093' AND STORE_CD = #{storeCd} AND NMCODE_CD = (CASE WHEN tmp.STOCK_UNIT_FG IS NOT NULL THEN tmp.STOCK_UNIT_FG ELSE tmp.PO_UNIT_FG END))  AS PO_UNIT_FG_NM        /* 매장 가상로그인시 */
            ,       tmp.SAFE_STOCK_QTY AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tsssc.CURR_QTY                               )) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_IN_QTY                       )) AS ACC_STORE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_OUT_QTY                      )) AS ACC_STORE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_OUT_QTY                     )) AS ACC_PURCHS_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_IN_QTY                      )) AS ACC_PURCHS_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_IN_QTY                        )) AS ACC_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_OUT_QTY                       )) AS ACC_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_DISUSE_QTY                         )) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_ADJ_QTY                            )) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_SET_IN_QTY + tsssc.ACC_SET_OUT_QTY )) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_SALE_QTY                     )) AS ACC_STORE_SALE_QTY
        </if>
        <include refid="CmmSQL.PagingTemplateCount"/>
        FROM    TB_ST_STORE_STOCK_CUR tsssc
        ,       TB_MS_PRODUCT tmp
        ,       TB_MS_PRODUCT_BARCD tmpb
        <!-- ,       (   SELECT  tmvp.PROD_CD
                    ,   LISTAGG((   SELECT 	tmv.VENDR_NM
                                    FROM	TB_MS_VENDOR tmv
                                    WHERE 	tmv.STORE_CD  = tmvp.STORE_CD
                                    AND		tmv.VENDR_CD  = tmvp.VENDR_CD), ',') WITHIN GROUP (ORDER BY tmvp.VENDR_CD) AS VENDR_NM
                    FROM    TB_MS_VENDOR_PROD tmvp
                    WHERE   tmvp.STORE_CD    =   #{storeCd}
                    GROUP
                    BY      tmvp.PROD_CD
                ) tmv -->
        WHERE   tsssc.STORE_CD        =   #{storeCd}
        AND     tmp.STORE_CD          =   tsssc.STORE_CD
        AND     tsssc.STORAGE_CD      =   '999'
        AND     tmp.PROD_CD           =   tsssc.PROD_CD
        AND     tmp.STOCK_PROD_YN     =   'Y'
        AND     tmp.USE_YN            =   'Y'
        AND     tmpb.STORE_CD     (+) =   tsssc.STORE_CD
        AND     tmpb.PROD_CD      (+) =   tsssc.PROD_CD
        <!-- AND     tmv.PROD_CD       (+) =   tsssc.PROD_CD -->
        <if test='prodCd != null and prodCd != ""'>
            AND tsssc.PROD_CD = #{prodCd}
        </if>
        <if test='prodNm != null and prodNm != ""'>
            AND tmp.PROD_NM LIKE '%'||#{prodNm}||'%'
        </if>
        <if test='barcdCd != null and barcdCd != ""'>
            AND tmpb.BARCD_CD = #{barcdCd}
        </if>
        <if test='safeStockFg == "0"'>
            AND tmp.SAFE_STOCK_QTY > 0 AND tmp.SAFE_STOCK_QTY > tsssc.CURR_QTY
        </if>
        <if test='weightFg == "0"'>
            AND tmp.PROD_TYPE_FG IN ('1')
        </if>
        <if test='weightFg == "1"'>
            AND tmp.PROD_TYPE_FG IN ('2', '3')
        </if>
        <if test='prodClassCd != null and prodClassCd != ""'>
           AND tmp.PROD_CLASS_CD IN  (
                                       SELECT              PROD_CLASS_CD
                                       FROM                TB_MS_PRODUCT_CLASS
                                       WHERE               STORE_CD        = #{storeCd}
                                       START WITH          PROD_CLASS_CD   = #{prodClassCd}
                                       AND                 STORE_CD        = #{storeCd}
                                       CONNECT BY PRIOR    PROD_CLASS_CD   = P_PROD_CLASS_CD
                                       AND                 STORE_CD        = #{storeCd}
                                      )
        </if>
        <if test='arrVendrCd != null and arrVendrCd != ""'>
            AND tmp.PROD_CD IN    ( SELECT  PROD_CD
                                    FROM    TB_MS_VENDOR_PROD
                                    WHERE   STORE_CD = #{storeCd}
                                    AND     VENDR_CD IN
                                    <foreach collection="arrVendrCd" item="item" open="(" close=")" separator=",">
                                        #{item}
                                    </foreach>
                                  )
        </if>
        ORDER BY tsssc.PROD_CD
        <include refid="CmmSQL.PagingTemplateBottom"/>
    </select>

    <select id="getHqCurrDtlList" parameterType="hqCurrVO" resultType="DefaultMap">
	    SELECT	TSHSC.PROD_CD
		,		TSHSC.STORAGE_CD
		,		THS.STORAGE_NM
		,		SUM(TSHSC.CURR_QTY)	AS	CURR_QTY
		FROM	TB_ST_HQ_STOCK_CUR 	TSHSC
		,		TB_HQ_STORAGE		THS
        ,       TB_HQ_PRODUCT THP
		WHERE	TSHSC.HQ_OFFICE_CD	=	#{hqOfficeCd}
		AND		TSHSC.STORAGE_CD	<![CDATA[ >= ]]>	'001'			<!-- 고정 -->
		AND		TSHSC.STORAGE_CD	<![CDATA[ < ]]>	'999'			<!-- 고정 -->
		<if test='prodCd != null and prodCd != ""'>
		AND		TSHSC.PROD_CD		=	#{prodCd}
		</if>
		AND		THS.HQ_OFFICE_CD		=	TSHSC.HQ_OFFICE_CD
		AND		THS.STORAGE_CD		=	TSHSC.STORAGE_CD
        AND     THP.STOCK_PROD_YN = 'Y'
        AND     TSHSC.HQ_OFFICE_CD    (+) =   THP.HQ_OFFICE_CD
        AND     TSHSC.PROD_CD     (+) =   THP.PROD_CD
		GROUP
		BY		TSHSC.PROD_CD
		,		TSHSC.STORAGE_CD
		,		THS.STORAGE_NM
		ORDER
		BY		TSHSC.STORAGE_CD
    </select>

    <select id="getStoreCurrDtlList" parameterType="hqCurrVO" resultType="DefaultMap">
	    SELECT	TSSSC.PROD_CD
		,		TSSSC.STORAGE_CD
		,		DECODE(TSSSC.STORAGE_CD, '000', '매대', TMS.STORAGE_NM)	AS STORAGE_NM
		,		SUM(TSSSC.CURR_QTY)	AS	CURR_QTY
		FROM	TB_ST_STORE_STOCK_CUR 	TSSSC
		,		TB_MS_STORAGE		TMS
        ,       TB_MS_PRODUCT TMP
		WHERE	TSSSC.STORE_CD	=	#{storeCd}
		AND		TSSSC.STORAGE_CD	<![CDATA[ >= ]]> '000'
		AND		TSSSC.STORAGE_CD	<![CDATA[ < ]]>	'999'
		<if test='prodCd != null and prodCd != ""'>
		AND		TSSSC.PROD_CD		=	#{prodCd}
		</if>
		AND		TMS.STORE_CD	(+)	=	TSSSC.STORE_CD
		AND		TMS.STORAGE_CD	(+)	=	TSSSC.STORAGE_CD
        AND     TMP.STOCK_PROD_YN   = 'Y'
        AND     TMP.USE_YN          = 'Y'
        AND     TSSSC.STORE_CD    (+) =   TMP.STORE_CD
        AND     TSSSC.PROD_CD     (+) =   TMP.PROD_CD
		GROUP
		BY		TSSSC.PROD_CD
		,		TSSSC.STORAGE_CD
		,		TMS.STORAGE_NM
		ORDER
		BY		TSSSC.STORAGE_CD
    </select>

    <select id="getHqCurrExcelList" parameterType="hqCurrVO" resultType="DefaultMap">
        /* USE : HqCurrMapper.getHqCurrExcelList */
        SELECT  FN_GET_PROD_CLASS_CD_NM_STR(#{hqOfficeCd}, thp.PROD_CLASS_CD, 'NM_STR') AS PROD_CLASS_NM
        ,       FN_GET_VENDOR_STR(#{hqOfficeCd}, tshsc.PROD_CD,'NM') AS VENDR_NM
        ,		tshsc.PROD_CD
        ,       thp.PROD_NM
        ,       tshsc.FIRST_VENDR_IN_DATE
        ,       tshsc.LAST_VENDR_IN_DATE
        ,       tshsc.FIRST_HQ_OUT_DATE
        ,       tshsc.LAST_HQ_OUT_DATE
        ,       tshsc.FIRST_SALE_DATE
        ,       tshsc.LAST_SALE_DATE
        ,       thp.COST_UPRC
        <!-- ,       thv.VENDR_NM -->
        ,       thpb.BARCD_CD
        ,       thp.PO_UNIT_QTY
        ,       ROUND(tshsc.CURR_QTY * thp.COST_UPRC / thp.PO_UNIT_QTY) AS CURR_AMT

        <if test='unitFg == "1"'>
            ,       thp.PO_UNIT_FG AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_HQ_NMCODE WHERE NMCODE_GRP_CD = '093' AND HQ_OFFICE_CD = #{hqOfficeCd} AND NMCODE_CD = thp.PO_UNIT_FG)  AS PO_UNIT_FG_NM      /* 본사 가상로그인시 */
            ,       (thp.SAFE_STOCK_QTY / thp.PO_UNIT_QTY) AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tshsc.CURR_QTY                               ) / thp.PO_UNIT_QTY) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_IN_QTY                       ) / thp.PO_UNIT_QTY) AS ACC_VENDR_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_OUT_QTY                      ) / thp.PO_UNIT_QTY) AS ACC_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_OUT_QTY                         ) / thp.PO_UNIT_QTY) AS ACC_HQ_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_IN_QTY                          ) / thp.PO_UNIT_QTY) AS ACC_HQ_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_IN_QTY                  ) / thp.PO_UNIT_QTY) AS ACC_STORE_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_OUT_QTY                 ) / thp.PO_UNIT_QTY) AS ACC_STORE_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_DISUSE_QTY                         ) / thp.PO_UNIT_QTY) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_ADJ_QTY                            ) / thp.PO_UNIT_QTY) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SET_IN_QTY + tshsc.ACC_SET_OUT_QTY ) / thp.PO_UNIT_QTY) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_OUT_QTY                 ) / thp.PO_UNIT_QTY) AS ACC_SALE_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_IN_QTY                  ) / thp.PO_UNIT_QTY) AS ACC_SALE_VENDR_IN_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_OUT_QTY                 	  ) / thp.PO_UNIT_QTY) AS ACC_HQ_MOVE_OUT_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_IN_QTY                 	  ) / thp.PO_UNIT_QTY) AS ACC_HQ_MOVE_IN_QTY
        </if>
        <if test='unitFg == "0"'>
            ,       (CASE WHEN thp.STOCK_UNIT_FG IS NOT NULL THEN thp.STOCK_UNIT_FG ELSE thp.PO_UNIT_FG END) AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_HQ_NMCODE WHERE NMCODE_GRP_CD = '093' AND HQ_OFFICE_CD = #{hqOfficeCd} AND NMCODE_CD = (CASE WHEN thp.STOCK_UNIT_FG IS NOT NULL THEN thp.STOCK_UNIT_FG ELSE thp.PO_UNIT_FG END))  AS PO_UNIT_FG_NM      /* 본사 가상로그인시 */
            ,       thp.SAFE_STOCK_QTY AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tshsc.CURR_QTY                               )) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_IN_QTY                       )) AS ACC_VENDR_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_VENDR_OUT_QTY                      )) AS ACC_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_OUT_QTY                         )) AS ACC_HQ_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_HQ_IN_QTY                          )) AS ACC_HQ_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_IN_QTY                  )) AS ACC_STORE_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_STORE_MOVE_OUT_QTY                 )) AS ACC_STORE_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_DISUSE_QTY                         )) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_ADJ_QTY                            )) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SET_IN_QTY + tshsc.ACC_SET_OUT_QTY )) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_OUT_QTY                 )) AS ACC_SALE_VENDR_OUT_QTY
            ,       SF_ZERO_TO_NULL((tshsc.ACC_SALE_VENDR_IN_QTY                  )) AS ACC_SALE_VENDR_IN_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_OUT_QTY                 	  )) AS ACC_HQ_MOVE_OUT_QTY
            ,		SF_ZERO_TO_NULL((tshsc.ACC_HQ_MOVE_IN_QTY                 	  )) AS ACC_HQ_MOVE_IN_QTY
        </if>
        FROM    TB_ST_HQ_STOCK_CUR tshsc
        ,       TB_HQ_PRODUCT thp
        ,       TB_HQ_PRODUCT_BARCD thpb
        <!-- ,       (   SELECT   thvp.PROD_CD
                    ,      LISTAGG((SELECT 	thv.VENDR_NM
                                    FROM	TB_HQ_VENDOR thv
                                    WHERE 	thv.HQ_OFFICE_CD  = thvp.HQ_OFFICE_CD
                                    AND		thv.VENDR_CD  = thvp.VENDR_CD), ',') WITHIN GROUP (ORDER BY thvp.VENDR_CD) AS VENDR_NM
                    FROM    TB_HQ_VENDOR_PROD thvp
                    WHERE   thvp.HQ_OFFICE_CD    =   #{hqOfficeCd}
                    GROUP
                    BY      thvp.PROD_CD
                ) thv -->
        WHERE   tshsc.HQ_OFFICE_CD    =   #{hqOfficeCd}
        AND     tshsc.STORAGE_CD      =   '999'
        AND     thp.HQ_OFFICE_CD      =   tshsc.HQ_OFFICE_CD
        AND     thp.PROD_CD           =   tshsc.PROD_CD
        AND     thp.STOCK_PROD_YN     =   'Y'
        AND     thp.USE_YN            =   'Y'
        AND     thpb.HQ_OFFICE_CD (+) =   tshsc.HQ_OFFICE_CD
        AND     thpb.PROD_CD      (+) =   tshsc.PROD_CD
        <!-- AND     thv.PROD_CD       (+) =   tshsc.PROD_CD -->
        <if test='prodCd != null and prodCd != ""'>
            AND tshsc.PROD_CD = #{prodCd}
        </if>
        <if test='prodNm != null and prodNm != ""'>
            AND thp.PROD_NM LIKE '%'||#{prodNm}||'%'
        </if>
        <if test='barcdCd != null and barcdCd != ""'>
            AND thpb.BARCD_CD = #{barcdCd}
        </if>
        <if test='safeStockFg == "0"'>
            AND thp.SAFE_STOCK_QTY > 0 AND thp.SAFE_STOCK_QTY > tshsc.CURR_QTY
        </if>
        <if test='weightFg == "0"'>
            AND thp.PROD_TYPE_FG IN ('1')
        </if>
        <if test='weightFg == "1"'>
            AND thp.PROD_TYPE_FG IN ('2', '3')
        </if>
        <if test="prodClassCd != null and prodClassCd != ''">
            AND thp.PROD_CLASS_CD IN  ( SELECT  #{prodClassCd} AS PROD_CLASS_CD
                                        FROM    DUAL
                                        UNION
                                        SELECT  thpc.PROD_CLASS_CD
                                        FROM    TB_HQ_PRODUCT_CLASS thpc
                                        WHERE   thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                                        START WITH  thpc.P_PROD_CLASS_CD = #{prodClassCd} AND thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                                        CONNECT BY  thpc.P_PROD_CLASS_CD = PRIOR thpc.PROD_CLASS_CD AND thpc.HQ_OFFICE_CD = #{hqOfficeCd}
                                      )
        </if>
        <if test='arrVendrCd != null and arrVendrCd != ""'>
            AND thp.PROD_CD IN    ( SELECT  PROD_CD
                                    FROM    TB_HQ_VENDOR_PROD
                                    WHERE   HQ_OFFICE_CD = #{hqOfficeCd}
                                    AND     VENDR_CD IN
                                    <foreach collection="arrVendrCd" item="item" open="(" close=")" separator=",">
                                        #{item}
                                    </foreach>
                                  )
        </if>
        ORDER BY tshsc.PROD_CD
    </select>

    <select id="getHqStoreCurrExcelList" parameterType="hqCurrVO" resultType="DefaultMap">
        /* USE : HqCurrMapper.getHqStoreCurrExcelList */
        SELECT  FN_GET_PROD_CLASS_CD_NM_STR(#{storeCd}, tmp.PROD_CLASS_CD, 'NM_STR') AS PROD_CLASS_NM
        ,       FN_GET_VENDOR_STR(#{storeCd}, tsssc.PROD_CD,'NM') AS VENDR_NM
		,		tsssc.PROD_CD             ,   tmp.PROD_NM
        ,       tsssc.FIRST_IN_DATE       ,   tsssc.LAST_IN_DATE
        ,       tsssc.FIRST_SALE_DATE     ,   tsssc.LAST_SALE_DATE
        ,       tsssc.STORE_CD
        ,       (SELECT STORE_NM FROM TB_MS_STORE Z WHERE Z.STORE_CD = tsssc.STORE_CD) AS STORE_NM
        ,       tmp.COST_UPRC
        <!-- ,       tmv.VENDR_NM -->
        ,       tmpb.BARCD_CD
        ,       tmp.PO_UNIT_QTY
        ,       ROUND(tsssc.CURR_QTY * tmp.COST_UPRC / tmp.PO_UNIT_QTY) AS CURR_AMT
        <if test='unitFg == "1"'>
            ,       tmp.PO_UNIT_FG AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_MS_STORE_NMCODE WHERE NMCODE_GRP_CD = '093' AND STORE_CD = #{storeCd} AND NMCODE_CD = tmp.PO_UNIT_FG)  AS PO_UNIT_FG_NM        /* 매장 가상로그인시 */
            ,       (tmp.SAFE_STOCK_QTY / tmp.PO_UNIT_QTY) AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tsssc.CURR_QTY                               ) / tmp.PO_UNIT_QTY) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_IN_QTY                       ) / tmp.PO_UNIT_QTY) AS ACC_STORE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_OUT_QTY                      ) / tmp.PO_UNIT_QTY) AS ACC_STORE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_OUT_QTY                     ) / tmp.PO_UNIT_QTY) AS ACC_PURCHS_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_IN_QTY                      ) / tmp.PO_UNIT_QTY) AS ACC_PURCHS_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_IN_QTY                        ) / tmp.PO_UNIT_QTY) AS ACC_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_OUT_QTY                       ) / tmp.PO_UNIT_QTY) AS ACC_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_DISUSE_QTY                         ) / tmp.PO_UNIT_QTY) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_ADJ_QTY                            ) / tmp.PO_UNIT_QTY) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_SET_IN_QTY + tsssc.ACC_SET_OUT_QTY ) / tmp.PO_UNIT_QTY) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_SALE_QTY                     ) / tmp.PO_UNIT_QTY) AS ACC_STORE_SALE_QTY
        </if>
        <if test='unitFg == "0"'>
            ,       (CASE WHEN tmp.STOCK_UNIT_FG IS NOT NULL THEN tmp.STOCK_UNIT_FG ELSE tmp.PO_UNIT_FG END) AS PO_UNIT_FG
            ,		(SELECT NMCODE_NM FROM TB_MS_STORE_NMCODE WHERE NMCODE_GRP_CD = '093' AND STORE_CD = #{storeCd} AND NMCODE_CD = (CASE WHEN tmp.STOCK_UNIT_FG IS NOT NULL THEN tmp.STOCK_UNIT_FG ELSE tmp.PO_UNIT_FG END))  AS PO_UNIT_FG_NM        /* 매장 가상로그인시 */
            ,       tmp.SAFE_STOCK_QTY AS SAFE_STOCK_QTY
            ,       SF_ZERO_TO_NULL((tsssc.CURR_QTY                               )) AS CURR_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_IN_QTY                       )) AS ACC_STORE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_OUT_QTY                      )) AS ACC_STORE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_OUT_QTY                     )) AS ACC_PURCHS_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_PURCHS_IN_QTY                      )) AS ACC_PURCHS_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_IN_QTY                        )) AS ACC_MOVE_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_MOVE_OUT_QTY                       )) AS ACC_MOVE_OUT_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_DISUSE_QTY                         )) AS ACC_DISUSE_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_ADJ_QTY                            )) AS ACC_ADJ_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_SET_IN_QTY + tsssc.ACC_SET_OUT_QTY )) AS ACC_SET_IN_QTY
            ,       SF_ZERO_TO_NULL((tsssc.ACC_STORE_SALE_QTY                     )) AS ACC_STORE_SALE_QTY
        </if>
        FROM    TB_ST_STORE_STOCK_CUR tsssc
        ,       TB_MS_PRODUCT tmp
        ,       TB_MS_PRODUCT_BARCD tmpb
        <!-- ,       (   SELECT  tmvp.PROD_CD
                    ,   LISTAGG((   SELECT 	tmv.VENDR_NM
                                    FROM	TB_MS_VENDOR tmv
                                    WHERE 	tmv.STORE_CD  = tmvp.STORE_CD
                                    AND		tmv.VENDR_CD  = tmvp.VENDR_CD), ',') WITHIN GROUP (ORDER BY tmvp.VENDR_CD) AS VENDR_NM
                    FROM    TB_MS_VENDOR_PROD tmvp
                    WHERE   tmvp.STORE_CD    =   #{storeCd}
                    GROUP
                    BY      tmvp.PROD_CD
                ) tmv -->
        WHERE   tsssc.STORE_CD        =   #{storeCd}
        AND     tmp.STORE_CD          =   tsssc.STORE_CD
        AND     tsssc.STORAGE_CD      =   '999'
        AND     tmp.PROD_CD           =   tsssc.PROD_CD
        AND     tmp.STOCK_PROD_YN     =   'Y'
        AND     tmp.USE_YN            =   'Y'
        AND     tmpb.STORE_CD     (+) =   tsssc.STORE_CD
        AND     tmpb.PROD_CD      (+) =   tsssc.PROD_CD
        <!-- AND     tmv.PROD_CD       (+) =   tsssc.PROD_CD -->
        <if test='prodCd != null and prodCd != ""'>
            AND tsssc.PROD_CD = #{prodCd}
        </if>
        <if test='prodNm != null and prodNm != ""'>
            AND tmp.PROD_NM LIKE '%'||#{prodNm}||'%'
        </if>
        <if test='barcdCd != null and barcdCd != ""'>
            AND tmpb.BARCD_CD = #{barcdCd}
        </if>
        <if test='safeStockFg == "0"'>
            AND tmp.SAFE_STOCK_QTY > 0 AND tmp.SAFE_STOCK_QTY > tsssc.CURR_QTY
        </if>
        <if test='weightFg == "0"'>
            AND tmp.PROD_TYPE_FG IN ('1')
        </if>
        <if test='weightFg == "1"'>
            AND tmp.PROD_TYPE_FG IN ('2', '3')
        </if>
        <if test='prodClassCd != null and prodClassCd != ""'>
           AND tmp.PROD_CLASS_CD IN  (
                                       SELECT              PROD_CLASS_CD
                                       FROM                TB_MS_PRODUCT_CLASS
                                       WHERE               STORE_CD        = #{storeCd}
                                       START WITH          PROD_CLASS_CD   = #{prodClassCd}
                                       AND                 STORE_CD        = #{storeCd}
                                       CONNECT BY PRIOR    PROD_CLASS_CD   = P_PROD_CLASS_CD
                                       AND                 STORE_CD        = #{storeCd}
                                      )
        </if>
        <if test='arrVendrCd != null and arrVendrCd != ""'>
            AND tmp.PROD_CD IN    ( SELECT  PROD_CD
                                    FROM    TB_MS_VENDOR_PROD
                                    WHERE   STORE_CD = #{storeCd}
                                    AND     VENDR_CD IN
                                    <foreach collection="arrVendrCd" item="item" open="(" close=")" separator=",">
                                        #{item}
                                    </foreach>
                                  )
        </if>
        ORDER BY tsssc.PROD_CD
    </select>

    <!-- 현재고현황 - 현재고수량현황 팝업 리스트 조회 -->
    <!--
        TABLE    :
        COMMENTS :
    -->
    <select id="getSearchHqCurrQtyDtlList" parameterType="hqCurrVO" resultType="DefaultMap">
        /* HqCurrMapper.getSearchHqCurrQtyDtlList*/
        <choose>
            <!-- 본사 -->
            <when test='orgnFg != null and orgnFg == "H"'>
                SELECT	IOSTOCK_DATE
                ,		IOSTOCK_FG
                ,		IOSTOCK_QTY
                ,		SUM(REAL_IOSTOCK_QTY) OVER (ORDER BY ORDER_NO, IOSTOCK_DATE, IOSTOCK_CD, SLIP_NO)	AS ACC_IOSTOCK_QTY
                FROM	(
                            SELECT	'1'					        AS ORDER_NO
                            ,		'조회기간 전'			        AS IOSTOCK_DATE
                            ,		''					        AS IOSTOCK_FG
                            ,		''					        AS IOSTOCK_CD
                            <if test='unitFg == "0"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            <if test='unitFg == "1"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            ,		''					        AS SLIP_NO
                            FROM	TB_ST_HQ_STOCK_DAILY A
                            ,       TB_HQ_PRODUCT B
                            WHERE	B.HQ_OFFICE_CD  =   A.HQ_OFFICE_CD
                            AND     B.PROD_CD       =   A.PROD_CD
                            AND     A.HQ_OFFICE_CD 	=	#{hqOfficeCd}
                            AND		A.PROD_CD		=	#{prodCd}
                            AND     B.STOCK_PROD_YN =   'Y'
                            AND     B.USE_YN        =   'Y'
                            <![CDATA[
                                AND		A.IOSTOCK_DATE 	<	#{startDate}
                            ]]>
                            UNION ALL
                            SELECT	'2'
                            ,		TO_CHAR(TO_DATE(IOSTOCK_DATE, 'yyyymmdd'), 'yyyy-mm-dd') AS IOSTOCK_DATE
                            ,		IOSTOCK_FG
                            ,		IOSTOCK_CD
                            ,		IOSTOCK_QTY
                            ,		REAL_IOSTOCK_QTY
                            ,		SLIP_NO
                            FROM	(
                                        SELECT	A.INSTOCK_DATE	AS IOSTOCK_DATE
                                        ,		DECODE(B.SLIP_FG, '1', '본사입고', '-1', '업체반출','')	AS IOSTOCK_FG
                                        ,		DECODE(B.SLIP_FG, '1', '01', '-1', '02','')	            AS IOSTOCK_CD
                                        <if test='unitFg == "0"'>
                                            ,		ABS(B.IN_TOT_QTY)	AS IOSTOCK_QTY
                                            ,		B.IN_TOT_QTY		AS REAL_IOSTOCK_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		ABS(B.IN_TOT_QTY / B.PO_UNIT_QTY)	AS IOSTOCK_QTY
                                            ,		B.IN_TOT_QTY / B.PO_UNIT_QTY		AS REAL_IOSTOCK_QTY
                                        </if>
                                        ,		B.SLIP_NO
                                        FROM	TB_PO_HQ_VENDR_INSTOCK A
                                        ,		TB_PO_HQ_VENDR_INSTOCK_DTL B
                                        ,       TB_HQ_PRODUCT C
                                        WHERE	B.HQ_OFFICE_CD 	=	A.HQ_OFFICE_CD
                                        AND		B.SLIP_NO 		=	A.SLIP_NO
                                        AND     C.HQ_OFFICE_CD  =   B.HQ_OFFICE_CD
                                        AND     C.PROD_CD       =   B.PROD_CD
                                        AND		A.PROC_FG 		=	'1'
                                        AND		B.HQ_OFFICE_CD 	=	#{hqOfficeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND     C.STOCK_PROD_YN =   'Y'
                                        AND     C.USE_YN        =   'Y'
                                        AND		A.INSTOCK_DATE 	BETWEEN #{startDate} AND #{endDate}
                                        UNION ALL
                                        SELECT	DECODE(A.SLIP_FG, '1', A.IN_DATE , '-1', A.OUT_DATE ,'')	AS IOSTOCK_DATE
                                        ,		DECODE(B.SLIP_FG, '1', '본사출고', '-1', '본사반입','')		AS IOSTOCK_FG
                                        ,		DECODE(B.SLIP_FG, '1', '03', '-1', '04','')					AS IOSTOCK_CD
                                        <if test='unitFg == "0"'>
                                            ,		DECODE(B.SLIP_FG, '1', ABS(B.IN_TOT_QTY) , '-1', ABS(B.OUT_TOT_QTY) ,'')	AS IOSTOCK_QTY
                                            ,		DECODE(B.SLIP_FG, '1', (B.IN_TOT_QTY*-1) , '-1', (B.OUT_TOT_QTY*-1) ,'')	AS REAL_IOSTOCK_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		DECODE(B.SLIP_FG, '1', ABS(B.IN_TOT_QTY / B.PO_UNIT_QTY) , '-1', ABS(B.OUT_TOT_QTY / B.PO_UNIT_QTY) ,'')	    AS IOSTOCK_QTY
                                            ,		DECODE(B.SLIP_FG, '1', ((B.IN_TOT_QTY*-1) / B.PO_UNIT_QTY) , '-1', ((B.OUT_TOT_QTY*-1) / B.PO_UNIT_QTY) ,'')	AS REAL_IOSTOCK_QTY
                                        </if>
                                        ,		B.SLIP_NO
                                        FROM	TB_PO_HQ_STORE_OUTSTOCK A
                                        ,		TB_PO_HQ_STORE_OUTSTOCK_DTL B
                                        ,       TB_HQ_PRODUCT C
                                        WHERE	B.HQ_OFFICE_CD 	=	A.HQ_OFFICE_CD
                                        AND		B.SLIP_NO 		=	A.SLIP_NO
                                        AND     C.HQ_OFFICE_CD  =   B.HQ_OFFICE_CD
                                        AND     C.PROD_CD       =   B.PROD_CD
                                        AND		A.SLIP_KIND 	=	'0'
                                        AND		B.HQ_OFFICE_CD 	= 	#{hqOfficeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND		B.PROC_FG		IN  ('20', '30')
                                        AND     C.STOCK_PROD_YN =   'Y'
                                        AND     C.USE_YN        =   'Y'
                                        AND		DECODE(A.SLIP_FG, '1', A.IN_DATE , '-1', A.OUT_DATE ,'') BETWEEN #{startDate} AND #{endDate}
                                        UNION ALL
                                        SELECT	MOVE_DATE
                                        ,		DECODE(MOVE_NM, 'IN_TOT_QTY', '매장이입', 'OUT_TOT_QTY', '매장이출')	AS MOVE_NM
                                        ,		DECODE(MOVE_NM, 'IN_TOT_QTY', '05', 'OUT_TOT_QTY', '06','')			AS IOSTOCK_CD
                                        ,		ABS(TOT_QTY)    AS IOSTOCK_QTY
                                        ,		TOT_QTY         AS REAL_IOSTOCK_QTY
                                        ,		SLIP_NO
                                        FROM	(
                                                    SELECT	A.MOVE_DATE
                                                    <if test='unitFg == "0"'>
                                                        ,		B.IN_TOT_QTY
                                                        ,		B.OUT_TOT_QTY  * -1 AS OUT_TOT_QTY
                                                    </if>
                                                    <if test='unitFg == "1"'>
                                                        ,		(B.IN_TOT_QTY / B.PO_UNIT_QTY)          AS IN_TOT_QTY
                                                        ,		(B.OUT_TOT_QTY  * -1) / B.PO_UNIT_QTY   AS OUT_TOT_QTY
                                                    </if>
                                                    ,		B.SLIP_NO
                                                    FROM	TB_PO_STORE_MOVE A
                                                    ,		TB_PO_STORE_MOVE_DTL B
                                                    ,       TB_HQ_PRODUCT C
                                                    WHERE	B.HQ_OFFICE_CD 	=	A.HQ_OFFICE_CD
                                                    AND		B.SLIP_NO 		=	A.SLIP_NO
                                                    AND     C.HQ_OFFICE_CD  =   B.HQ_OFFICE_CD
                                                    AND     C.PROD_CD       =   B.PROD_CD
                                                    AND		A.PROC_FG 		=	'3'
                                                    AND		B.HQ_OFFICE_CD 	= 	#{hqOfficeCd}
                                                    AND		B.PROD_CD		=	#{prodCd}
                                                    AND     C.STOCK_PROD_YN =   'Y'
                                                    AND     C.USE_YN        =   'Y'
                                                    AND		A.MOVE_DATE 	BETWEEN #{startDate} AND #{endDate}
                                                )
                                        UNPIVOT	(
                                                    TOT_QTY
                                                    FOR	MOVE_NM IN (IN_TOT_QTY, OUT_TOT_QTY)
                                                )
                                        UNION ALL
                                        SELECT	B.ADJ_DATE
                                        ,		'재고조정'
                                        ,		'07'
                                        <if test='unitFg == "0"'>
                                            ,		ABS(B.ADJ_QTY)
                                            ,		B.ADJ_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		ABS(B.ADJ_QTY / B.PO_UNIT_QTY)
                                            ,		B.ADJ_QTY / B.PO_UNIT_QTY
                                        </if>
                                        ,		TO_CHAR(B.SEQ_NO)
                                        FROM	TB_ST_HQ_ADJUST A
                                        ,		TB_ST_HQ_ADJUST_DTL B
                                        ,       TB_HQ_PRODUCT C
                                        WHERE	B.HQ_OFFICE_CD 	=	A.HQ_OFFICE_CD
                                        AND		B.ADJ_DATE 		=	A.ADJ_DATE
                                        AND		B.SEQ_NO		=	A.SEQ_NO
                                        AND     C.HQ_OFFICE_CD  =   B.HQ_OFFICE_CD
                                        AND     C.PROD_CD       =   B.PROD_CD
                                        AND		A.PROC_FG 		=	'1'
                                        AND		B.HQ_OFFICE_CD 	= 	#{hqOfficeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND     C.STOCK_PROD_YN =   'Y'
                                        AND     C.USE_YN        =   'Y'
                                        AND		A.ADJ_DATE 		BETWEEN #{startDate} AND #{endDate}
                                        UNION ALL
                                        SELECT	B.DISUSE_DATE
                                        ,		'재고폐기'
                                        ,		'08'
                                        <if test='unitFg == "0"'>
                                            ,		ABS(B.DISUSE_QTY * -1)
                                            ,		(B.DISUSE_QTY * -1)
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		ABS((B.DISUSE_QTY * -1) / B.PO_UNIT_QTY)
                                            ,		(B.DISUSE_QTY * -1) / B.PO_UNIT_QTY
                                        </if>
                                        ,		TO_CHAR(B.SEQ_NO)
                                        FROM	TB_ST_HQ_DISUSE A
                                        ,		TB_ST_HQ_DISUSE_DTL B
                                        ,       TB_HQ_PRODUCT C
                                        WHERE	B.HQ_OFFICE_CD	=	A.HQ_OFFICE_CD
                                        AND		B.DISUSE_DATE 	=	A.DISUSE_DATE
                                        AND		B.SEQ_NO 		=	A.SEQ_NO
                                        AND     C.HQ_OFFICE_CD  =   B.HQ_OFFICE_CD
                                        AND     C.PROD_CD       =   B.PROD_CD
                                        AND		A.PROC_FG 		=	'1'
                                        AND		B.HQ_OFFICE_CD 	= 	#{hqOfficeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND     C.STOCK_PROD_YN =   'Y'
                                        AND     C.USE_YN        =   'Y'
                                        AND		A.DISUSE_DATE 	BETWEEN #{startDate} AND #{endDate}
                                    )
                            UNION ALL
                            SELECT	'3'					        AS ORDER_NO
                            ,		'조회기간 후'			        AS IOSTOCK_DATE
                            ,		''					        AS IOSTOCK_FG
                            ,		''					        AS IOSTOCK_CD
                            <if test='unitFg == "0"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            <if test='unitFg == "1"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            ,		''					        AS SLIP_NO
                            FROM	TB_ST_HQ_STOCK_DAILY A
                            ,       TB_HQ_PRODUCT B
                            WHERE	B.HQ_OFFICE_CD  =   A.HQ_OFFICE_CD
                            AND     B.PROD_CD       =   A.PROD_CD
                            AND     A.HQ_OFFICE_CD 	=	#{hqOfficeCd}
                            AND		A.PROD_CD		=	#{prodCd}
                            AND		B.STOCK_PROD_YN =	'Y'
                            AND		B.USE_YN	    =	'Y'
                            <![CDATA[
                                AND		A.IOSTOCK_DATE 	>	#{endDate}
                            ]]>
                        )
            </when>
            <when test='orgnFg != null and orgnFg == "S"'>
                SELECT	IOSTOCK_DATE
                ,		IOSTOCK_FG
                ,		IOSTOCK_QTY
                ,		SUM(REAL_IOSTOCK_QTY) OVER (ORDER BY ORDER_NO, IOSTOCK_DATE, IOSTOCK_CD, SLIP_NO)	AS ACC_IOSTOCK_QTY
                FROM	(
                            SELECT	'1'					        AS ORDER_NO
                            ,		'조회기간 전'			        AS IOSTOCK_DATE
                            ,		''					        AS IOSTOCK_FG
                            ,		''					        AS IOSTOCK_CD
                            <if test='unitFg == "0"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            <if test='unitFg == "1"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            ,		''					        AS SLIP_NO
                            FROM	TB_ST_STORE_STOCK_DAILY A
                            ,       TB_MS_PRODUCT B
                            WHERE	B.STORE_CD      =   A.STORE_CD
                            AND     B.PROD_CD       =   A.PROD_CD
                            AND     A.STORE_CD 		=	#{storeCd}
                            AND		A.PROD_CD		=	#{prodCd}
                            AND 	B.STOCK_PROD_YN = 	'Y'
                            AND 	B.USE_YN 		= 	'Y'
                            <![CDATA[
                                AND		A.IOSTOCK_DATE 	<	#{startDate}
                            ]]>
                            UNION ALL
                            SELECT	'2'     AS ORDER_NO
                            ,		TO_CHAR(TO_DATE(IOSTOCK_DATE, 'yyyymmdd'), 'yyyy-mm-dd') AS IOSTOCK_DATE
                            ,		IOSTOCK_FG          AS IOSTOCK_FG
                            ,		IOSTOCK_CD          AS IOSTOCK_CD
                            ,		IOSTOCK_QTY
                            ,		REAL_IOSTOCK_QTY
                            ,		SLIP_NO
                            FROM	(
                                        SELECT	DECODE(A.SLIP_FG, '1', A.IN_DATE , '-1', A.OUT_DATE ,'')	AS IOSTOCK_DATE
                                        ,		DECODE(B.SLIP_FG, '1', '매장입고', '-1', '매장반품','')		AS IOSTOCK_FG
                                        ,		DECODE(B.SLIP_FG, '1', '01', '-1', '02','')					AS IOSTOCK_CD
                                        <if test='unitFg == "0"'>
                                            ,		DECODE(B.SLIP_FG, '1', B.IN_TOT_QTY , '-1', (B.OUT_TOT_QTY * -1) ,'')	    AS IOSTOCK_QTY
                                            ,		DECODE(B.SLIP_FG, '1', (B.IN_TOT_QTY) , '-1', (B.OUT_TOT_QTY) ,'')	        AS REAL_IOSTOCK_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		DECODE(B.SLIP_FG, '1', B.IN_TOT_QTY / B.PO_UNIT_QTY , '-1', (B.OUT_TOT_QTY * -1 / B.PO_UNIT_QTY) ,'')	    AS IOSTOCK_QTY
                                            ,		DECODE(B.SLIP_FG, '1', ((B.IN_TOT_QTY) / B.PO_UNIT_QTY) , '-1', ((B.OUT_TOT_QTY) / B.PO_UNIT_QTY) ,'')	AS REAL_IOSTOCK_QTY
                                        </if>
                                        ,		B.SLIP_NO || B.SEQ  AS SLIP_NO
                                        FROM	TB_PO_HQ_STORE_OUTSTOCK A
                                        ,		TB_PO_HQ_STORE_OUTSTOCK_DTL B
                                        ,       TB_HQ_PRODUCT C
                                        WHERE	B.HQ_OFFICE_CD 	=	A.HQ_OFFICE_CD
                                        AND		B.SLIP_NO 		=	A.SLIP_NO
                                        AND		C.HQ_OFFICE_CD 	=	B.HQ_OFFICE_CD
                                        AND		C.PROD_CD 		=	B.PROD_CD
                                        AND		A.SLIP_KIND 	=	'0'
                                        AND		B.HQ_OFFICE_CD 	= 	#{hqOfficeCd}
                                        AND		B.STORE_CD 		=	#{storeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND		B.PROC_FG		IN  ('20', '30')
                                        AND		C.STOCK_PROD_YN =	'Y'
                                        AND		C.USE_YN	    =	'Y'
                                        AND		DECODE(A.SLIP_FG, '1', A.IN_DATE , '-1', A.OUT_DATE ,'') BETWEEN #{startDate} AND #{endDate}
                                        UNION ALL
                                        SELECT	A.INSTOCK_DATE	AS IOSTOCK_DATE
                                        ,		DECODE(B.SLIP_FG, '1', '사입입고', '-1', '사입반품','')	AS IOSTOCK_FG
                                        ,		DECODE(B.SLIP_FG, '1', '03', '-1', '04','')	            AS IOSTOCK_CD
                                        <if test='unitFg == "0"'>
                                            ,		B.IN_TOT_QTY	    AS IOSTOCK_QTY
                                            ,		B.IN_TOT_QTY		AS REAL_IOSTOCK_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		B.IN_TOT_QTY / B.PO_UNIT_QTY	    AS IOSTOCK_QTY
                                            ,		B.IN_TOT_QTY / B.PO_UNIT_QTY		AS REAL_IOSTOCK_QTY
                                        </if>
                                        ,		B.SLIP_NO
                                        FROM	TB_PO_STORE_VENDR_INSTOCK A
                                        ,		TB_PO_STORE_VENDR_INSTOCK_DTL B
                                        ,       TB_MS_PRODUCT C
                                        WHERE	B.STORE_CD 		=	A.STORE_CD
                                        AND		B.SLIP_NO 		=	A.SLIP_NO
                                        AND     C.STORE_CD      =   B.STORE_CD
                                        AND     C.PROD_CD       =   B.PROD_CD
                                        AND		A.PROC_FG 		=	'1'
                                        AND		B.STORE_CD 		=	#{storeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND		C.STOCK_PROD_YN =	'Y'
                                        AND		C.USE_YN	    =	'Y'
                                        AND		A.INSTOCK_DATE 	BETWEEN #{startDate} AND #{endDate}
                                        UNION ALL
                                        SELECT  A.SALE_DATE     AS IOSTOCK_DATE
                                        ,		'매장판매'       AS IOSTOCK_FG
                                        ,		'05'            AS IOSTOCK_CD
                                        <if test='unitFg == "0"'>
                                            ,       A.TOT_SALE_QTY 	        AS  IOSTOCK_QTY
                                            ,       (A.TOT_SALE_QTY * -1) 	AS  REAL_IOSTOCK_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,       (A.TOT_SALE_QTY / B.PO_UNIT_QTY) 	    AS  IOSTOCK_QTY
                                            ,       (A.TOT_SALE_QTY * -1) / B.PO_UNIT_QTY 	AS  REAL_IOSTOCK_QTY
                                        </if>
                                        ,		''          AS SLIP_NO
                                        FROM    TB_SL_DAILY_PROD A
                                        , 		TB_MS_PRODUCT B
                                        WHERE   A.STORE_CD 		= 	B.STORE_CD
                                        AND 	A.PROD_CD 		= 	B.PROD_CD
                                        AND		A.STORE_CD   	=   #{storeCd}
                                        AND 	A.PROD_CD    	=   #{prodCd}   /* 상품코드 */
                                        AND 	B.STOCK_PROD_YN = 	'Y'
                                        AND 	B.USE_YN 		= 	'Y'
                                        AND 	A.SALE_DATE  	BETWEEN #{startDate} AND #{endDate}
                                        UNION ALL
                                        SELECT	MOVE_DATE       AS IOSTOCK_DATE
                                        ,		DECODE(MOVE_NM, 'IN_TOT_QTY', '매장이입', 'OUT_TOT_QTY', '매장이출')	AS IOSTOCK_FG
                                        ,		DECODE(MOVE_NM, 'IN_TOT_QTY', '06', 'OUT_TOT_QTY', '07','')			AS IOSTOCK_CD
                                        ,		ABS(TOT_QTY)    AS  IOSTOCK_QTY
                                        ,		TOT_QTY         AS  REAL_IOSTOCK_QTY
                                        ,		SLIP_NO
                                        FROM	(
                                                    SELECT	A.MOVE_DATE
                                                    <if test='unitFg == "0"'>
                                                        ,		DECODE(A.IN_STORE_CD, #{storeCd}, B.IN_TOT_QTY, '')	AS IN_TOT_QTY
                                                        ,		DECODE(A.OUT_STORE_CD, #{storeCd}, B.OUT_TOT_QTY * -1, '') AS OUT_TOT_QTY
                                                    </if>
                                                    <if test='unitFg == "1"'>
                                                        ,		DECODE(A.IN_STORE_CD, #{storeCd}, (B.IN_TOT_QTY / B.PO_UNIT_QTY) , '')	AS IN_TOT_QTY
                                                        ,		DECODE(A.OUT_STORE_CD, #{storeCd}, (B.OUT_TOT_QTY * -1 / B.PO_UNIT_QTY), '') AS OUT_TOT_QTY
                                                    </if>
                                                    ,		B.SLIP_NO
                                                    FROM	TB_PO_STORE_MOVE A
                                                    ,		TB_PO_STORE_MOVE_DTL B
                                                    ,		TB_HQ_PRODUCT C
                                                    WHERE	B.HQ_OFFICE_CD 	=	A.HQ_OFFICE_CD
                                                    AND		B.SLIP_NO 		=	A.SLIP_NO
                                                    AND		C.HQ_OFFICE_CD 	=	B.HQ_OFFICE_CD
                                                    AND		C.PROD_CD 		=	B.PROD_CD
                                                    AND		(A.IN_STORE_CD 	=	#{storeCd} OR A.OUT_STORE_CD	=	#{storeCd})
                                                    AND		A.PROC_FG 		=	'3'
                                                    AND		B.HQ_OFFICE_CD 	= 	#{hqOfficeCd}
                                                    AND		B.PROD_CD		=	#{prodCd}
                                                    AND 	C.STOCK_PROD_YN = 	'Y'
                                                    AND 	C.USE_YN 		= 	'Y'
                                                    AND		A.MOVE_DATE 	BETWEEN #{startDate} AND #{endDate}
                                                )
                                        UNPIVOT	(
                                                    TOT_QTY
                                                    FOR	MOVE_NM IN (IN_TOT_QTY, OUT_TOT_QTY)
                                                )
                                        UNION ALL
                                        SELECT	B.ADJ_DATE      AS IOSTOCK_DATE
                                        ,		'재고조정'       AS IOSTOCK_FG
                                        ,		'08'            AS IOSTOCK_CD
                                        <if test='unitFg == "0"'>
                                            ,		B.ADJ_QTY       AS  IOSTOCK_QTY
                                            ,		B.ADJ_QTY       AS  REAL_IOSTOCK_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		B.ADJ_QTY / B.PO_UNIT_QTY       AS  IOSTOCK_QTY
                                            ,		B.ADJ_QTY / B.PO_UNIT_QTY       AS  REAL_IOSTOCK_QTY
                                        </if>
                                        ,		TO_CHAR(B.SEQ_NO)       AS SLIP_NO
                                        FROM	TB_ST_STORE_ADJUST A
                                        ,		TB_ST_STORE_ADJUST_DTL B
                                        ,		TB_MS_PRODUCT C
                                        WHERE	B.STORE_CD 		=	A.STORE_CD
                                        AND		B.ADJ_DATE 		=	A.ADJ_DATE
                                        AND		B.SEQ_NO		=	A.SEQ_NO
                                        AND     C.STORE_CD      =   B.STORE_CD
                                        AND     C.PROD_CD       =   B.PROD_CD
                                        AND		A.PROC_FG 		=	'1'
                                        AND		B.STORE_CD 		= 	#{storeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND 	C.STOCK_PROD_YN = 	'Y'
                                        AND 	C.USE_YN 		= 	'Y'
                                        AND		A.ADJ_DATE 		BETWEEN #{startDate} AND #{endDate}
                                        UNION ALL
                                        SELECT	B.DISUSE_DATE    AS IOSTOCK_DATE
                                        ,		'재고폐기'        AS IOSTOCK_FG
                                        ,		'09'             AS IOSTOCK_CD
                                        <if test='unitFg == "0"'>
                                            ,		(B.DISUSE_QTY)         AS  IOSTOCK_QTY
                                            ,		(B.DISUSE_QTY * -1)         AS  REAL_IOSTOCK_QTY
                                        </if>
                                        <if test='unitFg == "1"'>
                                            ,		B.DISUSE_QTY / B.PO_UNIT_QTY                AS  IOSTOCK_QTY
                                            ,		(B.DISUSE_QTY * -1) / B.PO_UNIT_QTY         AS  REAL_IOSTOCK_QTY
                                        </if>
                                        ,		TO_CHAR(B.SEQ_NO)   AS SLIP_NO
                                        FROM	TB_ST_STORE_DISUSE A
                                        ,		TB_ST_STORE_DISUSE_DTL B
                                        ,		TB_MS_PRODUCT C
                                        WHERE	B.STORE_CD		=	A.STORE_CD
                                        AND		B.DISUSE_DATE 	=	A.DISUSE_DATE
                                        AND		B.SEQ_NO 		=	A.SEQ_NO
                                        AND     C.STORE_CD      =   B.STORE_CD
                                        AND     C.PROD_CD       =   B.PROD_CD
                                        AND		A.PROC_FG 		=	'1'
                                        AND		B.STORE_CD 		= 	#{storeCd}
                                        AND		B.PROD_CD		=	#{prodCd}
                                        AND 	C.STOCK_PROD_YN = 	'Y'
                                        AND 	C.USE_YN 		= 	'Y'
                                        AND		A.DISUSE_DATE 	BETWEEN #{startDate} AND #{endDate}
                                    )
                            UNION ALL
                            SELECT	'3'					        AS ORDER_NO
                            ,		'조회기간 후'			        AS IOSTOCK_DATE
                            ,		''					        AS IOSTOCK_FG
                            ,		''					        AS IOSTOCK_CD
                            <if test='unitFg == "0"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            <if test='unitFg == "1"'>
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS IOSTOCK_QTY
                                ,		NVL(SUM(A.IOSTOCK_QTY / A.PO_UNIT_QTY),0)	AS REAL_IOSTOCK_QTY
                            </if>
                            ,		''					        AS SLIP_NO
                            FROM	TB_ST_STORE_STOCK_DAILY A
                            ,       TB_MS_PRODUCT B
                            WHERE	B.STORE_CD      =   A.STORE_CD
                            AND     B.PROD_CD       =   A.PROD_CD
                            AND     A.STORE_CD 		=	#{storeCd}
                            AND		A.PROD_CD		=	#{prodCd}
                            AND 	B.STOCK_PROD_YN = 	'Y'
                            AND 	B.USE_YN 		= 	'Y'
                            <![CDATA[
                                AND		A.IOSTOCK_DATE 	>	#{endDate}
                            ]]>
                        )
            </when>
        </choose>
    </select>
</mapper>
